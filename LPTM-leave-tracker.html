<!doctype html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
  <meta name="viewport"
    content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Leave/Holidays Tracker | LPTM</title>
    
    <!-- 
      CONFLUENCE MACRO REQUIRED: Include global-notifications.html as a macro
      This provides showSuccessToast(), showErrorToast(), showWarningToast(), showInfoToast()
    -->
    
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    
    <!-- Alpine.js CDN (for tabs) -->
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    
    <!-- ApexCharts CDN -->
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
    
    <!-- Tailwind Config -->
    <script>
      tailwind.config = {
        darkMode: 'class',
        theme: {
          extend: {
            colors: {
              brand: {
                25: '#f2f7ff',
                50: '#ecf3ff',
                100: '#dde9ff',
                200: '#c2d6ff',
                300: '#9cb9ff',
                400: '#7592ff',
                500: '#465fff',
                600: '#3641f5',
                700: '#2a31d8',
                800: '#252dae',
                900: '#262e89',
                950: '#161950',
              },
              success: {
                25: '#f6fef9',
                50: '#ecfdf3',
                100: '#d1fadf',
                200: '#a6f4c5',
                300: '#6ce9a6',
                400: '#32d583',
                500: '#12b76a',
                600: '#039855',
                700: '#027a48',
                800: '#05603a',
                900: '#054f31',
                950: '#053321',
              },
              error: {
                25: '#fffbfa',
                50: '#fef3f2',
                100: '#fee4e2',
                200: '#fecdca',
                300: '#fda29b',
                400: '#f97066',
                500: '#f04438',
                600: '#d92d20',
                700: '#b42318',
                800: '#912018',
                900: '#7a271a',
                950: '#55160c',
              },
              warning: {
                25: '#fffcf5',
                50: '#fffaeb',
                100: '#fef0c7',
                200: '#fedf89',
                300: '#fec84b',
                400: '#fdb022',
                500: '#f79009',
                600: '#dc6803',
                700: '#b54708',
                800: '#93370d',
                900: '#7a2e0e',
                950: '#4e1d09',
              },
              orange: {
                25: '#fffaf5',
                50: '#fff6ed',
                100: '#ffead5',
                200: '#fddcab',
                300: '#feb273',
                400: '#fd853a',
                500: '#fb6514',
                600: '#ec4a0a',
                700: '#c4320a',
                800: '#9c2a10',
                900: '#7e2410',
                950: '#511c10',
              },
              gray: {
                25: '#fcfcfd',
                50: '#f9fafb',
                100: '#f2f4f7',
                200: '#e4e7ec',
                300: '#d0d5dd',
                400: '#98a2b3',
                500: '#667085',
                600: '#475467',
                700: '#344054',
                800: '#1d2939',
                900: '#101828',
                950: '#0c111d',
                dark: '#1a2231',
              },
            },
            fontSize: {
              'theme-xl': ['20px', '30px'],
              'theme-sm': ['14px', '20px'],
              'theme-xs': ['12px', '18px'],
            },
            boxShadow: {
              'theme-md': '0px 4px 8px -2px rgba(16, 24, 40, 0.1), 0px 2px 4px -2px rgba(16, 24, 40, 0.06)',
              'theme-lg': '0px 12px 16px -4px rgba(16, 24, 40, 0.08), 0px 4px 6px -2px rgba(16, 24, 40, 0.03)',
              'theme-sm': '0px 1px 3px 0px rgba(16, 24, 40, 0.1), 0px 1px 2px 0px rgba(16, 24, 40, 0.06)',
              'theme-xs': '0px 1px 2px 0px rgba(16, 24, 40, 0.05)',
              'theme-xl': '0px 20px 24px -4px rgba(16, 24, 40, 0.08), 0px 8px 8px -4px rgba(16, 24, 40, 0.03)',
            },
            zIndex: {
              1: '1',
              9: '9',
              99: '99',
              999: '999',
              9999: '9999',
              99999: '99999',
              999999: '999999',
            },
            screens: {
              '2xsm': '375px',
              'xsm': '425px',
              '3xl': '2000px',
            },
          },
        },
      }
    </script>
    
    <style>
      [x-cloak] {
        display: none !important;
      }
      
      body {
        font-family: 'Outfit', sans-serif;
      }
      
      .no-scrollbar::-webkit-scrollbar {
        display: none;
      }

      .no-scrollbar {
        -ms-overflow-style: none;
        scrollbar-width: none;
      }
      
        .custom-scrollbar::-webkit-scrollbar {
            width: 6px;
        height: 6px;
        }

        .custom-scrollbar::-webkit-scrollbar-track {
        border-radius: 9999px;
        }

        .custom-scrollbar::-webkit-scrollbar-thumb {
        border-radius: 9999px;
        background-color: #e4e7ec;
      }

      .dark .custom-scrollbar::-webkit-scrollbar-thumb {
        background-color: #344054;
      }
      
      /* Dark mode body and main */
      :root {
        --card-bg: white;
        --input-bg: transparent;
      }

      .dark {
        --card-bg: #26292b;
        --input-bg: #1a1d1e;
      }

      .dark body {
        background-color: #0a0b0b;
      }

      .dark main {
        background-color: #0a0b0b;
      }

      .dark input[type="text"],
      .dark input[type="date"],
      .dark input[type="email"],
      .dark select {
        background-color: var(--input-bg) !important;
        border-color: #3a3d3f !important;
      }
      
      /* Hide native date input calendar icon */
      input[type="date"]::-webkit-calendar-picker-indicator {
        opacity: 0;
        cursor: pointer;
        position: absolute;
        right: 0;
        width: 100%;
        height: 100%;
      }
      
      input[type="date"]::-webkit-inner-spin-button,
      input[type="date"]::-webkit-clear-button {
        display: none;
      }
      
      /* Dark mode table styling */
      .dark thead {
        background-color: #1a1d1e !important;
        border-color: #3a3d3f !important;
      }
      
      .dark tbody {
        border-color: #3a3d3f !important;
      }
      
      .dark tbody tr {
        border-color: #3a3d3f !important;
      }
      
    .dark .divide-gray-100>* {
        border-color: #3a3d3f !important;
      }
      
      .dark .border-gray-100 {
        border-color: #3a3d3f !important;
      }
      
      .dark .border-gray-200 {
        border-color: #3a3d3f !important;
      }
      
      .dark .border-gray-800 {
        border-color: #3a3d3f !important;
      }
      
    .dark .divide-gray-800>* {
        border-color: #3a3d3f !important;
      }
      
      /* Modal and input consistency */
      .dark .modal-dialog {
        background-color: var(--card-bg) !important;
      }
      
      .dark .bg-gray-50 {
        background-color: #1a1d1e !important;
      }
      
      .dark .bg-gray-100 {
        background-color: #2a2d2f !important;
      }
      
      .dark .bg-gray-700 {
        background-color: #1a1d1e !important;
      }
      
      .dark .border-gray-300 {
        border-color: #3a3d3f !important;
      }
      
      .dark .border-gray-700 {
        border-color: #3a3d3f !important;
      }
      
      /* Remove any blue tints from hover states */
      .dark .hover\:bg-gray-50:hover {
        background-color: #2a2d2f !important;
      }
      
      .dark .hover\:bg-gray-200:hover {
        background-color: #3a3d3f !important;
      }
      
      /* Date picker styling to ensure proper functionality */
      input[type="date"] {
        position: relative;
        cursor: pointer;
      }
      
      input[type="date"]::-webkit-calendar-picker-indicator {
        cursor: pointer;
        opacity: 1;
        display: block;
        background: transparent;
        bottom: 0;
        color: transparent;
        height: auto;
        left: 0;
        position: absolute;
        right: 0;
        top: 0;
        width: auto;
      }
      
      /* Form check input styles */
    .form-check-input:checked~span {
        border-color: #465fff;
        border-width: 6px;
      }

    .dark .form-check-input:checked~span {
        border-color: #465fff;
      }
    </style>
</head>

  <body class="bg-gray-50 dark:bg-gray-950">
    <!-- ===== Main Content Start ===== -->
    <main class="min-h-screen bg-gray-50 dark:bg-gray-950">
      <div class="mx-auto max-w-[1536px] p-4 md:p-6">
      <div class="rounded-2xl border border-gray-200 bg-white dark:border-gray-800"
        style="background-color: var(--card-bg, white);">
          <div class="px-5 py-4 sm:px-6 sm:py-5">
            <h3 class="!text-2xl font-medium text-gray-800 dark:text-white/90">
              Leave & Holidays Tracker
            </h3>
          <p class="mt-1 !text-base text-gray-500 dark:text-gray-400">
              Manage team leave requests and track holidays across your organization
            </p>
          </div>
          <div class="border-t border-gray-100 p-5 sm:p-6 dark:border-gray-800">
            
            <!-- Action Buttons -->
            <div class="mb-6 flex items-center justify-end gap-3">
              <button id="addLeaveButton"
                class="flex items-center gap-2 rounded-lg border border-brand-500 bg-brand-500 px-4 py-2.5 !text-base font-medium text-white hover:bg-brand-600 transition-all duration-200">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                    </svg>
                Add Leave
                  </button>
              <button id="manageTeamButton"
                class="flex items-center gap-2 rounded-lg border border-gray-300 bg-white px-4 py-2.5 !text-base font-medium text-gray-700 hover:bg-gray-50 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-300 dark:hover:bg-gray-700 transition-all duration-200">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"></path>
                    </svg>
                Manage Team
                  </button>
              <button id="fetchHolidaysButton"
                class="flex items-center gap-2 rounded-lg border border-green-500 bg-green-500 px-4 py-2.5 !text-base font-medium text-white hover:bg-green-600 transition-all duration-200">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                </svg>
                Fetch Holidays
              </button>
              <button id="downloadOutlookButton"
                class="flex items-center gap-2 rounded-lg border border-indigo-500 bg-indigo-500 px-4 py-2.5 !text-base font-medium text-white hover:bg-indigo-600 transition-all duration-200">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                </svg>
                Download Outlook
              </button>
              </div>

            <!-- Timeline Section -->
            <div class="rounded-2xl border border-gray-200 bg-white p-6 mb-6 dark:border-gray-800"
              style="background-color: var(--card-bg, white); overflow: visible;">
              <!-- Date Range and Week Selector -->
              <div class="mb-6 flex flex-col gap-4" style="overflow: visible;">
                <div class="flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between">
                  <div>
                    <h3 class="!text-lg font-semibold text-gray-800 dark:text-white/90">Team Leave Timeline</h3>
                    <p class="mt-1 !text-base text-gray-500 dark:text-gray-400">View and manage leave across your team</p>
                  </div>
                  <div class="flex flex-wrap items-center gap-4" style="position: relative; z-index: 50;">
                    <!-- Quick Filter -->
                    <div class="flex flex-col gap-1.5" x-data="{selectedRange: 'week'}">
                      <span class="!text-base font-medium text-gray-700 dark:text-gray-300 tracking-wide text-center">View</span>
                      <div class="flex items-center gap-0.5 rounded-lg bg-gray-100 p-0.5 dark:bg-gray-900">
                        <button @click="selectedRange = 'week'" x-on:click="selectTimelineRange('week')" :class="selectedRange === 'week' ? 'shadow-theme-xs text-gray-900 dark:text-white bg-white dark:bg-gray-800' : 'text-gray-500 dark:text-gray-400'" class="hover:text-gray-900 dark:hover:text-white rounded-md px-3.5 py-2.5 !text-base font-medium transition-colors">
                          Week
                        </button>
                        <button @click="selectedRange = 'month'" x-on:click="selectTimelineRange('month')" :class="selectedRange === 'month' ? 'shadow-theme-xs text-gray-900 dark:text-white bg-white dark:bg-gray-800' : 'text-gray-500 dark:text-gray-400'" class="hover:text-gray-900 dark:hover:text-white rounded-md px-3.5 py-2.5 !text-base font-medium transition-colors">
                          Month
                        </button>
                        <button @click="selectedRange = 'quarter'" x-on:click="selectTimelineRange('quarter')" :class="selectedRange === 'quarter' ? 'shadow-theme-xs text-gray-900 dark:text-white bg-white dark:bg-gray-800' : 'text-gray-500 dark:text-gray-400'" class="hover:text-gray-900 dark:hover:text-white rounded-md px-3.5 py-2.5 !text-base font-medium transition-colors">
                          Quarter
                        </button>
                        <button @click="selectedRange = 'year'" x-on:click="selectTimelineRange('year')" :class="selectedRange === 'year' ? 'shadow-theme-xs text-gray-900 dark:text-white bg-white dark:bg-gray-800' : 'text-gray-500 dark:text-gray-400'" class="hover:text-gray-900 dark:hover:text-white rounded-md px-3.5 py-2.5 !text-base font-medium transition-colors">
                          Year
                        </button>
                      </div>
                    </div>
                    
                    <!-- Custom Date Range -->
                    <div class="flex flex-col gap-1.5">
                      <span class="!text-base font-medium text-gray-700 text-center dark:text-gray-300 tracking-wide">Custom Range</span>
                      <div class="flex items-center gap-2" style="position: relative;">
                        <input type="date" id="timelineStartDate" class="h-9 rounded-lg border border-gray-300 bg-white px-3 py-1.5 !text-base text-gray-800 focus:border-brand-500 focus:ring-2 focus:ring-brand-500/10 focus:outline-none dark:border-gray-700 dark:bg-gray-800 dark:text-white" style="position: relative; z-index: 100;" />
                        <span class="text-gray-500 dark:text-gray-400">to</span>
                        <input type="date" id="timelineEndDate" class="h-9 rounded-lg border border-gray-300 bg-white px-3 py-1.5 !text-base text-gray-800 focus:border-brand-500 focus:ring-2 focus:ring-brand-500/10 focus:outline-none dark:border-gray-700 dark:bg-gray-800 dark:text-white" style="position: relative; z-index: 100;" />
                      </div>
                    </div>
                  </div>
                  </div>
                </div>

              <!-- Timeline Grid -->
              <div class="overflow-x-auto no-scrollbar rounded-lg border border-gray-200 dark:border-gray-700">
                <table class="min-w-full">
                  <thead>
                    <tr>
                      <th class="sticky left-0 z-20 border-r border-b border-gray-200 bg-gray-50 px-4 py-3 text-left dark:border-gray-700 dark:bg-gray-800">
                        <span class="!text-base font-medium text-gray-700 dark:text-gray-300">Team Member</span>
                      </th>
                      <!-- Date columns will be generated here -->
                    </tr>
                  </thead>
                  <tbody id="timelineTableBody">
                    <!-- Timeline rows will be generated here -->
                  </tbody>
                </table>
              </div>

              <!-- Legend -->
              <div class="mt-4 flex flex-wrap items-center gap-4">
                <span class="!text-base font-medium text-gray-700 dark:text-gray-300">Legend:</span>
                <div class="flex items-center gap-2">
                  <span class="inline-block h-6 w-12 rounded bg-green-100 border border-gray-200 dark:bg-gray-800/50 dark:border-gray-700"></span>
                  <span class="!text-base text-gray-600 dark:text-gray-400">Annual</span>
                </div>
                <div class="flex items-center gap-2">
                  <span class="inline-block h-6 w-12 rounded bg-red-100 border border-gray-200 dark:bg-gray-800/50 dark:border-gray-700"></span>
                  <span class="!text-base text-gray-600 dark:text-gray-400">Sick</span>
                </div>
                <div class="flex items-center gap-2">
                  <span class="inline-block h-6 w-12 rounded bg-purple-100 border border-gray-200 dark:bg-gray-800/50 dark:border-gray-700"></span>
                  <span class="!text-base text-gray-600 dark:text-gray-400">Public</span>
                </div>
                <div class="flex items-center gap-2">
                  <span class="inline-block h-6 w-12 rounded bg-amber-100 border border-gray-200 dark:bg-gray-800/50 dark:border-gray-700"></span>
                  <span class="!text-base text-gray-600 dark:text-gray-400">Other</span>
                </div>
                <div class="flex items-center gap-2">
                  <span class="inline-block h-6 w-12 rounded bg-gray-50 border border-gray-200 dark:bg-gray-800/50 dark:border-gray-700"></span>
                  <span class="!text-base text-gray-600 dark:text-gray-400">Weekend</span>
                </div>
              </div>
                </div>

            <!-- Summary Section -->
            <div class="mb-6">
                  <div class="grid grid-cols-12 gap-4 md:gap-6">
                    
                    <!-- Metric Cards -->
                    <div class="col-span-12">
                    <div class="grid grid-cols-1 gap-4 sm:grid-cols-2 md:gap-6 xl:grid-cols-4">
                        
                        <!-- Total Leaves -->
                      <div class="rounded-2xl border border-gray-200 bg-white px-6 pb-5 pt-6 dark:border-gray-800"
                        style="background-color: var(--card-bg, white);">
                          <div class="mb-6 flex items-center gap-3">
                          <div
                            class="flex h-10 w-10 items-center justify-center rounded-full bg-blue-100 dark:bg-blue-900/20">
                            <svg class="h-6 w-6 text-blue-600 dark:text-blue-400" fill="none" stroke="currentColor"
                              viewBox="0 0 24 24">
                              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z">
                              </path>
                              </svg>
                            </div>
                            <div>
                              <h3 class="text-base font-semibold text-gray-800 dark:text-white/90">Total Leaves</h3>
                            <span class="block !text-base text-gray-500 dark:text-gray-400">This year</span>
                            </div>
                          </div>
                          <div class="flex items-end justify-between">
                            <div>
                            <h4 id="total-leaves-count"
                              class="!text-3xl font-bold text-gray-800 leading-none dark:text-white/90">0</h4>
                            </div>
                          </div>
                        </div>

                        <!-- Annual Leave -->
                      <div class="rounded-2xl border border-gray-200 bg-white px-6 pb-5 pt-6 dark:border-gray-800"
                        style="background-color: var(--card-bg, white);">
                          <div class="mb-6 flex items-center gap-3">
                          <div
                            class="flex h-10 w-10 items-center justify-center rounded-full bg-green-100 dark:bg-green-900/20">
                            <svg class="h-6 w-6 text-green-600 dark:text-green-400" fill="none" stroke="currentColor"
                              viewBox="0 0 24 24">
                              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                              </svg>
                            </div>
                            <div>
                              <h3 class="text-base font-semibold text-gray-800 dark:text-white/90">Annual</h3>
                            <span class="block !text-base text-gray-500 dark:text-gray-400">Vacation days</span>
                            </div>
                          </div>
                          <div class="flex items-end justify-between gap-3">
                            <div>
                            <h4 id="annual-leave-count"
                              class="!text-3xl font-bold text-gray-800 leading-none dark:text-white/90">0</h4>
                            </div>
                          <span
                            class="flex items-center gap-1 rounded-full bg-success-50 px-3 py-1 !text-xl font-bold text-success-600 leading-none dark:bg-success-500/15 dark:text-success-500"
                            id="annual-percentage">
                              0%
                            </span>
                          </div>
                        </div>

                        <!-- Sick Leave -->
                      <div class="rounded-2xl border border-gray-200 bg-white px-6 pb-5 pt-6 dark:border-gray-800"
                        style="background-color: var(--card-bg, white);">
                          <div class="mb-6 flex items-center gap-3">
                          <div
                            class="flex h-10 w-10 items-center justify-center rounded-full bg-red-100 dark:bg-red-900/20">
                            <svg class="h-6 w-6 text-red-600 dark:text-red-400" fill="none" stroke="currentColor"
                              viewBox="0 0 24 24">
                              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z">
                              </path>
                              </svg>
                            </div>
                            <div>
                              <h3 class="text-base font-semibold text-gray-800 dark:text-white/90">Sick</h3>
                            <span class="block !text-base text-gray-500 dark:text-gray-400">Medical leave</span>
                            </div>
                          </div>
                          <div class="flex items-end justify-between gap-3">
                            <div>
                            <h4 id="sick-leave-count"
                              class="!text-3xl font-bold text-gray-800 leading-none dark:text-white/90">0</h4>
                            </div>
                          <span
                            class="flex items-center gap-1 rounded-full bg-error-50 px-3 py-1 !text-xl font-bold text-error-600 leading-none dark:bg-error-500/15 dark:text-error-500"
                            id="sick-percentage">
                              0%
                            </span>
                          </div>
                        </div>

                        <!-- Public Holidays -->
                      <div class="rounded-2xl border border-gray-200 bg-white px-6 pb-5 pt-6 dark:border-gray-800"
                        style="background-color: var(--card-bg, white);">
                          <div class="mb-6 flex items-center gap-3">
                          <div
                            class="flex h-10 w-10 items-center justify-center rounded-full bg-purple-100 dark:bg-purple-900/20">
                            <svg class="h-6 w-6 text-purple-600 dark:text-purple-400" fill="none" stroke="currentColor"
                              viewBox="0 0 24 24">
                              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                              </svg>
                            </div>
                            <div>
                              <h3 class="text-base font-semibold text-gray-800 dark:text-white/90">Public</h3>
                            <span class="block !text-base text-gray-500 dark:text-gray-400">Holidays</span>
                            </div>
                          </div>
                          <div class="flex items-end justify-between gap-3">
                            <div>
                            <h4 id="public-leave-count"
                              class="!text-3xl font-bold text-gray-800 leading-none dark:text-white/90">0</h4>
                            </div>
                          <span
                            class="flex items-center gap-1 rounded-full bg-success-50 px-3 py-1 !text-xl font-bold text-success-600 leading-none dark:bg-success-500/15 dark:text-success-500"
                            id="public-percentage">
                              0%
                            </span>
                          </div>
                        </div>


                      </div>
                    </div>

                    <!-- Charts Row -->
                    <div class="col-span-12 grid grid-cols-1 gap-4 md:gap-6 lg:grid-cols-2">
                      
                      <!-- Leave Trends Chart -->
                    <div class="rounded-2xl border border-gray-200 bg-white px-5 pb-5 pt-5 dark:border-gray-800"
                      style="background-color: var(--card-bg, white);">
                        <div class="mb-6 flex flex-col gap-5 sm:flex-row sm:items-center sm:justify-between">
                          <div>
                            <h3 class="!text-lg font-semibold text-gray-800 dark:text-white/90">Leave Trends</h3>
                          <p class="mt-1 !text-base text-gray-500 dark:text-gray-400">Monthly leave distribution across
                            the year</p>
                          </div>
                        </div>
                      <div>
                        <div id="leaveTrendsChart"></div>
                        </div>
                      </div>

                      <!-- Leave Breakdown Chart -->
                    <div class="rounded-2xl border border-gray-200 bg-white px-5 pb-5 pt-5 dark:border-gray-800"
                      style="background-color: var(--card-bg, white);">
                        <div class="mb-6 flex items-center justify-between">
                          <div>
                            <h3 class="!text-lg font-semibold text-gray-800 dark:text-white/90">Leave Breakdown</h3>
                          <p class="mt-1 !text-base text-gray-500 dark:text-gray-400">Distribution by leave type</p>
                          </div>
                        </div>
                        <div>
                        <div id="leaveBreakdownChart"></div>
                        </div>
                      </div>

                    </div>

                    <!-- Recent Leave Requests Table -->
                    <div class="col-span-12">
                    <div class="rounded-2xl border border-gray-200 bg-white dark:border-gray-800"
                      style="background-color: var(--card-bg, white);">
                      <!-- Header with Title, Filter, and Search -->
                      <div class="px-6 py-4 border-b border-gray-200 dark:border-gray-800">
                        <div class="flex flex-col gap-3 lg:flex-row lg:items-center lg:justify-between">
                          <!-- Title -->
                          <div class="flex-shrink-0">
                            <h3 class="!text-lg font-semibold text-gray-800 dark:text-white/90">Recent Leave Requests
                            </h3>
                            <p class="mt-1 !text-base text-gray-500 dark:text-gray-400">Comprehensive details for recent
                              leave submissions</p>
                          </div>
                          <!-- Filter Toggle and Search -->
                          <div class="flex flex-col gap-3 sm:flex-row sm:items-center">
                            <!-- Filter Toggle -->
                            <div class="flex flex-col gap-1.5" x-data="{selectedFilter: 'top10'}">
                              <div class="flex items-center gap-0.5 rounded-lg bg-gray-100 p-0.5 dark:bg-gray-900">
                                <button @click="selectedFilter = 'top10'" x-on:click="setLeaveFilter('top10')" :class="selectedFilter === 'top10' ? 'shadow-theme-xs text-gray-900 dark:text-white bg-white dark:bg-gray-800' : 'text-gray-500 dark:text-gray-400'" class="hover:text-gray-900 dark:hover:text-white rounded-md px-3.5 py-2.5 !text-base font-medium transition-colors">
                                  Top 10
                                </button>
                                <button @click="selectedFilter = 'all'" x-on:click="setLeaveFilter('all')" :class="selectedFilter === 'all' ? 'shadow-theme-xs text-gray-900 dark:text-white bg-white dark:bg-gray-800' : 'text-gray-500 dark:text-gray-400'" class="hover:text-gray-900 dark:hover:text-white rounded-md px-3.5 py-2.5 !text-base font-medium transition-colors">
                                  All
                                </button>
                              </div>
                            </div>
                            <!-- Search Input -->
                            <div class="relative w-full sm:w-64">
                              <span class="pointer-events-none absolute top-1/2 left-3 -translate-y-1/2">
                                <svg class="fill-gray-500 dark:fill-gray-400" width="18" height="18" viewBox="0 0 20 20"
                                  fill="none" xmlns="http://www.w3.org/2000/svg">
                                  <path fill-rule="evenodd" clip-rule="evenodd"
                                    d="M3.04199 9.37381C3.04199 5.87712 5.87735 3.04218 9.37533 3.04218C12.8733 3.04218 15.7087 5.87712 15.7087 9.37381C15.7087 12.8705 12.8733 15.7055 9.37533 15.7055C5.87735 15.7055 3.04199 12.8705 3.04199 9.37381ZM9.37533 1.54218C5.04926 1.54218 1.54199 5.04835 1.54199 9.37381C1.54199 13.6993 5.04926 17.2055 9.37533 17.2055C11.2676 17.2055 13.0032 16.5346 14.3572 15.4178L17.1773 18.2381C17.4702 18.531 17.945 18.5311 18.2379 18.2382C18.5308 17.9453 18.5309 17.4704 18.238 17.1775L15.4182 14.3575C16.5367 13.0035 17.2087 11.2671 17.2087 9.37381C17.2087 5.04835 13.7014 1.54218 9.37533 1.54218Z"
                                    fill="" />
                                </svg>
                              </span>
                              <input type="text" id="leaveSearchInput" placeholder="Search by name, type, delegate..."
                                class="h-9 w-full rounded-lg border border-gray-300 bg-white py-2 pr-3 pl-9 !text-base text-gray-800 placeholder:text-gray-400 focus:border-brand-500 focus:ring-2 focus:ring-brand-500/10 focus:outline-none shadow-sm dark:border-gray-700 dark:bg-gray-800 dark:text-white dark:placeholder:text-gray-500" />
                            </div>
                          </div>
                        </div>
                      </div>
                      <!-- Table -->
                      <div class="custom-scrollbar overflow-x-auto">
                        <table class="min-w-full">
                          <thead>
                            <tr class="bg-gray-50 dark:bg-gray-800/50">
                              <th
                                class="px-6 py-4 text-center !text-base font-medium whitespace-nowrap text-gray-500 dark:text-gray-400">
                                Team Member</th>
                              <th
                                class="px-6 py-4 text-center !text-base font-medium whitespace-nowrap text-gray-500 dark:text-gray-400">
                                Leave Type</th>
                              <th
                                class="px-6 py-4 text-center !text-base font-medium whitespace-nowrap text-gray-500 dark:text-gray-400">
                                Start Date</th>
                              <th
                                class="px-6 py-4 text-center !text-base font-medium whitespace-nowrap text-gray-500 dark:text-gray-400">
                                End Date</th>
                              <th
                                class="px-6 py-4 text-center !text-base font-medium whitespace-nowrap text-gray-500 dark:text-gray-400">
                                Days</th>
                              <th
                                class="px-6 py-4 text-center !text-base font-medium whitespace-nowrap text-gray-500 dark:text-gray-400">
                                Delegate</th>
                            </tr>
                          </thead>
                          <tbody class="divide-y divide-gray-200 dark:divide-gray-700" id="recentLeavesTableBody">
                            <!-- Table rows will be populated by JavaScript -->
                          </tbody>
                        </table>
                      </div>
                      <!-- Pagination (only shown when "All" filter is active) -->
                      <div id="leavePaginationContainer"
                        class="border-t border-gray-200 px-6 py-4 dark:border-gray-800 hidden">
                        <div class="flex items-center justify-between">
                          <div class="flex items-center gap-2">
                            <span class="!!text-lg !text-gray-700 dark:!text-gray-400">Show</span>
                            <select id="leavesPerPage"
                              class="rounded-lg border border-gray-300 bg-white px-2 py-1 !!text-lg !text-gray-700 dark:border-gray-700 dark:bg-gray-800 dark:!text-white/90">
                              <option value="10" selected>10</option>
                              <option value="20">20</option>
                              <option value="50">50</option>
                              <option value="100">100</option>
                            </select>
                            <span class="!!text-lg !text-gray-700 dark:!text-gray-400">items per page</span>
                          </div>

                          <div class="flex items-center gap-2">
                            <button id="previousLeavePageBtn"
                              class="!!text-lg shadow-theme-xs flex items-center gap-2 rounded-lg border border-gray-300 bg-white px-2 py-2 font-medium !text-gray-700 hover:bg-gray-50 hover:!text-gray-800 sm:px-3.5 dark:border-gray-700 dark:bg-gray-800 dark:!text-gray-400 dark:hover:bg-gray-700">
                              <svg class="fill-current" width="20" height="20" viewBox="0 0 20 20" fill="none"
                                xmlns="http://www.w3.org/2000/svg">
                                <path fill-rule="evenodd" clip-rule="evenodd"
                                  d="M2.58301 9.99868C2.58272 10.1909 2.65588 10.3833 2.80249 10.53L7.79915 15.5301C8.09194 15.8231 8.56682 15.8233 8.85981 15.5305C9.15281 15.2377 9.15297 14.7629 8.86018 14.4699L5.14009 10.7472L16.6675 10.7472C17.0817 10.7472 17.4175 10.4114 17.4175 9.99715C17.4175 9.58294 17.0817 9.24715 16.6675 9.24715L5.14554 9.24715L8.86017 5.53016C9.15297 5.23717 9.15282 4.7623 8.85983 4.4695C8.56684 4.1767 8.09197 4.17685 7.79917 4.46984L2.84167 9.43049C2.68321 9.568 2.58301 9.77087 2.58301 9.99715C2.58301 9.99766 2.58301 9.99817 2.58301 9.99868Z"
                                  fill=""></path>
                              </svg>
                              <span class="hidden sm:inline">Previous</span>
                            </button>

                            <span class="block !!text-lg font-medium !text-gray-700 sm:hidden dark:!text-gray-400">
                              Page <span id="leaveCurrentPage">1</span> of <span id="leaveTotalPages">1</span>
                            </span>

                            <ul class="hidden items-center gap-0.5 sm:flex" id="leavePagination">
                              <!-- Pagination will be dynamically added here -->
                            </ul>

                            <button id="nextLeavePageBtn"
                              class="!!text-lg shadow-theme-xs flex items-center gap-2 rounded-lg border border-gray-300 bg-white px-2 py-2 font-medium !text-gray-700 hover:bg-gray-50 hover:!text-gray-800 sm:px-3.5 dark:border-gray-700 dark:bg-gray-800 dark:!text-gray-400 dark:hover:bg-gray-700">
                              <span class="hidden sm:inline">Next</span>
                              <svg class="fill-current" width="20" height="20" viewBox="0 0 20 20" fill="none"
                                xmlns="http://www.w3.org/2000/svg">
                                <path fill-rule="evenodd" clip-rule="evenodd"
                                  d="M17.4175 9.9986C17.4178 10.1909 17.3446 10.3832 17.198 10.53L12.2013 15.5301C11.9085 15.8231 11.4337 15.8233 11.1407 15.5305C10.8477 15.2377 10.8475 14.7629 11.1403 14.4699L14.8604 10.7472L3.33301 10.7472C2.91879 10.7472 2.58301 10.4114 2.58301 9.99715C2.58301 9.58294 2.91879 9.24715 3.33301 9.24715L14.8549 9.24715L11.1403 5.53016C10.8475 5.23717 10.8477 4.7623 11.1407 4.4695C11.4336 4.1767 11.9085 4.17685 12.2013 4.46984L17.1588 9.43049C17.3173 9.568 17.4175 9.77087 17.4175 9.99715C17.4175 9.99763 17.4175 9.99812 17.4175 9.9986Z"
                                  fill=""></path>
                              </svg>
                            </button>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>

                  <!-- Public Holidays Table -->
                  <div class="col-span-12">
                    <div class="rounded-2xl border border-gray-200 bg-white dark:border-gray-800"
                      style="background-color: var(--card-bg, white);">
                        <!-- Header with Title and Search -->
                        <div class="px-6 py-4 border-b border-gray-200 dark:border-gray-800">
                          <div class="flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between">
                            <div>
                            <h3 class="!text-lg font-semibold text-gray-800 dark:text-white/90">Public Holidays</h3>
                            <p class="mt-1 !text-base text-gray-500 dark:text-gray-400">Complete list of public holidays
                              across all regions</p>
                            </div>
                            <!-- Search Input -->
                            <div class="relative w-full sm:w-64">
                              <span class="pointer-events-none absolute top-1/2 left-3 -translate-y-1/2">
                              <svg class="fill-gray-500 dark:fill-gray-400" width="18" height="18" viewBox="0 0 20 20"
                                fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path fill-rule="evenodd" clip-rule="evenodd"
                                  d="M3.04199 9.37381C3.04199 5.87712 5.87735 3.04218 9.37533 3.04218C12.8733 3.04218 15.7087 5.87712 15.7087 9.37381C15.7087 12.8705 12.8733 15.7055 9.37533 15.7055C5.87735 15.7055 3.04199 12.8705 3.04199 9.37381ZM9.37533 1.54218C5.04926 1.54218 1.54199 5.04835 1.54199 9.37381C1.54199 13.6993 5.04926 17.2055 9.37533 17.2055C11.2676 17.2055 13.0032 16.5346 14.3572 15.4178L17.1773 18.2381C17.4702 18.531 17.945 18.5311 18.2379 18.2382C18.5308 17.9453 18.5309 17.4704 18.238 17.1775L15.4182 14.3575C16.5367 13.0035 17.2087 11.2671 17.2087 9.37381C17.2087 5.04835 13.7014 1.54218 9.37533 1.54218Z"
                                  fill="" />
                                </svg>
                              </span>
                            <input type="text" id="holidaySearchInput" placeholder="Search by name, country, date..."
                              class="h-9 w-full rounded-lg border border-gray-300 bg-white py-2 pr-3 pl-9 !text-base text-gray-800 placeholder:text-gray-400 focus:border-brand-500 focus:ring-2 focus:ring-brand-500/10 focus:outline-none shadow-sm dark:border-gray-700 dark:bg-gray-800 dark:text-white dark:placeholder:text-gray-500" />
                            </div>
                          </div>
                        </div>
                        <!-- Table -->
                        <div class="custom-scrollbar overflow-x-auto">
                          <table class="min-w-full">
                            <thead>
                              <tr class="bg-gray-50 dark:bg-gray-800/50">
                              <th
                                class="px-6 py-4 text-center !text-base font-medium whitespace-nowrap text-gray-500 dark:text-gray-400">
                                Holiday Name</th>
                              <th
                                class="px-6 py-4 text-center !text-base font-medium whitespace-nowrap text-gray-500 dark:text-gray-400">
                                Date</th>
                              <th
                                class="px-6 py-4 text-center !text-base font-medium whitespace-nowrap text-gray-500 dark:text-gray-400">
                                Country/Region</th>
                              <th
                                class="px-6 py-4 text-center !text-base font-medium whitespace-nowrap text-gray-500 dark:text-gray-400">
                                Local Name</th>
                              </tr>
                            </thead>
                          <tbody class="divide-y divide-gray-200 dark:divide-gray-700" id="holidaysTableBody">
                              <!-- Table rows will be populated by JavaScript -->
                            </tbody>
                          </table>
                        </div>
                      <!-- Pagination -->
                      <div class="border-t border-gray-200 px-6 py-4 dark:border-gray-800">
                        <div class="flex items-center justify-between">
                          <div class="flex items-center gap-2">
                            <span class="!!text-lg !text-gray-700 dark:!text-gray-400">Show</span>
                            <select id="holidaysPerPage"
                              class="rounded-lg border border-gray-300 bg-white px-2 py-1 !!text-lg !text-gray-700 dark:border-gray-700 dark:bg-gray-800 dark:!text-white/90">
                              <option value="10" selected>10</option>
                              <option value="20">20</option>
                              <option value="50">50</option>
                              <option value="100">100</option>
                            </select>
                            <span class="!!text-lg !text-gray-700 dark:!text-gray-400">items per page</span>
                          </div>

                          <div class="flex items-center gap-2">
                            <button id="previousHolidayPageBtn"
                              class="!!text-lg shadow-theme-xs flex items-center gap-2 rounded-lg border border-gray-300 bg-white px-2 py-2 font-medium !text-gray-700 hover:bg-gray-50 hover:!text-gray-800 sm:px-3.5 dark:border-gray-700 dark:bg-gray-800 dark:!text-gray-400 dark:hover:bg-gray-700">
                              <svg class="fill-current" width="20" height="20" viewBox="0 0 20 20" fill="none"
                                xmlns="http://www.w3.org/2000/svg">
                                <path fill-rule="evenodd" clip-rule="evenodd"
                                  d="M2.58301 9.99868C2.58272 10.1909 2.65588 10.3833 2.80249 10.53L7.79915 15.5301C8.09194 15.8231 8.56682 15.8233 8.85981 15.5305C9.15281 15.2377 9.15297 14.7629 8.86018 14.4699L5.14009 10.7472L16.6675 10.7472C17.0817 10.7472 17.4175 10.4114 17.4175 9.99715C17.4175 9.58294 17.0817 9.24715 16.6675 9.24715L5.14554 9.24715L8.86017 5.53016C9.15297 5.23717 9.15282 4.7623 8.85983 4.4695C8.56684 4.1767 8.09197 4.17685 7.79917 4.46984L2.84167 9.43049C2.68321 9.568 2.58301 9.77087 2.58301 9.99715C2.58301 9.99766 2.58301 9.99817 2.58301 9.99868Z"
                                  fill=""></path>
                              </svg>
                              <span class="hidden sm:inline">Previous</span>
                            </button>

                            <span class="block !!text-lg font-medium !text-gray-700 sm:hidden dark:!text-gray-400">
                              Page <span id="holidayCurrentPage">1</span> of <span id="holidayTotalPages">1</span>
                            </span>

                            <ul class="hidden items-center gap-0.5 sm:flex" id="holidayPagination">
                              <!-- Pagination will be dynamically added here -->
                            </ul>

                            <button id="nextHolidayPageBtn"
                              class="!!text-lg shadow-theme-xs flex items-center gap-2 rounded-lg border border-gray-300 bg-white px-2 py-2 font-medium !text-gray-700 hover:bg-gray-50 hover:!text-gray-800 sm:px-3.5 dark:border-gray-700 dark:bg-gray-800 dark:!text-gray-400 dark:hover:bg-gray-700">
                              <span class="hidden sm:inline">Next</span>
                              <svg class="fill-current" width="20" height="20" viewBox="0 0 20 20" fill="none"
                                xmlns="http://www.w3.org/2000/svg">
                                <path fill-rule="evenodd" clip-rule="evenodd"
                                  d="M17.4175 9.9986C17.4178 10.1909 17.3446 10.3832 17.198 10.53L12.2013 15.5301C11.9085 15.8231 11.4337 15.8233 11.1407 15.5305C10.8477 15.2377 10.8475 14.7629 11.1403 14.4699L14.8604 10.7472L3.33301 10.7472C2.91879 10.7472 2.58301 10.4114 2.58301 9.99715C2.58301 9.58294 2.91879 9.24715 3.33301 9.24715L14.8549 9.24715L11.1403 5.53016C10.8475 5.23717 10.8477 4.7623 11.1407 4.4695C11.4336 4.1767 11.9085 4.17685 12.2013 4.46984L17.1588 9.43049C17.3173 9.568 17.4175 9.77087 17.4175 9.99715C17.4175 9.99763 17.4175 9.99812 17.4175 9.9986Z"
                                  fill=""></path>
                              </svg>
                            </button>
                          </div>
                        </div>
                      </div>
                      </div>
                    </div>

                  </div>
                </div>

            </div>
              </div>
            </div>

          </div>
        </div>
      </div>

            <!-- BEGIN MODAL -->
    <div class="fixed inset-0 items-center justify-center hidden p-5 overflow-y-auto modal z-[9999]" id="eventModal">
      <div class="modal-close-btn fixed inset-0 h-full w-full bg-gray-400/50 backdrop-blur-[32px]"></div>
      <div
        class="modal-dialog modal-dialog-scrollable modal-lg no-scrollbar relative flex w-full max-w-[700px] flex-col overflow-y-auto rounded-3xl bg-white p-6 lg:p-11"
        style="background-color: var(--card-bg, white);">
        <!-- close btn -->
        <button
          class="modal-close-btn transition-color absolute top-5 right-5 z-[999] flex h-8 w-8 items-center justify-center rounded-full bg-gray-100 text-gray-400 hover:bg-gray-200 hover:text-gray-600 sm:h-11 sm:w-11 dark:bg-gray-700 dark:bg-white/[0.05] dark:text-gray-400 dark:hover:bg-white/[0.07] dark:hover:text-gray-300">
          <svg class="fill-current" width="24" height="24" viewBox="0 0 24 24" fill="none"
            xmlns="http://www.w3.org/2000/svg">
            <path fill-rule="evenodd" clip-rule="evenodd"
              d="M6.04289 16.5418C5.65237 16.9323 5.65237 17.5655 6.04289 17.956C6.43342 18.3465 7.06658 18.3465 7.45711 17.956L11.9987 13.4144L16.5408 17.9565C16.9313 18.347 17.5645 18.347 17.955 17.9565C18.3455 17.566 18.3455 16.9328 17.955 16.5423L13.4129 12.0002L17.955 7.45808C18.3455 7.06756 18.3455 6.43439 17.955 6.04387C17.5645 5.65335 16.9313 5.65335 16.5408 6.04387L11.9987 10.586L7.45711 6.04439C7.06658 5.65386 6.43342 5.65386 6.04289 6.04439C5.65237 6.43491 5.65237 7.06808 6.04289 7.4586L10.5845 12.0002L6.04289 16.5418Z"
              fill="" />
          </svg>
        </button>

        <div class="flex flex-col px-2 overflow-y-auto modal-content custom-scrollbar">
          <div class="modal-header">
            <h5 class="mb-2 font-semibold text-gray-800 modal-title !text-xl lg:!text-2xl dark:text-white/90"
              id="eventModalLabel">
                      Add / Edit Leave Request
            </h5>
            <p class="!text-base text-gray-500 dark:text-gray-400">
                      Submit or update leave/holiday requests for team members
            </p>
          </div>
          <div class="mt-8 modal-body">
            <div>
              <!-- Team Member Field -->
                <div>
                <label class="mb-1.5 block !text-base font-medium text-gray-700 dark:text-gray-400">
                  Team Member
                  </label>
                <select id="event-team-member" required
                  class="dark:bg-gray-900 shadow-theme-xs focus:border-brand-300 focus:ring-brand-500/10 dark:focus:border-brand-800 h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 !text-base text-gray-800 placeholder:text-gray-400 focus:ring-4 focus:outline-none dark:border-gray-700 dark:text-white/90 dark:placeholder:text-white/30">
                  <option value="">Select Team Member</option>
                </select>
                </div>

              <!-- Leave Type -->
              <div class="mt-6">
                <label class="block mb-4 !text-base font-medium text-gray-700 dark:text-gray-400">
                  Leave Type
                  </label>
                <div class="flex flex-wrap items-center gap-4 sm:gap-5">
                  <div class="n-chk">
                            <div class="form-check form-check-primary form-check-inline">
                      <label class="flex items-center !text-base text-gray-700 form-check-label dark:text-gray-400"
                        for="modalAnnual">
                        <span class="relative">
                          <input class="sr-only form-check-input" type="radio" name="event-level" value="Annual"
                            id="modalAnnual" />
                          <span
                            class="flex items-center justify-center w-5 h-5 mr-2 border border-gray-300 rounded-full box dark:border-gray-700">
                            <span class="w-2 h-2 bg-white rounded-full dark:bg-transparent">
                            </span>
                          </span>
                        </span>
                                Annual Leave
                      </label>
                    </div>
                  </div>
                  <div class="n-chk">
                    <div class="form-check form-check-warning form-check-inline">
                      <label class="flex items-center !text-base text-gray-700 form-check-label dark:text-gray-400"
                        for="modalSick">
                        <span class="relative">
                          <input class="sr-only form-check-input" type="radio" name="event-level" value="Sick"
                            id="modalSick" />
                          <span
                            class="flex items-center justify-center w-5 h-5 mr-2 border border-gray-300 rounded-full box dark:border-gray-700">
                            <span class="w-2 h-2 bg-white rounded-full dark:bg-transparent">
                            </span>
                          </span>
                        </span>
                                Sick Leave
                      </label>
                    </div>
                  </div>
                  <div class="n-chk">
                    <div class="form-check form-check-success form-check-inline">
                      <label class="flex items-center !text-base text-gray-700 form-check-label dark:text-gray-400"
                        for="modalPublic">
                        <span class="relative">
                          <input class="sr-only form-check-input" type="radio" name="event-level" value="Public"
                            id="modalPublic" />
                          <span
                            class="flex items-center justify-center w-5 h-5 mr-2 border border-gray-300 rounded-full box dark:border-gray-700">
                            <span class="w-2 h-2 bg-white rounded-full dark:bg-transparent">
                            </span>
                          </span>
                        </span>
                                Public Holiday
                      </label>
                    </div>
                  </div>
                  <div class="n-chk">
                            <div class="form-check form-check-danger form-check-inline">
                      <label class="flex items-center !text-base text-gray-700 form-check-label dark:text-gray-400"
                        for="modalOther">
                        <span class="relative">
                          <input class="sr-only form-check-input" type="radio" name="event-level" value="Other"
                            id="modalOther" />
                          <span
                            class="flex items-center justify-center w-5 h-5 mr-2 border border-gray-300 rounded-full box dark:border-gray-700">
                            <span class="w-2 h-2 bg-white rounded-full dark:bg-transparent">
                            </span>
                          </span>
                        </span>
                                Other
                      </label>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Date Range Grid -->
              <div class="mt-6 grid grid-cols-1 gap-4 sm:grid-cols-2">
                <div>
                  <label class="mb-1.5 block !text-base font-medium text-gray-700 dark:text-gray-400">
                    Start Date
                  </label>
                  <div class="relative">
                    <input id="event-start-date" type="date"
                      class="dark:bg-gray-900 shadow-theme-xs focus:border-brand-300 focus:ring-brand-500/10 dark:focus:border-brand-800 h-11 w-full appearance-none rounded-lg border border-gray-300 bg-transparent bg-none px-4 py-2.5 pr-11 pl-4 !text-base text-gray-800 placeholder:text-gray-400 focus:ring-4 focus:outline-none dark:border-gray-700 dark:text-white/90 dark:placeholder:text-white/30"
                      onclick="this.showPicker()" />
                    <span class="absolute top-1/2 right-3.5 -translate-y-1/2 pointer-events-none">
                      <svg class="fill-gray-700 dark:fill-gray-400" width="14" height="14" viewBox="0 0 14 14"
                        fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path fill-rule="evenodd" clip-rule="evenodd"
                          d="M4.33317 0.0830078C4.74738 0.0830078 5.08317 0.418794 5.08317 0.833008V1.24967H8.9165V0.833008C8.9165 0.418794 9.25229 0.0830078 9.6665 0.0830078C10.0807 0.0830078 10.4165 0.418794 10.4165 0.833008V1.24967L11.3332 1.24967C12.2997 1.24967 13.0832 2.03318 13.0832 2.99967V4.99967V11.6663C13.0832 12.6328 12.2997 13.4163 11.3332 13.4163H2.6665C1.70001 13.4163 0.916504 12.6328 0.916504 11.6663V4.99967V2.99967C0.916504 2.03318 1.70001 1.24967 2.6665 1.24967L3.58317 1.24967V0.833008C3.58317 0.418794 3.91896 0.0830078 4.33317 0.0830078ZM4.33317 2.74967H2.6665C2.52843 2.74967 2.4165 2.8616 2.4165 2.99967V4.24967H11.5832V2.99967C11.5832 2.8616 11.4712 2.74967 11.3332 2.74967H9.6665H4.33317ZM11.5832 5.74967H2.4165V11.6663C2.4165 11.8044 2.52843 11.9163 2.6665 11.9163H11.3332C11.4712 11.9163 11.5832 11.8044 11.5832 11.6663V5.74967Z"
                          fill="" />
                      </svg>
                    </span>
                </div>
              </div>

                <div>
                  <label class="mb-1.5 block !text-base font-medium text-gray-700 dark:text-gray-400">
                    End Date
                  </label>
                  <div class="relative">
                    <input id="event-end-date" type="date"
                      class="dark:bg-gray-900 datepickerTwo shadow-theme-xs focus:border-brand-300 focus:ring-brand-500/10 dark:focus:border-brand-800 h-11 w-full appearance-none rounded-lg border border-gray-300 bg-transparent bg-none px-4 py-2.5 pr-11 pl-4 !text-base text-gray-800 placeholder:text-gray-400 focus:ring-4 focus:outline-none dark:border-gray-700 dark:text-white/90 dark:placeholder:text-white/30"
                      onclick="this.showPicker()" />
                    <span class="absolute top-1/2 right-3.5 -translate-y-1/2 pointer-events-none">
                      <svg class="fill-gray-700 dark:fill-gray-400" width="14" height="14" viewBox="0 0 14 14"
                        fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path fill-rule="evenodd" clip-rule="evenodd"
                          d="M4.33317 0.0830078C4.74738 0.0830078 5.08317 0.418794 5.08317 0.833008V1.24967H8.9165V0.833008C8.9165 0.418794 9.25229 0.0830078 9.6665 0.0830078C10.0807 0.0830078 10.4165 0.418794 10.4165 0.833008V1.24967L11.3332 1.24967C12.2997 1.24967 13.0832 2.03318 13.0832 2.99967V4.99967V11.6663C13.0832 12.6328 12.2997 13.4163 11.3332 13.4163H2.6665C1.70001 13.4163 0.916504 12.6328 0.916504 11.6663V4.99967V2.99967C0.916504 2.03318 1.70001 1.24967 2.6665 1.24967L3.58317 1.24967V0.833008C3.58317 0.418794 3.91896 0.0830078 4.33317 0.0830078ZM4.33317 2.74967H2.6665C2.52843 2.74967 2.4165 2.8616 2.4165 2.99967V4.24967H11.5832V2.99967C11.5832 2.8616 11.4712 2.74967 11.3332 2.74967H9.6665H4.33317ZM11.5832 5.74967H2.4165V11.6663C2.4165 11.8044 2.52843 11.9163 2.6665 11.9163H11.3332C11.4712 11.9163 11.5832 11.8044 11.5832 11.6663V5.74967Z"
                          fill="" />
                      </svg>
                    </span>
                  </div>
                </div>
              </div>

              <!-- Delegate Field -->
              <div class="mt-6">
                <label class="mb-1.5 block !text-base font-medium text-gray-700 dark:text-gray-400">
                  Delegate (Optional)
                </label>
                <select id="event-delegate"
                  class="dark:bg-gray-900 shadow-theme-xs focus:border-brand-300 focus:ring-brand-500/10 dark:focus:border-brand-800 h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 !text-base text-gray-800 placeholder:text-gray-400 focus:ring-4 focus:outline-none dark:border-gray-700 dark:text-white/90 dark:placeholder:text-white/30">
                  <option value="">No Delegate</option>
                </select>
                <p class="mt-1.5 !text-base text-gray-500 dark:text-gray-400">
                  Select a team member to handle responsibilities while on leave
                </p>
              </div>
            </div>
          </div>
          <div class="flex items-center gap-3 mt-6 modal-footer sm:justify-end">
            <button type="button"
              class="btn modal-close-btn bg-danger-subtle text-danger flex w-full justify-center rounded-lg border border-gray-300 bg-white px-4 py-2.5 !text-base font-medium text-gray-700 hover:bg-gray-50 sm:w-auto dark:border-gray-700 dark:text-gray-400"
                      style="background-color: var(--input-bg, white); border-color: var(--input-bg, #e4e7ec);"
              data-bs-dismiss="modal">
              Close
            </button>
            <button type="button"
              class="btn btn-success btn-update-event bg-brand-500 hover:bg-brand-600 flex w-full justify-center rounded-lg px-4 py-2.5 !text-base font-medium text-white sm:w-auto"
              data-fc-event-public-id="">
                      Update Leave
            </button>
            <button type="button"
              class="btn btn-primary btn-add-event bg-brand-500 hover:bg-brand-600 flex w-full justify-center rounded-lg px-4 py-2.5 !text-base font-medium text-white sm:w-auto">
                      Add Leave Request
            </button>
          </div>
        </div>
      </div>
    </div>
            <!-- END MODAL -->

            <!-- BEGIN TEAM MANAGEMENT MODAL -->
    <div class="fixed inset-0 items-center justify-center hidden p-5 overflow-y-auto modal z-[9999]"
      id="teamManagementModal">
      <div class="modal-close-team-btn fixed inset-0 h-full w-full bg-gray-400/50 backdrop-blur-[32px]"></div>
      <div class="modal-dialog relative flex w-full max-w-[1400px] flex-col overflow-y-auto rounded-3xl p-6 lg:p-10"
        style="background-color: var(--card-bg, white);">
                <!-- close btn -->
                <button
          class="modal-close-team-btn transition-color absolute top-5 right-5 z-[999] flex h-8 w-8 items-center justify-center rounded-full bg-gray-100 text-gray-400 hover:bg-gray-200 hover:text-gray-600 sm:h-11 sm:w-11 dark:bg-gray-700 dark:bg-white/[0.05] dark:text-gray-400 dark:hover:bg-white/[0.07] dark:hover:text-gray-300">
          <svg class="fill-current" width="24" height="24" viewBox="0 0 24 24" fill="none"
            xmlns="http://www.w3.org/2000/svg">
            <path fill-rule="evenodd" clip-rule="evenodd"
                      d="M6.04289 16.5418C5.65237 16.9323 5.65237 17.5655 6.04289 17.956C6.43342 18.3465 7.06658 18.3465 7.45711 17.956L11.9987 13.4144L16.5408 17.9565C16.9313 18.347 17.5645 18.347 17.955 17.9565C18.3455 17.566 18.3455 16.9328 17.955 16.5423L13.4129 12.0002L17.955 7.45808C18.3455 7.06756 18.3455 6.43439 17.955 6.04387C17.5645 5.65335 16.9313 5.65335 16.5408 6.04387L11.9987 10.586L7.45711 6.04439C7.06658 5.65386 6.43342 5.65386 6.04289 6.04439C5.65237 6.43491 5.65237 7.06808 6.04289 7.4586L10.5845 12.0002L6.04289 16.5418Z"
              fill="" />
                            </svg>
                        </button>

                <div class="flex flex-col px-2 overflow-y-auto modal-content custom-scrollbar">
                  <div class="modal-header mb-6">
            <h5 class="mb-2 font-semibold text-gray-800 modal-title !text-xl lg:!text-2xl dark:text-white/90">
                      Manage Team Members
                    </h5>
            <p class="!text-base text-gray-500 dark:text-gray-400">
                      Add, edit, or remove team members from your organization
                    </p>
                            </div>

                  <div class="mb-6">
            <button id="openAddTeamMemberBtn"
              class="flex items-center gap-2 rounded-lg border border-blue-500 bg-blue-500 px-4 py-2.5 !text-base font-medium text-white hover:bg-blue-600 transition-all duration-200">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                                    </svg>
                      Add Team Member
                                </button>
                            </div>

                  <!-- Team Members Table -->
          <div class="rounded-2xl border border-gray-200 bg-white dark:border-gray-800"
            style="background-color: var(--card-bg, white);">
                    <div class="px-6 py-4 border-b border-gray-200 dark:border-gray-800">
                      <h3 class="!text-lg font-semibold text-gray-800 dark:text-white/90">
                        Team Members
                      </h3>
              <p class="!text-base font-medium text-gray-500 mt-1 dark:text-gray-400">Manage your team roster</p>
                    </div>

                    <div class="custom-scrollbar overflow-x-auto">
                      <table class="min-w-full">
                        <thead>
                          <tr class="bg-gray-50 dark:bg-gray-800/50">
                    <th
                      class="px-6 py-4 text-center !text-base font-medium whitespace-nowrap text-gray-500 dark:text-gray-400">
                      Full Name</th>
                    <th
                      class="px-6 py-4 text-center !text-base font-medium whitespace-nowrap text-gray-500 dark:text-gray-400">
                      Country</th>
                    <th
                      class="px-6 py-4 text-center !text-base font-medium whitespace-nowrap text-gray-500 dark:text-gray-400">
                      Actions</th>
                          </tr>
                        </thead>
                        <tbody class="divide-y divide-gray-200 dark:divide-gray-700" id="teamMembersTableBody">
                          <!-- Team members will be dynamically loaded here -->
                        </tbody>
                      </table>
                    </div>
                  </div>
                    </div>
                </div>
            </div>
            <!-- END TEAM MANAGEMENT MODAL -->

            <!-- BEGIN ADD/EDIT TEAM MEMBER MODAL -->
    <div class="fixed inset-0 items-center justify-center hidden p-5 overflow-y-auto modal z-[9999]"
      id="teamMemberModal">
      <div class="modal-close-member-btn fixed inset-0 h-full w-full bg-gray-900/70 backdrop-blur-[32px]"></div>
      <div class="modal-dialog relative flex w-full max-w-[500px] flex-col overflow-y-auto rounded-3xl p-6 lg:p-8"
        style="background-color: var(--card-bg, white);">
                <!-- close btn -->
                <button
          class="modal-close-member-btn absolute right-6 top-6 z-10 flex h-9 w-9 items-center justify-center rounded-full bg-gray-100 transition-all duration-200 hover:bg-gray-200 dark:bg-white/[0.03] dark:hover:bg-white/10">
          <svg class="fill-gray-700 dark:fill-gray-400" width="24" height="24" viewBox="0 0 24 24" fill="none"
            xmlns="http://www.w3.org/2000/svg">
            <path fill-rule="evenodd" clip-rule="evenodd"
                      d="M6.04289 16.5418C5.65237 16.9323 5.65237 17.5655 6.04289 17.956C6.43342 18.3465 7.06658 18.3465 7.45711 17.956L11.9987 13.4144L16.5408 17.9565C16.9313 18.347 17.5645 18.347 17.955 17.9565C18.3455 17.566 18.3455 16.9328 17.955 16.5423L13.4129 12.0002L17.955 7.45808C18.3455 7.06756 18.3455 6.43439 17.955 6.04387C17.5645 5.65335 16.9313 5.65335 16.5408 6.04387L11.9987 10.586L7.45711 6.04439C7.06658 5.65386 6.43342 5.65386 6.04289 6.04439C5.65237 6.43491 5.65237 7.06808 6.04289 7.4586L10.5845 12.0002L6.04289 16.5418Z"
              fill="" />
                            </svg>
                        </button>

                <div class="flex flex-col overflow-y-auto modal-content custom-scrollbar">
                  <div class="modal-header mb-6">
            <h5 class="mb-2 font-semibold text-gray-800 modal-title !text-xl lg:!text-2xl dark:text-white/90"
              id="teamMemberModalTitle">
                      Add Team Member
                    </h5>
            <p class="!text-base text-gray-500 dark:text-gray-400">
                      Enter team member details below
                    </p>
                            </div>

                  <form id="addTeamMemberForm" onsubmit="submitTeamMember(event)">
                    <input type="hidden" id="team-member-id" />
                    <div class="space-y-5">
                      <div>
                <label class="mb-1.5 block !text-base font-medium text-gray-700 dark:text-gray-400">
                          Full Name
                                </label>
                <input type="text" id="team-member-name" required placeholder="Enter full name"
                  class="dark:bg-gray-900 shadow-theme-xs focus:border-brand-300 focus:ring-brand-500/10 dark:focus:border-brand-800 h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 !text-base text-gray-800 placeholder:text-gray-400 focus:ring-4 focus:outline-none dark:border-gray-700 dark:text-white/90 dark:placeholder:text-white/30" />
                            </div>
                      <div>
                <label class="mb-1.5 block !text-base font-medium text-gray-700 dark:text-gray-400">
                                    Country
                                </label>
                <input type="text" id="team-member-country" required
                          placeholder="e.g., Austria, Germany, USA, UK, Singapore"
                  class="dark:bg-gray-900 shadow-theme-xs focus:border-brand-300 focus:ring-brand-500/10 dark:focus:border-brand-800 h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 !text-base text-gray-800 placeholder:text-gray-400 focus:ring-4 focus:outline-none dark:border-gray-700 dark:text-white/90 dark:placeholder:text-white/30" />
                <p class="mt-1.5 !text-base text-gray-500 dark:text-gray-400">
                  Use standard country names for public holiday fetching (e.g., Austria, Germany, USA, UK, Canada,
                  Australia, Singapore)
                        </p>
                            </div>
                      <div class="flex items-center gap-3 mt-8 pt-2">
                <button type="button" id="closeTeamMemberModalBtn"
                  class="flex w-full justify-center rounded-lg border border-gray-300 bg-white px-4 py-2.5 !text-base font-medium text-gray-700 hover:bg-gray-50 sm:w-auto dark:border-gray-700 dark:text-gray-400"
                  style="background-color: var(--input-bg, white); border-color: var(--input-bg, #e4e7ec);">
                          Cancel
                        </button>
                <button type="submit"
                  class="bg-brand-500 hover:bg-brand-600 flex w-full justify-center rounded-lg px-4 py-2.5 !text-base font-medium text-white sm:w-auto">
                                    Save Team Member
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
            <!-- END ADD/EDIT TEAM MEMBER MODAL -->

            <!-- BEGIN DELETE CONFIRMATION MODAL -->
    <div class="fixed inset-0 items-center justify-center hidden p-5 overflow-y-auto modal z-[9999]"
      id="deleteConfirmationModal">
      <div class="modal-close-delete-btn fixed inset-0 h-full w-full bg-gray-900/70 backdrop-blur-[32px]"></div>
      <div class="modal-dialog relative flex w-full max-w-[450px] flex-col overflow-y-auto rounded-3xl p-6 lg:p-8"
        style="background-color: var(--card-bg, white);">
                <!-- close btn -->
                <button
          class="modal-close-delete-btn absolute right-6 top-6 z-10 flex h-9 w-9 items-center justify-center rounded-full bg-gray-100 transition-all duration-200 hover:bg-gray-200 dark:bg-white/[0.03] dark:hover:bg-white/10">
          <svg class="fill-gray-700 dark:fill-gray-400" width="24" height="24" viewBox="0 0 24 24" fill="none"
            xmlns="http://www.w3.org/2000/svg">
            <path fill-rule="evenodd" clip-rule="evenodd"
                      d="M6.04289 16.5418C5.65237 16.9323 5.65237 17.5655 6.04289 17.956C6.43342 18.3465 7.06658 18.3465 7.45711 17.956L11.9987 13.4144L16.5408 17.9565C16.9313 18.347 17.5645 18.347 17.955 17.9565C18.3455 17.566 18.3455 16.9328 17.955 16.5423L13.4129 12.0002L17.955 7.45808C18.3455 7.06756 18.3455 6.43439 17.955 6.04387C17.5645 5.65335 16.9313 5.65335 16.5408 6.04387L11.9987 10.586L7.45711 6.04439C7.06658 5.65386 6.43342 5.65386 6.04289 6.04439C5.65237 6.43491 5.65237 7.06808 6.04289 7.4586L10.5845 12.0002L6.04289 16.5418Z"
              fill="" />
                  </svg>
                </button>

                <div class="flex flex-col overflow-y-auto modal-content custom-scrollbar">
                  <div class="modal-header mb-6 text-center">
                    <!-- Warning Icon -->
            <div
              class="mx-auto mb-4 flex h-14 w-14 items-center justify-center rounded-full bg-error-50 dark:bg-error-500/15">
              <svg class="h-7 w-7 text-error-600 dark:text-error-500" fill="none" stroke="currentColor"
                viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z">
                </path>
                      </svg>
                    </div>
            <h5 class="mb-2 font-semibold text-gray-800 modal-title !text-xl lg:!text-2xl dark:text-white/90">
                      Delete Team Member
                    </h5>
            <p class="!text-base text-gray-500 dark:text-gray-400">
              Are you sure you want to delete <span id="delete-member-name"
                class="font-semibold text-gray-800 dark:text-white/90"></span>?
                    </p>
            <p class="!text-base text-gray-500 mt-2 dark:text-gray-400">
              This action cannot be undone. All leave records associated with this team member will remain in the
              calendar.
                    </p>
                  </div>

                  <div class="flex items-center gap-3 mt-2">
            <button type="button" id="closeDeleteConfirmationBtn"
              class="flex w-full justify-center rounded-lg border border-gray-300 bg-white px-4 py-2.5 !text-base font-medium text-gray-700 hover:bg-gray-50 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-800"
              style="background-color: var(--input-bg, white); border-color: var(--input-bg, #e4e7ec);">
                      Cancel
                    </button>
            <button type="button" id="confirmDeleteTeamMemberBtn"
              class="bg-error-500 hover:bg-error-600 dark:bg-error-600 dark:hover:bg-error-700 flex w-full justify-center rounded-lg px-4 py-2.5 !text-base font-medium text-white transition-colors">
                      Delete Member
                    </button>
                  </div>
                </div>
              </div>
            </div>
            <!-- END DELETE CONFIRMATION MODAL -->

            <!-- BEGIN FETCH HOLIDAYS CONFIRMATION MODAL -->
    <div class="fixed inset-0 items-center justify-center hidden p-5 overflow-y-auto modal z-[9999]"
      id="fetchHolidaysConfirmModal">
      <div class="modal-close-fetch-btn fixed inset-0 h-full w-full bg-gray-900/70 backdrop-blur-[32px]"></div>
      <div class="modal-dialog relative flex w-full max-w-[450px] flex-col overflow-y-auto rounded-3xl p-6 lg:p-8"
        style="background-color: var(--card-bg, white);">
                <!-- close btn -->
                <button
          class="modal-close-fetch-btn absolute right-6 top-6 z-10 flex h-9 w-9 items-center justify-center rounded-full bg-gray-100 transition-all duration-200 hover:bg-gray-200 dark:bg-white/[0.03] dark:hover:bg-white/10">
          <svg class="fill-gray-700 dark:fill-gray-400" width="24" height="24" viewBox="0 0 24 24" fill="none"
            xmlns="http://www.w3.org/2000/svg">
            <path fill-rule="evenodd" clip-rule="evenodd"
                      d="M6.04289 16.5418C5.65237 16.9323 5.65237 17.5655 6.04289 17.956C6.43342 18.3465 7.06658 18.3465 7.45711 17.956L11.9987 13.4144L16.5408 17.9565C16.9313 18.347 17.5645 18.347 17.955 17.9565C18.3455 17.566 18.3455 16.9328 17.955 16.5423L13.4129 12.0002L17.955 7.45808C18.3455 7.06756 18.3455 6.43439 17.955 6.04387C17.5645 5.65335 16.9313 5.65335 16.5408 6.04387L11.9987 10.586L7.45711 6.04439C7.06658 5.65386 6.43342 5.65386 6.04289 6.04439C5.65237 6.43491 5.65237 7.06808 6.04289 7.4586L10.5845 12.0002L6.04289 16.5418Z"
              fill="" />
                  </svg>
                </button>

                <div class="flex flex-col overflow-y-auto modal-content custom-scrollbar">
                  <div class="modal-header mb-6 text-center">
                    <!-- Info Icon -->
            <div
              class="mx-auto mb-4 flex h-14 w-14 items-center justify-center rounded-full bg-brand-50 dark:bg-brand-500/15">
              <svg class="h-7 w-7 text-brand-600 dark:text-brand-500" fill="none" stroke="currentColor"
                viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                      </svg>
                    </div>
            <h5 class="mb-2 font-semibold text-gray-800 modal-title !text-xl lg:!text-2xl dark:text-white/90">
                      Fetch Public Holidays
                    </h5>
            <p class="!text-base text-gray-500 dark:text-gray-400">
              Fetch public holidays for <span id="fetch-countries-list"
                class="font-semibold text-gray-800 dark:text-white/90"></span>?
                    </p>
            <p class="!text-base text-warning-600 dark:text-warning-500 mt-2 font-medium">
                       This will replace all existing public holidays in the calendar.
                    </p>
                  </div>

                  <div class="flex items-center gap-3 mt-2">
            <button type="button" id="closeFetchHolidaysBtn"
              class="flex w-full justify-center rounded-lg border border-gray-300 bg-white px-4 py-2.5 !text-base font-medium text-gray-700 hover:bg-gray-50 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-800"
              style="background-color: var(--input-bg, white); border-color: var(--input-bg, #e4e7ec);">
                      Cancel
                    </button>
            <button type="button" id="confirmFetchHolidaysBtn"
              class="bg-brand-500 hover:bg-brand-600 dark:bg-brand-600 dark:hover:bg-brand-700 flex w-full justify-center rounded-lg px-4 py-2.5 !text-base font-medium text-white transition-colors">
                      Fetch Holidays
                    </button>
                  </div>
                </div>
              </div>
            </div>
            <!-- END FETCH HOLIDAYS CONFIRMATION MODAL -->
    </div>
    </main>
    <!-- ===== Main Content End ===== -->

    <!-- Calendar JavaScript -->
    <script>
      // Global variables for team members and calendar
        let teamMembers = [];
        // Calendar events array (replaces FullCalendar)
        let calendarEvents = [];
        let leaveTrendsChart = null;
        let leaveBreakdownChart = null;
    let pendingCountryCodes = [];
    let teamSummaryChart = null;

      // Team Management Functions (Global scope for onclick handlers)
      /*=====================*/
      // Fetch team members from Confluence
      /*=====================*/
      async function fetchTeamMembers() {
        try {
          const response = await fetch('https://cedt-confluence.net/confluence/download/attachments/2740868871/team_members.json?api=v2');
          
          if (!response.ok) {
            console.warn('Team members file not found (this is normal for first-time setup)');
            return [];
          }

          const data = await response.json();
          
          if (data.members && Array.isArray(data.members)) {
            return data.members;
          } else if (Array.isArray(data)) {
            return data;
          } else {
            console.warn('Unexpected data format:', data);
            return [];
          }
        } catch (error) {
          console.warn('Could not fetch team members (this is normal for first-time setup):', error.message);
          return [];
        }
      }

    // Fetch calendar events from Confluence
    async function fetchCalendarEvents() {
      try {
        const response = await fetch('https://cedt-confluence.net/confluence/download/attachments/2740868871/calendar_events.json?api=v2');

        if (!response.ok) {
          console.warn('Calendar events file not found, using dummy data');
          // Return dummy data that matches what's in calendarEventsList
          return [];
        }

        const data = await response.json();

        if (data.events && Array.isArray(data.events)) {
          return data.events;
        } else if (Array.isArray(data)) {
          return data;
        } else {
          console.warn('Unexpected calendar events data format:', data);
          return [];
        }
      } catch (error) {
        console.warn('Calendar events file not found or error fetching (this is normal for first-time setup):', error.message);
        // Return empty array since initial dummy data is already in calendarEventsList
        return [];
      }
    }

    // Update calendar events in Confluence
    async function updateCalendarEventsFile(events) {
      try {
        let attachmentId = null;
        let fileExists = false;

        // Check if file exists
        try {
          const attachmentsResponse = await fetch('https://cedt-confluence.net/confluence/rest/api/content/2740868871/child/attachment?filename=calendar_events.json');

          if (attachmentsResponse.ok) {
            const attachmentsData = await attachmentsResponse.json();

            if (attachmentsData.results && attachmentsData.results.length > 0) {
              attachmentId = attachmentsData.results[0].id;
              fileExists = true;
            }
          }
        } catch (checkError) {
          console.warn('Could not check for existing calendar events file:', checkError);
        }

        const dataToSave = {
          events: events,
          metadata: {
            lastUpdated: new Date().toISOString(),
            totalEvents: events.length
          }
        };

        const formData = new FormData();
        const blob = new Blob([JSON.stringify(dataToSave, null, 2)], { type: 'application/json' });
        formData.append('file', blob, 'calendar_events.json');

        const endpoint = `https://cedt-confluence.net/confluence/rest/api/content/2740868871/child/attachment${attachmentId ? `/${attachmentId}` : ''}`;

        const response = await fetch(endpoint, {
          method: 'POST',
          headers: {
            'X-Atlassian-Token': 'no-check'
          },
          body: formData
        });

        if (!response.ok) {
          throw new Error(`Failed to ${fileExists ? 'update' : 'create'} calendar events file: ${response.status} ${response.statusText}`);
        }

        return true;
      } catch (error) {
        console.warn('Could not save to Confluence:', error.message);
        throw error;
      }
    }

    // Save all calendar events to Confluence
    async function saveCalendarEvents() {
      const eventsData = calendarEvents.map(event => ({
        id: event.id,
        title: event.title,
        start: event.start,
        end: event.end,
        allDay: event.allDay !== undefined ? event.allDay : true,
        extendedProps: event.extendedProps
      }));

      try {
        await updateCalendarEventsFile(eventsData);
        return true;
      } catch (error) {
        console.warn('Could not save to Confluence (this is normal when running locally):', error.message);
        return false;
      }
    }

    // Load calendar events into calendar array
    async function loadCalendarEvents() {
      try {
        const events = await fetchCalendarEvents();

        if (events.length > 0) {
          calendarEvents = events;
        }
      } catch (error) {
        console.error('Error loading calendar events:', error);
        }
      }

      // Update team members in Confluence
      async function updateTeamMembersFile(members) {
      try {
        let attachmentId = null;
        let fileExists = false;

        // Check if file exists
        try {
          const attachmentsResponse = await fetch('https://cedt-confluence.net/confluence/rest/api/content/2740868871/child/attachment?filename=team_members.json');

          if (attachmentsResponse.ok) {
          const attachmentsData = await attachmentsResponse.json();

          if (attachmentsData.results && attachmentsData.results.length > 0) {
            attachmentId = attachmentsData.results[0].id;
              fileExists = true;
            }
          }
        } catch (checkError) {
          console.warn('Could not check for existing file:', checkError);
          }

          const dataToSave = {
            members: members,
            metadata: {
              lastUpdated: new Date().toISOString(),
              totalMembers: members.length
            }
          };

          const formData = new FormData();
          const blob = new Blob([JSON.stringify(dataToSave, null, 2)], { type: 'application/json' });
          formData.append('file', blob, 'team_members.json');

        const endpoint = `https://cedt-confluence.net/confluence/rest/api/content/2740868871/child/attachment${attachmentId ? `/${attachmentId}` : ''}`;

        const response = await fetch(endpoint, {
            method: 'POST',
            headers: {
              'X-Atlassian-Token': 'no-check'
            },
            body: formData
          });

          if (!response.ok) {
          throw new Error(`Failed to ${fileExists ? 'update' : 'create'} team members file: ${response.status} ${response.statusText}`);
          }

          return true;
        } catch (error) {
          console.error('Error updating team members file:', error);
          throw error;
        }
      }

      // Open team management modal
      function openTeamManagementModal() {
      const modal = document.getElementById("teamManagementModal");
      if (modal) {
        modal.classList.remove('hidden');
        modal.style.display = "flex";
        loadTeamMembers();
      } else {
        console.error("Team Management modal not found");
      }
    }
    window.openTeamManagementModal = openTeamManagementModal;

      // Close team management modal
      function closeTeamManagementModal() {
      const modal = document.getElementById("teamManagementModal");
      if (modal) {
        modal.classList.add('hidden');
        modal.style.display = "none";
      }
      }

      // Load team members into table
      async function loadTeamMembers() {
        teamMembers = await fetchTeamMembers();
        updateTeamMembersTable();
        updateTeamMemberDropdown();
      }

      // Update team members table
      function updateTeamMembersTable() {
        const tbody = document.getElementById('teamMembersTableBody');
        if (teamMembers.length === 0) {
          tbody.innerHTML = `
            <tr>
              <td colspan="3" class="px-6 py-12 text-center">
                <div class="flex flex-col items-center justify-center">
                  <svg class="h-12 w-12 text-gray-400 dark:text-gray-600 mb-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path>
                  </svg>
                  <p class="!text-base font-medium text-gray-500 dark:text-gray-400">No team members yet</p>
                  <p class="!text-base text-gray-400 dark:text-gray-500 mt-1">Add your first team member above to get started</p>
                </div>
              </td>
            </tr>
          `;
          return;
        }

        tbody.innerHTML = teamMembers.map(member => {
          const initials = member.name.split(' ').map(n => n[0]).join('').toUpperCase().substring(0, 2);
          const colors = [
            { bg: 'bg-brand-100 dark:bg-brand-900/20', text: 'text-brand-600 dark:text-brand-400' },
            { bg: 'bg-pink-50 dark:bg-pink-900/20', text: 'text-pink-600 dark:text-pink-400' },
            { bg: 'bg-cyan-50 dark:bg-cyan-900/20', text: 'text-cyan-600 dark:text-cyan-400' },
            { bg: 'bg-orange-50 dark:bg-orange-900/20', text: 'text-orange-600 dark:text-orange-400' },
            { bg: 'bg-success-50 dark:bg-success-900/20', text: 'text-success-600 dark:text-success-400' }
          ];
          const color = colors[Math.abs(hashCode(member.id || member.name)) % colors.length];
          
          // Country badge colors
          const countryColors = [
            'bg-blue-50 text-blue-600 dark:bg-blue-900/20 dark:text-blue-400',
            'bg-green-50 text-green-600 dark:bg-green-900/20 dark:text-green-400',
            'bg-purple-50 text-purple-600 dark:bg-purple-900/20 dark:text-purple-400',
            'bg-amber-50 text-amber-600 dark:bg-amber-900/20 dark:text-amber-400',
            'bg-rose-50 text-rose-600 dark:bg-rose-900/20 dark:text-rose-400'
          ];
          const countryColor = countryColors[Math.abs(hashCode(member.country)) % countryColors.length];

          return `
            <tr class="hover:bg-gray-50 dark:hover:bg-gray-800/50 transition-colors">
              <td class="px-6 py-4 whitespace-nowrap">
                <div class="flex items-center justify-center gap-3">
                  <div class="flex items-center justify-center w-10 h-10 rounded-full ${color.bg}">
                    <span class="!text-base font-semibold ${color.text}">${initials}</span>
                  </div>
                  <span class="!text-base font-medium text-gray-900 dark:text-white">
                    ${member.name}
                  </span>
                </div>
              </td>
              <td class="px-6 py-4 text-center">
                <span class="${countryColor} rounded-full px-2 py-0.5 !text-base font-medium">
                  ${member.country}
                </span>
              </td>
              <td class="px-6 py-4">
                <div class="flex items-center justify-center gap-2">
                  <button data-action="edit" data-member-id="${member.id}" class="edit-team-member-btn text-brand-500 hover:text-brand-600 dark:text-brand-400 dark:hover:text-brand-300 transition-colors">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                    </svg>
                  </button>
                  <button data-action="delete" data-member-id="${member.id}" class="delete-team-member-btn text-gray-400 hover:text-error-500 dark:text-gray-500 dark:hover:text-error-400 transition-colors">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                    </svg>
                  </button>
                </div>
              </td>
            </tr>
          `;
        }).join('');
      }

      // Update team member dropdown in event modal
      function updateTeamMemberDropdown() {
        const dropdown = document.getElementById('event-team-member');
        const delegateDropdown = document.getElementById('event-delegate');
        
        if (dropdown) {
          dropdown.innerHTML = '<option value="">Select Team Member</option>' +
            teamMembers.map(member => 
              `<option value="${member.id}">${member.name}</option>`
            ).join('');
        }
        
        if (delegateDropdown) {
          delegateDropdown.innerHTML = '<option value="">No Delegate</option>' +
            teamMembers.map(member => 
              `<option value="${member.id}">${member.name}</option>`
            ).join('');
        }
        
        // Update delegate dropdown when team member changes
        if (dropdown) {
        dropdown.addEventListener('change', function () {
            updateDelegateOptions(this.value);
          });
        }
      }
      
      // Update delegate dropdown to exclude selected team member
      function updateDelegateOptions(selectedMemberId) {
        const delegateDropdown = document.getElementById('event-delegate');
        if (!delegateDropdown) return;
        
        const currentDelegate = delegateDropdown.value;
        delegateDropdown.innerHTML = '<option value="">No Delegate</option>' +
          teamMembers
            .filter(member => member.id !== selectedMemberId)
            .map(member => 
              `<option value="${member.id}">${member.name}</option>`
            ).join('');
        
        // Restore previous selection if still valid
        if (currentDelegate && currentDelegate !== selectedMemberId) {
          delegateDropdown.value = currentDelegate;
        }
      }

      // Hash function for consistent colors
      function hashCode(str) {
        if (!str) return 0; // Handle undefined/null/empty strings
        let hash = 0;
        for (let i = 0; i < str.length; i++) {
          hash = str.charCodeAt(i) + ((hash << 5) - hash);
        }
        return hash;
      }

      // Open add team member modal
      function openAddTeamMemberForm() {
      const modal = document.getElementById('teamMemberModal');
      if (modal) {
        modal.classList.remove('hidden');
        modal.style.display = 'flex';
      }
        document.getElementById('teamMemberModalTitle').textContent = 'Add Team Member';
        document.getElementById('addTeamMemberForm').reset();
        document.getElementById('team-member-id').value = '';
      }

      // Close team member modal
      function closeTeamMemberModal() {
      const modal = document.getElementById('teamMemberModal');
      if (modal) {
        modal.classList.add('hidden');
        modal.style.display = 'none';
      }
        document.getElementById('addTeamMemberForm').reset();
      }

      // Edit team member
      function editTeamMember(id) {
        const member = teamMembers.find(m => m.id === id);
        if (!member) return;

        document.getElementById('teamMemberModal').style.display = 'flex';
        document.getElementById('teamMemberModalTitle').textContent = 'Edit Team Member';
        document.getElementById('team-member-id').value = member.id;
        document.getElementById('team-member-name').value = member.name;
        document.getElementById('team-member-country').value = member.country;
      }

      // Submit team member (add or edit)
      async function submitTeamMember(event) {
        event.preventDefault();

        const id = document.getElementById('team-member-id').value;
        const name = document.getElementById('team-member-name').value;
        const country = document.getElementById('team-member-country').value;

        if (id) {
          // Edit existing member
          const index = teamMembers.findIndex(m => m.id === id);
          if (index !== -1) {
            teamMembers[index] = { id, name, country };
          }
        } else {
          // Add new member
          const newMember = {
            id: `member_${Date.now()}`,
            name,
            country
          };
          teamMembers.push(newMember);
        }

        try {
          await updateTeamMembersFile(teamMembers);
          updateTeamMembersTable();
          updateTeamMemberDropdown();
          closeTeamMemberModal();
          showSuccessToast(id ? 'Team member updated successfully' : 'Team member added successfully');
        } catch (error) {
          showErrorToast('Failed to save team member. Please try again.');
        }
      }

      // Delete team member - open confirmation modal
      let memberToDelete = null;
      
      function deleteTeamMember(id) {
        const member = teamMembers.find(m => m.id === id);
        if (!member) return;
        
        memberToDelete = id;
        document.getElementById('delete-member-name').textContent = member.name;
      const modal = document.getElementById('deleteConfirmationModal');
      if (modal) {
        modal.classList.remove('hidden');
        modal.style.display = 'flex';
      }
      }
      
      // Close delete confirmation modal
      function closeDeleteConfirmationModal() {
      const modal = document.getElementById('deleteConfirmationModal');
      if (modal) {
        modal.classList.add('hidden');
        modal.style.display = 'none';
      }
        memberToDelete = null;
      }
      
      // Confirm and execute deletion
      async function confirmDeleteTeamMember() {
        if (!memberToDelete) return;
        
        const memberId = memberToDelete;
        closeDeleteConfirmationModal();
        
        // Show loading overlay
        showDeletionLoadingOverlay();
        
        try {
          // Filter out the deleted member
          teamMembers = teamMembers.filter(m => m.id !== memberId);
          
          // Update the file
          await updateTeamMembersFile(teamMembers);
          
          // Remove all events associated with this team member from calendar
          calendarEvents = calendarEvents.filter(event => 
            event.extendedProps.teamMember !== memberId
          );

        // Save calendar events to Confluence (after removing member's events)
        try {
          await saveCalendarEvents();
        } catch (saveError) {
          console.error('Failed to save calendar events:', saveError);
          }
          
          // Refresh all UI components
          updateTeamMembersTable();
          updateTeamMemberDropdown();
          
          // Refresh analytics if on summary tab
          if (typeof refreshAnalytics === 'function') {
            refreshAnalytics();
          }
          
          // Hide loading overlay
          hideDeletionLoadingOverlay();
          
          // Show success message
          showSuccessToast('Team member deleted successfully');
          
        } catch (error) {
          console.error('Error deleting team member:', error);
          hideDeletionLoadingOverlay();
          showErrorToast('Failed to delete team member. Please try again.');
        }
      }
      
      // Show loading overlay during deletion
      function showDeletionLoadingOverlay() {
        const overlay = document.createElement('div');
        overlay.id = 'deletion-loading-overlay';
      overlay.className = 'fixed inset-0 z-[9999] flex items-center justify-center bg-gray-900/70 backdrop-blur-sm';
        overlay.innerHTML = `
          <div class="rounded-2xl bg-white dark:bg-gray-800 p-6 shadow-xl" style="background-color: var(--card-bg, white);">
            <div class="text-center">
              <svg class="animate-spin h-12 w-12 text-brand-500 mx-auto mb-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
              </svg>
              <p class="!text-lg font-semibold text-gray-800 dark:text-white">Deleting Team Member</p>
              <p class="!text-base text-gray-500 dark:text-gray-400 mt-1">Please wait...</p>
            </div>
          </div>
        `;
        document.body.appendChild(overlay);
      }
      
      // Hide loading overlay
      function hideDeletionLoadingOverlay() {
        const overlay = document.getElementById('deletion-loading-overlay');
        if (overlay) {
          overlay.remove();
        }
      }
      
      // ============================================
      // NOTIFICATIONS
      // ============================================
      // Toast notifications are provided by global-notifications.html
      // Available functions: showSuccessToast(), showErrorToast(), showWarningToast(), showInfoToast()
      // ============================================

      document.addEventListener("DOMContentLoaded", function () {
                /*=================*/
                //  Calender Date variable
                /*=================*/
                const newDate = new Date();
                const getDynamicMonth = () => {
                    const month = newDate.getMonth() + 1;
                    return month < 10 ? `0${month}` : `${month}`;
                };

                /*=================*/
                // Calender Modal Elements
                /*=================*/
          const getModalStartDateEl = document.querySelector("#event-start-date");
          const getModalEndDateEl = document.querySelector("#event-end-date");
          const getModalAddBtnEl = document.querySelector(".btn-add-event");
          const getModalUpdateBtnEl = document.querySelector(".btn-update-event");

                /*=====================*/
                // Calendar Events Data
                /*=====================*/

                /*=====================*/
                // Modal Functions
                /*=====================*/
                const openModal = () => {
          const modal = document.getElementById("eventModal");
          if (modal) {
            modal.classList.remove("hidden");
            modal.style.display = "flex";
            console.log(' Modal opened');
          } else {
            console.error("Event modal not found");
          }
        };
        window.openModal = openModal;

                const closeModal = () => {
          const modal = document.getElementById("eventModal");
          if (modal) {
            modal.classList.add("hidden");
            modal.style.display = "none";
                    resetModalFields();
            console.log(' Modal closed');
          }
                };
        window.closeModal = closeModal;

                // Close modal when clicking outside of it
                window.onclick = function (event) {
            const modal = document.getElementById("eventModal");
                    if (event.target === modal) {
                        closeModal();
                    }
                };

                /*=====================*/
                // Calendar Select fn.
                /*=====================*/
                const calendarSelect = (info) => {
                    resetModalFields();

            getModalAddBtnEl.style.display = "flex";
            getModalUpdateBtnEl.style.display = "none";
                    openModal();
                    // Set start date from the selection
                    getModalStartDateEl.value = info.startStr.slice(0, 10);
                    // Set end date (subtract 1 day because FullCalendar's endStr is exclusive)
                    const endDate = new Date(info.end);
                    endDate.setDate(endDate.getDate() - 1);
                    const endDateStr = endDate.toISOString().slice(0, 10);
                    getModalEndDateEl.value = endDateStr;
            document.getElementById('event-team-member').value = "";
                };
        window.calendarSelect = calendarSelect;

                /*=====================*/
                // Calendar AddEvent fn.
                /*=====================*/
                const calendarAddEvent = (info) => {
          console.log(' calendarAddEvent called', info);
                    let startDate;
                    
                    // If info is provided (clicked on calendar), use the clicked date
                    if (info && info.dateStr) {
                        startDate = info.dateStr;
            console.log('   Using clicked date:', startDate);
                    } else {
                        // Otherwise use current date (clicked from button)
                        const currentDate = new Date();
                        const dd = String(currentDate.getDate()).padStart(2, "0");
                        const mm = String(currentDate.getMonth() + 1).padStart(2, "0");
                        const yyyy = currentDate.getFullYear();
                        startDate = `${yyyy}-${mm}-${dd}`;
            console.log('   Using current date:', startDate);
                    }

          console.log('   Opening modal...');
            getModalAddBtnEl.style.display = "flex";
            getModalUpdateBtnEl.style.display = "none";
                    openModal();
                    getModalStartDateEl.value = startDate;
                    getModalEndDateEl.value = startDate;
            document.getElementById('event-team-member').value = "";
            document.getElementById('event-delegate').value = "";
                };
        window.calendarAddEvent = calendarAddEvent;

                /*=====================*/
                // Calender Event Function
                /*=====================*/
                const calendarEventClick = (info) => {
                    const eventObj = info.event;

                    if (eventObj.url) {
                        window.open(eventObj.url);
                        info.jsEvent.preventDefault();
                    } else {
                        const getModalEventId = eventObj._def.publicId;
                        const getModalEventLevel = eventObj._def.extendedProps.calendar;
              const teamMemberId = eventObj._def.extendedProps.teamMember;
                        const getModalCheckedRadioBtnEl = document.querySelector(
                `input[value="${getModalEventLevel}"]`,
              );

              // Set team member
              const teamMemberDropdown = document.getElementById('event-team-member');
              if (teamMemberId && teamMemberDropdown) {
                teamMemberDropdown.value = teamMemberId;
                updateDelegateOptions(teamMemberId);
              }

              // Set delegate
              const delegateId = eventObj._def.extendedProps.delegate;
              const delegateDropdown = document.getElementById('event-delegate');
              if (delegateDropdown) {
                delegateDropdown.value = delegateId || "";
              }

                        getModalStartDateEl.value = eventObj.startStr.slice(0, 10);
                        getModalEndDateEl.value = eventObj.endStr
                            ? eventObj.endStr.slice(0, 10)
                            : "";
                        if (getModalCheckedRadioBtnEl) {
                            getModalCheckedRadioBtnEl.checked = true;
                        }
                        getModalUpdateBtnEl.dataset.fcEventPublicId = getModalEventId;
              getModalAddBtnEl.style.display = "none";
              getModalUpdateBtnEl.style.display = "block";
                        openModal();
                    }
                };
        window.calendarEventClick = calendarEventClick;

          /*=====================*/
          // Fetch Public Holidays from API
          /*=====================*/
          const fetchPublicHolidays = async () => {
            // Get unique countries from team members
            const countries = [...new Set(teamMembers.map(m => m.country).filter(c => c))];
            
            if (countries.length === 0) {
              showWarningToast('No team members with countries assigned. Please add team members with their countries first.');
              return;
            }
            
            // Map country names to ISO codes (add more as needed)
            const countryCodeMap = {
              'Austria': 'AT',
              'Germany': 'DE',
              'USA': 'US',
              'United States': 'US',
              'UK': 'GB',
              'United Kingdom': 'GB',
              'Canada': 'CA',
              'Australia': 'AU',
              'Singapore': 'SG',
              'France': 'FR',
              'Italy': 'IT',
              'Spain': 'ES',
              'Netherlands': 'NL',
              'Belgium': 'BE',
              'Switzerland': 'CH',
              'Poland': 'PL',
              'Sweden': 'SE',
              'Norway': 'NO',
              'Denmark': 'DK',
              'Finland': 'FI',
              'Ireland': 'IE',
              'Portugal': 'PT',
              'Greece': 'GR',
              'Czech Republic': 'CZ',
              'Hungary': 'HU',
              'Romania': 'RO',
              'Japan': 'JP',
              'China': 'CN',
              'India': 'IN',
              'Brazil': 'BR',
              'Mexico': 'MX',
              'Argentina': 'AR',
              'Chile': 'CL',
              'Colombia': 'CO',
              'South Africa': 'ZA',
              'New Zealand': 'NZ',
              'South Korea': 'KR',
              'Thailand': 'TH',
              'Malaysia': 'MY',
              'Indonesia': 'ID',
              'Philippines': 'PH',
              'Vietnam': 'VN',
            };
            
            // Get country codes
            const countryCodes = countries
              .map(country => countryCodeMap[country] || countryCodeMap[country.trim()])
              .filter(code => code);
            
            if (countryCodes.length === 0) {
              showWarningToast('No valid country codes found. Please use standard country names (e.g., Austria, Germany, USA, UK, etc.).');
              return;
            }
            
            // Show confirmation modal
            pendingCountryCodes = countryCodes;
            document.getElementById('fetch-countries-list').textContent = countryCodes.join(', ');
          const fetchModal = document.getElementById('fetchHolidaysConfirmModal');
          if (fetchModal) {
            fetchModal.classList.remove('hidden');
            fetchModal.style.display = 'flex';
          }
        };
        window.fetchPublicHolidays = fetchPublicHolidays;
          
          // Close fetch holidays modal
          function closeFetchHolidaysModal() {
          const fetchModal = document.getElementById('fetchHolidaysConfirmModal');
          if (fetchModal) {
            fetchModal.classList.add('hidden');
            fetchModal.style.display = 'none';
          }
            pendingCountryCodes = [];
          }
        window.closeFetchHolidaysModal = closeFetchHolidaysModal;
          
          // Confirm and execute holiday fetching
          async function confirmFetchHolidays() {
            const countryCodes = pendingCountryCodes;
            closeFetchHolidaysModal();
            
            if (countryCodes.length === 0) return;
            
            // Remove all existing public holidays
            let removedCount = 0;
            calendarEvents = calendarEvents.filter(event => {
              if (event.extendedProps.calendar === 'Public') {
                removedCount++;
                return false;
              }
              return true;
            });
            
            // Get current year
            const currentYear = new Date().getFullYear();
            
            // Show loading overlay
            const loadingOverlay = document.createElement('div');
            loadingOverlay.id = 'calendar-loading-overlay';
            loadingOverlay.className = 'fixed inset-0 z-[999] flex items-center justify-center bg-white/90 dark:bg-gray-950/90 backdrop-blur-sm';
            loadingOverlay.innerHTML = `
              <div class="text-center">
                <svg class="animate-spin h-16 w-16 text-brand-500 mx-auto mb-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                  <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                  <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                </svg>
                <p class="!text-lg font-semibold text-gray-800 dark:text-white">Fetching Public Holidays</p>
                <p class="!text-base text-gray-500 dark:text-gray-400 mt-1">Loading holidays for ${countryCodes.join(', ')}...</p>
              </div>
            `;
            
            document.body.appendChild(loadingOverlay);
            
            try {
              // Fetch holidays for each country
              let totalHolidays = 0;
              for (const code of countryCodes) {
                try {
                  const response = await fetch(`https://date.nager.at/api/v3/publicholidays/${currentYear}/${code}`);
                  if (!response.ok) continue;
                  
                  const holidays = await response.json();
                  
                  // Add each holiday to the calendar
                  holidays.forEach(holiday => {
                    calendarEvents.push({
                      id: `holiday-${code}-${holiday.date}`,
                      title: `${holiday.name} (${code})`,
                      start: holiday.date,
                      end: holiday.date,
                      allDay: true,
                      extendedProps: {
                        calendar: 'Public',
                        countryCode: code,
                        localName: holiday.localName
                      },
                    });
                    totalHolidays++;
                  });
                } catch (err) {
                  console.error(`Failed to fetch holidays for ${code}:`, err);
                }
              }
              
              // Remove loading overlay
              const overlay = document.getElementById('calendar-loading-overlay');
              if (overlay) {
                overlay.remove();
              }
              
              // Show success message
              console.log(` Successfully fetched ${totalHolidays} public holidays`);
              showSuccessToast(`Added ${totalHolidays} public holidays for ${currentYear}`);
              
              // Refresh analytics and timeline
              console.log(' Refreshing timeline and charts...');
              refreshAnalytics();
              console.log(' Timeline and charts updated');
              
            // Save calendar events to Confluence (in background)
            saveCalendarEvents().catch(saveError => {
              console.warn('Could not save to Confluence (this is normal when running locally):', saveError.message);
            });
              
            } catch (error) {
              console.error('Error fetching holidays:', error);
              const overlay = document.getElementById('calendar-loading-overlay');
              if (overlay) {
                overlay.remove();
              }
              
              // Show error message
              showErrorToast('Failed to fetch holidays. Please try again.');
            }
          };
        window.confirmFetchHolidays = confirmFetchHolidays;

          /*=====================*/
          // Download to Outlook (ICS format)
          /*=====================*/
          const downloadOutlookCalendar = () => {
            const events = calendarEvents;
            
            // Helper function to format date for ICS
            const formatICSDate = (date) => {
              if (!date) return '';
              const d = new Date(date);
              const year = d.getUTCFullYear();
              const month = String(d.getUTCMonth() + 1).padStart(2, '0');
              const day = String(d.getUTCDate()).padStart(2, '0');
              const hours = String(d.getUTCHours()).padStart(2, '0');
              const minutes = String(d.getUTCMinutes()).padStart(2, '0');
              const seconds = String(d.getUTCSeconds()).padStart(2, '0');
              return `${year}${month}${day}T${hours}${minutes}${seconds}Z`;
            };

            // Build ICS content
            let icsContent = [
              'BEGIN:VCALENDAR',
              'VERSION:2.0',
              'PRODID:-//LPTM Calendar//EN',
              'CALSCALE:GREGORIAN',
              'METHOD:PUBLISH',
              'X-WR-CALNAME:LPTM Calendar',
              'X-WR-TIMEZONE:UTC',
            ];

            events.forEach(event => {
              const startDate = event.start;
              const endDate = event.end || event.start;
              const title = event.title || 'Untitled Event';
              const uid = event.id || Math.random().toString(36).substring(2);

              icsContent.push('BEGIN:VEVENT');
              icsContent.push(`UID:${uid}@lptm-calendar`);
              icsContent.push(`DTSTAMP:${formatICSDate(new Date())}`);
              icsContent.push(`DTSTART:${formatICSDate(startDate)}`);
              icsContent.push(`DTEND:${formatICSDate(endDate)}`);
              icsContent.push(`SUMMARY:${title}`);
              icsContent.push('STATUS:CONFIRMED');
              icsContent.push('SEQUENCE:0');
              icsContent.push('END:VEVENT');
            });

            icsContent.push('END:VCALENDAR');

            // Create blob and download
            const blob = new Blob([icsContent.join('\r\n')], { type: 'text/calendar;charset=utf-8' });
            const link = document.createElement('a');
            link.href = window.URL.createObjectURL(blob);
            link.download = 'lptm-calendar.ics';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            // Show success message
            showSuccessToast(`Calendar downloaded successfully (${events.length} events)`);
                };
        window.downloadOutlookCalendar = downloadOutlookCalendar;

                /*=====================*/
                // Initialize Calendar Events Array
                /*=====================*/
          // Calendar events will be loaded from Confluence
          calendarEvents = [];
          console.log(' calendarEvents initialized (empty - will load from Confluence)');

                /*=====================*/
                // Update Calender Event
                /*=====================*/
        getModalUpdateBtnEl.addEventListener("click", async () => {
                    const getPublicID = getModalUpdateBtnEl.dataset.fcEventPublicId;
            const teamMemberId = document.getElementById('event-team-member').value;
                    const setModalStartDateValue = getModalStartDateEl.value;
                    const setModalEndDateValue = getModalEndDateEl.value;
                    const getEvent = calendarEvents.find(e => e.id == getPublicID);
                    const getModalUpdatedCheckedRadioBtnEl = document.querySelector(
              'input[name="event-level"]:checked',
                    );

            const leaveType =
                        getModalUpdatedCheckedRadioBtnEl
                            ? getModalUpdatedCheckedRadioBtnEl.value
                            : "";

            // Get team member name and delegate
            const delegateId = document.getElementById('event-delegate').value;
            const teamMember = teamMembers.find(m => m.id === teamMemberId);
            const memberName = teamMember ? teamMember.name : "Unknown";
            const eventTitle = `${memberName} - ${leaveType} Leave`;

            // Update event properties
            if (getEvent) {
              getEvent.title = eventTitle;
              getEvent.start = setModalStartDateValue;
              getEvent.end = setModalEndDateValue;
              getEvent.extendedProps.calendar = leaveType;
              getEvent.extendedProps.teamMember = teamMemberId;
              getEvent.extendedProps.delegate = delegateId;
            }
                    closeModal();
                    refreshAnalytics();

          // Save calendar events to Confluence
          try {
            await saveCalendarEvents();
          } catch (error) {
            console.error('Failed to save calendar events:', error);
          }
                });

                /*=====================*/
                // Add Calender Event
                /*=====================*/
        getModalAddBtnEl.addEventListener("click", async () => {
                    const getModalCheckedRadioBtnEl = document.querySelector(
              'input[name="event-level"]:checked',
                    );

            const teamMemberId = document.getElementById('event-team-member').value;
                    const setModalStartDateValue = getModalStartDateEl.value;
                    const setModalEndDateValue = getModalEndDateEl.value;
            const leaveType = getModalCheckedRadioBtnEl
                        ? getModalCheckedRadioBtnEl.value
                        : "";

            if (!teamMemberId) {
              showWarningToast('Please select a team member');
              return;
            }

            if (!leaveType) {
              showWarningToast('Please select a leave type');
              return;
            }

            // Get team member name and delegate
            const delegateId = document.getElementById('event-delegate').value;
            const teamMember = teamMembers.find(m => m.id === teamMemberId);
            const memberName = teamMember ? teamMember.name : "Unknown";
            const eventTitle = `${memberName} - ${leaveType} Leave`;

                    // Add event to array
                    calendarEvents.push({
                        id: Date.now().toString(), // Use unique ID based on timestamp
              title: eventTitle,
                        start: setModalStartDateValue,
                        end: setModalEndDateValue,
                        allDay: true,
              extendedProps: { 
                calendar: leaveType,
                teamMember: teamMemberId,
                delegate: delegateId
              },
                    });
                    closeModal();
                    refreshAnalytics();

          // Save calendar events to Confluence
          try {
            await saveCalendarEvents();
            showSuccessToast('Leave request added successfully');
          } catch (error) {
            console.error('Failed to save calendar events:', error);
            showWarningToast('Leave added to calendar but failed to save to Confluence');
          }
                });

                /*=====================*/
                // Calendar Init (No longer needed - using simple array)
                /*=====================*/
                // Calendar events array is already initialized above

                // Reset modal fields when hidden
          document.getElementById("eventModal").addEventListener("click", (event) => {
                    if (event.target.classList.contains("modal-close-btn")) {
                        closeModal();
                    }
                });

                function resetModalFields() {
            document.getElementById('event-team-member').value = "";
            document.getElementById('event-delegate').value = "";
                    getModalStartDateEl.value = "";
                    getModalEndDateEl.value = "";
                    const getModalIfCheckedRadioBtnEl = document.querySelector(
              'input[name="event-level"]:checked',
                    );
                    if (getModalIfCheckedRadioBtnEl) {
                        getModalIfCheckedRadioBtnEl.checked = false;
                    }
                }

                document
                    .getElementById("eventModal")
                    .addEventListener("hidden.bs.modal", () => {
                        resetModalFields();
                    });

                // Close modal when clicking on close button or outside modal
                document.querySelectorAll(".modal-close-btn").forEach((btn) => {
                    btn.addEventListener("click", closeModal);
                });

                window.addEventListener("click", (event) => {
                    if (event.target === document.getElementById("eventModal")) {
                        closeModal();
                    }
                });

          // Initialize calendar events array (already done above)
          // No render needed - using simple array instead of FullCalendar
          
          // Close team modal on button click
          document.querySelectorAll(".modal-close-team-btn").forEach((btn) => {
            btn.addEventListener("click", closeTeamManagementModal);
          });

          window.addEventListener("click", (event) => {
            if (event.target === document.getElementById("teamManagementModal")) {
              closeTeamManagementModal();
            }
          });

          // Close team member modal on button click
          document.querySelectorAll(".modal-close-member-btn").forEach((btn) => {
            btn.addEventListener("click", closeTeamMemberModal);
          });

          window.addEventListener("click", (event) => {
            if (event.target === document.getElementById("teamMemberModal")) {
              closeTeamMemberModal();
            }
          });

          // Close delete confirmation modal on button click
          document.querySelectorAll(".modal-close-delete-btn").forEach((btn) => {
            btn.addEventListener("click", closeDeleteConfirmationModal);
          });

          window.addEventListener("click", (event) => {
            if (event.target === document.getElementById("deleteConfirmationModal")) {
              closeDeleteConfirmationModal();
            }
          });

          // Close fetch holidays confirmation modal on button click
          document.querySelectorAll(".modal-close-fetch-btn").forEach((btn) => {
            btn.addEventListener("click", closeFetchHolidaysModal);
          });

          window.addEventListener("click", (event) => {
            if (event.target === document.getElementById("fetchHolidaysConfirmModal")) {
              closeFetchHolidaysModal();
            }
          });

        // Load team members and calendar events on page load
        setTimeout(async () => {
            await loadTeamMembers();
            await loadCalendarEvents();
            console.log(' Data loaded - teamMembers:', teamMembers.length, ', calendarEvents:', calendarEvents.length);
              initializeAnalytics();
            initializeTimeline();
          }, 500);

        console.log(' Calendar and all handlers initialized and exposed to global scope');

        // ============================================
        // Attach Event Listeners for Calendar Action Buttons
        // (Must be inside this block to access the functions)
        // ============================================
        
        // Add Leave Button
        const addLeaveBtn = document.getElementById('addLeaveButton');
        if (addLeaveBtn) {
          addLeaveBtn.addEventListener('click', function() {
            console.log('Add Leave button clicked');
            calendarAddEvent();
          });
          console.log('    Add Leave button listener attached');
        }

        // Manage Team Button
        const manageTeamBtn = document.getElementById('manageTeamButton');
        if (manageTeamBtn) {
          manageTeamBtn.addEventListener('click', function() {
            console.log('Manage Team button clicked');
            openTeamManagementModal();
          });
          console.log('    Manage Team button listener attached');
        }

        // Fetch Holidays Button
        const fetchHolidaysBtn = document.getElementById('fetchHolidaysButton');
        if (fetchHolidaysBtn) {
          fetchHolidaysBtn.addEventListener('click', function() {
            console.log('Fetch Holidays button clicked');
            fetchPublicHolidays();
          });
          console.log('    Fetch Holidays button listener attached');
        }

        // Download Outlook Button
        const downloadOutlookBtn = document.getElementById('downloadOutlookButton');
        if (downloadOutlookBtn) {
          downloadOutlookBtn.addEventListener('click', function() {
            console.log('Download Outlook button clicked');
            downloadOutlookCalendar();
          });
          console.log('    Download Outlook button listener attached');
        }
    });

    // ============================================
    // Event Listeners (outside DOMContentLoaded for better Confluence compatibility)
    // ============================================
    document.addEventListener('DOMContentLoaded', function() {
      // Leave Requests Pagination
      const previousLeaveBtn = document.getElementById('previousLeavePageBtn');
      const nextLeaveBtn = document.getElementById('nextLeavePageBtn');
      if (previousLeaveBtn) previousLeaveBtn.addEventListener('click', previousLeavePage);
      if (nextLeaveBtn) nextLeaveBtn.addEventListener('click', nextLeavePage);

      // Public Holidays Pagination
      const previousHolidayBtn = document.getElementById('previousHolidayPageBtn');
      const nextHolidayBtn = document.getElementById('nextHolidayPageBtn');
      if (previousHolidayBtn) previousHolidayBtn.addEventListener('click', previousHolidayPage);
      if (nextHolidayBtn) nextHolidayBtn.addEventListener('click', nextHolidayPage);

      // Calendar Action Buttons are now attached inside the calendar DOMContentLoaded block
      // (Add Leave, Manage Team, Fetch Holidays, Download Outlook)

      // Team Member Management Buttons
      const openTeamMemberBtn = document.getElementById('openAddTeamMemberBtn');
      const closeTeamMemberBtn = document.getElementById('closeTeamMemberModalBtn');
      if (openTeamMemberBtn) openTeamMemberBtn.addEventListener('click', openAddTeamMemberForm);
      if (closeTeamMemberBtn) closeTeamMemberBtn.addEventListener('click', closeTeamMemberModal);

      // Delete Confirmation Modal Buttons
      const closeDeleteBtn = document.getElementById('closeDeleteConfirmationBtn');
      const confirmDeleteBtn = document.getElementById('confirmDeleteTeamMemberBtn');
      if (closeDeleteBtn) closeDeleteBtn.addEventListener('click', closeDeleteConfirmationModal);
      if (confirmDeleteBtn) confirmDeleteBtn.addEventListener('click', confirmDeleteTeamMember);

      // Fetch Holidays Modal Buttons
      const closeFetchHolidaysBtn = document.getElementById('closeFetchHolidaysBtn');
      const confirmFetchHolidaysBtn = document.getElementById('confirmFetchHolidaysBtn');
      if (closeFetchHolidaysBtn) closeFetchHolidaysBtn.addEventListener('click', closeFetchHolidaysModal);
      if (confirmFetchHolidaysBtn) confirmFetchHolidaysBtn.addEventListener('click', confirmFetchHolidays);

      // Event delegation for dynamically generated team member buttons
      document.addEventListener('click', function(e) {
        // Edit team member button
        if (e.target.closest('.edit-team-member-btn')) {
          const memberId = e.target.closest('.edit-team-member-btn').dataset.memberId;
          if (memberId) editTeamMember(memberId);
        }
        
        // Delete team member button
        if (e.target.closest('.delete-team-member-btn')) {
          const memberId = e.target.closest('.delete-team-member-btn').dataset.memberId;
          if (memberId) deleteTeamMember(memberId);
        }
      });

      console.log(' All event listeners attached successfully');
      });
      
      /*=====================================================*/
      // Analytics and Summary Dashboard Functions
      /*=====================================================*/
      
      function initializeAnalytics() {
        console.log(' initializeAnalytics called, calendarEvents:', calendarEvents.length);
        calculateAndDisplayMetrics();
        initializeLeaveTrendsChart();
        initializeLeaveBreakdownChart();
        populateRecentLeavesTable();
        populateHolidaysTable();
      }
      
      function calculateAndDisplayMetrics() {
        const events = calendarEvents;
        
        // Count leave types
        let annualCount = 0;
        let sickCount = 0;
        let publicCount = 0;
        let otherCount = 0;
        
        events.forEach(event => {
          const leaveType = event.extendedProps.calendar;
        switch (leaveType) {
            case 'Annual':
              annualCount++;
              break;
            case 'Sick':
              sickCount++;
              break;
            case 'Public':
              publicCount++;
              break;
            case 'Other':
              otherCount++;
              break;
          }
        });
        
        const totalCount = events.length;
        
        // Update metric cards
        document.getElementById('total-leaves-count').textContent = totalCount;
        document.getElementById('annual-leave-count').textContent = annualCount;
        document.getElementById('sick-leave-count').textContent = sickCount;
        document.getElementById('public-leave-count').textContent = publicCount;
        
        // Calculate percentages
        const annualPercentage = totalCount > 0 ? Math.round((annualCount / totalCount) * 100) : 0;
        const sickPercentage = totalCount > 0 ? Math.round((sickCount / totalCount) * 100) : 0;
        const publicPercentage = totalCount > 0 ? Math.round((publicCount / totalCount) * 100) : 0;
        
        document.getElementById('annual-percentage').textContent = annualPercentage + '%';
        document.getElementById('sick-percentage').textContent = sickPercentage + '%';
        document.getElementById('public-percentage').textContent = publicPercentage + '%';
        
      }
      
      function initializeLeaveTrendsChart() {
        const events = calendarEvents;
        const chartElement = document.querySelector("#leaveTrendsChart");
        
        if (!chartElement) return;
        
        // Destroy existing chart if it exists
        if (leaveTrendsChart) {
          leaveTrendsChart.destroy();
          leaveTrendsChart = null;
        }
        
        // Clear the element
        chartElement.innerHTML = '';
        
        // Show "no data" message if no events
        if (events.length === 0) {
          chartElement.innerHTML = `
            <div class="flex items-center justify-center py-20">
              <div class="text-center">
                <svg class="mx-auto h-12 w-12 text-gray-400 dark:text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                </svg>
                <p class="mt-4 !text-base text-gray-500 dark:text-gray-400">No leave data available</p>
                <p class="mt-1 !text-base text-gray-400 dark:text-gray-500">Add leave requests to see trends</p>
              </div>
            </div>
          `;
          return;
        }
        
        // Initialize monthly data
        const monthlyData = {};
        const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
        
        months.forEach(month => {
          monthlyData[month] = {
            Annual: 0,
            Sick: 0,
            Public: 0,
            Other: 0
          };
        });
        
        // Count leaves per month
        events.forEach(event => {
          const startDate = typeof event.start === 'string' ? new Date(event.start) : event.start;
          const month = months[startDate.getMonth()];
          const leaveType = event.extendedProps.calendar;
          if (monthlyData[month] && monthlyData[month][leaveType] !== undefined) {
            monthlyData[month][leaveType]++;
          }
        });
        
        // Prepare series data
        const annualData = months.map(month => monthlyData[month].Annual);
        const sickData = months.map(month => monthlyData[month].Sick);
        const publicData = months.map(month => monthlyData[month].Public);
        const otherData = months.map(month => monthlyData[month].Other);
        
        const chartOptions = {
          series: [
            { name: "Annual Leave", data: annualData },
            { name: "Sick Leave", data: sickData },
            { name: "Public Holidays", data: publicData },
            { name: "Other", data: otherData }
          ],
          legend: {
            show: true,
            position: "top",
            horizontalAlign: "left",
          },
          colors: ["#10B981", "#EF4444", "#8B5CF6", "#F59E0B"],
          chart: {
            fontFamily: "Outfit, sans-serif",
            height: 335,
            type: "area",
            toolbar: { show: false },
          parentHeightOffset: 0,
          },
          stroke: {
            curve: "smooth",
            width: 2,
          },
          dataLabels: { enabled: false },
          markers: { size: 0 },
          xaxis: {
            categories: months,
            axisBorder: { show: false },
            axisTicks: { show: false },
          },
          fill: {
            type: 'gradient',
            gradient: {
              enabled: true,
              opacityFrom: 0.55,
              opacityTo: 0,
            },
          },
          grid: {
            xaxis: { lines: { show: false } },
          yaxis: {
            lines: {
              show: true,
              borderColor: '#E5E7EB',
              strokeDashArray: 4
            }
          },
          },
          yaxis: {
            title: { style: { fontSize: "0px" } },
          },
        };
        
        leaveTrendsChart = new ApexCharts(chartElement, chartOptions);
        leaveTrendsChart.render();
      }
      
      function initializeLeaveBreakdownChart() {
        const events = calendarEvents;
        const chartElement = document.querySelector("#leaveBreakdownChart");
        
        if (!chartElement) return;
        
        // Destroy existing chart if it exists
        if (leaveBreakdownChart) {
          leaveBreakdownChart.destroy();
          leaveBreakdownChart = null;
        }
        
        // Clear the element
        chartElement.innerHTML = '';
        
        // Show "no data" message if no events
        if (events.length === 0) {
          chartElement.innerHTML = `
            <div class="flex items-center justify-center py-20">
              <div class="text-center">
                <svg class="mx-auto h-12 w-12 text-gray-400 dark:text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                </svg>
                <p class="mt-4 !text-base text-gray-500 dark:text-gray-400">No leave data available</p>
                <p class="mt-1 !text-base text-gray-400 dark:text-gray-500">Add leave requests to see breakdown</p>
              </div>
            </div>
          `;
          return;
        }
        
        // Count leave types
        let annualCount = 0;
        let sickCount = 0;
        let publicCount = 0;
        let otherCount = 0;
        
        events.forEach(event => {
          const leaveType = event.extendedProps.calendar;
        switch (leaveType) {
            case 'Annual':
              annualCount++;
              break;
            case 'Sick':
              sickCount++;
              break;
            case 'Public':
              publicCount++;
              break;
            case 'Other':
              otherCount++;
              break;
          }
        });
        
        const chartOptions = {
          series: [
            { name: "Leave Days", data: [annualCount, sickCount, publicCount, otherCount] }
          ],
          colors: ["#465fff"],
          chart: {
            fontFamily: "Outfit, sans-serif",
            type: "bar",
            height: 335,
            toolbar: { show: false },
          parentHeightOffset: 0,
          },
          plotOptions: {
            bar: {
              horizontal: false,
              columnWidth: "50%",
              borderRadius: 5,
              borderRadiusApplication: "end",
              dataLabels: {
                position: "top",
              },
            },
          },
          dataLabels: { 
            enabled: true,
            offsetY: -25,
            style: {
              fontSize: "11px",
              fontWeight: 600,
              colors: ["#374151"],
            },
            background: {
              enabled: true,
              foreColor: "#374151",
              backgroundColor: "#F3F4F6",
              borderRadius: 8,
              padding: 6,
              opacity: 1,
              borderWidth: 0,
            },
          },
          stroke: {
            show: true,
            width: 4,
            colors: ["transparent"],
          },
          xaxis: {
            categories: ["Annual", "Sick", "Public", "Other"],
            axisBorder: { show: false },
            axisTicks: { show: false },
          },
          legend: {
            show: false,
          },
          yaxis: { title: false },
          grid: {
          yaxis: {
            lines: {
              show: true,
              borderColor: '#E5E7EB',
              strokeDashArray: 4
            }
          },
          },
          fill: { opacity: 1 },
          tooltip: {
            x: { show: true },
            y: {
              formatter: function (val) {
                return val + " days";
              },
            },
          },
        };
        
        leaveBreakdownChart = new ApexCharts(chartElement, chartOptions);
        leaveBreakdownChart.render();
      }

    function initializeTeamSummaryChart() {
      const events = calendarEvents;
      const chartElement = document.querySelector("#teamSummaryChart");

      if (!chartElement) return;

      // Destroy existing chart if it exists
      if (teamSummaryChart) {
        teamSummaryChart.destroy();
        teamSummaryChart = null;
      }

      // Clear the element
      chartElement.innerHTML = '';

      // Calculate team summary data
      const totalMembers = teamMembers.length;
      const today = new Date();
      today.setHours(0, 0, 0, 0);

      let currentLeaveCount = 0;
      let upcomingLeaveCount = 0;

      events.forEach(event => {
        const startDate = new Date(event.start);
        const endDate = event.end ? new Date(event.end) : startDate;
        startDate.setHours(0, 0, 0, 0);
        endDate.setHours(0, 0, 0, 0);

        if (startDate <= today && endDate >= today) {
          currentLeaveCount++;
        } else if (startDate > today) {
          upcomingLeaveCount++;
        }
      });

      // Show "no data" message if no team members
      if (totalMembers === 0) {
        chartElement.innerHTML = `
            <div class="flex items-center justify-center py-20">
              <div class="text-center">
                <svg class="mx-auto h-12 w-12 text-gray-400 dark:text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path>
                </svg>
                <p class="mt-4 !text-base text-gray-500 dark:text-gray-400">No team members available</p>
                <p class="mt-1 !text-base text-gray-400 dark:text-gray-500">Add team members to see summary</p>
              </div>
            </div>
          `;
        return;
      }

      // Update total team members display in badge
      document.getElementById('team-summary-total-badge').textContent = totalMembers;

      const chartOptions = {
        series: [currentLeaveCount, upcomingLeaveCount],
        colors: ["#EF4444", "#10B981"],
        labels: ["On Leave", "Upcoming"],
        chart: {
          fontFamily: "Outfit, sans-serif",
          type: "donut",
          width: 445,
          height: 290,
          parentHeightOffset: 0,
        },
        plotOptions: {
          pie: {
            donut: {
              size: "65%",
              background: "transparent",
              labels: {
                show: true,
                value: {
                  show: true,
                  offsetY: 0,
                },
              },
            },
          },
        },
        dataLabels: {
          enabled: false,
        },
        tooltip: {
          enabled: true,
        },
        stroke: {
          show: false,
          width: 4,
          colors: "transparent",
        },
        legend: {
          show: true,
          position: "bottom",
          horizontalAlign: "center",
          fontFamily: "Outfit",
          fontSize: "14px",
          fontWeight: 400,
          labels: {
            colors: ['#6B7280'],
          },
          markers: {
            size: 5,
            shape: "circle",
            radius: 999,
            strokeWidth: 0,
          },
          itemMargin: {
            horizontal: 10,
            vertical: 0,
          },
        },
        responsive: [
          {
            breakpoint: 640,
            options: {
              chart: {
                width: 370,
                height: 290,
              },
            },
          },
        ],
      };

      teamSummaryChart = new ApexCharts(chartElement, chartOptions);
      teamSummaryChart.render();
    }

    // ============================================
    // RECENT LEAVE REQUESTS TABLE WITH FILTER AND PAGINATION
    // ============================================
    let allLeaveRequests = [];
    let filteredLeaveRequests = [];
    let leaveCurrentPage = 1;
    let leavesPerPage = 10;
    let leaveFilterMode = 'top10'; // 'top10' or 'all'
      
      function populateRecentLeavesTable() {
        const events = calendarEvents;

      // Filter out public holidays and sort by start date (most recent first)
      allLeaveRequests = events
        .filter(event => event.extendedProps.calendar !== 'Public')
        .sort((a, b) => {
          const dateA = typeof a.start === 'string' ? new Date(a.start) : a.start;
          const dateB = typeof b.start === 'string' ? new Date(b.start) : b.start;
          return dateB - dateA;
        });

      filteredLeaveRequests = [...allLeaveRequests];
      leaveCurrentPage = 1;
      updateLeaveRequestsTable();
    }

    function setLeaveFilter(mode) {
      leaveFilterMode = mode;
      leaveCurrentPage = 1;

      // Update pagination visibility
      const paginationContainer = document.getElementById('leavePaginationContainer');

      if (mode === 'top10') {
        paginationContainer.classList.add('hidden');
      } else {
        paginationContainer.classList.remove('hidden');
      }

      updateLeaveRequestsTable();
      
      if (typeof showSuccessToast === 'function') {
        showSuccessToast(`Showing ${mode === 'top10' ? 'top 10' : 'all'} leave requests`);
      }
    }
    window.setLeaveFilter = setLeaveFilter;

    function updateLeaveRequestsTable() {
        const tbody = document.getElementById('recentLeavesTableBody');
        
        if (!tbody) return;
        
        // Clear existing rows
        tbody.innerHTML = '';
        
        // Show "no data" message if no events
      if (filteredLeaveRequests.length === 0) {
          tbody.innerHTML = `
            <tr>
              <td colspan="6" class="px-6 py-8 text-center">
                <p class="text-gray-500 dark:text-gray-400">No leave data available. Add leave requests to see them here.</p>
              </td>
            </tr>
          `;
        const countElement = document.getElementById('recent-leaves-count');
        if (countElement) {
          countElement.textContent = '0';
        }
          return;
        }

      // Determine which events to show based on filter mode
      let eventsToShow;
      if (leaveFilterMode === 'top10') {
        eventsToShow = filteredLeaveRequests.slice(0, 10);
      } else {
        // Pagination for "All" mode
        const startIndex = (leaveCurrentPage - 1) * leavesPerPage;
        const endIndex = startIndex + leavesPerPage;
        eventsToShow = filteredLeaveRequests.slice(startIndex, endIndex);
        }
        
        // Populate table
      eventsToShow.forEach(event => {
          const teamMemberId = event.extendedProps.teamMember;
          const teamMember = teamMembers.find(m => m.id === teamMemberId);
          const memberName = teamMember ? teamMember.name : 'Unknown';
          
          const leaveType = event.extendedProps.calendar;
          const start = typeof event.start === 'string' ? new Date(event.start) : event.start;
          const end = event.end ? (typeof event.end === 'string' ? new Date(event.end) : event.end) : start;
          const startDate = start.toLocaleDateString();
          const endDate = end.toLocaleDateString();
          
          // Calculate days
          const diffTime = Math.abs(end - start);
          const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24)) + 1;
          
          // Color coding for leave types with badge styling
          let leaveTypeBadge = '';
        switch (leaveType) {
            case 'Annual':
            leaveTypeBadge = '<span class="inline-flex items-center rounded-full bg-green-100 px-2.5 py-0.5 !text-base font-medium text-green-700 dark:bg-green-900/20 dark:text-green-400">Annual</span>';
              break;
            case 'Sick':
            leaveTypeBadge = '<span class="inline-flex items-center rounded-full bg-red-100 px-2.5 py-0.5 !text-base font-medium text-red-700 dark:bg-red-900/20 dark:text-red-400">Sick</span>';
              break;
            case 'Public':
            leaveTypeBadge = '<span class="inline-flex items-center rounded-full bg-purple-100 px-2.5 py-0.5 !text-base font-medium text-purple-700 dark:bg-purple-900/20 dark:text-purple-400">Public</span>';
              break;
            case 'Other':
            leaveTypeBadge = '<span class="inline-flex items-center rounded-full bg-amber-100 px-2.5 py-0.5 !text-base font-medium text-amber-700 dark:bg-amber-900/20 dark:text-amber-400">Other</span>';
              break;
          }
          
          // Get delegate name
          const delegateId = event.extendedProps.delegate;
          const delegate = teamMembers.find(m => m.id === delegateId);
          const delegateName = delegate ? delegate.name : '-';
          
          const row = document.createElement('tr');
          row.className = 'hover:bg-gray-50 dark:hover:bg-gray-800/50 transition-colors';
          row.innerHTML = `
            <td class="px-6 py-4 text-center whitespace-nowrap">
              <span class="!text-base font-medium text-gray-900 dark:text-white">${memberName}</span>
            </td>
            <td class="px-6 py-4 text-center whitespace-nowrap">
              ${leaveTypeBadge}
            </td>
            <td class="px-6 py-4 text-center whitespace-nowrap">
              <span class="!text-base text-gray-700 dark:text-gray-300">${startDate}</span>
            </td>
            <td class="px-6 py-4 text-center whitespace-nowrap">
              <span class="!text-base text-gray-700 dark:text-gray-300">${endDate}</span>
            </td>
            <td class="px-6 py-4 text-center whitespace-nowrap">
              <span class="!text-base font-semibold text-gray-900 dark:text-white">${diffDays}</span>
            </td>
            <td class="px-6 py-4 text-center whitespace-nowrap">
              <span class="!text-base ${delegateId ? 'font-medium text-gray-900 dark:text-white' : 'text-gray-400 dark:text-gray-500'}">${delegateName}</span>
            </td>
          `;
          tbody.appendChild(row);
        });

      // Update pagination if in "All" mode
      if (leaveFilterMode === 'all') {
        updateLeavePagination();
      }
    }

    function updateLeavePagination() {
      const pagination = document.getElementById('leavePagination');
      const totalPages = Math.ceil(filteredLeaveRequests.length / leavesPerPage);

      if (!pagination) return;

      pagination.innerHTML = '';

      // Always show first page
      if (totalPages > 0) {
        addLeavePageButton(1);
      }

      // Show ellipsis if needed
      if (leaveCurrentPage > 3) {
        addLeaveEllipsis();
      }

      // Show pages around current page
      for (let i = Math.max(2, leaveCurrentPage - 1); i <= Math.min(totalPages - 1, leaveCurrentPage + 1); i++) {
        if (i > 1 && i < totalPages) {
          addLeavePageButton(i);
        }
      }

      // Show ellipsis if needed
      if (leaveCurrentPage < totalPages - 2) {
        addLeaveEllipsis();
      }

      // Always show last page
      if (totalPages > 1) {
        addLeavePageButton(totalPages);
      }

      document.getElementById('leaveCurrentPage').textContent = leaveCurrentPage;
      document.getElementById('leaveTotalPages').textContent = totalPages;
    }

    function addLeavePageButton(pageNum) {
      const pagination = document.getElementById('leavePagination');
      const li = document.createElement('li');
      const a = document.createElement('a');
      a.href = '#';
      a.className = pageNum === leaveCurrentPage
        ? 'bg-brand-500/[0.08] !!text-lg text-brand-500 hover:bg-brand-500/[0.08] hover:text-brand-500 flex h-10 w-10 items-center justify-center rounded-lg font-medium'
        : '!!text-lg hover:bg-brand-500/[0.08] hover:text-brand-500 flex h-10 w-10 items-center justify-center rounded-lg font-medium !text-gray-700 dark:!text-gray-400';
      a.textContent = pageNum;
      a.onclick = (e) => {
        e.preventDefault();
        leaveCurrentPage = pageNum;
        updateLeaveRequestsTable();
      };
      li.appendChild(a);
      pagination.appendChild(li);
    }

    function addLeaveEllipsis() {
      const pagination = document.getElementById('leavePagination');
      const li = document.createElement('li');
      li.className = '!!text-lg flex h-10 w-10 items-center justify-center text-gray-700 dark:!text-gray-400';
      li.textContent = '...';
      pagination.appendChild(li);
    }

    function nextLeavePage() {
      const totalPages = Math.ceil(filteredLeaveRequests.length / leavesPerPage);
      if (leaveCurrentPage < totalPages) {
        leaveCurrentPage++;
        updateLeaveRequestsTable();
      }
    }

    function previousLeavePage() {
      if (leaveCurrentPage > 1) {
        leaveCurrentPage--;
        updateLeaveRequestsTable();
      }
    }

    function filterLeaveRequests() {
      const searchTerm = document.getElementById('leaveSearchInput').value.toLowerCase();

      filteredLeaveRequests = allLeaveRequests.filter(event => {
        const teamMemberId = event.extendedProps.teamMember;
        const teamMember = teamMembers.find(m => m.id === teamMemberId);
        const memberName = teamMember ? teamMember.name.toLowerCase() : '';
        const leaveType = event.extendedProps.calendar.toLowerCase();
        const delegateId = event.extendedProps.delegate;
        const delegate = teamMembers.find(m => m.id === delegateId);
        const delegateName = delegate ? delegate.name.toLowerCase() : '';

        return memberName.includes(searchTerm) ||
          leaveType.includes(searchTerm) ||
          delegateName.includes(searchTerm);
      });

      leaveCurrentPage = 1;
      updateLeaveRequestsTable();
      }
      
      // Refresh analytics whenever events change
      function refreshAnalytics() {
        if (typeof initializeAnalytics === 'function') {
          initializeAnalytics();
        }
        if (typeof renderTimelineGrid === 'function') {
          renderTimelineGrid();
        }
      }

    // ============================================
    // TIMELINE GRID VIEW
    // ============================================
    let timelineStartDate = null;
    let timelineEndDate = null;
    let timelineRange = 'thisWeek'; // 'thisWeek', 'thisMonth', 'next2Weeks', 'custom'

    function selectTimelineRange(range) {
      const now = new Date();
      
      switch(range) {
        case 'week':
          timelineStartDate = getStartOfWeek(now);
          timelineEndDate = getEndOfWeek(now);
          break;
        case 'month':
          timelineStartDate = new Date(now.getFullYear(), now.getMonth(), 1);
          timelineEndDate = new Date(now.getFullYear(), now.getMonth() + 1, 0);
          break;
        case 'quarter':
          const currentQuarter = Math.floor(now.getMonth() / 3);
          timelineStartDate = new Date(now.getFullYear(), currentQuarter * 3, 1);
          timelineEndDate = new Date(now.getFullYear(), (currentQuarter + 1) * 3, 0);
          break;
        case 'year':
          timelineStartDate = new Date(now.getFullYear(), 0, 1);
          timelineEndDate = new Date(now.getFullYear(), 11, 31);
          break;
      }
      
      // Update date inputs
      const startInput = document.getElementById('timelineStartDate');
      const endInput = document.getElementById('timelineEndDate');
      if (startInput) startInput.value = formatDateForInput(timelineStartDate);
      if (endInput) endInput.value = formatDateForInput(timelineEndDate);
      
      renderTimelineGrid();
      
      if (typeof showSuccessToast === 'function') {
        showSuccessToast(`Timeline updated to ${range} view`);
      }
    }
    window.selectTimelineRange = selectTimelineRange;

    function initializeTimeline() {
      console.log(' initializeTimeline called, teamMembers:', teamMembers.length, ', calendarEvents:', calendarEvents.length);
      // Set default to current week
      selectTimelineRange('week');
      
      // Get date inputs
      const startInput = document.getElementById('timelineStartDate');
      const endInput = document.getElementById('timelineEndDate');
      
      // Prevent event propagation on date inputs to avoid conflicts
      if (startInput) {
        // Stop propagation on all events that might interfere
        startInput.addEventListener('click', function(e) {
          e.stopPropagation();
        });
        startInput.addEventListener('focus', function(e) {
          e.stopPropagation();
        });
        startInput.addEventListener('mousedown', function(e) {
          e.stopPropagation();
        });
        
        // Handle change event
        startInput.addEventListener('change', function(e) {
          e.stopPropagation();
          console.log('Start date changed:', startInput.value);
          if (endInput.value) {
            setTimeout(() => applyCustomRange(), 100);
          }
        });
      }
      
      if (endInput) {
        // Stop propagation on all events that might interfere
        endInput.addEventListener('click', function(e) {
          e.stopPropagation();
        });
        endInput.addEventListener('focus', function(e) {
          e.stopPropagation();
        });
        endInput.addEventListener('mousedown', function(e) {
          e.stopPropagation();
        });
        
        // Handle change event
        endInput.addEventListener('change', function(e) {
          e.stopPropagation();
          console.log('End date changed:', endInput.value);
          if (startInput.value) {
            setTimeout(() => applyCustomRange(), 100);
          }
        });
      }
    }
    
    function getStartOfWeek(date) {
      const d = new Date(date);
      const day = d.getDay();
      const diff = d.getDate() - day + (day === 0 ? -6 : 1); // Monday as start of week
      d.setDate(diff);
      return d;
    }
    
    function getEndOfWeek(date) {
      const d = getStartOfWeek(date);
      d.setDate(d.getDate() + 6); // Sunday
      return d;
    }
    
    function formatDateForInput(date) {
      const year = date.getFullYear();
      const month = String(date.getMonth() + 1).padStart(2, '0');
      const day = String(date.getDate()).padStart(2, '0');
      return `${year}-${month}-${day}`;
    }

    function applyCustomRange() {
      console.log('applyCustomRange called');
      const startInput = document.getElementById('timelineStartDate');
      const endInput = document.getElementById('timelineEndDate');
      
      console.log('Start value:', startInput?.value);
      console.log('End value:', endInput?.value);
      
      if (!startInput.value || !endInput.value) {
        console.warn('Missing date values');
        if (typeof showWarningToast === 'function') {
          showWarningToast('Please select both start and end dates');
        }
        return;
      }
      
      // Parse dates correctly
      const startParts = startInput.value.split('-');
      const endParts = endInput.value.split('-');
      
      timelineStartDate = new Date(parseInt(startParts[0]), parseInt(startParts[1]) - 1, parseInt(startParts[2]));
      timelineEndDate = new Date(parseInt(endParts[0]), parseInt(endParts[1]) - 1, parseInt(endParts[2]));
      
      console.log('Parsed start date:', timelineStartDate);
      console.log('Parsed end date:', timelineEndDate);
      
      if (timelineStartDate > timelineEndDate) {
        console.warn('Start date is after end date');
        if (typeof showWarningToast === 'function') {
          showWarningToast('Start date must be before end date');
        }
        return;
      }
      
      console.log('Rendering timeline grid with new dates');
      renderTimelineGrid();
      
      if (typeof showSuccessToast === 'function') {
        showSuccessToast('Timeline updated successfully');
      }
    }

    function renderTimelineGrid() {
      console.log(' renderTimelineGrid called');
      const thead = document.querySelector('#timelineTableBody').parentElement.querySelector('thead tr');
      const tbody = document.getElementById('timelineTableBody');
      console.log('   tbody:', !!tbody, ', thead:', !!thead, ', startDate:', timelineStartDate, ', endDate:', timelineEndDate);
      if (!tbody || !thead || !timelineStartDate || !timelineEndDate) {
        console.log('    Early return - missing elements or dates');
        return;
      }
      
      // Generate date array
      const dates = [];
      const currentDate = new Date(timelineStartDate);
      while (currentDate <= timelineEndDate) {
        dates.push(new Date(currentDate));
        currentDate.setDate(currentDate.getDate() + 1);
      }
      
      // Get events from calendar
      const events = calendarEvents;
      
      // Calculate dynamic width based on longest team member name
      let maxNameLength = 0;
      let longestName = '';
      teamMembers.forEach(member => {
        if (member.name && member.name.length > maxNameLength) {
          maxNameLength = member.name.length;
          longestName = member.name;
        }
      });
      
      // Calculate width: ~9.5px per character + 48px padding (24px each side)
      // Minimum width of 180px, maximum of 350px
      const dynamicWidth = Math.min(Math.max(Math.ceil(maxNameLength * 9.5) + 48, 180), 350);
      
      console.log(`Team Member column width: ${dynamicWidth}px (longest name: "${longestName}", ${maxNameLength} chars)`);
      
      // Build header row with dates
      let headerHTML = `<th class="sticky left-0 z-20 border-r border-b border-gray-200 bg-gray-50 px-6 py-3 text-left dark:border-gray-700 dark:bg-gray-800 whitespace-nowrap" style="width: ${dynamicWidth}px; min-width: ${dynamicWidth}px; max-width: ${dynamicWidth}px;"><span class="!text-base font-medium text-gray-700 dark:text-gray-300">Team Member</span></th>`;
      
      dates.forEach(date => {
        const dayName = date.toLocaleDateString('en-US', { weekday: 'short' });
        const dayNum = date.getDate();
        const monthName = date.toLocaleDateString('en-US', { month: 'short' });
        const isWeekend = date.getDay() === 0 || date.getDay() === 6;
        const isToday = date.toDateString() === new Date().toDateString();
        
        headerHTML += `<th class="border-r border-b border-gray-200 dark:border-gray-700 px-2 py-2 text-center min-w-[80px] align-middle ${isWeekend ? 'bg-gray-100 dark:bg-gray-800' : 'bg-gray-50 dark:bg-gray-800/50'} ${isToday ? '!bg-brand-50 dark:!bg-brand-900/20' : ''}">`;
        headerHTML += `<div class="!text-base font-medium text-gray-500 dark:text-gray-400">${dayName}</div>`;
        headerHTML += `<div class="!text-base font-semibold text-gray-800 dark:text-gray-200">${dayNum}</div>`;
        headerHTML += `<div class="!text-base text-gray-500 dark:text-gray-400">${monthName}</div>`;
        headerHTML += '</th>';
      });
      
      thead.innerHTML = headerHTML;
      
      // Build body rows with team members
      let bodyHTML = '';
      
      // Body rows with team members
      teamMembers.forEach(member => {
        bodyHTML += '<tr class="hover:bg-gray-50 dark:hover:bg-gray-800/30 transition-colors">';
        bodyHTML += `<td class="sticky left-0 z-10 bg-white dark:bg-gray-900 border-r border-b border-gray-200 dark:border-gray-700 px-6 py-4 whitespace-nowrap" style="width: ${dynamicWidth}px; min-width: ${dynamicWidth}px; max-width: ${dynamicWidth}px;">`;
        bodyHTML += `<span class="!text-base font-medium text-gray-800 dark:text-white whitespace-nowrap">${member.name}</span>`;
        bodyHTML += '</td>';
        
        dates.forEach(date => {
          const dateStr = date.toISOString().split('T')[0];
          const isWeekend = date.getDay() === 0 || date.getDay() === 6;
          const isToday = date.toDateString() === new Date().toDateString();
          
          // Check for public holidays first (applies to everyone)
          const publicHoliday = events.find(event => {
            if (event.extendedProps.calendar !== 'Public') return false;
            const eventStart = new Date(event.start);
            const eventEnd = event.end ? new Date(event.end) : eventStart;
            eventStart.setHours(0, 0, 0, 0);
            eventEnd.setHours(0, 0, 0, 0);
            const checkDate = new Date(date);
            checkDate.setHours(0, 0, 0, 0);
            return checkDate >= eventStart && checkDate <= eventEnd;
          });
          
          // Find if there's member-specific leave on this date
          const memberLeave = events.find(event => {
            if (event.extendedProps.calendar === 'Public') return false; // Skip public holidays
            if (!event.extendedProps.teamMember || event.extendedProps.teamMember !== member.id) return false;
            const eventStart = new Date(event.start);
            const eventEnd = event.end ? new Date(event.end) : eventStart;
            eventStart.setHours(0, 0, 0, 0);
            eventEnd.setHours(0, 0, 0, 0);
            const checkDate = new Date(date);
            checkDate.setHours(0, 0, 0, 0);
            return checkDate >= eventStart && checkDate <= eventEnd;
          });
          
          let cellClass = 'border-r border-b border-gray-200 dark:border-gray-700 px-2 py-2 text-center transition-colors align-middle';
          let cellContent = '';
          let cellStyle = '';
          
          // Priority: Member leave > Public holiday > Weekend > Today
          if (memberLeave || publicHoliday) {
            const leaveEvent = memberLeave || publicHoliday;
            const leaveType = leaveEvent.extendedProps.calendar;
            let bgColor, textColor, badgeClass;
            
            switch(leaveType) {
              case 'Annual':
                // Green to match Recent Leave Requests table
                bgColor = 'rgb(220, 252, 231)'; // bg-green-100
                textColor = 'rgb(21, 128, 61)'; // text-green-700
                badgeClass = 'bg-green-100 text-green-700 dark:bg-green-900/20 dark:text-green-400';
                break;
              case 'Sick':
                // Red to match Recent Leave Requests table
                bgColor = 'rgb(254, 226, 226)'; // bg-red-100
                textColor = 'rgb(185, 28, 28)'; // text-red-700
                badgeClass = 'bg-red-100 text-red-700 dark:bg-red-900/20 dark:text-red-400';
                break;
              case 'Public':
                // Purple to match Recent Leave Requests table
                bgColor = 'rgb(243, 232, 255)'; // bg-purple-100
                textColor = 'rgb(126, 34, 206)'; // text-purple-700
                badgeClass = 'bg-purple-100 text-purple-700 dark:bg-purple-900/20 dark:text-purple-400';
                cellClass += ' cursor-default'; // Public holidays not clickable
                break;
              default: // Other
                // Amber to match Recent Leave Requests table
                bgColor = 'rgb(254, 243, 199)'; // bg-amber-100
                textColor = 'rgb(180, 83, 9)'; // text-amber-700
                badgeClass = 'bg-amber-100 text-amber-700 dark:bg-amber-900/20 dark:text-amber-400';
            }
            
            cellStyle = `background-color: ${bgColor};`;
            if (leaveType !== 'Public') {
              cellClass += ' cursor-pointer hover:opacity-80';
            }
            
            // Build cell content with badge and additional info
            let additionalInfo = '';
            
            if (leaveType === 'Public') {
              // For public holidays, show country/region below
              const country = leaveEvent.extendedProps.country || leaveEvent.extendedProps.region || '';
              if (country) {
                additionalInfo = `<div class="mt-1 !text-base text-gray-600 dark:text-gray-400">${country}</div>`;
              }
              } else {
              // For member leaves, show delegate below
              const delegateId = leaveEvent.extendedProps.delegate;
              if (delegateId) {
                const delegate = teamMembers.find(m => m.id === delegateId);
                if (delegate) {
                  additionalInfo = `<div class="mt-1 !text-base text-gray-600 dark:text-gray-400">Delegate: ${delegate.name}</div>`;
                }
              }
            }
            
            cellContent = `<div class="flex flex-col items-center justify-center"><span class="inline-flex items-center rounded-full px-2 py-0.5 !text-base font-medium ${badgeClass}">${leaveType === 'Public' ? 'Public' : leaveType}</span>${additionalInfo}</div>`;
          } else if (isWeekend) {
            cellClass += ' bg-gray-50 dark:bg-gray-800/50 cursor-default';
            cellContent = '<span class="!text-base text-gray-400 dark:text-gray-600">Weekend</span>';
              } else {
            cellClass += ' cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700 bg-white dark:bg-gray-900';
            if (isToday) {
              cellClass += ' !bg-brand-50 dark:!bg-brand-900/10';
            }
          }
          
          bodyHTML += `<td class="${cellClass}" ${cellStyle ? `style="${cellStyle}"` : ''} data-date="${dateStr}" data-member-id="${member.id}" ${publicHoliday || isWeekend ? '' : 'onclick="handleTimelineCellClick(event)"'}>`;
          bodyHTML += cellContent;
          bodyHTML += '</td>';
        });
        
        bodyHTML += '</tr>';
      });
      
      tbody.innerHTML = bodyHTML;
    }

    function handleTimelineCellClick(event) {
      event.stopPropagation(); // Prevent event bubbling
      
      const cell = event.currentTarget;
      const date = cell.dataset.date;
      const memberId = cell.dataset.memberId;
      
      if (!date || !memberId) return;
      
      // Find the member
      const member = teamMembers.find(m => m.id === memberId);
      if (!member) return;
      
      // Check if there's already leave on this date
      const events = calendarEvents;
      
      // Check for public holiday (not editable from timeline)
      const publicHoliday = events.find(event => {
        if (event.extendedProps.calendar !== 'Public') return false;
        const eventStart = new Date(event.start);
        const eventEnd = event.end ? new Date(event.end) : eventStart;
        const clickedDate = new Date(date);
        eventStart.setHours(0, 0, 0, 0);
        eventEnd.setHours(0, 0, 0, 0);
        clickedDate.setHours(0, 0, 0, 0);
        return clickedDate >= eventStart && clickedDate <= eventEnd;
      });
      
      if (publicHoliday) {
        // Don't allow editing public holidays
        return;
      }
      
      // Check for weekends
      const clickedDate = new Date(date);
      const isWeekend = clickedDate.getDay() === 0 || clickedDate.getDay() === 6;
      if (isWeekend) {
        // Don't allow adding leave on weekends
        return;
      }
      
      const existingLeave = events.find(event => {
        if (event.extendedProps.calendar === 'Public') return false;
        if (!event.extendedProps.teamMember || event.extendedProps.teamMember !== memberId) return false;
        const eventStart = new Date(event.start);
        const eventEnd = event.end ? new Date(event.end) : eventStart;
        const checkDate = new Date(date);
        eventStart.setHours(0, 0, 0, 0);
        eventEnd.setHours(0, 0, 0, 0);
        checkDate.setHours(0, 0, 0, 0);
        return checkDate >= eventStart && checkDate <= eventEnd;
      });
      
      if (existingLeave) {
        // Edit existing leave
        if (typeof calendarEventClick === 'function') {
          calendarEventClick({ event: existingLeave });
        }
      } else {
        // Add new leave
        if (typeof calendarAddEvent === 'function') {
          calendarAddEvent({ dateStr: date });
          // Pre-select the team member
          setTimeout(() => {
            const teamMemberDropdown = document.getElementById('event-team-member');
            if (teamMemberDropdown) {
              teamMemberDropdown.value = memberId;
              console.log(` Pre-selected team member: ${member.name} (ID: ${memberId})`);
              if (typeof updateDelegateOptions === 'function') {
                updateDelegateOptions(memberId);
              }
            } else {
              console.warn(' Team member dropdown not found');
            }
          }, 100);
        }
      }
    }

    // Make function globally accessible
    window.handleTimelineCellClick = handleTimelineCellClick;

    // ============================================
    // PUBLIC HOLIDAYS TABLE WITH PAGINATION
    // ============================================
    let allHolidays = [];
    let filteredHolidays = [];
    let holidayCurrentPage = 1;
    let holidaysPerPage = 10;

    function populateHolidaysTable() {
      const events = calendarEvents;
      console.log(' populateHolidaysTable called, calendarEvents:', events.length);

      // Filter only public holidays
      allHolidays = events
        .filter(event => event.extendedProps.calendar === 'Public')
        .map(event => ({
          name: event.title,
          date: event.start,
          countryCode: event.extendedProps.countryCode || 'N/A',
          localName: event.extendedProps.localName || event.title
        }))
        .sort((a, b) => {
          const dateA = typeof a.date === 'string' ? new Date(a.date) : a.date;
          const dateB = typeof b.date === 'string' ? new Date(b.date) : b.date;
          return dateA - dateB;
        });

      console.log('   Public holidays found:', allHolidays.length);
      filteredHolidays = [...allHolidays];
      holidayCurrentPage = 1;
      updateHolidaysTable();
    }

    function updateHolidaysTable() {
      console.log(' updateHolidaysTable called, filteredHolidays:', filteredHolidays.length);
      const tbody = document.getElementById('holidaysTableBody');

      if (!tbody) {
        console.log('    holidaysTableBody not found');
        return;
      }

      // Clear existing rows
      tbody.innerHTML = '';

      // Show "no data" message if no holidays
      if (filteredHolidays.length === 0) {
        tbody.innerHTML = `
            <tr>
              <td colspan="4" class="px-6 py-8 text-center">
                <p class="text-gray-500 dark:text-gray-400">No public holidays found. Use "Fetch Holidays" button to load holidays.</p>
              </td>
            </tr>
          `;
        return;
      }

      // Calculate pagination
      const startIndex = (holidayCurrentPage - 1) * holidaysPerPage;
      const endIndex = startIndex + holidaysPerPage;
      const pageHolidays = filteredHolidays.slice(startIndex, endIndex);

      // Populate table
      pageHolidays.forEach(holiday => {
        const holidayDate = typeof holiday.date === 'string' ? new Date(holiday.date) : holiday.date;
        const formattedDate = holidayDate.toLocaleDateString('en-US', {
          year: 'numeric',
          month: 'short',
          day: 'numeric'
        });

        const row = document.createElement('tr');
        row.className = 'hover:bg-gray-50 dark:hover:bg-gray-800/50 transition-colors';
        row.innerHTML = `
            <td class="px-6 py-4 text-center whitespace-nowrap">
              <span class="!text-base font-medium text-gray-900 dark:text-white">${holiday.name}</span>
            </td>
            <td class="px-6 py-4 text-center whitespace-nowrap">
              <span class="!text-base text-gray-700 dark:text-gray-300">${formattedDate}</span>
            </td>
            <td class="px-6 py-4 text-center whitespace-nowrap">
              <span class="inline-flex items-center rounded-full bg-purple-100 px-2.5 py-0.5 !text-base font-medium text-purple-700 dark:bg-purple-900/20 dark:text-purple-400">${holiday.countryCode}</span>
            </td>
            <td class="px-6 py-4 text-center whitespace-nowrap">
              <span class="!text-base text-gray-700 dark:text-gray-300">${holiday.localName}</span>
            </td>
          `;
        tbody.appendChild(row);
      });

      updateHolidayPagination();
    }

    function updateHolidayPagination() {
      const pagination = document.getElementById('holidayPagination');
      const totalPages = Math.ceil(filteredHolidays.length / holidaysPerPage);

      if (!pagination) return;

      pagination.innerHTML = '';

      // Always show first page
      if (totalPages > 0) {
        addHolidayPageButton(1);
      }

      // Show ellipsis if needed
      if (holidayCurrentPage > 3) {
        addHolidayEllipsis();
      }

      // Show pages around current page
      for (let i = Math.max(2, holidayCurrentPage - 1); i <= Math.min(totalPages - 1, holidayCurrentPage + 1); i++) {
        if (i > 1 && i < totalPages) {
          addHolidayPageButton(i);
        }
      }

      // Show ellipsis if needed
      if (holidayCurrentPage < totalPages - 2) {
        addHolidayEllipsis();
      }

      // Always show last page
      if (totalPages > 1) {
        addHolidayPageButton(totalPages);
      }

      document.getElementById('holidayCurrentPage').textContent = holidayCurrentPage;
      document.getElementById('holidayTotalPages').textContent = totalPages;
    }

    function addHolidayPageButton(pageNum) {
      const pagination = document.getElementById('holidayPagination');
      const li = document.createElement('li');
      const a = document.createElement('a');
      a.href = '#';
      a.className = pageNum === holidayCurrentPage
        ? 'bg-brand-500/[0.08] !!text-lg text-brand-500 hover:bg-brand-500/[0.08] hover:text-brand-500 flex h-10 w-10 items-center justify-center rounded-lg font-medium'
        : '!!text-lg hover:bg-brand-500/[0.08] hover:text-brand-500 flex h-10 w-10 items-center justify-center rounded-lg font-medium !text-gray-700 dark:!text-gray-400';
      a.textContent = pageNum;
      a.onclick = (e) => {
        e.preventDefault();
        holidayCurrentPage = pageNum;
        updateHolidaysTable();
      };
      li.appendChild(a);
      pagination.appendChild(li);
    }

    function addHolidayEllipsis() {
      const pagination = document.getElementById('holidayPagination');
      const li = document.createElement('li');
      li.className = '!!text-lg flex h-10 w-10 items-center justify-center text-gray-700 dark:!text-gray-400';
      li.textContent = '...';
      pagination.appendChild(li);
    }

    function nextHolidayPage() {
      const totalPages = Math.ceil(filteredHolidays.length / holidaysPerPage);
      if (holidayCurrentPage < totalPages) {
        holidayCurrentPage++;
        updateHolidaysTable();
      }
    }

    function previousHolidayPage() {
      if (holidayCurrentPage > 1) {
        holidayCurrentPage--;
        updateHolidaysTable();
      }
    }

    function filterHolidays() {
      const searchTerm = document.getElementById('holidaySearchInput').value.toLowerCase();

      filteredHolidays = allHolidays.filter(holiday => {
        return holiday.name.toLowerCase().includes(searchTerm) ||
          holiday.countryCode.toLowerCase().includes(searchTerm) ||
          holiday.localName.toLowerCase().includes(searchTerm) ||
          holiday.date.toLocaleDateString().toLowerCase().includes(searchTerm);
      });

      holidayCurrentPage = 1;
      updateHolidaysTable();
    }
      
      // Search functionality for leave requests table
    document.addEventListener('DOMContentLoaded', function () {
        const searchInput = document.getElementById('leaveSearchInput');
        if (searchInput) {
        searchInput.addEventListener('input', filterLeaveRequests);
      }

      // Items per page change for leave requests
      const leavesPerPageSelect = document.getElementById('leavesPerPage');
      if (leavesPerPageSelect) {
        leavesPerPageSelect.addEventListener('change', function (e) {
          leavesPerPage = parseInt(e.target.value);
          leaveCurrentPage = 1;
          updateLeaveRequestsTable();
        });
      }

      // Search functionality for holidays table
      const holidaySearchInput = document.getElementById('holidaySearchInput');
      if (holidaySearchInput) {
        holidaySearchInput.addEventListener('input', filterHolidays);
      }

      // Items per page change for holidays
      const holidaysPerPageSelect = document.getElementById('holidaysPerPage');
      if (holidaysPerPageSelect) {
        holidaysPerPageSelect.addEventListener('change', function (e) {
          holidaysPerPage = parseInt(e.target.value);
          holidayCurrentPage = 1;
          updateHolidaysTable();
          });
        }
      });

    // ============================================================================
    // NOTE: All event handlers are attached using addEventListener
    // See the event listeners section above for button click handlers
    // This approach works better with Confluence HTML Macros when files are split
    // ============================================================================
    </script>
</body>

</html>
