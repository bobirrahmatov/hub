<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Marketplace Requests</title>
    
    <!-- 
      CONFLUENCE MACRO REQUIRED: Include global-notifications.html as a macro
      This provides showSuccessToast(), showErrorToast(), showWarningToast(), showInfoToast()
    -->
    
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Only keep essential webkit scrollbar styles that can't be done with Tailwind */
        .custom-scrollbar::-webkit-scrollbar {
            height: 6px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 3px;
        }
        .dark .custom-scrollbar::-webkit-scrollbar-track {
            background: #374151;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 3px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
        .dark .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #6b7280;
        }
        .dark .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: #9ca3af;
        }
        
        /* Loading shimmer animation - can't be replicated with Tailwind alone */
        @keyframes shimmer {
            0% {
                background-position: -200% 0;
            }
            100% {
                background-position: 200% 0;
            }
        }
        .loading-shimmer {
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 200% 100%;
            animation: shimmer 1.5s infinite;
        }
        .dark .loading-shimmer {
            background: linear-gradient(90deg, #374151 25%, #4b5563 50%, #374151 75%);
            background-size: 200% 100%;
            animation: shimmer 1.5s infinite;
        }
    </style>
</head>
<body class="bg-gray-50 dark:bg-gray-900">
    <div class="p-4">
        <div class="rounded-2xl border border-gray-200 bg-white dark:border-gray-700 dark:bg-gray-800">
            <div class="px-5 py-4 sm:px-6 sm:py-5">
                <h3 class="!text-2xl font-medium !text-gray-800 dark:!text-white">
                    Marketplace Requests
                </h3>
            </div>
            <div class="border-t border-gray-100 p-5 sm:p-6 dark:border-gray-700">
                <!-- Search Section -->
                <div class="mb-4 flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between">
                        <div class="flex flex-1 items-center gap-4">
                            <div class="w-[512px]">
                                <div class="relative">
                                    <span class="pointer-events-none absolute top-1/2 left-4 -translate-y-1/2">
                                        <svg class="fill-gray-500 dark:fill-gray-400" width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                                            <path fill-rule="evenodd" clip-rule="evenodd" d="M3.04199 9.37381C3.04199 5.87712 5.87735 3.04218 9.37533 3.04218C12.8733 3.04218 15.7087 5.87712 15.7087 9.37381C15.7087 12.8705 12.8733 15.7055 9.37533 15.7055C5.87735 15.7055 3.04199 12.8705 3.04199 9.37381ZM9.37533 1.54218C5.04926 1.54218 1.54199 5.04835 1.54199 9.37381C1.54199 13.6993 5.04926 17.2055 9.37533 17.2055C11.2676 17.2055 13.0032 16.5346 14.3572 15.4178L17.1773 18.2381C17.4702 18.531 17.945 18.5311 18.2379 18.2382C18.5308 17.9453 18.5309 17.4704 18.238 17.1775L15.4182 14.3575C16.5367 13.0035 17.2087 11.2671 17.2087 9.37381C17.2087 5.04835 13.7014 1.54218 9.37533 1.54218Z" fill=""></path>
                                        </svg>
                                    </span>
                                    <input type="text" id="simple-search" placeholder="Search requests..." class="shadow-theme-xs focus:border-brand-300 focus:ring-brand-500/10 h-[42px] w-full rounded-lg border border-gray-300 bg-transparent py-2.5 pr-4 pl-[42px] !text-lg !text-gray-800 placeholder:!text-gray-400 focus:ring-3 focus:outline-hidden dark:border-gray-600 dark:!text-white dark:placeholder:!text-gray-500">
                                </div>
                            </div>
                            <button onclick="openAddRequestModal()" class="flex items-center gap-2 rounded-lg border border-blue-500 bg-blue-500 px-3 py-2 !text-lg font-medium !text-white hover:bg-blue-700 transition-all duration-200 ease-in-out hover:scale-105">
                                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                                </svg>
                                Add Request
                            </button>
                        </div>
                    </div>

                <!-- Filter Section -->
                <div class="mb-6">
                        <div class="flex flex-wrap items-center gap-2">
                            <button onclick="filterByCategory('all')" class="inline-flex items-center justify-center gap-1.5 rounded-full bg-gray-600 py-1.5 pl-2.5 pr-3 text-sm font-medium text-white hover:bg-gray-700 transition-all duration-200">
                                <svg class="fill-current" width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path fill-rule="evenodd" clip-rule="evenodd" d="M2 4C2 3.44772 2.44772 3 3 3H13C13.5523 3 14 3.44772 14 4C14 4.55228 13.5523 5 13 5H3C2.44772 5 2 4.55228 2 4ZM2 8C2 7.44772 2.44772 7 3 7H13C13.5523 7 14 7.44772 14 8C14 8.55228 13.5523 9 13 9H3C2.44772 9 2 8.55228 2 8ZM3 11C2.44772 11 2 11.4477 2 12C2 12.5523 2.44772 13 3 13H13C13.5523 13 14 12.5523 14 12C14 11.4477 13.5523 11 13 11H3Z" fill=""/>
                                </svg>
                                All
                            </button>
                            <button onclick="filterByCategory('Drive')" class="inline-flex items-center justify-center gap-1.5 rounded-full bg-emerald-600 py-1.5 pl-2.5 pr-3 text-sm font-medium text-white hover:bg-emerald-700 transition-all duration-200">
                                <svg class="fill-current" width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M2 4.66667C2 4.29848 2.29848 4 2.66667 4H8L10 6H13.3333C13.7015 6 14 6.29848 14 6.66667V11.3333C14 11.7015 13.7015 12 13.3333 12H2.66667C2.29848 12 2 11.7015 2 11.3333V4.66667Z" fill=""/>
                                </svg>
                                Drive
                            </button>
                            <button onclick="filterByCategory('Apps')" class="inline-flex items-center justify-center gap-1.5 rounded-full bg-rose-600 py-1.5 pl-2.5 pr-3 text-sm font-medium text-white hover:bg-rose-700 transition-all duration-200">
                                <svg class="fill-current" width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M3 3H7V7H3V3ZM9 3H13V7H9V3ZM9 9H13V13H9V9ZM3 9H7V13H3V9Z" fill=""/>
                                </svg>
                                Apps
                            </button>
                            <button onclick="filterByCategory('Learning')" class="inline-flex items-center justify-center gap-1.5 rounded-full bg-purple-600 py-1.5 pl-2.5 pr-3 text-sm font-medium text-white hover:bg-purple-700 transition-all duration-200">
                                <svg class="fill-current" width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M2 4.66667C2 4.29848 2.29848 4 2.66667 4H4C4.36819 4 4.66667 4.29848 4.66667 4.66667V12.6667C4.66667 13.0349 4.36819 13.3333 4 13.3333H2.66667C2.29848 13.3333 2 13.0349 2 12.6667V4.66667Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" fill="none"/>
                                    <path d="M4.66667 4.66667C4.66667 3.19391 5.86058 2 7.33333 2C8.80609 2 10 3.19391 10 4.66667V12.6667C10 13.0349 9.70152 13.3333 9.33333 13.3333H5.33333C4.96514 13.3333 4.66667 13.0349 4.66667 12.6667V4.66667Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" fill="none"/>
                                    <path d="M10 4.66667C10 3.19391 11.1939 2 12.6667 2C14.1394 2 15.3333 3.19391 15.3333 4.66667V12.6667C15.3333 13.0349 15.0349 13.3333 14.6667 13.3333H10.6667C10.2985 13.3333 10 13.0349 10 12.6667V4.66667Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" fill="none"/>
                                </svg>
                                Learning
                            </button>
                            <button onclick="filterByCategory('HR')" class="inline-flex items-center justify-center gap-1.5 rounded-full bg-blue-600 py-1.5 pl-2.5 pr-3 text-sm font-medium text-white hover:bg-blue-700 transition-all duration-200">
                                <svg class="fill-current" width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M8 2C6.34315 2 5 3.34315 5 5C5 6.65685 6.34315 8 8 8C9.65685 8 11 6.65685 11 5C11 3.34315 9.65685 2 8 2ZM4 11C2.89543 11 2 11.8954 2 13V14H14V13C14 11.8954 13.1046 11 12 11H4Z" fill=""/>
                                </svg>
                                HR
                            </button>
                            <button onclick="filterByCategory('Dev')" class="inline-flex items-center justify-center gap-1.5 rounded-full bg-amber-600 py-1.5 pl-2.5 pr-3 text-sm font-medium text-white hover:bg-amber-700 transition-all duration-200">
                                <svg class="fill-current" width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M5.33333 11.3333L2 8L5.33333 4.66667M10.6667 4.66667L14 8L10.6667 11.3333M9.33333 2.66667L6.66667 13.3333" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" fill="none"/>
                                </svg>
                                Dev
                            </button>
                        </div>
                </div>

                <div class="rounded-2xl border border-gray-200 bg-white pt-4 dark:border-gray-700 dark:bg-gray-800">
                    <div class="custom-scrollbar max-w-full overflow-x-auto px-5 sm:px-6">
                        <table class="min-w-full">
                            <thead class="border-y border-gray-100 py-3 bg-white dark:border-gray-700 dark:bg-gray-800">
                                <tr>
                                    <th class="py-3 font-normal w-1/6">
                                        <div class="flex items-center">
                                            <p class="!text-lg !text-gray-500 dark:!text-gray-400">Name</p>
                                        </div>
                                    </th>
                                    <th class="py-3 font-normal w-2/5">
                                        <div class="flex items-center">
                                            <p class="!text-lg !text-gray-500 dark:!text-gray-400">Description</p>
                                        </div>
                                    </th>
                                    <th class="py-3 font-normal whitespace-nowrap w-1/6">
                                        <div class="flex items-center">
                                            <p class="!text-lg !text-gray-500 dark:!text-gray-400">Category</p>
                                        </div>
                                    </th>
                                    <th class="py-3 font-normal whitespace-nowrap w-1/6">
                                        <div class="flex items-center">
                                            <p class="!text-lg !text-gray-500 dark:!text-gray-400">Region</p>
                                        </div>
                                    </th>
                                    <th class="py-3 font-normal whitespace-nowrap w-24">
                                        <div class="flex items-center">
                                            <p class="!text-lg !text-gray-500 dark:!text-gray-400">Actions</p>
                                        </div>
                                    </th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-gray-100 dark:divide-gray-700" id="tableBody">
                                <!-- Table rows will be dynamically added here -->
                            </tbody>
                        </table>
                    </div>

                    <div class="border-t border-gray-200 px-6 py-4 dark:border-gray-700">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center gap-2">
                                <span class="!text-lg !text-gray-700 dark:!text-gray-300">Show</span>
                                <select id="itemsPerPage" class="rounded-lg border border-gray-300 bg-white px-2 py-1 !text-lg !text-gray-700 dark:border-gray-600 dark:bg-gray-700 dark:!text-gray-300">
                                    <option value="5">5</option>
                                    <option value="10" selected>10</option>
                                    <option value="20">20</option>
                                    <option value="50">50</option>
                                </select>
                                <span class="!text-lg !text-gray-700 dark:!text-gray-300">items per page</span>
                            </div>

                            <div class="flex items-center gap-2">
                                <button onclick="previousPage()" class="!text-lg shadow-theme-xs flex items-center gap-2 rounded-lg border border-gray-300 bg-white px-2 py-2 font-medium !text-gray-700 hover:bg-gray-50 hover:!text-gray-800 sm:px-3.5 dark:border-gray-600 dark:bg-gray-700 dark:!text-gray-300 dark:hover:bg-gray-600">
                                    <svg class="fill-current" width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <path fill-rule="evenodd" clip-rule="evenodd" d="M2.58301 9.99868C2.58272 10.1909 2.65588 10.3833 2.80249 10.53L7.79915 15.5301C8.09194 15.8231 8.56682 15.8233 8.85981 15.5305C9.15281 15.2377 9.15297 14.7629 8.86018 14.4699L5.14009 10.7472L16.6675 10.7472C17.0817 10.7472 17.4175 10.4114 17.4175 9.99715C17.4175 9.58294 17.0817 9.24715 16.6675 9.24715L5.14554 9.24715L8.86017 5.53016C9.15297 5.23717 9.15282 4.7623 8.85983 4.4695C8.56684 4.1767 8.09197 4.17685 7.79917 4.46984L2.84167 9.43049C2.68321 9.568 2.58301 9.77087 2.58301 9.99715C2.58301 9.99766 2.58301 9.99817 2.58301 9.99868Z" fill=""></path>
                                    </svg>
                                    <span class="hidden sm:inline">Previous</span>
                                </button>

                                <span class="block !text-lg font-medium !text-gray-700 sm:hidden dark:!text-gray-300">
                                    Page <span id="currentPage">1</span> of <span id="totalPages">1</span>
                                </span>

                                <ul class="hidden items-center gap-0.5 sm:flex" id="pagination">
                                    <!-- Pagination will be dynamically added here -->
                                </ul>

                                <button onclick="nextPage()" class="!text-lg shadow-theme-xs flex items-center gap-2 rounded-lg border border-gray-300 bg-white px-2 py-2 font-medium !text-gray-700 hover:bg-gray-50 hover:!text-gray-800 sm:px-3.5 dark:border-gray-600 dark:bg-gray-700 dark:!text-gray-300 dark:hover:bg-gray-600">
                                    <span class="hidden sm:inline">Next</span>
                                    <svg class="fill-current" width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <path fill-rule="evenodd" clip-rule="evenodd" d="M17.4175 9.9986C17.4178 10.1909 17.3446 10.3832 17.198 10.53L12.2013 15.5301C11.9085 15.8231 11.4337 15.8233 11.1407 15.5305C10.8477 15.2377 10.8475 14.7629 11.1403 14.4699L14.8604 10.7472L3.33301 10.7472C2.91879 10.7472 2.58301 10.4114 2.58301 9.99715C2.58301 9.58294 2.91879 9.24715 3.33301 9.24715L14.8549 9.24715L11.1403 5.53016C10.8475 5.23717 10.8477 4.7623 11.1407 4.4695C11.4336 4.1767 11.9085 4.17685 12.2013 4.46984L17.1588 9.43049C17.3173 9.568 17.4175 9.77087 17.4175 9.99715C17.4175 9.99763 17.4175 9.99812 17.4175 9.9986Z" fill=""></path>
                                    </svg>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Marketplace Request Modal -->
    <div id="addRequestModal" class="fixed inset-0 z-50 hidden overflow-y-auto" aria-labelledby="modal-title" role="dialog" aria-modal="true">
        <div class="flex min-h-screen items-center justify-center p-4 text-center sm:p-0">
            <div class="fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity dark:bg-gray-900 dark:bg-opacity-75" aria-hidden="true" onclick="closeAddRequestModal()"></div>
            <div class="relative transform overflow-hidden rounded-2xl bg-white text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-lg dark:bg-gray-800">
                <div class="rounded-2xl border border-gray-200 bg-white dark:border-gray-700 dark:bg-gray-800">
                    <div class="px-5 py-4 sm:px-6 sm:py-5">
                        <div class="flex items-center justify-between">
                            <h3 class="!text-2xl font-medium !text-gray-800 dark:!text-white">
                                Add New Marketplace Request
                            </h3>
                            <button type="button" onclick="closeAddRequestModal()" class="!text-gray-400 hover:!text-gray-500 dark:!text-gray-500 dark:hover:!text-gray-400">
                                <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                </svg>
                            </button>
                        </div>
                    </div>
                    <div class="p-5 space-y-6 border-t border-gray-100 sm:p-6 dark:border-gray-700">
                        <form id="addRequestForm" onsubmit="submitNewRequest(event)">
                            <div class="-mx-2.5 flex flex-wrap gap-y-5">
                                <div class="w-full px-2.5">
                                    <input type="text" id="requestName" placeholder="Request Name" required
                                        class="h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 !text-lg !text-gray-800 shadow-theme-xs placeholder:!text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-600 dark:!text-white dark:placeholder:!text-gray-500">
                                </div>

                                <div class="w-full px-2.5">
                                    <textarea id="requestDescription" placeholder="Request Description" required rows="3"
                                        class="w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 !text-lg !text-gray-800 shadow-theme-xs placeholder:!text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-600 dark:!text-white dark:placeholder:!text-gray-500"></textarea>
                                </div>

                                <div class="w-full px-2.5">
                                    <select id="requestCategory" required
                                        class="h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 !text-lg !text-gray-800 shadow-theme-xs placeholder:!text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-600 dark:!text-white dark:placeholder:!text-gray-500">
                                        <option value="">Select Category</option>
                                        <option value="Drive">Drive</option>
                                        <option value="Apps">Apps</option>
                                        <option value="Learning">Learning</option>
                                        <option value="HR">HR</option>
                                        <option value="Dev">Dev</option>
                                    </select>
                                </div>

                                <div class="w-full px-2.5">
                                    <select id="requestRegion" required
                                        class="h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 !text-lg !text-gray-800 shadow-theme-xs placeholder:!text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-600 dark:!text-white dark:placeholder:!text-gray-500">
                                        <option value="">Select Region</option>
                                        <option value="NAM">NAM</option>
                                        <option value="APAC">APAC</option>
                                        <option value="EMEA">EMEA</option>
                                        <option value="LATAM">LATAM</option>
                                        <option value="GLOBAL">GLOBAL</option>
                                    </select>
                                </div>

                                <div class="w-full px-2.5">
                                    <input type="url" id="requestCopyLink" placeholder="Copy Link URL" required
                                        class="h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 !text-lg !text-gray-800 shadow-theme-xs placeholder:!text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-600 dark:!text-white dark:placeholder:!text-gray-500">
                                </div>

                                <div class="w-full px-2.5">
                                    <input type="url" id="requestShopLink" placeholder="Shop Link URL" required
                                        class="h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 !text-lg !text-gray-800 shadow-theme-xs placeholder:!text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-600 dark:!text-white dark:placeholder:!text-gray-500">
                                </div>

                                <div class="w-full px-2.5">
                                    <input type="url" id="requestDownloadLink" placeholder="Download Link URL" required
                                        class="h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 !text-lg !text-gray-800 shadow-theme-xs placeholder:!text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-600 dark:!text-white dark:placeholder:!text-gray-500">
                                </div>

                                <div class="w-full px-2.5">
                                    <button type="submit" class="w-full p-3 !text-lg font-medium !text-white transition-colors rounded-lg bg-blue-500 hover:bg-blue-800">
                                        Add Request
                                    </button>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

<script>
        // Global variables for table data
        let tableData = [];
        let filteredData = [];
        let currentPage = 1;
        let itemsPerPage = 10;
        let selectedCategory = 'all';

        // Function to refresh data
        async function refreshData() {
            showLoadingState();
            try {
                const data = await fetchDataFromConfluence();
                if (data && data.length > 0) {
                    tableData = data;
                    filterData();
                } else {
                    showNoDataState();
                }
            } catch (error) {
                console.error('Error refreshing data:', error);
                showNoDataState();
            }
        }

        // Filter by category
        function filterByCategory(category) {
            selectedCategory = category;
            currentPage = 1;

            // Update button styles
            document.querySelectorAll('button[onclick^="filterByCategory"]').forEach(btn => {
                const btnCategory = btn.textContent.trim();
                if (btnCategory === 'All' && category === 'all') {
                    btn.className = 'inline-flex items-center justify-center gap-1.5 rounded-full bg-gray-700 py-1.5 pl-2.5 pr-3 text-sm font-medium text-white hover:bg-gray-800 transition-all duration-200';
                } else if (btnCategory === category) {
                    // Keep current category color but make it darker
                    if (category === 'Drive') {
                        btn.className = 'inline-flex items-center justify-center gap-1.5 rounded-full bg-emerald-700 py-1.5 pl-2.5 pr-3 text-sm font-medium text-white hover:bg-emerald-800 transition-all duration-200';
                    } else if (category === 'Apps') {
                        btn.className = 'inline-flex items-center justify-center gap-1.5 rounded-full bg-rose-700 py-1.5 pl-2.5 pr-3 text-sm font-medium text-white hover:bg-rose-800 transition-all duration-200';
                    } else if (category === 'Learning') {
                        btn.className = 'inline-flex items-center justify-center gap-1.5 rounded-full bg-purple-700 py-1.5 pl-2.5 pr-3 text-sm font-medium text-white hover:bg-purple-800 transition-all duration-200';
                    } else if (category === 'HR') {
                        btn.className = 'inline-flex items-center justify-center gap-1.5 rounded-full bg-blue-700 py-1.5 pl-2.5 pr-3 text-sm font-medium text-white hover:bg-blue-800 transition-all duration-200';
                    } else if (category === 'Dev') {
                        btn.className = 'inline-flex items-center justify-center gap-1.5 rounded-full bg-amber-700 py-1.5 pl-2.5 pr-3 text-sm font-medium text-white hover:bg-amber-800 transition-all duration-200';
                    }
                } else {
                    // Reset to original color
                    if (btnCategory === 'All') {
                        btn.className = 'inline-flex items-center justify-center gap-1.5 rounded-full bg-gray-600 py-1.5 pl-2.5 pr-3 text-sm font-medium text-white hover:bg-gray-700 transition-all duration-200';
                    } else if (btnCategory === 'Drive') {
                        btn.className = 'inline-flex items-center justify-center gap-1.5 rounded-full bg-emerald-600 py-1.5 pl-2.5 pr-3 text-sm font-medium text-white hover:bg-emerald-700 transition-all duration-200';
                    } else if (btnCategory === 'Apps') {
                        btn.className = 'inline-flex items-center justify-center gap-1.5 rounded-full bg-rose-600 py-1.5 pl-2.5 pr-3 text-sm font-medium text-white hover:bg-rose-700 transition-all duration-200';
                    } else if (btnCategory === 'Learning') {
                        btn.className = 'inline-flex items-center justify-center gap-1.5 rounded-full bg-purple-600 py-1.5 pl-2.5 pr-3 text-sm font-medium text-white hover:bg-purple-700 transition-all duration-200';
                    } else if (btnCategory === 'HR') {
                        btn.className = 'inline-flex items-center justify-center gap-1.5 rounded-full bg-blue-600 py-1.5 pl-2.5 pr-3 text-sm font-medium text-white hover:bg-blue-700 transition-all duration-200';
                    } else if (btnCategory === 'Dev') {
                        btn.className = 'inline-flex items-center justify-center gap-1.5 rounded-full bg-amber-600 py-1.5 pl-2.5 pr-3 text-sm font-medium text-white hover:bg-amber-700 transition-all duration-200';
                    }
                }
            });

            filterData();
        }

        // Filter data based on search term and category
        function filterData() {
            const searchTerm = document.getElementById('simple-search').value.toLowerCase();
            
            filteredData = tableData.filter(item => {
                const matchesSearch = !searchTerm || 
                    Object.values(item).some(value => 
                        String(value).toLowerCase().includes(searchTerm)
                    );
                const matchesCategory = selectedCategory === 'all' || 
                    item.category === selectedCategory;
                
                return matchesSearch && matchesCategory;
            });

            currentPage = 1;
            updateTable();
        }

        // Function to fetch Excel data from Confluence
        async function fetchDataFromConfluence() {
            try {
                // Fetch the marketplace_requests.xlsx file from Confluence
                const excelResponse = await fetch('https://cedt-confluence.net/confluence/download/attachments/2740868871/marketplace_requests.xlsx?api=v2', {
                    headers: {
                        'X-Atlassian-Token': 'no-check'
                    }
                });

                if (!excelResponse.ok) {
                    throw new Error('Failed to fetch marketplace_requests.xlsx file');
                }

                const excelBlob = await excelResponse.blob();
                
                return new Promise((resolve, reject) => {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        try {
                            const data = new Uint8Array(e.target.result);
                            const workbook = XLSX.read(data, { type: 'array' });
                            const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                            const jsonData = XLSX.utils.sheet_to_json(firstSheet);

                            // Transform Excel data to marketplace request format
                            const transformedData = jsonData.map(row => ({
                                id: row.id || Math.random().toString(36).substr(2, 9),
                                name: row.name,
                                description: row.description,
                                category: row.category,
                                region: row.region,
                                copyLink: row.copyLink,
                                shopLink: row.shopLink,
                                downloadLink: row.downloadLink
                            }));

                            resolve(transformedData);
                        } catch (error) {
                            reject(error);
                        }
                    };
                    reader.onerror = () => reject(new Error('Failed to read Excel file'));
                    reader.readAsArrayBuffer(excelBlob);
                });

            } catch (error) {
                console.error('Error fetching data:', error);
                return null;
            }
        }

        // Function to get category color and icon
        function getCategoryInfo(category) {
            const categories = {
                'Drive': {
                    classes: 'bg-emerald-50 !text-emerald-700 border border-emerald-200',
                    icon: '<svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 7v10a2 2 0 002 2h14 a2 2 0 002-2V9a2 2 0 00-2-2H5a2 2 0 00-2-2v0a2 2 0 002-2h6l2 2h6a2 2 0 012 2v1"/></svg>'
                },
                'Apps': {
                    classes: 'bg-rose-50 !text-rose-700 border border-rose-200',
                    icon: '<svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 3v2m6-2v2M9 19v2m6-2v2M5 9H3m2 6H3m18-6h-2m2 6h-2M7 19h10a2 2 0 002-2V7a2 2 0 00-2-2H7a2 2 0 00-2 2v10a2 2 0 002 2zM9 9h6v6H9V9z"/></svg>'
                },
                'Learning': {
                    classes: 'bg-purple-50 !text-purple-700 border border-purple-200',
                    icon: '<svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"/></svg>'
                },
                'HR': {
                    classes: 'bg-blue-50 !text-blue-700 border border-blue-200',
                    icon: '<svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/></svg>'
                },
                'Dev': {
                    classes: 'bg-amber-50 !text-amber-700 border border-amber-200',
                    icon: '<svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"/></svg>'
                }
            };

            return categories[category] || {
                classes: 'bg-slate-50 !text-slate-700 border border-slate-200',
                icon: '<svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"/></svg>'
            };
        }

        // Function to get region flag and name
        function getRegionInfo(region) {
            const regions = {
                'NAM': { 
                    flag: `<svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M12 2C6.48 2 2 6.48 2 12C2 17.52 6.48 22 12 22C17.52 22 22 17.52 22 12C22 6.48 17.52 2 12 2Z" fill="currentColor"/>
                        <path d="M12 4C7.58 4 4 7.58 4 12C4 16.42 7.58 20 12 20C16.42 20 20 16.42 20 12C20 7.58 16.42 4 12 4Z" fill="white"/>
                        <path d="M12 6C8.69 6 6 8.69 6 12C6 15.31 8.69 18 12 18C15.31 18 18 15.31 18 12C18 8.69 15.31 6 12 6Z" fill="currentColor"/>
                        <path d="M12 8C9.79 8 8 9.79 8 12C8 14.21 9.79 16 12 16C14.21 16 16 14.21 16 12C16 9.79 14.21 8 12 8Z" fill="white"/>
                        <path d="M12 10C10.9 10 10 10.9 10 12C10 13.1 10.9 14 12 14C13.1 14 14 13.1 14 12C14 10.9 13.1 10 12 10Z" fill="currentColor"/>
                    </svg>`,
                    name: 'North America',
                    color: 'bg-blue-100 text-blue-800'
                },
                'APAC': { 
                    flag: `<svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M12 2C6.48 2 2 6.48 2 12C2 17.52 6.48 22 12 22C17.52 22 22 17.52 22 12C22 6.48 17.52 2 12 2Z" fill="currentColor"/>
                        <path d="M12 4C7.58 4 4 7.58 4 12C4 16.42 7.58 20 12 20C16.42 20 20 16.42 20 12C20 7.58 16.42 4 12 4Z" fill="white"/>
                        <path d="M12 6L16 12L12 18L8 12L12 6Z" fill="currentColor"/>
                        <path d="M12 10L14 12L12 14L10 12L12 10Z" fill="white"/>
                    </svg>`,
                    name: 'Asia Pacific',
                    color: 'bg-red-100 text-red-800'
                },
                'EMEA': { 
                    flag: `<svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M12 2C6.48 2 2 6.48 2 12C2 17.52 6.48 22 12 22C17.52 22 22 17.52 22 12C22 6.48 17.52 2 12 2Z" fill="currentColor"/>
                        <path d="M12 4C7.58 4 4 7.58 4 12C4 16.42 7.58 20 12 20C16.42 20 20 16.42 20 12C20 7.58 16.42 4 12 4Z" fill="white"/>
                        <path d="M12 6L16 12L12 18L8 12L12 6Z" fill="currentColor"/>
                        <path d="M12 8L14 12L12 16L10 12L12 8Z" fill="white"/>
                        <path d="M12 10L13 12L12 14L11 12L12 10Z" fill="currentColor"/>
                    </svg>`,
                    name: 'Europe',
                    color: 'bg-green-100 text-green-800'
                },
                'LATAM': { 
                    flag: `<svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M12 2C6.48 2 2 6.48 2 12C2 17.52 6.48 22 12 22C17.52 22 22 17.52 22 12C22 6.48 17.52 2 12 2Z" fill="currentColor"/>
                        <path d="M12 4C7.58 4 4 7.58 4 12C4 16.42 7.58 20 12 20C16.42 20 20 16.42 20 12C20 7.58 16.42 4 12 4Z" fill="white"/>
                        <path d="M12 6L16 12L12 18L8 12L12 6Z" fill="currentColor"/>
                        <path d="M12 8L14 12L12 16L10 12L12 8Z" fill="white"/>
                        <path d="M12 10L13 12L12 14L11 12L12 10Z" fill="currentColor"/>
                        <path d="M12 11L12.5 12L12 13L11.5 12L12 11Z" fill="white"/>
                    </svg>`,
                    name: 'Latin America',
                    color: 'bg-yellow-100 text-yellow-800'
                },
                'GLOBAL': { 
                    flag: `<svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M12 2C6.48 2 2 6.48 2 12C2 17.52 6.48 22 12 22C17.52 22 22 17.52 22 12C22 6.48 17.52 2 12 2Z" fill="currentColor"/>
                        <path d="M12 4C7.58 4 4 7.58 4 12C4 16.42 7.58 20 12 20C16.42 20 20 16.42 20 12C20 7.58 16.42 4 12 4Z" fill="white"/>
                        <path d="M12 6L16 12L12 18L8 12L12 6Z" fill="currentColor"/>
                        <path d="M12 8L14 12L12 16L10 12L12 8Z" fill="white"/>
                        <path d="M12 10L13 12L12 14L11 12L12 10Z" fill="currentColor"/>
                        <path d="M12 11L12.5 12L12 13L11.5 12L12 11Z" fill="white"/>
                        <path d="M12 11.5L12.25 12L12 12.5L11.75 12L12 11.5Z" fill="currentColor"/>
                    </svg>`,
                    name: 'Global',
                    color: 'bg-purple-100 text-purple-800'
                }
            };
            return regions[region] || { 
                flag: `<svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M12 2C6.48 2 2 6.48 2 12C2 17.52 6.48 22 12 22C17.52 22 22 17.52 22 12C22 6.48 17.52 2 12 2Z" fill="currentColor"/>
                    <path d="M12 4C7.58 4 4 7.58 4 12C4 16.42 7.58 20 12 20C16.42 20 20 16.42 20 12C20 7.58 16.42 4 12 4Z" fill="white"/>
                </svg>`,
                name: region,
                color: 'bg-gray-100 text-gray-800'
            };
        }

        // Function to create table row
        function createTableRow(item) {
            const regionInfo = getRegionInfo(item.region);
            const categoryInfo = getCategoryInfo(item.category);
            return `
                <tr class="dark:hover:bg-gray-700">
                    <td class="py-3">
                        <div class="flex items-center">
                            <span class="!text-lg block font-medium !text-gray-700 dark:!text-white">
                                ${item.name}
                            </span>
                        </div>
                    </td>
                    <td class="py-3">
                        <div class="flex items-center">
                            <p class="!text-lg !text-gray-700 dark:!text-gray-300">
                                ${item.description}
                            </p>
                        </div>
                    </td>
                    <td class="py-3 whitespace-nowrap">
                        <div class="flex items-center">
                            <span class="inline-flex items-center gap-1 rounded-full px-2.5 py-1 !text-lg font-medium transition-all duration-200 ease-in-out hover:scale-105 ${categoryInfo.classes}">
                                ${categoryInfo.icon}
                                ${item.category}
                            </span>
                        </div>
                    </td>
                    <td class="py-3 whitespace-nowrap">
                        <div class="flex items-center gap-2">
                            <div class="${regionInfo.color} rounded-full p-1">
                                ${regionInfo.flag}
                            </div>
                            <p class="!text-lg !text-gray-700 dark:!text-gray-300">
                                ${item.region}
                            </p>
                        </div>
                    </td>
                    <td class="py-3 whitespace-nowrap">
                        <div class="flex items-center gap-2">
                            <button onclick="copyItem('${item.copyLink}')" class="group relative rounded-lg bg-blue-100 p-2 !text-blue-600 hover:bg-blue-200 transition-all duration-200 ease-in-out hover:scale-105">
                                <span class="invisible absolute bottom-full left-1/2 z-10 mb-2 -translate-x-1/2 whitespace-nowrap rounded bg-blue-600 px-2 py-1 !text-lg !text-white opacity-0 transition-all duration-200 group-hover:visible group-hover:opacity-100">
                                    Copy to clipboard
                                    <span class="absolute top-full left-1/2 -translate-x-1/2 border-4 border-transparent border-t-blue-600"></span>
                                </span>
                                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m2 4H10m0 0l3-3m-3 3l3 3"></path>
                                </svg>
                            </button>
                            <a href="${item.shopLink}" target="_blank" class="group relative rounded-lg bg-green-100 p-2 !text-green-600 hover:bg-green-200 transition-all duration-200 ease-in-out hover:scale-105">
                                <span class="invisible absolute bottom-full left-1/2 z-10 mb-2 -translate-x-1/2 whitespace-nowrap rounded bg-green-600 px-2 py-1 !text-lg !text-white opacity-0 transition-all duration-200 group-hover:visible group-hover:opacity-100">
                                    Order the marketplace request
                                    <span class="absolute top-full left-1/2 -translate-x-1/2 border-4 border-transparent border-t-green-600"></span>
                                </span>
                                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"></path>
                                </svg>
                            </a>
                            <a href="${item.downloadLink}" download class="group relative rounded-lg bg-purple-100 p-2 !text-purple-600 hover:bg-purple-200 transition-all duration-200 ease-in-out hover:scale-105">
                                <span class="invisible absolute bottom-full left-1/2 z-10 mb-2 -translate-x-1/2 whitespace-nowrap rounded bg-purple-600 px-2 py-1 !text-lg !text-white opacity-0 transition-all duration-200 group-hover:visible group-hover:opacity-100">
                                    Download file
                                    <span class="absolute top-full left-1/2 -translate-x-1/2 border-4 border-transparent border-t-purple-600"></span>
                                </span>
                                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path>
                                </svg>
                            </a>
                        </div>
                    </td>
                </tr>
            `;
        }

        // Function to update pagination
        function updatePagination() {
            const pagination = document.getElementById('pagination');
            const totalPages = Math.ceil(filteredData.length / itemsPerPage);
            pagination.innerHTML = '';
            
            // Always show first page
            if (totalPages > 0) {
                addPageButton(1);
            }

            // Show ellipsis if needed
            if (currentPage > 3) {
                addEllipsis();
            }

            // Show pages around current page
            for (let i = Math.max(2, currentPage - 1); i <= Math.min(totalPages - 1, currentPage + 1); i++) {
                if (i > 1 && i < totalPages) {
                    addPageButton(i);
                }
            }

            // Show ellipsis if needed
            if (currentPage < totalPages - 2) {
                addEllipsis();
            }

            // Always show last page
            if (totalPages > 1) {
                addPageButton(totalPages);
            }

            document.getElementById('currentPage').textContent = currentPage;
            document.getElementById('totalPages').textContent = totalPages;

            // Update button states
            const prevButton = document.querySelector('button[onclick="previousPage()"]');
            const nextButton = document.querySelector('button[onclick="nextPage()"]');
            
            if (prevButton) prevButton.disabled = currentPage === 1;
            if (nextButton) nextButton.disabled = currentPage === totalPages;
        }

        function addPageButton(pageNum) {
            const li = document.createElement('li');
            const a = document.createElement('a');
            a.href = '#';
            a.className = pageNum === currentPage 
                ? 'bg-brand-500/[0.08] !text-lg !text-brand-500 hover:bg-brand-500/[0.08] hover:!text-brand-500 flex h-10 w-10 items-center justify-center rounded-lg font-medium'
                : '!text-lg hover:bg-brand-500/[0.08] hover:!text-brand-500 flex h-10 w-10 items-center justify-center rounded-lg font-medium !text-gray-700 dark:!text-gray-300';
            a.textContent = pageNum;
            a.onclick = (e) => {
                e.preventDefault();
                currentPage = pageNum;
                updateTable();
            };
            li.appendChild(a);
            pagination.appendChild(li);
        }

        function addEllipsis() {
            const li = document.createElement('li');
            li.className = '!text-lg flex h-10 w-10 items-center justify-center !text-gray-700 dark:!text-gray-300';
            li.textContent = '...';
            pagination.appendChild(li);
        }

        // Function to update table
        function updateTable() {
            const tableBody = document.getElementById('tableBody');
            const start = (currentPage - 1) * itemsPerPage;
            const end = start + itemsPerPage;
            const pageData = filteredData.slice(start, end);

            if (pageData.length === 0) {
                showNoDataState();
            } else {
                tableBody.innerHTML = pageData.map(createTableRow).join('');
            }
            updatePagination();
        }

        // Function to handle next page
        function nextPage() {
            const totalPages = Math.ceil(filteredData.length / itemsPerPage);
            if (currentPage < totalPages) {
                currentPage++;
                updateTable();
            }
        }

        // Function to handle previous page
        function previousPage() {
            if (currentPage > 1) {
                currentPage--;
                updateTable();
            }
        }

        // Action functions
        function copyItem(link) {
            const button = event.currentTarget;
            button.classList.add('animate-pulse');
            navigator.clipboard.writeText(link).then(() => {
                setTimeout(() => {
                    button.classList.remove('animate-pulse');
                }, 300);
            });
        }

        // Add loading state
        function showLoadingState() {
            const tableBody = document.getElementById('tableBody');
            tableBody.innerHTML = `
                <tr>
                    <td colspan="5" class="py-16">
                        <div class="flex flex-col items-center justify-center">
                            <div class="relative">
                                <div class="animate-spin rounded-full h-16 w-16 border-4 border-blue-200 dark:border-blue-800"></div>
                                <div class="animate-spin rounded-full h-16 w-16 border-4 border-blue-600 border-t-transparent absolute top-0 left-0"></div>
                            </div>
                            <div class="mt-6 text-center">
                                <span class="!text-lg font-medium !text-gray-700 dark:!text-gray-300">Loading requests...</span>
                            </div>
                        </div>
                    </td>
                </tr>
            `;
        }

        // Show no data state
        function showNoDataState() {
            const tableBody = document.getElementById('tableBody');
            tableBody.innerHTML = `
                <tr>
                    <td colspan="5" class="py-16">
                        <div class="flex flex-col items-center justify-center">
                            <svg class="mb-4 h-16 w-16 text-gray-400 dark:text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4"></path>
                            </svg>
                            <span class="!text-lg font-medium !text-gray-600 dark:!text-gray-400">No data available</span>
                        </div>
                    </td>
                </tr>
            `;
        }

        // Initialize table with data
        async function initializeTable() {
            showLoadingState();
            try {
                const data = await fetchDataFromConfluence();
                if (data && data.length > 0) {
                    tableData = data;
                    currentPage = 1;
                    itemsPerPage = parseInt(document.getElementById('itemsPerPage').value);
                    filterData();
                } else {
                    showNoDataState();
                }
            } catch (error) {
                console.error('Error initializing table:', error);
                showNoDataState();
            }
        }

        // Call initializeTable when the page loads
        document.addEventListener('DOMContentLoaded', async function() {
            await initializeTable();

            // Items per page change handler
            document.getElementById('itemsPerPage').addEventListener('change', function(e) {
                itemsPerPage = parseInt(e.target.value);
                currentPage = 1; // Reset to first page when changing items per page
                filterData();
            });

            // Search functionality
            const searchInput = document.getElementById('simple-search');
            if (searchInput) {
                searchInput.addEventListener('input', function(e) {
                    filterData();
                });

                // Prevent form submission on Enter key press
                searchInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        e.preventDefault();
                    }
                });
            }
        });

        // Add Marketplace Request Modal Functions
        function openAddRequestModal() {
            const modal = document.getElementById('addRequestModal');
            modal.classList.remove('hidden');
        }

        function closeAddRequestModal() {
            const modal = document.getElementById('addRequestModal');
            if (modal) {
                modal.classList.add('hidden');
                document.getElementById('addRequestForm').reset();
            }
        }

        async function submitNewRequest(event) {
            event.preventDefault();
            
            const newRequest = {
                name: document.getElementById('requestName').value,
                description: document.getElementById('requestDescription').value,
                category: document.getElementById('requestCategory').value,
                region: document.getElementById('requestRegion').value,
                copyLink: document.getElementById('requestCopyLink').value,
                shopLink: document.getElementById('requestShopLink').value,
                downloadLink: document.getElementById('requestDownloadLink').value
            };

            // Close the form immediately
            closeAddRequestModal();

            try {
                // First, get the attachment ID for marketplace_requests.xlsx
                const attachmentsResponse = await fetch('https://cedt-confluence.net/confluence/rest/api/content/2740868871/child/attachment?filename=marketplace_requests.xlsx');
                const attachmentsData = await attachmentsResponse.json();
                
                let attachmentId;
                let existingRequests = [];

                if (attachmentsData.results && attachmentsData.results.length > 0) {
                    // If marketplace_requests.xlsx exists, get its content and attachment ID
                    attachmentId = attachmentsData.results[0].id;
                    
                    const excelResponse = await fetch(`https://cedt-confluence.net/confluence/download/attachments/2740868871/marketplace_requests.xlsx?api=v2`, {
                        headers: {
                            'X-Atlassian-Token': 'no-check'
                        }
                    });

                    if (excelResponse.ok) {
                        const excelBlob = await excelResponse.blob();
                        const reader = new FileReader();

                        reader.onload = async function(e) {
                            const data = new Uint8Array(e.target.result);
                            const workbook = XLSX.read(data, { type: 'array' });
                            const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                            existingRequests = XLSX.utils.sheet_to_json(firstSheet);

                            // Add new request to the existing data
                            existingRequests.push(newRequest);

                            // Add the new row to the existing sheet (preserving headers and formatting)
                            const range = XLSX.utils.decode_range(firstSheet['!ref']);
                            const newRowIndex = range.e.r + 1; // Next row after the last data row
                            
                            // Generate ID for the new request
                            const requestId = Math.random().toString(36).substr(2, 9);
                            newRequest.id = requestId;
                            
                            // Add each field of the new request to the sheet
                            const headers = ['id', 'name', 'description', 'category', 'region', 'copyLink', 'shopLink', 'downloadLink'];
                            headers.forEach((header, colIndex) => {
                                const cellAddress = XLSX.utils.encode_cell({ r: newRowIndex, c: colIndex });
                                firstSheet[cellAddress] = { v: newRequest[header], t: 's' };
                            });
                            
                            // Update the sheet range to include the new row
                            firstSheet['!ref'] = XLSX.utils.encode_range({
                                s: { r: range.s.r, c: range.s.c },
                                e: { r: newRowIndex, c: range.e.c }
                            });

                            // Convert to blob using the original workbook (preserving structure)
                            const excelBuffer = XLSX.write(workbook, { bookType: 'xlsx', type: 'array' });
                            const blob = new Blob([excelBuffer], { type: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet' });

                            // Upload the updated Excel file using the attachment ID
                            const formData = new FormData();
                            formData.append('file', blob, 'marketplace_requests.xlsx');

                            const uploadResponse = await fetch(`https://cedt-confluence.net/confluence/rest/api/content/2740868871/child/attachment/${attachmentId}`, {
                                method: 'POST',
                                headers: {
                                    'X-Atlassian-Token': 'no-check'
                                },
                                body: formData
                            });

                            if (!uploadResponse.ok) {
                                throw new Error(`Failed to update Excel file: ${uploadResponse.status} ${uploadResponse.statusText}`);
                            }
                            
                            // Add the new request to the current tableData array and update the table immediately
                            const transformedRequest = {
                                id: requestId,
                                name: newRequest.name,
                                description: newRequest.description,
                                category: newRequest.category,
                                region: newRequest.region,
                                copyLink: newRequest.copyLink,
                                shopLink: newRequest.shopLink,
                                downloadLink: newRequest.downloadLink
                            };
                            
                            tableData.push(transformedRequest);
                            filteredData = [...tableData];
                            updateTable();
                        };

                        reader.readAsArrayBuffer(excelBlob);
                    } else {
                        throw new Error('Failed to fetch existing marketplace_requests.xlsx file');
                    }
                } else {
                    // If marketplace_requests.xlsx doesn't exist, create a new one
                    const newWorkbook = XLSX.utils.book_new();
                    const newWorksheet = XLSX.utils.json_to_sheet([newRequest]);
                    XLSX.utils.book_append_sheet(newWorkbook, newWorksheet, 'Requests');

                    // Convert to blob
                    const excelBuffer = XLSX.write(newWorkbook, { bookType: 'xlsx', type: 'array' });
                    const blob = new Blob([excelBuffer], { type: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet' });

                    // Upload the new Excel file
                    const formData = new FormData();
                    formData.append('file', blob, 'marketplace_requests.xlsx');

                    const uploadResponse = await fetch('https://cedt-confluence.net/confluence/rest/api/content/2740868871/child/attachment', {
                        method: 'POST',
                        headers: {
                            'X-Atlassian-Token': 'no-check'
                        },
                        body: formData
                    });

                    if (!uploadResponse.ok) {
                        throw new Error(`Failed to create Excel file: ${uploadResponse.status} ${uploadResponse.statusText}`);
                    }

                    refreshData(); // Refresh the request list
                }
            } catch (error) {
                console.error('Error adding marketplace request:', error);
            }
        }

        // ============================================
        // NOTIFICATIONS
        // ============================================
        // Toast notifications are provided by global-notifications.html (included as Confluence macro)
        // Available functions: showSuccessToast(), showErrorToast(), showWarningToast(), showInfoToast()
        // 
        // Legacy compatibility wrapper for showNotification()
        // ============================================
        function showNotification(message, type = 'success') {
            const typeMap = {
                'success': showSuccessToast,
                'error': showErrorToast,
                'warning': showWarningToast,
                'info': showInfoToast
            };
            const toastFn = typeMap[type] || showInfoToast;
            toastFn(message);
        }
    </script>

    <!-- Add SheetJS library for Excel parsing -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</body>
</html>
