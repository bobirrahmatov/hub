<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Training Courses</title>
    
    <!-- 
      CONFLUENCE MACRO REQUIRED: Include global-notifications.html as a macro
      This provides showSuccessToast(), showErrorToast(), showWarningToast(), showInfoToast()
    -->
    
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Only keep essential webkit scrollbar styles that can't be done with Tailwind */
        .custom-scrollbar::-webkit-scrollbar {
            height: 6px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 3px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 3px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
        
        /* Loading shimmer animation - can't be replicated with Tailwind alone */
        @keyframes shimmer {
            0% {
                background-position: -200% 0;
            }
            100% {
                background-position: 200% 0;
            }
        }
        .loading-shimmer {
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 200% 100%;
            animation: shimmer 1.5s infinite;
        }
        
        /* Simple blog-style hover effects */
        .card-hover-border {
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
        }

        /* Text clamp utilities for better browser support */
        .line-clamp-2 {
            display: -webkit-box;
            -webkit-line-clamp: 2;
            line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        .line-clamp-3 {
            display: -webkit-box;
            -webkit-line-clamp: 3;
            line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        /* Ensure consistent card heights in grid */
        .auto-rows-fr {
            grid-auto-rows: 1fr;
        }

        /* Card alignment improvements */
        #courseCardsContainer > div {
            display: flex;
            flex-direction: column;
        }

        /* Ribbon shadow and positioning enhancements */
        .ribbon-shadow {
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }
    </style>
</head>
<body class="bg-gray-50">
    <div class="p-4">
        <div class="rounded-2xl border border-gray-200 bg-white shadow-sm">
            <div class="px-5 py-4 sm:px-6 sm:py-5">
                <h3 class="!text-2xl font-medium text-gray-800">
                    Training Courses
                </h3>
            </div>
            <div class="border-t border-gray-100 p-5 sm:p-6">
                <div class="rounded-2xl border border-gray-200 bg-white pt-4">
                    <!-- Search Section -->
                    <div class="mb-6 flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between px-5 sm:px-6">
                        <div class="flex flex-1 items-center gap-4">
                            <div class="w-[512px]">
                                <div class="relative">
                                    <span class="pointer-events-none absolute top-1/2 left-4 -translate-y-1/2">
                                        <svg class="fill-gray-500" width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                                            <path fill-rule="evenodd" clip-rule="evenodd" d="M3.04199 9.37381C3.04199 5.87712 5.87735 3.04218 9.37533 3.04218C12.8733 3.04218 15.7087 5.87712 15.7087 9.37381C15.7087 12.8705 12.8733 15.7055 9.37533 15.7055C5.87735 15.7055 3.04199 12.8705 3.04199 9.37381ZM9.37533 1.54218C5.04926 1.54218 1.54199 5.04835 1.54199 9.37381C1.54199 13.6993 5.04926 17.2055 9.37533 17.2055C11.2676 17.2055 13.0032 16.5346 14.3572 15.4178L17.1773 18.2381C17.4702 18.531 17.945 18.5311 18.2379 18.2382C18.5308 17.9453 18.5309 17.4704 18.238 17.1775L15.4182 14.3575C16.5367 13.0035 17.2087 11.2671 17.2087 9.37381C17.2087 5.04835 13.7014 1.54218 9.37533 1.54218Z" fill=""></path>
                                        </svg>
                                    </span>
                                    <input type="text" id="simple-search" placeholder="Search courses, instructors, categories..." class="shadow-theme-xs focus:border-brand-300 focus:ring-brand-500/10 h-[42px] w-full rounded-lg border border-gray-300 bg-transparent py-2.5 pr-4 pl-[42px] !text-lg !text-gray-800 placeholder:!text-gray-400 focus:ring-3 focus:outline-hidden">
                                </div>
                            </div>
                            <button onclick="refreshCourses()" id="refreshButton" class="flex items-center gap-2 rounded-lg bg-gray-100 px-3 py-2 !text-lg font-medium text-gray-700 hover:bg-gray-200 transition-all duration-200">
                                <svg id="refreshIcon" class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M21 10C21 10 18.995 7.26822 17.3662 5.63824C15.7373 4.00827 13.4864 3 11 3C6.02944 3 2 7.02944 2 12C2 16.9706 6.02944 21 11 21C15.1031 21 18.5649 18.2543 19.6482 14.5M21 10V4M21 10H15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                                Refresh
                            </button>
                            
                            <button onclick="openAddCourseModal()" class="flex items-center gap-2 rounded-lg border border-blue-500 bg-blue-500 px-3 py-2 !text-lg font-medium !text-white hover:bg-blue-700 transition-all duration-200 ease-in-out hover:scale-105">
                                <svg class="w-7 h-7" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                                </svg>
                                Add Course
                            </button>
                        </div>
                    </div>

                    <!-- Filter Section -->
                    <div class="mb-8 px-5 sm:px-6">
                        <div class="flex flex-wrap items-center gap-2">
                            <button onclick="filterByCategory('all')" class="category-filter-btn inline-flex items-center justify-center gap-1.5 rounded-full bg-gray-600 py-1.5 pl-2.5 pr-3 !text-base font-medium !text-white hover:bg-gray-700 transition-all duration-200">
                                <svg class="fill-current" width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path fill-rule="evenodd" clip-rule="evenodd" d="M2 4C2 3.44772 2.44772 3 3 3H13C13.5523 3 14 3.44772 14 4C14 4.55228 13.5523 5 13 5H3C2.44772 5 2 4.55228 2 4ZM2 8C2 7.44772 2.44772 7 3 7H13C13.5523 7 14 7.44772 14 8C14 8.55228 13.5523 9 13 9H3C2.44772 9 2 8.55228 2 8ZM3 11C2.44772 11 2 11.4477 2 12C2 12.5523 2.44772 13 3 13H13C13.5523 13 14 12.5523 14 12C14 11.4477 13.5523 11 13 11H3Z" fill=""/>
                                </svg>
                                All Categories
                            </button>
                            <button onclick="filterByCategory('Data Analytics')" class="category-filter-btn inline-flex items-center justify-center gap-1.5 rounded-full bg-blue-600 py-1.5 pl-2.5 pr-3 !text-base font-medium !text-white hover:bg-blue-700 transition-all duration-200">
                                <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
                                </svg>
                                Data Analytics
                            </button>
                            <button onclick="filterByCategory('AI & Innovation')" class="category-filter-btn inline-flex items-center justify-center gap-1.5 rounded-full bg-purple-600 py-1.5 pl-2.5 pr-3 !text-base font-medium !text-white hover:bg-purple-700 transition-all duration-200">
                                <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"/>
                                </svg>
                                AI & Innovation
                            </button>
                            <button onclick="filterByCategory('Coding and Tech')" class="category-filter-btn inline-flex items-center justify-center gap-1.5 rounded-full bg-emerald-600 py-1.5 pl-2.5 pr-3 !text-base font-medium !text-white hover:bg-emerald-700 transition-all duration-200">
                                <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"/>
                                </svg>
                                Coding & Tech
                            </button>
                            <button onclick="filterByCategory('Process Management')" class="category-filter-btn inline-flex items-center justify-center gap-1.5 rounded-full bg-teal-600 py-1.5 pl-2.5 pr-3 !text-base font-medium !text-white hover:bg-teal-700 transition-all duration-200">
                                <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/>
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                                </svg>
                                Process Management
                            </button>
                            <button onclick="filterByCategory('Soft Skills')" class="category-filter-btn inline-flex items-center justify-center gap-1.5 rounded-full bg-rose-600 py-1.5 pl-2.5 pr-3 !text-base font-medium !text-white hover:bg-rose-700 transition-all duration-200">
                                <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"/>
                                </svg>
                                Soft Skills
                            </button>
                            <button onclick="filterByCategory('WCM Knowledge')" class="category-filter-btn inline-flex items-center justify-center gap-1.5 rounded-full bg-amber-600 py-1.5 pl-2.5 pr-3 !text-base font-medium !text-white hover:bg-amber-700 transition-all duration-200">
                                <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 7.172V5L8 4z"/>
                                </svg>
                                WCM Knowledge
                            </button>
                            <button onclick="filterByCategory('Cross Skills')" class="category-filter-btn inline-flex items-center justify-center gap-1.5 rounded-full bg-orange-600 py-1.5 pl-2.5 pr-3 !text-base font-medium !text-white hover:bg-orange-700 transition-all duration-200">
                                <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 4a2 2 0 114 0v1a1 1 0 001 1h3a1 1 0 011 1v3a1 1 0 01-1 1h-1a2 2 0 100 4h1a1 1 0 011 1v3a1 1 0 01-1 1h-3a1 1 0 01-1-1v-1a2 2 0 10-4 0v1a1 1 0 01-1 1H7a1 1 0 01-1-1v-3a1 1 0 00-1-1H4a2 2 0 110-4h1a1 1 0 001-1V7a1 1 0 011-1h3a1 1 0 001-1V4z"/>
                                </svg>
                                Cross Skills
                            </button>
                        </div>
                    </div>

                    <!-- Active Filters Badge Container -->
                    <div id="activeFiltersContainer" class="hidden mb-6 px-5 sm:px-6">
                        <div class="flex flex-wrap items-center gap-2">
                            <span class="!text-base font-medium text-gray-600">Active Filters:</span>
                            <div id="filterBadges" class="flex flex-wrap gap-2">
                                <!-- Filter badges will be dynamically added here -->
                            </div>
                        </div>
                    </div>

                    <!-- Course Cards Container -->
                    <div class="px-5 sm:px-6">
                        <!-- Loading Overlay -->
                        <div id="loadingOverlay" class="hidden items-center justify-center py-16 mb-6">
                            <div class="text-center">
                                <svg class="animate-spin h-12 w-12 text-blue-600 mx-auto" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                                </svg>
                                <p class="mt-3 !text-base font-medium text-gray-700">Refreshing courses...</p>
                            </div>
                        </div>
                        
                        <!-- Content Container -->
                        <div id="contentContainer">
                        <div class="grid grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 auto-rows-fr" id="courseCardsContainer">
                            <!-- Course cards will be dynamically added here -->
                            </div>
                        </div>
                    </div>

                    <div class="border-t border-gray-200 px-6 py-4">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center gap-2">
                                <span class="!text-lg !text-gray-700">Show</span>
                                <select id="itemsPerPage" class="rounded-lg border border-gray-300 bg-white px-2 py-1 !text-lg !text-gray-700">
                                    <option value="5">5</option>
                                    <option value="10" selected>10</option>
                                    <option value="20">20</option>
                                    <option value="50">50</option>
                                </select>
                                <span class="!text-lg !text-gray-700">items per page</span>
                            </div>

                            <div class="flex items-center gap-2">
                                <button onclick="previousPage()" class="!text-lg shadow-theme-xs flex items-center gap-2 rounded-lg border border-gray-300 bg-white px-2 py-2 font-medium !text-gray-700 hover:bg-gray-50 hover:!text-gray-800 sm:px-3.5">
                                    <svg class="fill-current" width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <path fill-rule="evenodd" clip-rule="evenodd" d="M2.58301 9.99868C2.58272 10.1909 2.65588 10.3833 2.80249 10.53L7.79915 15.5301C8.09194 15.8231 8.56682 15.8233 8.85981 15.5305C9.15281 15.2377 9.15297 14.7629 8.86018 14.4699L5.14009 10.7472L16.6675 10.7472C17.0817 10.7472 17.4175 10.4114 17.4175 9.99715C17.4175 9.58294 17.0817 9.24715 16.6675 9.24715L5.14554 9.24715L8.86017 5.53016C9.15297 5.23717 9.15282 4.7623 8.85983 4.4695C8.56684 4.1767 8.09197 4.17685 7.79917 4.46984L2.84167 9.43049C2.68321 9.568 2.58301 9.77087 2.58301 9.99715C2.58301 9.99766 2.58301 9.99817 2.58301 9.99868Z" fill=""></path>
                                    </svg>
                                    <span class="hidden sm:inline">Previous</span>
                                </button>

                                <span class="block !text-lg font-medium !text-gray-700 sm:hidden">
                                    Page <span id="currentPage">1</span> of <span id="totalPages">1</span>
                                </span>

                                <ul class="hidden items-center gap-0.5 sm:flex" id="pagination">
                                    <!-- Pagination will be dynamically added here -->
                                </ul>

                                <button onclick="nextPage()" class="!text-lg shadow-theme-xs flex items-center gap-2 rounded-lg border border-gray-300 bg-white px-2 py-2 font-medium !text-gray-700 hover:bg-gray-50 hover:!text-gray-800 sm:px-3.5">
                                    <span class="hidden sm:inline">Next</span>
                                    <svg class="fill-current" width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <path fill-rule="evenodd" clip-rule="evenodd" d="M17.4175 9.9986C17.4178 10.1909 17.3446 10.3832 17.198 10.53L12.2013 15.5301C11.9085 15.8231 11.4337 15.8233 11.1407 15.5305C10.8477 15.2377 10.8475 14.7629 11.1403 14.4699L14.8604 10.7472L3.33301 10.7472C2.91879 10.7472 2.58301 10.4114 2.58301 9.99715C2.58301 9.58294 2.91879 9.24715 3.33301 9.24715L14.8549 9.24715L11.1403 5.53016C10.8475 5.23717 10.8477 4.7623 11.1407 4.4695C11.4336 4.1767 11.9085 4.17685 12.2013 4.46984L17.1588 9.43049C17.3173 9.568 17.4175 9.77087 17.4175 9.99715C17.4175 9.99763 17.4175 9.99812 17.4175 9.9986Z" fill=""></path>
                                    </svg>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Training Course Modal -->
    <div id="addCourseModal" class="fixed inset-0 z-[9999] hidden overflow-y-auto" aria-labelledby="modal-title" role="dialog" aria-modal="true">
        <div class="flex min-h-screen items-center justify-center p-4 text-center sm:p-0">
            <div class="fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity" aria-hidden="true" onclick="closeAddCourseModal()"></div>
            <div class="relative transform overflow-hidden rounded-2xl bg-white text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-lg">
                <div class="rounded-2xl border border-gray-200 bg-white">
                    <div class="px-5 py-4 sm:px-6 sm:py-5">
                        <div class="flex items-center justify-between">
                            <h3 class="!text-2xl font-medium text-gray-800">
                                Add New Training Course
                            </h3>
                            <button type="button" onclick="closeAddCourseModal()" class="!text-gray-400 hover:!text-gray-500">
                                <svg class="h-7 w-7" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                </svg>
                            </button>
                        </div>
                    </div>
                    <div class="p-5 space-y-6 border-t border-gray-100 sm:p-6">
                        <form id="addCourseForm" onsubmit="submitNewCourse(event)">
                            <div class="-mx-2.5 flex flex-wrap gap-y-5">
                                <div class="w-full px-2.5">
                                    <input type="text" id="courseName" placeholder="Course Name" required
                                        class="h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 !text-lg !text-gray-800 shadow-theme-xs placeholder:!text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10">
                                </div>

                                <div class="w-full px-2.5">
                                    <textarea id="courseDescription" placeholder="Course Description" required rows="3"
                                        class="w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 !text-lg !text-gray-800 shadow-theme-xs placeholder:!text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10"></textarea>
                                </div>

                                <div class="w-full px-2.5">
                                    <select id="courseCategory" required
                                        class="h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 !text-lg !text-gray-800 shadow-theme-xs placeholder:!text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10">
                                        <option value="">Select Category</option>
                                        <option value="Data Analytics">Data Analytics</option>
                                        <option value="AI & Innovation">AI & Innovation</option>
                                        <option value="Coding and Tech">Coding and Tech</option>
                                        <option value="Process Management">Process Management</option>
                                        <option value="Soft Skills">Soft Skills</option>
                                        <option value="WCM Knowledge">WCM Knowledge</option>
                                        <option value="Cross Skills">Cross Skills</option>
                                    </select>
                                </div>

                                <div class="w-full px-2.5">
                                    <input type="text" id="courseInstructor" placeholder="Instructor Name" required
                                        class="h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 !text-lg !text-gray-800 shadow-theme-xs placeholder:!text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10">
                                </div>

                                <div class="w-full px-2.5">
                                    <input type="datetime-local" id="courseStartDate" required
                                        class="h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 !text-lg !text-gray-800 shadow-theme-xs placeholder:!text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10">
                                </div>

                                <div class="w-full px-2.5">
                                    <input type="datetime-local" id="courseEndDate" required
                                        class="h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 !text-lg !text-gray-800 shadow-theme-xs placeholder:!text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10">
                                </div>

                                <div class="w-full px-2.5">
                                    <input type="number" id="courseMaxStudents" placeholder="Maximum Students" required min="1" max="100"
                                        class="h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 !text-lg !text-gray-800 shadow-theme-xs placeholder:!text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10">
                                </div>

                                <div class="w-full px-2.5">
                                    <input type="text" id="courseLocation" placeholder="Location (Online/Room/Address)" required
                                        class="h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 !text-lg !text-gray-800 shadow-theme-xs placeholder:!text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10">
                                </div>

                                <div class="w-full px-2.5">
                                    <label class="block !text-lg font-medium !text-gray-700 mb-2">Course Outline (What You'll Learn)</label>
                                    <div id="courseOutlineContainer" class="space-y-2">
                                        <div class="flex items-center gap-2">
                                            <span class="!text-gray-500">â€¢</span>
                                            <input type="text" placeholder="Learning objective 1" 
                                                class="course-outline-item flex-1 rounded-lg border border-gray-300 bg-transparent px-3 py-2 !text-lg !text-gray-800 shadow-theme-xs placeholder:!text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10">
                                            <button type="button" onclick="removeCourseOutlineItem(this)" class="!text-red-500 hover:!text-red-700 px-2" style="display: none;">
                                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                                </svg>
                                            </button>
                                        </div>
                                    </div>
                                    <button type="button" onclick="addCourseOutlineItem()" class="mt-2 !text-lg !text-blue-600 hover:!text-blue-800 flex items-center gap-1">
                                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                                        </svg>
                                        Add Learning Objective
                                    </button>
                                </div>

                                <div class="w-full px-2.5">
                                    <button type="submit" class="w-full p-3 !text-lg font-medium !text-white transition-colors rounded-lg bg-blue-500 hover:bg-blue-800">
                                        Add Course
                                    </button>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Course Details Modal -->
    <div id="courseDetailsModal" class="fixed inset-0 z-[9999] hidden overflow-y-auto" aria-labelledby="modal-title" role="dialog" aria-modal="true">
        <div class="flex min-h-screen items-center justify-center p-4 text-center sm:p-0">
            <div class="fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity" aria-hidden="true" onclick="closeCourseDetailsModal()"></div>
            <div class="relative transform overflow-hidden rounded-2xl bg-white text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-2xl">
                <div class="rounded-2xl border border-gray-200 bg-white">
                    <!-- Modal Header -->
                    <div class="px-5 py-4 sm:px-6 sm:py-5">
                        <div class="flex items-center justify-between">
                            <h3 class="!text-2xl font-medium !text-gray-800" id="modalCourseTitle">
                                Course Details
                            </h3>
                            <button type="button" onclick="closeCourseDetailsModal()" class="!text-gray-400 hover:!text-gray-500">
                                <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                </svg>
                            </button>
                        </div>
                    </div>

                    <!-- Modal Content -->
                    <div class="p-5 space-y-6 border-t border-gray-100 sm:p-6 max-h-[60vh] overflow-y-auto">
                        <!-- Category Badge -->
                        <div>
                            <span class="inline-flex items-center gap-1.5 rounded-full px-3 py-1.5 !text-base font-medium" id="modalCategoryBadge">
                                Category
                            </span>
                        </div>

                        <!-- Course Description -->
                        <div>
                            <h4 class="!text-lg font-semibold !text-gray-800 mb-2">Course Description</h4>
                            <p class="!text-base !text-gray-600 leading-relaxed" id="modalCourseDescription">
                                Course description will be displayed here.
                            </p>
                        </div>

                        <!-- Course Details Grid -->
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                            <!-- Instructor -->
                            <div class="flex items-start gap-3">
                                <div class="flex-shrink-0 w-10 h-10 bg-indigo-100 rounded-lg flex items-center justify-center">
                                    <svg class="w-5 h-5 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                                    </svg>
                                </div>
                                <div>
                                    <p class="!text-base font-medium !text-gray-500">Instructor</p>
                                    <p class="!text-base !text-gray-900 font-semibold" id="modalInstructor">Instructor Name</p>
                                </div>
                            </div>

                            <!-- Schedule -->
                            <div class="flex items-start gap-3">
                                <div class="flex-shrink-0 w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center">
                                    <svg class="w-5 h-5 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                                    </svg>
                                </div>
                                <div>
                                    <p class="!text-base font-medium !text-gray-500">Schedule</p>
                                    <p class="!text-base !text-gray-900 font-semibold" id="modalSchedule">Date & Time</p>
                                </div>
                            </div>

                            <!-- Location -->
                            <div class="flex items-start gap-3">
                                <div class="flex-shrink-0 w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center">
                                    <svg class="w-5 h-5 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path>
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                    </svg>
                                </div>
                                <div>
                                    <p class="!text-base font-medium !text-gray-500">Location</p>
                                    <p class="!text-base !text-gray-900 font-semibold" id="modalLocation">Location Details</p>
                                </div>
                            </div>

                            <!-- Enrollment -->
                            <div class="flex items-start gap-3">
                                <div class="flex-shrink-0 w-10 h-10 bg-purple-100 rounded-lg flex items-center justify-center">
                                    <svg class="w-5 h-5 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path>
                                    </svg>
                                </div>
                                <div>
                                    <p class="!text-base font-medium !text-gray-500">Enrollment</p>
                                    <p class="!text-base !text-gray-900 font-semibold" id="modalEnrollment">0/0 Students</p>
                                </div>
                            </div>
                        </div>

                        <!-- Enrollment Progress Bar -->
                        <div>
                            <div class="flex justify-between items-center mb-2">
                                <span class="!text-base font-medium !text-gray-700">Course Capacity</span>
                                <span class="!text-base font-medium !text-gray-500" id="modalProgressText">0% filled</span>
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-2.5">
                                <div id="modalProgressBar" class="bg-blue-600 h-2.5 rounded-full transition-all duration-500" style="width: 0%"></div>
                            </div>
                        </div>

                        <!-- Registered Participants -->
                        <div id="modalRegisteredSection" class="hidden">
                            <h4 class="!text-lg font-semibold !text-gray-800 mb-3">Registered Participants</h4>
                            <div class="bg-purple-50 rounded-lg p-4">
                                <div class="flex flex-wrap gap-2" id="modalRegisteredUsers">
                                    <!-- Registered users will be dynamically loaded -->
                                </div>
                            </div>
                        </div>

                        <!-- Course Outline -->
                        <div>
                            <h4 class="!text-lg font-semibold !text-gray-800 mb-3">What You'll Learn</h4>
                            <div class="space-y-3" id="modalCourseOutline">
                                <!-- Learning objectives will be dynamically loaded -->
                            </div>
                        </div>
                    </div>

                    <!-- Modal Footer -->
                    <div class="px-5 py-4 border-t border-gray-100 sm:px-6">
                        <div class="flex items-center justify-between">
                            <span class="!text-base !text-gray-600" id="modalAvailableSpots">0 spots available</span>
                            <div class="flex gap-3">
                                <button onclick="closeCourseDetailsModal()" class="px-4 py-2.5 !text-base font-medium !text-gray-700 transition-colors rounded-lg bg-white border border-gray-300 hover:bg-gray-50">
                                    Close
                                </button>
                                <button onclick="event.stopPropagation(); registerFromModal()" id="modalRegisterBtn" class="px-6 py-2.5 !text-base font-semibold !text-white transition-all duration-200 rounded-lg shadow-lg hover:shadow-xl">
                                    Register Now
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global variables for table data
        let tableData = [];
        let filteredData = [];
        let currentPage = 1;
        let itemsPerPage = 10;
        let selectedCategory = 'all';
        let currentUser = null;

        // Function to check if user is logged in and get user info
        async function checkUserAuthentication() {
            try {
                console.log('Checking user authentication...');
                const response = await fetch('https://cedt-confluence.net/confluence/rest/api/user/current', {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                if (response.ok) {
                    const userData = await response.json();
                    const username = userData.username || userData.displayName || userData.name || userData.accountId;
                    
                    if (username) {
                        currentUser = username;
                        console.log('User authenticated successfully:', currentUser);
                        return true;
                    } else {
                        console.warn('User data received but no username found:', userData);
                        currentUser = null;
                        return false;
                    }
                } else {
                    console.warn('Authentication failed with status:', response.status);
                    if (response.status === 401 || response.status === 403) {
                        currentUser = null;
                    }
                    return false;
                }
            } catch (error) {
                console.error('Error checking authentication:', error);
                return currentUser !== null;
            }
        }

        // Function to register for a course
        async function registerForCourse(courseId) {
            try {
                const isLoggedIn = await checkUserAuthentication();
                
                if (!isLoggedIn || !currentUser) {
                    if (typeof showErrorToast === 'function') {
                        showErrorToast('You need to be signed in to register for courses');
                    }
                    return;
                }

                const course = tableData.find(c => c.id === courseId);
                if (!course) {
                    if (typeof showErrorToast === 'function') {
                        showErrorToast('Course not found');
                    }
                    return;
                }

                const availableSpots = course.maxStudents - course.enrolledStudents;
                if (availableSpots <= 0) {
                    if (typeof showErrorToast === 'function') {
                        showErrorToast('This course is already full');
                    }
                    return;
                }

                if (!course.registrations) {
                    course.registrations = [];
                } else if (!Array.isArray(course.registrations)) {
                    if (typeof course.registrations === 'string') {
                        try {
                            course.registrations = JSON.parse(course.registrations);
                        } catch (e) {
                            course.registrations = course.registrations.split(',')
                                .map(s => s.trim())
                                .filter(s => s.length > 0);
                        }
                    } else {
                        course.registrations = [];
                    }
                }

                const isAlreadyRegistered = course.registrations.includes(currentUser);
                
                if (isAlreadyRegistered) {
                    if (typeof showInfoToast === 'function') {
                        showInfoToast('You are already registered for this course');
                    }
                    return;
                }

                course.registrations.push(currentUser);
                course.enrolledStudents = course.registrations.length;

                await updateTrainingCourseFile(course);

                if (typeof showSuccessToast === 'function') {
                    showSuccessToast(`Successfully registered for "${course.name}"`);
                }
                
                updateTable();
                
            } catch (error) {
                console.error('Error registering for course:', error);
                if (typeof showErrorToast === 'function') {
                    showErrorToast('Failed to register for course. Please try again.');
                }
            }
        }

        // Function to unregister from a course
        async function unregisterFromCourse(courseId) {
            try {
                const isLoggedIn = await checkUserAuthentication();
                
                if (!isLoggedIn || !currentUser) {
                    if (typeof showErrorToast === 'function') {
                        showErrorToast('You need to be signed in to unregister from courses');
                    }
                    return;
                }

                const course = tableData.find(c => c.id === courseId);
                if (!course) {
                    if (typeof showErrorToast === 'function') {
                        showErrorToast('Course not found');
                    }
                    return;
                }

                if (!course.registrations) {
                    course.registrations = [];
                } else if (!Array.isArray(course.registrations)) {
                    if (typeof course.registrations === 'string') {
                        try {
                            course.registrations = JSON.parse(course.registrations);
                        } catch (e) {
                            course.registrations = course.registrations.split(',')
                                .map(s => s.trim())
                                .filter(s => s.length > 0);
                        }
                    } else {
                        course.registrations = [];
                    }
                }

                const isRegistered = course.registrations.includes(currentUser);
                
                if (!isRegistered) {
                    if (typeof showErrorToast === 'function') {
                        showErrorToast('You are not registered for this course');
                    }
                    return;
                }

                course.registrations = course.registrations.filter(user => user !== currentUser);
                course.enrolledStudents = course.registrations.length;

                await updateTrainingCourseFile(course);

                if (typeof showSuccessToast === 'function') {
                    showSuccessToast(`Successfully unregistered from "${course.name}"`);
                }
                
                updateTable();
                
            } catch (error) {
                console.error('Error unregistering from course:', error);
                if (typeof showErrorToast === 'function') {
                    showErrorToast('Failed to unregister from course. Please try again.');
                }
            }
        }

        // Function to update training course file
        async function updateTrainingCourseFile(updatedCourse) {
            const pageId = '2740868871';
            const attachmentName = 'training_courses.json';
            
            try {
                console.log('Updating JSON file for course:', updatedCourse.name);

                const attachmentsResponse = await fetch(`https://cedt-confluence.net/confluence/rest/api/content/${pageId}/child/attachment?filename=${attachmentName}`, {
                    headers: {
                        'X-Atlassian-Token': 'no-check'
                    }
                });

                let attachmentId = null;
                let existingData = { courses: [], metadata: { lastUpdated: '', totalCourses: 0, categories: {} } };

                if (attachmentsResponse.ok) {
                    const attachmentsData = await attachmentsResponse.json();
                    if (attachmentsData.results && attachmentsData.results.length > 0) {
                        attachmentId = attachmentsData.results[0].id;
                    
                        const dataResponse = await fetch(`https://cedt-confluence.net/confluence/download/attachments/${pageId}/${attachmentName}?api=v2`, {
                            headers: {
                                'X-Atlassian-Token': 'no-check'
                            }
                        });

                        if (dataResponse.ok) {
                            const data = await dataResponse.json();
                            if (data.courses && Array.isArray(data.courses)) {
                                existingData = data;
                            } else if (Array.isArray(data)) {
                                existingData.courses = data;
                            }
                        }
                    }
                }

                const courseIndex = existingData.courses.findIndex(c => c.id === updatedCourse.id);
                if (courseIndex !== -1) {
                    existingData.courses[courseIndex] = updatedCourse;
                } else {
                    existingData.courses.push(updatedCourse);
                }

                const tableIndex = tableData.findIndex(c => c.id === updatedCourse.id);
                if (tableIndex !== -1) {
                    tableData[tableIndex] = updatedCourse;
                }

                existingData.metadata = {
                    lastUpdated: new Date().toISOString(),
                    totalCourses: existingData.courses.length,
                    categories: existingData.courses.reduce((acc, course) => {
                        acc[course.category] = (acc[course.category] || 0) + 1;
                        return acc;
                    }, {})
                };

                const blob = new Blob([JSON.stringify(existingData, null, 2)], { type: 'application/json' });
                const formData = new FormData();
                formData.append('file', blob, attachmentName);

                const uploadUrl = `https://cedt-confluence.net/confluence/rest/api/content/${pageId}/child/attachment${attachmentId ? `/${attachmentId}` : ''}`;

                const uploadResponse = await fetch(uploadUrl, {
                    method: 'POST',
                    headers: {
                        'X-Atlassian-Token': 'no-check'
                    },
                    body: formData
                });

                if (!uploadResponse.ok) {
                    const errorText = await uploadResponse.text();
                    console.error('Upload response error:', errorText);
                    throw new Error(`Failed to update training courses file: ${uploadResponse.status} ${uploadResponse.statusText}`);
                }

                console.log('JSON file updated successfully');
            } catch (error) {
                console.error('Error updating training courses file:', error);
                throw error;
            }
        }

        // Function to refresh data
        async function refreshData() {
            showLoadingState();
            try {
                const data = await fetchDataFromConfluence();
                if (data && data.length > 0) {
                    tableData = data;
                    filterData();
                    showNotification('Success', `Refreshed ${data.length} courses successfully`, 'notification');
                } else {
                    tableData = [];
                    filterData();
                    showNotification('No Data', 'No training courses found', 'notification');
                }
            } catch (error) {
                console.error('Error refreshing data:', error);
                tableData = [];
                filterData();
                showNotification('Error', 'Failed to refresh training courses data', 'error');
            }
        }
        
        // Refresh courses function with button control and overlay
        async function refreshCourses() {
            const refreshButton = document.getElementById('refreshButton');
            const loadingOverlay = document.getElementById('loadingOverlay');
            const contentContainer = document.getElementById('contentContainer');
            
            // Disable button
            refreshButton.disabled = true;
            
            // Clear all filters
            clearAllFilters();
            
            // Hide content container, show only loading overlay
            contentContainer.classList.add('hidden');
            loadingOverlay.classList.remove('hidden');
            loadingOverlay.classList.add('flex');
            
            try {
                // Fetch fresh data
                const data = await fetchDataFromConfluence();
                
                if (data && data.length > 0) {
                    tableData = data;
                    currentPage = 1;
                    filterData();
                    
                    // Show success toast
                    if (typeof showSuccessToast === 'function') {
                        showSuccessToast(`Refreshed ${data.length} courses successfully`);
                    }
                } else {
                    tableData = [];
                    filterData();
                    if (typeof showInfoToast === 'function') {
                        showInfoToast('No courses found');
                    }
                }
                
                // Wait a bit to ensure render completes
                setTimeout(() => {
                    loadingOverlay.classList.add('hidden');
                    loadingOverlay.classList.remove('flex');
                    contentContainer.classList.remove('hidden');
                }, 500);
            } catch (error) {
                console.error('Error refreshing courses:', error);
                
                // Hide overlay and show content on error
                loadingOverlay.classList.add('hidden');
                loadingOverlay.classList.remove('flex');
                contentContainer.classList.remove('hidden');
                
                if (typeof showErrorToast === 'function') {
                    showErrorToast('Failed to refresh courses');
                }
            } finally {
                // Re-enable button
                setTimeout(() => {
                    refreshButton.disabled = false;
                }, 500);
            }
        }

        // Filter by category
        function filterByCategory(category) {
            selectedCategory = category;
            currentPage = 1;

            // Update button styles
            const buttons = document.querySelectorAll('.category-filter-btn');
            buttons.forEach(btn => {
                const btnText = btn.textContent.trim();
                const isActive = (category === 'all' && btnText === 'All Categories') || 
                                btnText === category;
                
                if (isActive) {
                    // Active state - darker shade
                    if (btnText === 'All Categories') {
                        btn.className = 'category-filter-btn inline-flex items-center justify-center gap-1.5 rounded-full bg-gray-700 py-1.5 pl-2.5 pr-3 !text-base font-medium !text-white hover:bg-gray-800 transition-all duration-200';
                    } else if (btnText === 'Data Analytics') {
                        btn.className = 'category-filter-btn inline-flex items-center justify-center gap-1.5 rounded-full bg-blue-700 py-1.5 pl-2.5 pr-3 !text-base font-medium !text-white hover:bg-blue-800 transition-all duration-200';
                    } else if (btnText === 'AI & Innovation') {
                        btn.className = 'category-filter-btn inline-flex items-center justify-center gap-1.5 rounded-full bg-purple-700 py-1.5 pl-2.5 pr-3 !text-base font-medium !text-white hover:bg-purple-800 transition-all duration-200';
                    } else if (btnText === 'Coding & Tech') {
                        btn.className = 'category-filter-btn inline-flex items-center justify-center gap-1.5 rounded-full bg-emerald-700 py-1.5 pl-2.5 pr-3 !text-base font-medium !text-white hover:bg-emerald-800 transition-all duration-200';
                    } else if (btnText === 'Process Management') {
                        btn.className = 'category-filter-btn inline-flex items-center justify-center gap-1.5 rounded-full bg-teal-700 py-1.5 pl-2.5 pr-3 !text-base font-medium !text-white hover:bg-teal-800 transition-all duration-200';
                    } else if (btnText === 'Soft Skills') {
                        btn.className = 'category-filter-btn inline-flex items-center justify-center gap-1.5 rounded-full bg-rose-700 py-1.5 pl-2.5 pr-3 !text-base font-medium !text-white hover:bg-rose-800 transition-all duration-200';
                    } else if (btnText === 'WCM Knowledge') {
                        btn.className = 'category-filter-btn inline-flex items-center justify-center gap-1.5 rounded-full bg-amber-700 py-1.5 pl-2.5 pr-3 !text-base font-medium !text-white hover:bg-amber-800 transition-all duration-200';
                    } else if (btnText === 'Cross Skills') {
                        btn.className = 'category-filter-btn inline-flex items-center justify-center gap-1.5 rounded-full bg-orange-700 py-1.5 pl-2.5 pr-3 !text-base font-medium !text-white hover:bg-orange-800 transition-all duration-200';
                    }
                } else {
                    // Reset to original color
                    if (btnText === 'All Categories') {
                        btn.className = 'category-filter-btn inline-flex items-center justify-center gap-1.5 rounded-full bg-gray-600 py-1.5 pl-2.5 pr-3 !text-base font-medium !text-white hover:bg-gray-700 transition-all duration-200';
                    } else if (btnText === 'Data Analytics') {
                        btn.className = 'category-filter-btn inline-flex items-center justify-center gap-1.5 rounded-full bg-blue-600 py-1.5 pl-2.5 pr-3 !text-base font-medium !text-white hover:bg-blue-700 transition-all duration-200';
                    } else if (btnText === 'AI & Innovation') {
                        btn.className = 'category-filter-btn inline-flex items-center justify-center gap-1.5 rounded-full bg-purple-600 py-1.5 pl-2.5 pr-3 !text-base font-medium !text-white hover:bg-purple-700 transition-all duration-200';
                    } else if (btnText === 'Coding & Tech') {
                        btn.className = 'category-filter-btn inline-flex items-center justify-center gap-1.5 rounded-full bg-emerald-600 py-1.5 pl-2.5 pr-3 !text-base font-medium !text-white hover:bg-emerald-700 transition-all duration-200';
                    } else if (btnText === 'Process Management') {
                        btn.className = 'category-filter-btn inline-flex items-center justify-center gap-1.5 rounded-full bg-teal-600 py-1.5 pl-2.5 pr-3 !text-base font-medium !text-white hover:bg-teal-700 transition-all duration-200';
                    } else if (btnText === 'Soft Skills') {
                        btn.className = 'category-filter-btn inline-flex items-center justify-center gap-1.5 rounded-full bg-rose-600 py-1.5 pl-2.5 pr-3 !text-base font-medium !text-white hover:bg-rose-700 transition-all duration-200';
                    } else if (btnText === 'WCM Knowledge') {
                        btn.className = 'category-filter-btn inline-flex items-center justify-center gap-1.5 rounded-full bg-amber-600 py-1.5 pl-2.5 pr-3 !text-base font-medium !text-white hover:bg-amber-700 transition-all duration-200';
                    } else if (btnText === 'Cross Skills') {
                        btn.className = 'category-filter-btn inline-flex items-center justify-center gap-1.5 rounded-full bg-orange-600 py-1.5 pl-2.5 pr-3 !text-base font-medium !text-white hover:bg-orange-700 transition-all duration-200';
                    }
                }
            });

            updateFilterBadges();
            filterData();
        }

        // Filter data based on search term and category
        function filterData() {
            const searchTerm = document.getElementById('simple-search').value.toLowerCase();
            
            filteredData = tableData.filter(item => {
                const matchesSearch = !searchTerm || 
                    Object.values(item).some(value => 
                        String(value).toLowerCase().includes(searchTerm)
                    );
                const matchesCategory = selectedCategory === 'all' || 
                    item.category === selectedCategory;
                
                return matchesSearch && matchesCategory;
            });

            currentPage = 1;
            updateFilterBadges();
            updateTable();
        }

        // Update filter badges display
        function updateFilterBadges() {
            const container = document.getElementById('activeFiltersContainer');
            const badgesContainer = document.getElementById('filterBadges');
            const searchTerm = document.getElementById('simple-search').value;
            
            let badges = [];
            
            // Add category filter badge
            if (selectedCategory !== 'all') {
                badges.push({
                    type: 'category',
                    label: `Category: ${selectedCategory}`,
                    value: selectedCategory
                });
            }
            
            // Add search filter badge
            if (searchTerm.trim()) {
                badges.push({
                    type: 'search',
                    label: `Search: "${searchTerm}"`,
                    value: searchTerm
                });
                }

            // Show/hide container
            if (badges.length > 0) {
                container.classList.remove('hidden');
                badgesContainer.innerHTML = badges.map(badge => `
                    <span class="inline-flex items-center gap-1.5 rounded-full bg-blue-100 px-3 py-1 !text-base font-medium text-blue-800 border border-blue-200">
                        ${badge.label}
                        <button onclick="removeFilter('${badge.type}')" class="hover:bg-blue-200 rounded-full p-0.5 transition-colors">
                            <svg class="h-3.5 w-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                        </button>
                    </span>
                `).join('');
            } else {
                container.classList.add('hidden');
            }
        }
        
        // Remove individual filter
        function removeFilter(type) {
            if (type === 'category') {
                filterByCategory('all');
            } else if (type === 'search') {
                document.getElementById('simple-search').value = '';
                filterData();
            }
        }
        
        // Clear all filters
        function clearAllFilters() {
            selectedCategory = 'all';
            document.getElementById('simple-search').value = '';
            filterByCategory('all');
                                }

        // Function to fetch JSON data from Confluence
        async function fetchDataFromConfluence() {
            const pageId = '2740868871';
            const attachmentName = 'training_courses.json';

            try {
                // First, check if attachment exists and get its ID
                const attachmentsResponse = await fetch(`https://cedt-confluence.net/confluence/rest/api/content/${pageId}/child/attachment?filename=${attachmentName}`, {
                    headers: {
                        'X-Atlassian-Token': 'no-check'
                    }
                });

                if (!attachmentsResponse.ok) {
                    console.log('No existing training_courses.json found');
                    return [];
                }

                const attachmentsData = await attachmentsResponse.json();

                if (attachmentsData.results && attachmentsData.results.length > 0) {
                    // Attachment exists, fetch its content
                    const attachmentId = attachmentsData.results[0].id;
                    const downloadUrl = `https://cedt-confluence.net/confluence/download/attachments/${pageId}/${attachmentName}?api=v2`;

                    const dataResponse = await fetch(downloadUrl, {
                        headers: {
                            'X-Atlassian-Token': 'no-check'
                        }
                    });

                    if (!dataResponse.ok) {
                        throw new Error('Failed to fetch training_courses.json file');
                    }

                    const jsonData = await dataResponse.json();
                    
                    // Handle both formats: { courses: [] } or direct array
                    if (jsonData.courses && Array.isArray(jsonData.courses)) {
                        return jsonData.courses;
                    } else if (Array.isArray(jsonData)) {
                        return jsonData;
                    } else {
                        console.warn('Unexpected data format:', jsonData);
                        return [];
                    }
                } else {
                    console.log('Attachment does not exist, will create a new one.');
                    return [];
                }
            } catch (error) {
                console.error('Error fetching data:', error);
                return [];
            }
        }

        // Function to get category color and icon
        function getCategoryInfo(category) {
            const categories = {
                'Data Analytics': {
                    classes: 'bg-blue-50 text-blue-700 border border-blue-200',
                    icon: '<svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/></svg>'
                },
                'AI & Innovation': {
                    classes: 'bg-purple-50 text-purple-700 border border-purple-200',
                    icon: '<svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"/></svg>'
                },
                'Coding and Tech': {
                    classes: 'bg-emerald-50 text-emerald-700 border border-emerald-200',
                    icon: '<svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"/></svg>'
                },
                'Process Management': {
                    classes: 'bg-teal-50 text-teal-700 border border-teal-200',
                    icon: '<svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/></svg>'
                },
                'Soft Skills': {
                    classes: 'bg-rose-50 text-rose-700 border border-rose-200',
                    icon: '<svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"/></svg>'
                },
                'WCM Knowledge': {
                    classes: 'bg-amber-50 text-amber-700 border border-amber-200',
                    icon: '<svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 7.172V5L8 4z"/></svg>'
                },
                'Cross Skills': {
                    classes: 'bg-orange-50 text-orange-700 border border-orange-200',
                    icon: '<svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 4a2 2 0 114 0v1a1 1 0 001 1h3a1 1 0 011 1v3a1 1 0 01-1 1h-1a2 2 0 100 4h1a1 1 0 011 1v3a1 1 0 01-1 1h-3a1 1 0 01-1-1v-1a2 2 0 10-4 0v1a1 1 0 01-1 1H7a1 1 0 01-1-1v-3a1 1 0 00-1-1H4a2 2 0 110-4h1a1 1 0 001-1V7a1 1 0 011-1h3a1 1 0 001-1V4z"/></svg>'
                }
            };

            return categories[category] || {
                classes: 'bg-slate-50 text-slate-700 border border-slate-200',
                icon: '<svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"/></svg>'
            };
        }



        // Function to get ribbon info based on course status
        function getRibbonInfo(item) {
            const availableSpots = item.maxStudents - item.enrolledStudents;
            const progressPercentage = ((item.enrolledStudents / item.maxStudents) * 100);
            const courseDate = new Date(item.startDate);
            const today = new Date();
            const daysUntilStart = Math.ceil((courseDate - today) / (1000 * 60 * 60 * 24));
            
            // Priority order: Full > Filling Fast > Starting Soon > New > Popular
            if (availableSpots <= 0) {
                return { text: 'Full', color: 'bg-red-600', show: true };
            } else if (progressPercentage >= 85) {
                return { text: 'Filling Fast', color: 'bg-orange-600', show: true };
            } else if (daysUntilStart <= 7 && daysUntilStart > 0) {
                return { text: 'Starting Soon', color: 'bg-purple-600', show: true };
            } else if (progressPercentage >= 50) {
                return { text: 'Popular', color: 'bg-emerald-600', show: true };
            } else if (daysUntilStart <= 30 && daysUntilStart > 7) {
                return { text: 'New', color: 'bg-blue-600', show: true };
            }
            return { text: '', color: '', show: false };
        }

        // Function to create course card
        function createCourseCard(item) {
            const categoryInfo = getCategoryInfo(item.category);
            const availableSpots = item.maxStudents - item.enrolledStudents;
            const spotsClass = availableSpots > 0 ? 'text-emerald-600' : 'text-red-500';
            const startDate = new Date(item.startDate).toLocaleDateString();
            const endDate = new Date(item.endDate).toLocaleDateString();
            const startTime = new Date(item.startDate).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
            const progressPercentage = ((item.enrolledStudents / item.maxStudents) * 100).toFixed(0);
            const progressColor = progressPercentage >= 90 ? 'bg-red-500' : progressPercentage >= 70 ? 'bg-amber-500' : 'bg-emerald-500';
            const isMultiDay = startDate !== endDate;
            const ribbonInfo = getRibbonInfo(item);
            
            // Check if current user is registered
            let isUserRegistered = false;
            if (currentUser && item.registrations) {
                if (Array.isArray(item.registrations)) {
                    isUserRegistered = item.registrations.includes(currentUser);
                } else if (typeof item.registrations === 'string') {
                    try {
                        const registrationsArray = JSON.parse(item.registrations);
                        isUserRegistered = registrationsArray.includes(currentUser);
                    } catch (e) {
                        const registrationsArray = item.registrations.split(',')
                            .map(s => s.trim())
                            .filter(s => s.length > 0);
                        isUserRegistered = registrationsArray.includes(currentUser);
                    }
                }
            }
            
            // Get list of registered users
            let registeredUsers = [];
            if (item.registrations) {
                if (Array.isArray(item.registrations)) {
                    registeredUsers = item.registrations;
                } else if (typeof item.registrations === 'string') {
                    try {
                        registeredUsers = JSON.parse(item.registrations);
                    } catch (e) {
                        registeredUsers = item.registrations.split(',')
                            .map(s => s.trim())
                            .filter(s => s.length > 0);
                    }
                }
            }
            
            const isFull = availableSpots <= 0;
            
            return `
                <div onclick="openCourseDetailsModal('${item.id}')" class="relative overflow-hidden rounded-xl border border-gray-200 bg-white p-6 flex flex-col h-full transition-all duration-200 ease-in-out hover:border-blue-600 hover:shadow-lg cursor-pointer">
                    ${ribbonInfo.show ? `
                    <!-- Status Ribbon -->
                    <span class="absolute -left-9 -top-7 mt-3 flex h-14 w-24 -rotate-45 items-end justify-center ${ribbonInfo.color} px-4 py-1.5 !text-base font-medium text-white shadow-lg z-10">
                        ${ribbonInfo.text}
                    </span>
                    ` : ''}
                    
                    <!-- Course Image/Icon -->
                    <div class="mb-4 aspect-video w-full rounded-lg bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center flex-shrink-0">
                        <div class="text-4xl ${categoryInfo.classes.includes('emerald') ? 'text-emerald-600' : 
                                                categoryInfo.classes.includes('rose') ? 'text-rose-600' : 
                                                categoryInfo.classes.includes('purple') ? 'text-purple-600' : 
                                                categoryInfo.classes.includes('blue') ? 'text-blue-600' : 
                                                categoryInfo.classes.includes('indigo') ? 'text-indigo-600' : 
                                                categoryInfo.classes.includes('teal') ? 'text-teal-600' : 
                                                categoryInfo.classes.includes('amber') ? 'text-amber-600' : 
                                                categoryInfo.classes.includes('orange') ? 'text-orange-600' : 'text-gray-600'}">
                            ${categoryInfo.icon.replace('h-4 w-4', 'h-12 w-12')}
                        </div>
                    </div>
                    
                    <!-- Category Badge -->
                    <div class="mb-4 flex-shrink-0">
                        <span class="inline-flex items-center gap-1 rounded-full px-2.5 py-1 !text-base font-medium transition-all duration-200 ease-in-out hover:scale-105 ${categoryInfo.classes}">
                            ${categoryInfo.icon}
                            ${item.category}
                        </span>
                    </div>
                    
                    <!-- Course Title -->
                    <h3 class="mb-3 !text-lg font-semibold text-gray-900 line-clamp-2 flex-shrink-0" style="min-height: 3.5rem;">${item.name}</h3>
                    
                    <!-- Course Description -->
                    <p class="mb-4 !text-base text-gray-600 line-clamp-3 flex-grow" style="min-height: 4.5rem;">${item.description}</p>
                    
                    <!-- Course Details -->
                    <div class="mb-4 space-y-2 flex-shrink-0">
                        <div class="flex items-center !text-base text-gray-600">
                            <svg class="h-4 w-4 mr-2 text-blue-500 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                            </svg>
                            <span class="truncate">${isMultiDay ? `${startDate} - ${endDate}` : startDate} at ${startTime}</span>
                        </div>
                        <div class="flex items-center !text-base text-gray-600">
                            <svg class="h-4 w-4 mr-2 text-indigo-500 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                            </svg>
                            <span class="truncate">${item.instructor}</span>
                        </div>
                        <div class="flex items-center !text-base text-gray-600">
                            <svg class="h-4 w-4 mr-2 text-green-500 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path>
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
                            </svg>
                            <span class="truncate">${item.location}</span>
                        </div>
                    </div>
                    
                    <!-- Registered Users List -->
                    ${registeredUsers.length > 0 ? `
                    <div class="mb-4 flex-shrink-0">
                        <div class="flex items-start gap-2">
                            <svg class="h-4 w-4 mt-0.5 text-purple-500 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path>
                            </svg>
                            <div class="flex-1">
                                <p class="!text-base font-medium text-gray-700 mb-1">Registered:</p>
                                <div class="flex flex-wrap gap-1">
                                    ${registeredUsers.slice(0, 3).map(user => `
                                        <span class="inline-flex items-center px-2 py-0.5 rounded-full !text-base font-medium bg-purple-100 text-purple-700">
                                            ${user}
                                        </span>
                                    `).join('')}
                                    ${registeredUsers.length > 3 ? `
                                        <span class="inline-flex items-center px-2 py-0.5 rounded-full !text-base font-medium bg-gray-100 text-gray-700">
                                            +${registeredUsers.length - 3} more
                                        </span>
                                    ` : ''}
                                </div>
                            </div>
                        </div>
                    </div>
                    ` : ''}
                    
                    <!-- Enrollment Progress -->
                    <div class="mb-4 flex-shrink-0">
                        <div class="flex justify-between items-center mb-2">
                            <span class="!text-base font-medium text-gray-600">Enrollment</span>
                            <span class="!text-base ${spotsClass} font-medium">
                                ${item.enrolledStudents}/${item.maxStudents} ${availableSpots > 0 ? `(${availableSpots} left)` : '(Full)'}
                            </span>
                        </div>
                        <div class="w-full bg-gray-200 rounded-full h-2">
                            <div class="${progressColor} h-2 rounded-full transition-all duration-500" style="width: ${progressPercentage}%"></div>
                        </div>
                    </div>
                    
                    <!-- Register Button -->
                    <div class="mt-auto flex-shrink-0">
                        <button onclick="event.stopPropagation(); ${isUserRegistered ? `unregisterFromCourse('${item.id}')` : `registerForCourse('${item.id}')`}" 
                                class="w-full py-3 px-4 rounded-lg !text-base font-medium transition-all duration-200 ${
                                    isUserRegistered ? 
                                        'bg-emerald-50 text-emerald-700 border border-emerald-200 hover:bg-emerald-100' :
                                        isFull ? 
                                            'bg-gray-100 text-gray-500 border border-gray-200 cursor-not-allowed' :
                                            'bg-blue-50 text-blue-700 border border-blue-200 hover:bg-blue-100'
                                }"
                                ${isFull && !isUserRegistered ? 'disabled' : ''}>
                            ${isUserRegistered ? 
                                'âœ“ Registered - Click to Unregister' :
                                isFull ? 
                                    'Course Full' :
                                    'Register Now'
                            }
                        </button>
                    </div>
                </div>
            `;
        }

        // Function to update pagination
        function updatePagination() {
            const pagination = document.getElementById('pagination');
            const totalPages = Math.ceil(filteredData.length / itemsPerPage);
            pagination.innerHTML = '';
            
            // Always show first page
            if (totalPages > 0) {
                addPageButton(1);
            }

            // Show ellipsis if needed
            if (currentPage > 3) {
                addEllipsis();
            }

            // Show pages around current page
            for (let i = Math.max(2, currentPage - 1); i <= Math.min(totalPages - 1, currentPage + 1); i++) {
                if (i > 1 && i < totalPages) {
                    addPageButton(i);
                }
            }

            // Show ellipsis if needed
            if (currentPage < totalPages - 2) {
                addEllipsis();
            }

            // Always show last page
            if (totalPages > 1) {
                addPageButton(totalPages);
            }

            document.getElementById('currentPage').textContent = currentPage;
            document.getElementById('totalPages').textContent = totalPages;

            // Update button states
            const prevButton = document.querySelector('button[onclick="previousPage()"]');
            const nextButton = document.querySelector('button[onclick="nextPage()"]');
            
            if (prevButton) prevButton.disabled = currentPage === 1;
            if (nextButton) nextButton.disabled = currentPage === totalPages;
        }

        function addPageButton(pageNum) {
            const li = document.createElement('li');
            const a = document.createElement('a');
            a.href = '#';
            a.className = pageNum === currentPage 
                ? 'bg-brand-500/[0.08] !text-lg text-brand-500 hover:bg-brand-500/[0.08] hover:text-brand-500 flex h-10 w-10 items-center justify-center rounded-lg font-medium'
                : '!text-lg hover:bg-brand-500/[0.08] hover:text-brand-500 flex h-10 w-10 items-center justify-center rounded-lg font-medium !text-gray-700';
            a.textContent = pageNum;
            a.onclick = (e) => {
                e.preventDefault();
                currentPage = pageNum;
                updateTable();
            };
            li.appendChild(a);
            pagination.appendChild(li);
        }

        function addEllipsis() {
            const li = document.createElement('li');
            li.className = '!text-lg flex h-10 w-10 items-center justify-center text-gray-700';
            li.textContent = '...';
            pagination.appendChild(li);
        }

        // Function to update cards
        function updateTable() {
            const cardsContainer = document.getElementById('courseCardsContainer');
            const start = (currentPage - 1) * itemsPerPage;
            const end = start + itemsPerPage;
            const pageData = filteredData.slice(start, end);

            if (pageData.length === 0) {
                showNoDataState();
            } else {
                cardsContainer.innerHTML = pageData.map(createCourseCard).join('');
            }
            updatePagination();
        }

        // Function to handle next page
        function nextPage() {
            const totalPages = Math.ceil(filteredData.length / itemsPerPage);
            if (currentPage < totalPages) {
                currentPage++;
                updateTable();
            }
        }

        // Function to handle previous page
        function previousPage() {
            if (currentPage > 1) {
                currentPage--;
                updateTable();
            }
        }



        // Add loading state
        function showLoadingState() {
            const cardsContainer = document.getElementById('courseCardsContainer');
            cardsContainer.innerHTML = `
                <div class="col-span-full py-16">
                    <div class="flex flex-col items-center justify-center">
                        <div class="relative">
                            <div class="animate-spin rounded-full h-16 w-16 border-4 border-blue-200"></div>
                            <div class="animate-spin rounded-full h-16 w-16 border-4 border-blue-600 border-t-transparent absolute top-0 left-0"></div>
                        </div>
                        <div class="mt-6 text-center">
                            <span class="!text-lg font-medium !text-gray-700">Loading courses...</span>
                        </div>
                    </div>
                </div>
            `;
        }

        // Show no data state
        function showNoDataState() {
            const cardsContainer = document.getElementById('courseCardsContainer');
            cardsContainer.innerHTML = `
                <div class="col-span-full py-16">
                    <div class="flex flex-col items-center justify-center text-center">
                        <div class="relative mb-6">
                            <div class="w-24 h-24 bg-gradient-to-br from-blue-100 to-indigo-100 rounded-full flex items-center justify-center">
                                <svg class="w-12 h-12 !text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"/>
                                </svg>
                            </div>
                        </div>
                        <h3 class="!text-lg font-semibold !text-gray-700 mb-2">No courses found</h3>
                        <p class="!text-gray-500 mb-4 max-w-md">We couldn't find any training courses matching your criteria.</p>
                        <div class="flex flex-col sm:flex-row gap-2 !text-lg !text-gray-400">
                            <span>â€¢ Try adjusting your search terms</span>
                            <span>â€¢ Check different category filters</span>
                        </div>
                    </div>
                </div>
            `;
        }

        // ============================================
        // NOTIFICATIONS
        // ============================================
        // Toast notifications are provided by global-notifications.html (included as Confluence macro)
        // Available functions: showSuccessToast(), showErrorToast(), showWarningToast(), showInfoToast()
        // 
        // Legacy compatibility wrapper for showNotification()
        // ============================================
        function showNotification(message, type = 'success') {
            const typeMap = {
                'success': showSuccessToast,
                'error': showErrorToast,
                'warning': showWarningToast,
                'info': showInfoToast
            };
            const toastFn = typeMap[type] || showInfoToast;
            toastFn(message);
        }

        // Initialize table with data
        async function initializeTable() {
            showLoadingState();
            try {
                const data = await fetchDataFromConfluence();
                if (data && data.length > 0) {
                    tableData = data;
                    currentPage = 1;
                    itemsPerPage = parseInt(document.getElementById('itemsPerPage').value);
                    filterData();
                    showNotification('Success', `Loaded ${data.length} courses successfully`, 'notification');
                } else {
                    tableData = [];
                    currentPage = 1;
                    itemsPerPage = parseInt(document.getElementById('itemsPerPage').value);
                    filterData();
                    showNotification('No Data', 'No training courses found', 'notification');
                }
            } catch (error) {
                console.error('Error initializing table:', error);
                tableData = [];
                currentPage = 1;
                itemsPerPage = parseInt(document.getElementById('itemsPerPage').value);
                filterData();
                showNotification('Error', 'Failed to load training courses data', 'error');
            }
        }

        // Call initializeTable when the page loads
        document.addEventListener('DOMContentLoaded', async function() {
            console.log('Page loaded, initializing...');
            
            // Check user authentication first
            await checkUserAuthentication();
            console.log('Initial currentUser:', currentUser);
            
            // Initialize the table
            initializeTable();

            // Items per page change handler
            document.getElementById('itemsPerPage').addEventListener('change', function(e) {
                itemsPerPage = parseInt(e.target.value);
                currentPage = 1; // Reset to first page when changing items per page
                filterData();
            });

            // Search functionality
            const searchInput = document.getElementById('simple-search');
            if (searchInput) {
                searchInput.addEventListener('input', function(e) {
                    filterData();
                });

                // Prevent form submission on Enter key press
                searchInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        e.preventDefault();
                    }
                });
            }
        });

        // Add click handlers for the close buttons
        document.querySelectorAll('.close-notification').forEach(button => {
            button.addEventListener('click', (e) => {
                const notification = e.target.closest('.notification-item');
                if (notification) {
                    notification.remove();
                }
            });
        });

        // Auto close existing notifications after 5 seconds
        document.querySelectorAll('.notification-item').forEach(notification => {
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.remove();
                }
            }, 5000);
        });

        // Course Details Modal Functions
        let currentCourseData = null;

        function openCourseDetailsModal(courseId) {
            const course = tableData.find(item => item.id === courseId);
            if (!course) return;

            currentCourseData = course;
            const modal = document.getElementById('courseDetailsModal');
            
            // Populate modal with course data
            populateCourseModal(course);
            
            // Show modal
            modal.classList.remove('hidden');
            document.body.style.overflow = 'hidden'; // Prevent background scrolling
        }

        function closeCourseDetailsModal() {
            const modal = document.getElementById('courseDetailsModal');
            modal.classList.add('hidden');
            document.body.style.overflow = ''; // Restore scrolling
            currentCourseData = null;
        }

        function populateCourseModal(course) {
            const categoryInfo = getCategoryInfo(course.category);
            const availableSpots = course.maxStudents - course.enrolledStudents;
            const progressPercentage = ((course.enrolledStudents / course.maxStudents) * 100).toFixed(0);
            const startDate = new Date(course.startDate).toLocaleDateString();
            const endDate = new Date(course.endDate).toLocaleDateString();
            const startTime = new Date(course.startDate).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
            const isMultiDay = startDate !== endDate;
            const progressColor = progressPercentage >= 90 ? 'bg-red-500' : progressPercentage >= 70 ? 'bg-amber-500' : 'bg-emerald-500';

            // Update modal content
            document.getElementById('modalCourseTitle').textContent = course.name;
            
            // Update category badge
            const categoryBadge = document.getElementById('modalCategoryBadge');
            categoryBadge.className = `inline-flex items-center gap-1.5 rounded-full px-3 py-1.5 !text-base font-medium ${categoryInfo.classes}`;
            categoryBadge.innerHTML = `${categoryInfo.icon} ${course.category}`;
            
            document.getElementById('modalCourseDescription').textContent = course.description;
            document.getElementById('modalInstructor').textContent = course.instructor;
            document.getElementById('modalSchedule').textContent = isMultiDay ? 
                `${startDate} - ${endDate} at ${startTime}` : 
                `${startDate} at ${startTime}`;
            document.getElementById('modalLocation').textContent = course.location;
            document.getElementById('modalEnrollment').textContent = `${course.enrolledStudents}/${course.maxStudents} Students`;
            document.getElementById('modalProgressText').textContent = `${progressPercentage}% filled`;
            document.getElementById('modalAvailableSpots').textContent = availableSpots > 0 ? 
                `${availableSpots} spots available` : 'Course is full';

            // Update progress bar
            const progressBar = document.getElementById('modalProgressBar');
            progressBar.className = `h-2.5 rounded-full transition-all duration-500 ${progressColor}`;
            progressBar.style.width = `${progressPercentage}%`;

            // Display registered users
            let registeredUsers = [];
            if (course.registrations) {
                if (Array.isArray(course.registrations)) {
                    registeredUsers = course.registrations;
                } else if (typeof course.registrations === 'string') {
                    try {
                        registeredUsers = JSON.parse(course.registrations);
                    } catch (e) {
                        registeredUsers = course.registrations.split(',')
                            .map(s => s.trim())
                            .filter(s => s.length > 0);
                    }
                }
            }

            const registeredSection = document.getElementById('modalRegisteredSection');
            const registeredUsersContainer = document.getElementById('modalRegisteredUsers');
            
            if (registeredUsers.length > 0) {
                registeredSection.classList.remove('hidden');
                registeredUsersContainer.innerHTML = registeredUsers.map(user => `
                    <span class="inline-flex items-center px-3 py-1.5 rounded-full !text-base font-medium bg-purple-100 text-purple-700 border border-purple-200">
                        <svg class="w-4 h-4 mr-1.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                        </svg>
                        ${user}
                    </span>
                `).join('');
            } else {
                registeredSection.classList.add('hidden');
            }

            // Check if current user is registered
            let isUserRegistered = false;
            if (currentUser && course.registrations) {
                if (Array.isArray(course.registrations)) {
                    isUserRegistered = course.registrations.includes(currentUser);
                } else if (typeof course.registrations === 'string') {
                    try {
                        const registrationsArray = JSON.parse(course.registrations);
                        isUserRegistered = registrationsArray.includes(currentUser);
                    } catch (e) {
                        const registrationsArray = course.registrations.split(',')
                            .map(s => s.trim())
                            .filter(s => s.length > 0);
                        isUserRegistered = registrationsArray.includes(currentUser);
                    }
                }
            }
            
            const isFull = availableSpots <= 0;
            
            // Update register button
            const registerBtn = document.getElementById('modalRegisterBtn');
            if (isUserRegistered) {
                registerBtn.disabled = false;
                registerBtn.className = 'px-6 py-2.5 !text-base font-semibold !text-white bg-gradient-to-r from-emerald-600 to-emerald-700 hover:from-emerald-700 hover:to-emerald-800 rounded-lg transition-all duration-200 shadow-lg hover:shadow-xl';
                registerBtn.textContent = 'âœ“ Registered - Click to Unregister';
            } else if (isFull) {
                registerBtn.disabled = true;
                registerBtn.className = 'px-6 py-2.5 !text-base font-semibold !text-gray-600 bg-gray-400 rounded-lg cursor-not-allowed';
                registerBtn.textContent = 'Course Full';
            } else {
                registerBtn.disabled = false;
                registerBtn.className = 'px-6 py-2.5 !text-base font-semibold !text-white bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 rounded-lg transition-all duration-200 shadow-lg hover:shadow-xl';
                registerBtn.textContent = 'Register Now';
            }

            // Generate course outline from course data
            generateCourseOutline(course);
        }

        function generateCourseOutline(course) {
            // Array of different icons for variety
            const icons = [
                `<svg class="w-5 h-5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>`,
                `<svg class="w-5 h-5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                </svg>`,
                `<svg class="w-5 h-5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"></path>
                </svg>`,
                `<svg class="w-5 h-5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path>
                </svg>`,
                `<svg class="w-5 h-5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 4a2 2 0 114 0v1a1 1 0 001 1h3a1 1 0 011 1v3a1 1 0 01-1 1h-1a2 2 0 100 4h1a1 1 0 011 1v3a1 1 0 01-1 1h-3a1 1 0 01-1-1v-1a2 2 0 10-4 0v1a1 1 0 01-1 1H7a1 1 0 01-1-1v-3a1 1 0 00-1-1H4a2 2 0 110-4h1a1 1 0 001-1V7a1 1 0 011-1h3a1 1 0 001-1V4z"></path>
                </svg>`
            ];
            
            // Use course outline from Excel data if available, otherwise fall back to category-based outline
            let outline = [];
            
            if (course.outline && Array.isArray(course.outline) && course.outline.length > 0) {
                // Use outline from Excel data
                outline = course.outline;
            } else {
                // Fall back to category-based outline
                const categoryOutlines = {
                    'Data Analytics': [
                        'Data collection and preprocessing techniques',
                        'Statistical analysis and visualization',
                        'Data modeling and interpretation',
                        'Tools and software proficiency',
                        'Real-world case studies and applications'
                    ],
                    'AI & Innovation': [
                        'Introduction to AI concepts and applications',
                        'Machine learning fundamentals',
                        'Innovation frameworks and methodologies',
                        'Hands-on projects and exercises',
                        'Future trends and emerging technologies'
                    ],
                    'Coding and Tech': [
                        'Programming fundamentals and best practices',
                        'Code structure and organization',
                        'Debugging and troubleshooting techniques',
                        'Version control and collaboration',
                        'Practical coding projects'
                    ],
                    'Process Management': [
                        'Process analysis and optimization',
                        'Workflow design and implementation',
                        'Quality control and assurance',
                        'Performance metrics and KPIs',
                        'Continuous improvement strategies'
                    ],
                    'Soft Skills': [
                        'Effective communication strategies',
                        'Team collaboration techniques',
                        'Conflict resolution methods',
                        'Leadership and influence skills',
                        'Emotional intelligence development'
                    ],
                    'WCM Knowledge': [
                        'WCM principles and methodologies',
                        'Implementation strategies',
                        'Best practices and case studies',
                        'Performance measurement',
                        'Continuous improvement approaches'
                    ],
                    'Cross Skills': [
                        'Interdisciplinary skill development',
                        'Cross-functional collaboration',
                        'Versatility and adaptability',
                        'Knowledge transfer techniques',
                        'Integrated problem-solving approaches'
                    ]
                };

                outline = categoryOutlines[course.category] || [
                    'Core concepts and fundamentals',
                    'Practical applications and exercises',
                    'Real-world case studies',
                    'Interactive discussions and Q&A',
                    'Resource materials and follow-up'
                ];
            }

            const outlineContainer = document.getElementById('modalCourseOutline');
            outlineContainer.innerHTML = outline.map((item, index) => `
                <div class="flex items-start gap-3 p-3 rounded-lg bg-gray-50 hover:bg-gray-100 transition-colors duration-200">
                    <div class="text-blue-600 mt-0.5">
                        ${icons[index % icons.length]}
                    </div>
                    <span class="!text-base !text-gray-700 leading-relaxed">${item}</span>
                </div>
            `).join('');
        }

        function registerFromModal() {
            if (currentCourseData) {
                // Check if user is already registered
                let isUserRegistered = false;
                if (currentUser && currentCourseData.registrations) {
                    if (Array.isArray(currentCourseData.registrations)) {
                        isUserRegistered = currentCourseData.registrations.includes(currentUser);
                    } else if (typeof currentCourseData.registrations === 'string') {
                        try {
                            const registrationsArray = JSON.parse(currentCourseData.registrations);
                            isUserRegistered = registrationsArray.includes(currentUser);
                        } catch (e) {
                            const registrationsArray = currentCourseData.registrations.split(',')
                                .map(s => s.trim())
                                .filter(s => s.length > 0);
                            isUserRegistered = registrationsArray.includes(currentUser);
                        }
                    }
                }
                
                if (isUserRegistered) {
                    unregisterFromCourse(currentCourseData.id);
                } else {
                    registerForCourse(currentCourseData.id);
                }
                closeCourseDetailsModal();
            }
        }

        // Close modal when clicking outside or pressing Escape
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                closeCourseDetailsModal();
            }
        });

        // Add Training Course Modal Functions
        function openAddCourseModal() {
            const modal = document.getElementById('addCourseModal');
            modal.classList.remove('hidden');
            // Reset outline container to have just one item
            resetCourseOutlineContainer();
        }

        function closeAddCourseModal() {
            const modal = document.getElementById('addCourseModal');
            if (modal) {
                modal.classList.add('hidden');
                document.getElementById('addCourseForm').reset();
                resetCourseOutlineContainer();
            }
        }

        // Course outline management functions
        function addCourseOutlineItem() {
            const container = document.getElementById('courseOutlineContainer');
            const newItem = document.createElement('div');
            newItem.className = 'flex items-center gap-2';
            newItem.innerHTML = `
                <span class="!text-gray-500">â€¢</span>
                <input type="text" placeholder="Learning objective" 
                    class="course-outline-item flex-1 rounded-lg border border-gray-300 bg-transparent px-3 py-2 !text-lg !text-gray-800 shadow-theme-xs placeholder:!text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10">
                <button type="button" onclick="removeCourseOutlineItem(this)" class="!text-red-500 hover:!text-red-700 px-2">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            `;
            container.appendChild(newItem);
            updateRemoveButtonVisibility();
        }

        function removeCourseOutlineItem(button) {
            const container = document.getElementById('courseOutlineContainer');
            if (container.children.length > 1) {
                button.parentElement.remove();
                updateRemoveButtonVisibility();
            }
        }

        function updateRemoveButtonVisibility() {
            const container = document.getElementById('courseOutlineContainer');
            const removeButtons = container.querySelectorAll('button[onclick*="removeCourseOutlineItem"]');
            
            removeButtons.forEach(button => {
                button.style.display = container.children.length > 1 ? 'block' : 'none';
            });
        }

        function resetCourseOutlineContainer() {
            const container = document.getElementById('courseOutlineContainer');
            container.innerHTML = `
                <div class="flex items-center gap-2">
                    <span class="!text-gray-500">â€¢</span>
                    <input type="text" placeholder="Learning objective 1" 
                        class="course-outline-item flex-1 rounded-lg border border-gray-300 bg-transparent px-3 py-2 !text-lg !text-gray-800 shadow-theme-xs placeholder:!text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10">
                    <button type="button" onclick="removeCourseOutlineItem(this)" class="!text-red-500 hover:!text-red-700 px-2" style="display: none;">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>
            `;
        }

        function getCourseOutlineFromForm() {
            const inputs = document.querySelectorAll('.course-outline-item');
            const outline = [];
            inputs.forEach(input => {
                const value = input.value.trim();
                if (value) {
                    outline.push(value);
                }
            });
            return outline;
        }

        async function submitNewCourse(event) {
            event.preventDefault();
            
            const pageId = '2740868871';
            const attachmentName = 'training_courses.json';
            
            // Get course outline from form
            const courseOutline = getCourseOutlineFromForm();
            
            const newCourse = {
                id: Math.random().toString(36).substr(2, 9),
                name: document.getElementById('courseName').value,
                description: document.getElementById('courseDescription').value,
                category: document.getElementById('courseCategory').value,
                instructor: document.getElementById('courseInstructor').value,
                startDate: document.getElementById('courseStartDate').value,
                endDate: document.getElementById('courseEndDate').value,
                maxStudents: parseInt(document.getElementById('courseMaxStudents').value),
                enrolledStudents: 0,
                location: document.getElementById('courseLocation').value,
                registrations: [],
                outline: courseOutline
            };

            // Close the form immediately
            closeAddCourseModal();

            if (typeof showInfoToast === 'function') {
                showInfoToast('Saving course...');
            }

            try {
                // First, check if attachment exists and get its ID
                const attachmentsResponse = await fetch(`https://cedt-confluence.net/confluence/rest/api/content/${pageId}/child/attachment?filename=${attachmentName}`, {
                    headers: {
                        'X-Atlassian-Token': 'no-check'
                    }
                });
                
                let attachmentId = null;
                let existingData = { courses: [], metadata: { lastUpdated: '', totalCourses: 0, categories: {} } };

                if (attachmentsResponse.ok) {
                    const attachmentsData = await attachmentsResponse.json();
                    if (attachmentsData.results && attachmentsData.results.length > 0) {
                        attachmentId = attachmentsData.results[0].id;
                        console.log('Found existing attachment with ID:', attachmentId);
                    
                        // Fetch existing data
                        try {
                            const dataResponse = await fetch(`https://cedt-confluence.net/confluence/download/attachments/${pageId}/${attachmentName}?api=v2`, {
                                headers: {
                                    'X-Atlassian-Token': 'no-check'
                                }
                            });

                            if (dataResponse.ok) {
                                const data = await dataResponse.json();
                                // Handle both formats: { courses: [] } or direct array
                                if (data.courses && Array.isArray(data.courses)) {
                                    existingData = data;
                                } else if (Array.isArray(data)) {
                                    existingData.courses = data;
                                }
                            }
                        } catch (err) {
                            console.warn('Could not fetch existing courses, starting fresh:', err);
                        }
                    }
                } else {
                    console.log('No existing attachment found, will create new one');
                }

                // Add new course to the beginning
                if (!Array.isArray(existingData.courses)) {
                    existingData.courses = [];
                }
                existingData.courses.unshift(newCourse);

                // Update metadata
                existingData.metadata = {
                    lastUpdated: new Date().toISOString(),
                    totalCourses: existingData.courses.length,
                    categories: existingData.courses.reduce((acc, course) => {
                        acc[course.category] = (acc[course.category] || 0) + 1;
                        return acc;
                    }, {})
                };
                            
                // Create blob with updated data
                const blob = new Blob([JSON.stringify(existingData, null, 2)], { type: 'application/json' });
                const formData = new FormData();
                formData.append('file', blob, attachmentName);

                // Upload to Confluence (create or update)
                const uploadUrl = `https://cedt-confluence.net/confluence/rest/api/content/${pageId}/child/attachment${attachmentId ? `/${attachmentId}` : ''}`;
                
                console.log('Uploading to:', uploadUrl);
                console.log('Method: POST');
                console.log('Attachment ID:', attachmentId || 'creating new');

                const uploadResponse = await fetch(uploadUrl, {
                    method: 'POST',
                    headers: {
                        'X-Atlassian-Token': 'no-check'
                    },
                    body: formData
                });

                if (!uploadResponse.ok) {
                    const errorText = await uploadResponse.text();
                    console.error('Upload failed:', errorText);
                    throw new Error(`Failed to save course: ${uploadResponse.status} ${uploadResponse.statusText}`);
                }

                const result = await uploadResponse.json();
                console.log('Course saved successfully!', result);

                // Add to local data and update table
                tableData.unshift(newCourse);
                currentPage = 1;
                filterData();
                
                if (typeof showSuccessToast === 'function') {
                    showSuccessToast('Training course added successfully!');
                }
            } catch (error) {
                console.error('Error adding training course:', error);
                if (typeof showErrorToast === 'function') {
                    showErrorToast('Failed to add training course. Please try again.');
                }
            }
        }
    </script>
</body>
</html>
