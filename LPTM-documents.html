<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document Library - LPTM Hub</title>
    
    <!-- 
      CONFLUENCE MACRO REQUIRED: Include global-notifications.html as a macro
      This provides showSuccessToast(), showErrorToast(), showWarningToast(), showInfoToast()
    -->
    
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        /* Fade-in animation */
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .animate-fade-in {
            animation: fadeIn 0.6s ease-out;
        }

        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 10px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }

        .dark ::-webkit-scrollbar-track {
            background: #374151;
        }

        ::-webkit-scrollbar-thumb {
            background: #d1d5db;
            border-radius: 5px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #9ca3af;
        }

        .dark ::-webkit-scrollbar-thumb {
            background: #6b7280;
        }

        .dark ::-webkit-scrollbar-thumb:hover {
            background: #9ca3af;
        }

        /* Custom scrollbar for table */
        .custom-scrollbar::-webkit-scrollbar {
            height: 6px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 3px;
        }
        .dark .custom-scrollbar::-webkit-scrollbar-track {
            background: #374151;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 3px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
        .dark .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #6b7280;
        }
        .dark .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: #9ca3af;
        }

        /* Loading shimmer animation */
        @keyframes shimmer {
            0% {
                background-position: -200% 0;
            }
            100% {
                background-position: 200% 0;
            }
        }
        .loading-shimmer {
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 200% 100%;
            animation: shimmer 1.5s infinite;
        }
        .dark .loading-shimmer {
            background: linear-gradient(90deg, #374151 25%, #4b5563 50%, #374151 75%);
            background-size: 200% 100%;
            animation: shimmer 1.5s infinite;
        }
    </style>
</head>
<body class="bg-gray-50 dark:bg-gray-900">
    <div class="p-4">
        <div class="rounded-2xl border border-gray-200 bg-white dark:border-gray-700 dark:bg-gray-800">
            <div class="px-5 py-4 sm:px-6 sm:py-5">
                <h3 class="!text-2xl font-medium text-gray-800 dark:text-white">
                    Document Library
                </h3>
            </div>
            <div class="border-t border-gray-100 p-5 sm:p-6 dark:border-gray-700">
                <!-- Search Section -->
                <div class="mb-4 flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between">
                    <div class="flex flex-1 items-center gap-4">
                        <div class="w-[512px]">
                            <div class="relative">
                                <span class="pointer-events-none absolute top-1/2 left-4 -translate-y-1/2">
                                    <svg class="fill-gray-500 dark:fill-gray-400" width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <path fill-rule="evenodd" clip-rule="evenodd" d="M3.04199 9.37381C3.04199 5.87712 5.87735 3.04218 9.37533 3.04218C12.8733 3.04218 15.7087 5.87712 15.7087 9.37381C15.7087 12.8705 12.8733 15.7055 9.37533 15.7055C5.87735 15.7055 3.04199 12.8705 3.04199 9.37381ZM9.37533 1.54218C5.04926 1.54218 1.54199 5.04835 1.54199 9.37381C1.54199 13.6993 5.04926 17.2055 9.37533 17.2055C11.2676 17.2055 13.0032 16.5346 14.3572 15.4178L17.1773 18.2381C17.4702 18.531 17.945 18.5311 18.2379 18.2382C18.5308 17.9453 18.5309 17.4704 18.238 17.1775L15.4182 14.3575C16.5367 13.0035 17.2087 11.2671 17.2087 9.37381C17.2087 5.04835 13.7014 1.54218 9.37533 1.54218Z" fill=""></path>
                                    </svg>
                                </span>
                                <input type="text" id="simple-search" placeholder="Search documents..." class="shadow-theme-xs focus:border-brand-300 focus:ring-brand-500/10 h-[42px] w-full rounded-lg border border-gray-300 bg-transparent py-2.5 pr-4 pl-[42px] !text-lg !text-gray-800 placeholder:!text-gray-400 focus:ring-3 focus:outline-hidden dark:border-gray-600 dark:!text-white dark:placeholder:!text-gray-500">
                            </div>
                        </div>
                        <button onclick="openUploadModal()" class="flex items-center gap-2 rounded-lg border border-blue-500 bg-blue-500 px-3 py-2 !text-lg font-medium !text-white hover:bg-blue-700 transition-all duration-200 ease-in-out hover:scale-105">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path>
                            </svg>
                            Upload File
                        </button>
                    </div>
                </div>

                <!-- Filter Section -->
                <div class="mb-6">
                    <div class="flex flex-wrap items-center gap-2">
                        <button onclick="filterByCategory('all')" class="inline-flex items-center justify-center gap-1.5 rounded-full bg-gray-600 py-1.5 pl-2.5 pr-3 !text-sm font-medium !text-white hover:bg-gray-700 transition-all duration-200">
                            <svg class="fill-current" width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path fill-rule="evenodd" clip-rule="evenodd" d="M2 4C2 3.44772 2.44772 3 3 3H13C13.5523 3 14 3.44772 14 4C14 4.55228 13.5523 5 13 5H3C2.44772 5 2 4.55228 2 4ZM2 8C2 7.44772 2.44772 7 3 7H13C13.5523 7 14 7.44772 14 8C14 8.55228 13.5523 9 13 9H3C2.44772 9 2 8.55228 2 8ZM3 11C2.44772 11 2 11.4477 2 12C2 12.5523 2.44772 13 3 13H13C13.5523 13 14 12.5523 14 12C14 11.4477 13.5523 11 13 11H3Z" fill=""/>
                            </svg>
                            All
                        </button>
                        <button onclick="filterByCategory('Procedures')" class="inline-flex items-center justify-center gap-1.5 rounded-full bg-blue-600 py-1.5 pl-2.5 pr-3 !text-sm font-medium !text-white hover:bg-blue-700 transition-all duration-200">
                            <svg class="fill-current" width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M9 2H4C3.46957 2 2.96086 2.21071 2.58579 2.58579C2.21071 2.96086 2 3.46957 2 4V12C2 12.5304 2.21071 13.0391 2.58579 13.4142C2.96086 13.7893 3.46957 14 4 14H10C10.5304 14 11.0391 13.7893 11.4142 13.4142C11.7893 13.0391 12 12.5304 12 12V5L9 2Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" fill="none"/>
                                <path d="M9 2V5H12" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" fill="none"/>
                                <path d="M5 8H9" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                                <path d="M5 10.5H9" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                            Procedures
                        </button>
                        <button onclick="filterByCategory('Guidelines')" class="inline-flex items-center justify-center gap-1.5 rounded-full bg-emerald-600 py-1.5 pl-2.5 pr-3 !text-sm font-medium !text-white hover:bg-emerald-700 transition-all duration-200">
                            <svg class="fill-current" width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M12 2H4C2.89543 2 2 2.89543 2 4V12C2 13.1046 2.89543 14 4 14H12C13.1046 14 14 13.1046 14 12V4C14 2.89543 13.1046 2 12 2Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" fill="none"/>
                                <path d="M5 8L7 10L11 6" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                            Guidelines
                        </button>
                        <button onclick="filterByCategory('Policies')" class="inline-flex items-center justify-center gap-1.5 rounded-full bg-rose-600 py-1.5 pl-2.5 pr-3 !text-sm font-medium !text-white hover:bg-rose-700 transition-all duration-200">
                            <svg class="fill-current" width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M8 1.33333L2.66667 3.33333V7.33333C2.66667 10.6667 5.33333 13.7333 8 14.6667C10.6667 13.7333 13.3333 10.6667 13.3333 7.33333V3.33333L8 1.33333Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" fill="none"/>
                                <path d="M6 8L7.33333 9.33333L10 6.66667" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                            Policies
                        </button>
                        <button onclick="filterByCategory('Reports')" class="inline-flex items-center justify-center gap-1.5 rounded-full bg-amber-600 py-1.5 pl-2.5 pr-3 !text-sm font-medium !text-white hover:bg-amber-700 transition-all duration-200">
                            <svg class="fill-current" width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M4 12.6667V7.33333M8 12.6667V3.33333M12 12.6667V9.33333" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" fill="none"/>
                                <rect x="1.33333" y="1.33333" width="13.3333" height="13.3333" rx="2" stroke="currentColor" stroke-width="1.5" fill="none"/>
                            </svg>
                            Reports
                        </button>
                        <button onclick="filterByCategory('Training')" class="inline-flex items-center justify-center gap-1.5 rounded-full bg-purple-600 py-1.5 pl-2.5 pr-3 !text-sm font-medium !text-white hover:bg-purple-700 transition-all duration-200">
                            <svg class="fill-current" width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M2 4.66667C2 4.29848 2.29848 4 2.66667 4H4C4.36819 4 4.66667 4.29848 4.66667 4.66667V12.6667C4.66667 13.0349 4.36819 13.3333 4 13.3333H2.66667C2.29848 13.3333 2 13.0349 2 12.6667V4.66667Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" fill="none"/>
                                <path d="M4.66667 4.66667C4.66667 3.19391 5.86058 2 7.33333 2C8.80609 2 10 3.19391 10 4.66667V12.6667C10 13.0349 9.70152 13.3333 9.33333 13.3333H5.33333C4.96514 13.3333 4.66667 13.0349 4.66667 12.6667V4.66667Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" fill="none"/>
                                <path d="M10 4.66667C10 3.19391 11.1939 2 12.6667 2C14.1394 2 15.3333 3.19391 15.3333 4.66667V12.6667C15.3333 13.0349 15.0349 13.3333 14.6667 13.3333H10.6667C10.2985 13.3333 10 13.0349 10 12.6667V4.66667Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" fill="none"/>
                            </svg>
                            Training
                        </button>
                        <button onclick="filterByCategory('Governance')" class="inline-flex items-center justify-center gap-1.5 rounded-full bg-indigo-600 py-1.5 pl-2.5 pr-3 !text-sm font-medium !text-white hover:bg-indigo-700 transition-all duration-200">
                            <svg class="fill-current" width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M8 10.6667C9.47276 10.6667 10.6667 9.47276 10.6667 8C10.6667 6.52724 9.47276 5.33333 8 5.33333C6.52724 5.33333 5.33333 6.52724 5.33333 8C5.33333 9.47276 6.52724 10.6667 8 10.6667Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" fill="none"/>
                                <path d="M8 1.33333V2.66667M8 13.3333V14.6667M3.28667 3.28667L4.23333 4.23333M11.7667 11.7667L12.7133 12.7133M1.33333 8H2.66667M13.3333 8H14.6667M3.28667 12.7133L4.23333 11.7667M11.7667 4.23333L12.7133 3.28667" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                            Governance
                        </button>
                    </div>
                </div>

                <div class="rounded-2xl border border-gray-200 bg-white pt-4 dark:border-gray-700 dark:bg-gray-800">
                    <div class="custom-scrollbar max-w-full overflow-x-auto px-5 sm:px-6">
                        <table class="min-w-full">
                            <thead class="border-y border-gray-100 py-3 bg-white dark:border-gray-700 dark:bg-gray-800">
                                <tr>
                                    <th class="py-3 font-normal w-2/5">
                                        <div class="flex items-center">
                                            <p class="!text-lg !text-gray-500 dark:!text-gray-400">File Name</p>
                                        </div>
                                    </th>
                                    <th class="py-3 font-normal whitespace-nowrap">
                                        <div class="flex items-center">
                                            <p class="!text-lg !text-gray-500 dark:!text-gray-400">Category</p>
                                        </div>
                                    </th>
                                    <th class="py-3 font-normal whitespace-nowrap">
                                        <div class="flex items-center">
                                            <p class="!text-lg !text-gray-500 dark:!text-gray-400">Size</p>
                                        </div>
                                    </th>
                                    <th class="py-3 font-normal whitespace-nowrap">
                                        <div class="flex items-center">
                                            <p class="!text-lg !text-gray-500 dark:!text-gray-400">Date Modified</p>
                                        </div>
                                    </th>
                                    <th class="py-3 font-normal whitespace-nowrap w-24">
                                        <div class="flex items-center">
                                            <p class="!text-lg !text-gray-500 dark:!text-gray-400">Actions</p>
                                        </div>
                                    </th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-gray-100 dark:divide-gray-700" id="tableBody">
                                <!-- Table rows will be dynamically added here -->
                            </tbody>
                        </table>
                    </div>

                    <div class="border-t border-gray-200 px-6 py-4 dark:border-gray-700">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center gap-2">
                                <span class="!text-lg !text-gray-700 dark:!text-gray-300">Show</span>
                                <select id="itemsPerPage" class="rounded-lg border border-gray-300 bg-white px-2 py-1 !text-lg !text-gray-700 dark:border-gray-600 dark:bg-gray-700 dark:!text-gray-300">
                                    <option value="10">10</option>
                                    <option value="20" selected>20</option>
                                    <option value="50">50</option>
                                    <option value="100">100</option>
                                </select>
                                <span class="!text-lg !text-gray-700 dark:!text-gray-300">items per page</span>
                            </div>

                            <div class="flex items-center gap-2">
                                <button onclick="previousPage()" class="!text-lg shadow-theme-xs flex items-center gap-2 rounded-lg border border-gray-300 bg-white px-2 py-2 font-medium !text-gray-700 hover:bg-gray-50 hover:!text-gray-800 sm:px-3.5 dark:border-gray-600 dark:bg-gray-700 dark:!text-gray-300 dark:hover:bg-gray-600">
                                    <svg class="fill-current" width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <path fill-rule="evenodd" clip-rule="evenodd" d="M2.58301 9.99868C2.58272 10.1909 2.65588 10.3833 2.80249 10.53L7.79915 15.5301C8.09194 15.8231 8.56682 15.8233 8.85981 15.5305C9.15281 15.2377 9.15297 14.7629 8.86018 14.4699L5.14009 10.7472L16.6675 10.7472C17.0817 10.7472 17.4175 10.4114 17.4175 9.99715C17.4175 9.58294 17.0817 9.24715 16.6675 9.24715L5.14554 9.24715L8.86017 5.53016C9.15297 5.23717 9.15282 4.7623 8.85983 4.4695C8.56684 4.1767 8.09197 4.17685 7.79917 4.46984L2.84167 9.43049C2.68321 9.568 2.58301 9.77087 2.58301 9.99715C2.58301 9.99766 2.58301 9.99817 2.58301 9.99868Z" fill=""></path>
                                    </svg>
                                    <span class="hidden sm:inline">Previous</span>
                                </button>

                                <span class="block !text-lg font-medium !text-gray-700 sm:hidden dark:!text-gray-300">
                                    Page <span id="currentPage">1</span> of <span id="totalPages">1</span>
                                </span>

                                <ul class="hidden items-center gap-0.5 sm:flex" id="pagination">
                                    <!-- Pagination will be dynamically added here -->
                                </ul>

                                <button onclick="nextPage()" class="!text-lg shadow-theme-xs flex items-center gap-2 rounded-lg border border-gray-300 bg-white px-2 py-2 font-medium !text-gray-700 hover:bg-gray-50 hover:!text-gray-800 sm:px-3.5 dark:border-gray-600 dark:bg-gray-700 dark:!text-gray-300 dark:hover:bg-gray-600">
                                    <span class="hidden sm:inline">Next</span>
                                    <svg class="fill-current" width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <path fill-rule="evenodd" clip-rule="evenodd" d="M17.4175 9.9986C17.4178 10.1909 17.3446 10.3832 17.198 10.53L12.2013 15.5301C11.9085 15.8231 11.4337 15.8233 11.1407 15.5305C10.8477 15.2377 10.8475 14.7629 11.1403 14.4699L14.8604 10.7472L3.33301 10.7472C2.91879 10.7472 2.58301 10.4114 2.58301 9.99715C2.58301 9.58294 2.91879 9.24715 3.33301 9.24715L14.8549 9.24715L11.1403 5.53016C10.8475 5.23717 10.8477 4.7623 11.1407 4.4695C11.4336 4.1767 11.9085 4.17685 12.2013 4.46984L17.1588 9.43049C17.3173 9.568 17.4175 9.77087 17.4175 9.99715C17.4175 9.99763 17.4175 9.99812 17.4175 9.9986Z" fill=""></path>
                                    </svg>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Upload Modal -->
    <div id="uploadModal" class="fixed inset-0 z-50 hidden overflow-y-auto" aria-labelledby="modal-title" role="dialog" aria-modal="true">
        <div class="flex min-h-screen items-center justify-center p-4 text-center sm:p-0">
            <div class="fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity dark:bg-gray-900 dark:bg-opacity-75" aria-hidden="true"></div>
            <div class="relative transform overflow-hidden rounded-2xl bg-white text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-lg dark:bg-gray-800">
                <div class="bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4 dark:bg-gray-800">
                    <h3 class="!text-2xl font-medium leading-6 !text-gray-900 mb-4 dark:!text-white" id="modal-title">
                        Upload Document
                    </h3>
                    <p class="!text-lg !text-gray-600 mb-4 dark:!text-gray-400">
                        This feature is currently under development. Please contact your administrator to upload documents.
                    </p>
                </div>
                <div class="bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse dark:bg-gray-700">
                    <button type="button" onclick="closeUploadModal()" class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-blue-600 !text-lg font-medium !text-white hover:bg-blue-700 focus:outline-none sm:ml-3 sm:w-auto sm:text-sm">
                        Close
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global variables for table data and pagination
        let documents = [];
        let filteredDocuments = [];
        let currentPage = 1;
        let itemsPerPage = 20;
        let selectedCategory = 'all';

        // Function to fetch documents from Confluence
        async function fetchDocuments() {
            try {
                // Try to fetch from Excel file first
                const response = await fetch('https://cedt-confluence.net/confluence/download/attachments/2740868871/lptm_documents.xlsx?api=v2', {
                    headers: {
                        'X-Atlassian-Token': 'no-check'
                    }
                });

                if (!response.ok) {
                    throw new Error('Failed to fetch documents file');
                }

                const blob = await response.blob();
                const data = await parseExcelFile(blob);
                return data;
            } catch (error) {
                console.error('Error fetching documents:', error);
                return null;
            }
        }

        // Function to parse Excel file using SheetJS
        function parseExcelFile(blob) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const data = new Uint8Array(e.target.result);
                        const workbook = XLSX.read(data, { type: 'array' });
                        const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                        const jsonData = XLSX.utils.sheet_to_json(firstSheet);
                        resolve(jsonData);
                    } catch (error) {
                        reject(error);
                    }
                };
                reader.onerror = () => reject(new Error('Failed to read Excel file'));
                reader.readAsArrayBuffer(blob);
            });
        }

        // Get file icon based on extension
        function getFileIcon(filename) {
            const ext = filename.split('.').pop().toLowerCase();
            const icons = {
                'pdf': `<svg class="w-6 h-6 text-red-600" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M4 4a2 2 0 012-2h4.586A2 2 0 0112 2.586L15.414 6A2 2 0 0116 7.414V16a2 2 0 01-2 2H6a2 2 0 01-2-2V4zm2 6a1 1 0 011-1h6a1 1 0 110 2H7a1 1 0 01-1-1zm1 3a1 1 0 100 2h6a1 1 0 100-2H7z" clip-rule="evenodd"></path></svg>`,
                'doc': `<svg class="w-6 h-6 text-blue-600" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M4 4a2 2 0 012-2h4.586A2 2 0 0112 2.586L15.414 6A2 2 0 0116 7.414V16a2 2 0 01-2 2H6a2 2 0 01-2-2V4z" clip-rule="evenodd"></path></svg>`,
                'docx': `<svg class="w-6 h-6 text-blue-600" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M4 4a2 2 0 012-2h4.586A2 2 0 0112 2.586L15.414 6A2 2 0 0116 7.414V16a2 2 0 01-2 2H6a2 2 0 01-2-2V4z" clip-rule="evenodd"></path></svg>`,
                'xls': `<svg class="w-6 h-6 text-green-600" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M4 4a2 2 0 012-2h4.586A2 2 0 0112 2.586L15.414 6A2 2 0 0116 7.414V16a2 2 0 01-2 2H6a2 2 0 01-2-2V4z" clip-rule="evenodd"></path></svg>`,
                'xlsx': `<svg class="w-6 h-6 text-green-600" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M4 4a2 2 0 012-2h4.586A2 2 0 0112 2.586L15.414 6A2 2 0 0116 7.414V16a2 2 0 01-2 2H6a2 2 0 01-2-2V4z" clip-rule="evenodd"></path></svg>`,
                'ppt': `<svg class="w-6 h-6 text-orange-600" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M4 4a2 2 0 012-2h4.586A2 2 0 0112 2.586L15.414 6A2 2 0 0116 7.414V16a2 2 0 01-2 2H6a2 2 0 01-2-2V4z" clip-rule="evenodd"></path></svg>`,
                'pptx': `<svg class="w-6 h-6 text-orange-600" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M4 4a2 2 0 012-2h4.586A2 2 0 0112 2.586L15.414 6A2 2 0 0116 7.414V16a2 2 0 01-2 2H6a2 2 0 01-2-2V4z" clip-rule="evenodd"></path></svg>`
            };
            return icons[ext] || `<svg class="w-6 h-6 text-gray-600" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M4 4a2 2 0 012-2h4.586A2 2 0 0112 2.586L15.414 6A2 2 0 0116 7.414V16a2 2 0 01-2 2H6a2 2 0 01-2-2V4z" clip-rule="evenodd"></path></svg>`;
        }

        // Get category badge styling
        function getCategoryBadge(category) {
            const badges = {
                'Procedures': 'bg-blue-50 !text-blue-700 border border-blue-200',
                'Guidelines': 'bg-emerald-50 !text-emerald-700 border border-emerald-200',
                'Policies': 'bg-rose-50 !text-rose-700 border border-rose-200',
                'Reports': 'bg-amber-50 !text-amber-700 border border-amber-200',
                'Training': 'bg-purple-50 !text-purple-700 border border-purple-200',
                'Governance': 'bg-indigo-50 !text-indigo-700 border border-indigo-200'
            };
            return badges[category] || 'bg-gray-50 !text-gray-700 border border-gray-200';
        }

        // Format file size
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return Math.round(bytes / Math.pow(k, i) * 100) / 100 + ' ' + sizes[i];
        }

        // Format date
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('en-US', { year: 'numeric', month: 'short', day: 'numeric' });
        }

        // Create document row
        function createDocumentRow(doc) {
            return `
                <tr class="hover:bg-gray-50 dark:hover:bg-gray-700">
                    <td class="py-3">
                        <div class="flex items-center gap-3">
                            ${getFileIcon(doc.name)}
                            <span class="!text-lg font-medium !text-gray-900 dark:!text-white">${doc.name}</span>
                        </div>
                    </td>
                    <td class="py-3">
                        <span class="inline-flex items-center gap-1 rounded-full px-2.5 py-1 !text-lg font-medium ${getCategoryBadge(doc.category)}">
                            ${doc.category}
                        </span>
                    </td>
                    <td class="py-3">
                        <span class="!text-lg !text-gray-700 dark:!text-gray-300">${formatFileSize(doc.size)}</span>
                    </td>
                    <td class="py-3">
                        <span class="!text-lg !text-gray-700 dark:!text-gray-300">${formatDate(doc.date)}</span>
                    </td>
                    <td class="py-3">
                        <div class="flex items-center gap-2">
                            <button onclick="downloadDocument('${doc.url}')" class="group relative rounded-lg bg-blue-100 p-2 !text-blue-600 hover:bg-blue-200 transition-all duration-200 ease-in-out hover:scale-105">
                                <span class="invisible absolute bottom-full left-1/2 z-10 mb-2 -translate-x-1/2 whitespace-nowrap rounded bg-blue-600 px-2 py-1 !text-lg !text-white opacity-0 transition-all duration-200 group-hover:visible group-hover:opacity-100">
                                    Download
                                    <span class="absolute top-full left-1/2 -translate-x-1/2 border-4 border-transparent border-t-blue-600"></span>
                                </span>
                                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path>
                                </svg>
                            </button>
                            <button onclick="viewDocument('${doc.url}')" class="group relative rounded-lg bg-green-100 p-2 !text-green-600 hover:bg-green-200 transition-all duration-200 ease-in-out hover:scale-105">
                                <span class="invisible absolute bottom-full left-1/2 z-10 mb-2 -translate-x-1/2 whitespace-nowrap rounded bg-green-600 px-2 py-1 !text-lg !text-white opacity-0 transition-all duration-200 group-hover:visible group-hover:opacity-100">
                                    View
                                    <span class="absolute top-full left-1/2 -translate-x-1/2 border-4 border-transparent border-t-green-600"></span>
                                </span>
                                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
                                </svg>
                            </button>
                        </div>
                    </td>
                </tr>
            `;
        }

        // Document actions
        function downloadDocument(url) {
            window.open(url, '_blank');
        }

        function viewDocument(url) {
            window.open(url, '_blank');
        }

        // Filter documents
        function filterDocuments() {
            const searchTerm = document.getElementById('simple-search').value.toLowerCase();
            
            filteredDocuments = documents.filter(doc => {
                const matchesSearch = !searchTerm || 
                    doc.name.toLowerCase().includes(searchTerm) ||
                    doc.category.toLowerCase().includes(searchTerm);
                const matchesCategory = selectedCategory === 'all' || 
                    doc.category === selectedCategory;
                
                return matchesSearch && matchesCategory;
            });

            currentPage = 1;
            updateTable();
        }

        // Filter by category
        function filterByCategory(category) {
            selectedCategory = category;
            currentPage = 1;

            // Update button styles
            document.querySelectorAll('button[onclick^="filterByCategory"]').forEach(btn => {
                const btnText = btn.textContent.trim();
                if ((category === 'all' && btnText === 'All') || btnText === category) {
                    // Active state - darker shade
                    if (btnText === 'All') {
                        btn.className = 'inline-flex items-center justify-center gap-1.5 rounded-full bg-gray-700 py-1.5 pl-2.5 pr-3 !text-sm font-medium !text-white hover:bg-gray-800 transition-all duration-200';
                    } else if (btnText === 'Procedures') {
                        btn.className = 'inline-flex items-center justify-center gap-1.5 rounded-full bg-blue-700 py-1.5 pl-2.5 pr-3 !text-sm font-medium !text-white hover:bg-blue-800 transition-all duration-200';
                    } else if (btnText === 'Guidelines') {
                        btn.className = 'inline-flex items-center justify-center gap-1.5 rounded-full bg-emerald-700 py-1.5 pl-2.5 pr-3 !text-sm font-medium !text-white hover:bg-emerald-800 transition-all duration-200';
                    } else if (btnText === 'Policies') {
                        btn.className = 'inline-flex items-center justify-center gap-1.5 rounded-full bg-rose-700 py-1.5 pl-2.5 pr-3 !text-sm font-medium !text-white hover:bg-rose-800 transition-all duration-200';
                    } else if (btnText === 'Reports') {
                        btn.className = 'inline-flex items-center justify-center gap-1.5 rounded-full bg-amber-700 py-1.5 pl-2.5 pr-3 !text-sm font-medium !text-white hover:bg-amber-800 transition-all duration-200';
                    } else if (btnText === 'Training') {
                        btn.className = 'inline-flex items-center justify-center gap-1.5 rounded-full bg-purple-700 py-1.5 pl-2.5 pr-3 !text-sm font-medium !text-white hover:bg-purple-800 transition-all duration-200';
                    } else if (btnText === 'Governance') {
                        btn.className = 'inline-flex items-center justify-center gap-1.5 rounded-full bg-indigo-700 py-1.5 pl-2.5 pr-3 !text-sm font-medium !text-white hover:bg-indigo-800 transition-all duration-200';
                    }
                } else {
                    // Reset to original color
                    if (btnText === 'All') {
                        btn.className = 'inline-flex items-center justify-center gap-1.5 rounded-full bg-gray-600 py-1.5 pl-2.5 pr-3 !text-sm font-medium !text-white hover:bg-gray-700 transition-all duration-200';
                    } else if (btnText === 'Procedures') {
                        btn.className = 'inline-flex items-center justify-center gap-1.5 rounded-full bg-blue-600 py-1.5 pl-2.5 pr-3 !text-sm font-medium !text-white hover:bg-blue-700 transition-all duration-200';
                    } else if (btnText === 'Guidelines') {
                        btn.className = 'inline-flex items-center justify-center gap-1.5 rounded-full bg-emerald-600 py-1.5 pl-2.5 pr-3 !text-sm font-medium !text-white hover:bg-emerald-700 transition-all duration-200';
                    } else if (btnText === 'Policies') {
                        btn.className = 'inline-flex items-center justify-center gap-1.5 rounded-full bg-rose-600 py-1.5 pl-2.5 pr-3 !text-sm font-medium !text-white hover:bg-rose-700 transition-all duration-200';
                    } else if (btnText === 'Reports') {
                        btn.className = 'inline-flex items-center justify-center gap-1.5 rounded-full bg-amber-600 py-1.5 pl-2.5 pr-3 !text-sm font-medium !text-white hover:bg-amber-700 transition-all duration-200';
                    } else if (btnText === 'Training') {
                        btn.className = 'inline-flex items-center justify-center gap-1.5 rounded-full bg-purple-600 py-1.5 pl-2.5 pr-3 !text-sm font-medium !text-white hover:bg-purple-700 transition-all duration-200';
                    } else if (btnText === 'Governance') {
                        btn.className = 'inline-flex items-center justify-center gap-1.5 rounded-full bg-indigo-600 py-1.5 pl-2.5 pr-3 !text-sm font-medium !text-white hover:bg-indigo-700 transition-all duration-200';
                    }
                }
            });

            filterDocuments();
        }

        // Update table
        function updateTable() {
            const tableBody = document.getElementById('tableBody');
            const start = (currentPage - 1) * itemsPerPage;
            const end = start + itemsPerPage;
            const pageData = filteredDocuments.slice(start, end);

            if (filteredDocuments.length === 0) {
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="5" class="py-16">
                            <div class="flex flex-col items-center justify-center">
                                <svg class="mb-4 h-16 w-16 text-gray-400 dark:text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                                </svg>
                                <span class="!text-lg font-medium !text-gray-600 dark:!text-gray-400">No data available</span>
                            </div>
                        </td>
                    </tr>
                `;
            } else {
                tableBody.innerHTML = pageData.map(createDocumentRow).join('');
            }
            updatePagination();
        }

        // Pagination functions
        function updatePagination() {
            const pagination = document.getElementById('pagination');
            const totalPages = Math.ceil(filteredDocuments.length / itemsPerPage);
            pagination.innerHTML = '';
            
            if (totalPages > 0) {
                addPageButton(1);
            }

            if (currentPage > 3) {
                addEllipsis();
            }

            for (let i = Math.max(2, currentPage - 1); i <= Math.min(totalPages - 1, currentPage + 1); i++) {
                if (i > 1 && i < totalPages) {
                    addPageButton(i);
                }
            }

            if (currentPage < totalPages - 2) {
                addEllipsis();
            }

            if (totalPages > 1) {
                addPageButton(totalPages);
            }

            document.getElementById('currentPage').textContent = currentPage;
            document.getElementById('totalPages').textContent = totalPages;

            const prevButton = document.querySelector('button[onclick="previousPage()"]');
            const nextButton = document.querySelector('button[onclick="nextPage()"]');
            
            if (prevButton) prevButton.disabled = currentPage === 1;
            if (nextButton) nextButton.disabled = currentPage === totalPages;
        }

        function addPageButton(pageNum) {
            const li = document.createElement('li');
            const a = document.createElement('a');
            a.href = '#';
            a.className = pageNum === currentPage 
                ? 'bg-brand-500/[0.08] !text-lg !text-brand-500 hover:bg-brand-500/[0.08] hover:!text-brand-500 flex h-10 w-10 items-center justify-center rounded-lg font-medium'
                : '!text-lg hover:bg-brand-500/[0.08] hover:!text-brand-500 flex h-10 w-10 items-center justify-center rounded-lg font-medium !text-gray-700 dark:!text-gray-300';
            a.textContent = pageNum;
            a.onclick = (e) => {
                e.preventDefault();
                goToPage(pageNum);
            };
            li.appendChild(a);
            pagination.appendChild(li);
        }

        function addEllipsis() {
            const li = document.createElement('li');
            li.className = '!text-lg flex h-10 w-10 items-center justify-center !text-gray-700 dark:!text-gray-300';
            li.textContent = '...';
            pagination.appendChild(li);
        }

        function goToPage(page) {
            const totalPages = Math.ceil(filteredDocuments.length / itemsPerPage);
            if (page >= 1 && page <= totalPages) {
                currentPage = page;
                updateTable();
            }
        }

        function nextPage() {
            const totalPages = Math.ceil(filteredDocuments.length / itemsPerPage);
            if (currentPage < totalPages) {
                currentPage++;
                updateTable();
            }
        }

        function previousPage() {
            if (currentPage > 1) {
                currentPage--;
                updateTable();
            }
        }

        function changeItemsPerPage(value) {
            itemsPerPage = parseInt(value);
            currentPage = 1;
            updateTable();
        }

        // Show loading state
        function showLoadingState() {
            const tableBody = document.getElementById('tableBody');
            tableBody.innerHTML = `
                <tr>
                    <td colspan="5" class="py-16">
                        <div class="flex flex-col items-center justify-center">
                            <div class="relative">
                                <div class="animate-spin rounded-full h-16 w-16 border-4 border-blue-200 dark:border-blue-800"></div>
                                <div class="animate-spin rounded-full h-16 w-16 border-4 border-blue-600 border-t-transparent absolute top-0 left-0"></div>
                            </div>
                            <div class="mt-6 text-center">
                                <span class="!text-lg font-medium !text-gray-700 dark:!text-gray-300">Loading documents...</span>
                            </div>
                        </div>
                    </td>
                </tr>
            `;
        }

        // Modal functions
        function openUploadModal() {
            document.getElementById('uploadModal').classList.remove('hidden');
        }

        function closeUploadModal() {
            document.getElementById('uploadModal').classList.add('hidden');
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', async function() {
            showLoadingState();

            try {
                const data = await fetchDocuments();
                if (data && data.length > 0) {
                    documents = data;
                    filteredDocuments = [...documents];
                    updateTable();
                } else {
                    // Show no data if fetch failed
                    updateTable();
                }
            } catch (error) {
                console.error('Error initializing documents:', error);
                updateTable();
            }

            // Event listeners
            document.getElementById('simple-search').addEventListener('input', filterDocuments);
            document.getElementById('itemsPerPage').addEventListener('change', (e) => {
                changeItemsPerPage(e.target.value);
            });
        });

        // ============================================
        // NOTIFICATIONS
        // ============================================
        // Toast notifications are provided by global-notifications.html (included as Confluence macro)
        // Available functions: showSuccessToast(), showErrorToast(), showWarningToast(), showInfoToast()
        // 
        // Legacy compatibility wrapper for showNotification()
        // ============================================
        function showNotification(message, type = 'success') {
            const typeMap = {
                'success': showSuccessToast,
                'error': showErrorToast,
                'warning': showWarningToast,
                'info': showInfoToast
            };
            const toastFn = typeMap[type] || showInfoToast;
            toastFn(message);
        }
    </script>

    <!-- SheetJS library for Excel parsing -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</body>
</html>
