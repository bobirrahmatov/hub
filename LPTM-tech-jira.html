<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0"
    />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Technology Jira Ticket Tracker | LPTM</title>
    
    <!-- 
      CONFLUENCE MACRO REQUIRED: Include global-notifications.html as a macro
      This provides showSuccessToast(), showErrorToast(), showWarningToast(), showInfoToast()
    -->
    
    <!-- Alpine.js for reactive components -->
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- SheetJS library for Excel export -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    
    <!-- ApexCharts CDN -->
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
    
    <!-- Tailwind Config -->
    <script>
      tailwind.config = {
        darkMode: 'class',
        theme: {
          extend: {
            colors: {
              brand: {
                25: '#f2f7ff',
                50: '#ecf3ff',
                100: '#dde9ff',
                200: '#c2d6ff',
                300: '#9cb9ff',
                400: '#7592ff',
                500: '#465fff',
                600: '#3641f5',
                700: '#2a31d8',
                800: '#252dae',
                900: '#262e89',
                950: '#161950',
              },
              success: {
                25: '#f6fef9',
                50: '#ecfdf3',
                100: '#d1fadf',
                200: '#a6f4c5',
                300: '#6ce9a6',
                400: '#32d583',
                500: '#12b76a',
                600: '#039855',
                700: '#027a48',
                800: '#05603a',
                900: '#054f31',
                950: '#053321',
              },
              error: {
                25: '#fffbfa',
                50: '#fef3f2',
                100: '#fee4e2',
                200: '#fecdca',
                300: '#fda29b',
                400: '#f97066',
                500: '#f04438',
                600: '#d92d20',
                700: '#b42318',
                800: '#912018',
                900: '#7a271a',
                950: '#55160c',
              },
              warning: {
                25: '#fffcf5',
                50: '#fffaeb',
                100: '#fef0c7',
                200: '#fedf89',
                300: '#fec84b',
                400: '#fdb022',
                500: '#f79009',
                600: '#dc6803',
                700: '#b54708',
                800: '#93370d',
                900: '#7a2e0e',
                950: '#4e1d09',
              },
              gray: {
                25: '#fcfcfd',
                50: '#f9fafb',
                100: '#f2f4f7',
                200: '#e4e7ec',
                300: '#d0d5dd',
                400: '#98a2b3',
                500: '#667085',
                600: '#475467',
                700: '#344054',
                800: '#1d2939',
                900: '#101828',
                950: '#0c111d',
                dark: '#1a2231',
              },
            },
          },
        },
      }
    </script>
    
    <style>
      [x-cloak] {
        display: none !important;
      }
      
      body {
        font-family: 'Outfit', sans-serif;
      }
      
      /* Prevent table row expansion when dropdown opens */
      table tbody tr {
        height: auto;
      }
      
      table td {
        overflow: visible;
        vertical-align: middle;
      }
      
      /* Ensure status dropdown container doesn't expand row */
      table td [x-data] {
        display: inline-block;
        line-height: 1;
      }
      
      /* Fixed dropdown positioning */
      [x-ref="dropdown"] {
        position: fixed !important;
      }
      
      .custom-scrollbar::-webkit-scrollbar {
        width: 6px;
        height: 6px;
      }
      .custom-scrollbar::-webkit-scrollbar-track {
        border-radius: 9999px;
      }
      .custom-scrollbar::-webkit-scrollbar-thumb {
        border-radius: 9999px;
        background-color: #e4e7ec;
      }
      .dark .custom-scrollbar::-webkit-scrollbar-thumb {
        background-color: #344054;
      }
      
      /* Dark mode */
      :root {
        --card-bg: white;
        --input-bg: transparent;
      }
      .dark {
        --card-bg: #26292b;
        --input-bg: #1a1d1e;
      }
      .dark body {
        background-color: #0a0b0b;
      }
      .dark input[type="text"],
      .dark input[type="date"],
      .dark input[type="number"],
      .dark textarea,
      .dark select {
        background-color: var(--input-bg) !important;
        border-color: #3a3d3f !important;
      }
      
      /* Task hierarchy styles */
      .task-row-parent {
        cursor: pointer;
      }
      .task-row-child {
        background-color: #f9fafb;
      }
      .dark .task-row-child {
        background-color: #1a1d1e;
      }
      .task-row-child td:first-child {
        padding-left: 3rem !important;
      }
      
      /* Expandable icon animation */
      .expand-icon {
        transition: transform 0.2s ease;
      }
      .expand-icon.expanded {
        transform: rotate(90deg);
      }
      
      /* Spinning animation for refresh button */
      @keyframes spin {
        from {
          transform: rotate(0deg);
        }
        to {
          transform: rotate(360deg);
        }
      }
      
      .spinning {
        animation: spin 1s linear infinite;
      }
      
      /* Table header rounded corners - Main Tasks Table */
      #mainTasksTable thead tr:first-child th:first-child {
        border-top-left-radius: 1rem !important;
      }
      
      #mainTasksTable thead tr:first-child th:last-child {
        border-top-right-radius: 1rem !important;
      }
      
      #mainTasksTable thead {
        border-top-left-radius: 1rem !important;
        border-top-right-radius: 1rem !important;
      }
      
      /* Ensure the Actions column (last th) has proper radius */
      #mainTasksTable thead tr:first-child th:nth-child(9) {
        border-top-right-radius: 1rem !important;
      }
      
      /* Remove rounded corners for summary table header */
      #summaryRecentTasksTable thead tr:first-child th:first-child,
      #summaryRecentTasksTable thead tr:first-child th:last-child,
      #summaryRecentTasksTable thead {
        border-top-left-radius: 0 !important;
        border-top-right-radius: 0 !important;
      }
      
      /* Kanban board styles */
      .swim-lane {
        min-height: 500px;
      }
      
      .task {
        transition: transform 0.2s ease, box-shadow 0.2s ease, opacity 0.2s ease;
      }
      
      .task:hover {
        transform: translateY(-2px);
      }
      
      .task:active {
        cursor: grabbing !important;
      }
      
      /* Drag and drop visual feedback */
      .space-y-5.bg-gray-50 {
        transition: background-color 0.2s ease;
      }
    </style>
</head>
<body class="bg-gray-50 dark:bg-gray-950">
    <!-- ===== Main Content Start ===== -->
    <main class="min-h-screen bg-gray-50 dark:bg-gray-950">
      <div class="mx-auto max-w-[1536px] p-4 md:p-6">
        <div class="rounded-2xl border border-gray-200 bg-white dark:border-gray-800" style="background-color: var(--card-bg, white);">
          <div class="px-5 py-4 sm:px-6 sm:py-5">
            <h3 class="text-2xl font-medium text-gray-800 dark:text-white/90">
              Technology Jira Ticket Tracker
            </h3>
            <p class="mt-1 !text-base text-gray-500 dark:text-gray-400">
              Track and manage technology support tickets and requests
            </p>
          </div>
          
          <div class="border-t border-gray-100 p-5 sm:p-6 dark:border-gray-800">
            
            <!-- Tabs Navigation -->
            <div class="rounded-xl border border-gray-200 dark:border-gray-800" x-data="{ activeTab: 'table' }">
              <div class="border-b border-gray-200 dark:border-gray-800">
                <nav class="-mb-px flex space-x-2 overflow-x-auto px-6 pt-4 [&::-webkit-scrollbar-thumb]:rounded-full [&::-webkit-scrollbar-thumb]:bg-gray-200 dark:[&::-webkit-scrollbar-thumb]:bg-gray-600 dark:[&::-webkit-scrollbar-track]:bg-transparent [&::-webkit-scrollbar]:h-1.5">
                  <button
                    class="inline-flex items-center gap-2 border-b-2 px-2.5 py-2 !text-base font-medium transition-colors duration-200 ease-in-out"
                    x-bind:class="activeTab === 'table' ? ' text-brand-500 border-brand-500  dark:text-brand-400 dark:border-brand-400' : 'bg-transparent text-gray-500 border-transparent  hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200'"
                    x-on:click="activeTab = 'table'"
                  >
                    <svg class="size-5" width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <path fill-rule="evenodd" clip-rule="evenodd" d="M3 3.5C3 2.67157 3.67157 2 4.5 2H15.5C16.3284 2 17 2.67157 17 3.5V16.5C17 17.3284 16.3284 18 15.5 18H4.5C3.67157 18 3 17.3284 3 16.5V3.5ZM15.5 3.5H4.5V7.5H15.5V3.5ZM4.5 9V12H15.5V9H4.5ZM4.5 13.5V16.5H15.5V13.5H4.5Z" fill="currentColor"/>
                    </svg>
                    Table View
                  </button>
                  <button
                    class="inline-flex items-center gap-2 border-b-2 px-2.5 py-2 !text-base font-medium transition-colors duration-200 ease-in-out"
                    x-bind:class="activeTab === 'kanban' ? ' text-brand-500 border-brand-500  dark:border-brand-400  dark:text-brand-400' : 'bg-transparent text-gray-500 border-transparent  hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200'"
                    x-on:click="activeTab = 'kanban'"
                  >
                    <svg class="size-5" width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <path fill-rule="evenodd" clip-rule="evenodd" d="M2.5 3C2.5 2.44772 2.94772 2 3.5 2H6.5C7.05228 2 7.5 2.44772 7.5 3V17C7.5 17.5523 7.05228 18 6.5 18H3.5C2.94772 18 2.5 17.5523 2.5 17V3ZM4 3.5V16.5H6V3.5H4ZM10 3C10 2.44772 10.4477 2 11 2H14C14.5523 2 15 2.44772 15 3V11C15 11.5523 14.5523 12 14 12H11C10.4477 12 10 11.5523 10 11V3ZM11.5 3.5V10.5H13.5V3.5H11.5ZM16.5 3C16.5 2.44772 16.9477 2 17.5 2H20.5C21.0523 2 21.5 2.44772 21.5 3V14C21.5 14.5523 21.0523 15 20.5 15H17.5C16.9477 15 16.5 14.5523 16.5 14V3Z" fill="currentColor"/>
                    </svg>
                    Kanban View
                  </button>
                  <button
                    class="inline-flex items-center gap-2 border-b-2 px-2.5 py-2 !text-base font-medium transition-colors duration-200 ease-in-out"
                    x-bind:class="activeTab === 'summary' ? ' text-brand-500 border-brand-500  dark:text-brand-400 dark:border-brand-400' : 'bg-transparent text-gray-500 border-transparent  hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200'"
                    x-on:click="activeTab = 'summary'"
                  >
                    <svg class="size-5" width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <path fill-rule="evenodd" clip-rule="evenodd" d="M9.85954 4.0835C9.5834 4.0835 9.35954 4.30735 9.35954 4.5835V15.4161C9.35954 15.6922 9.5834 15.9161 9.85954 15.9161H10.1373C10.4135 15.9161 10.6373 15.6922 10.6373 15.4161V4.5835C10.6373 4.30735 10.4135 4.0835 10.1373 4.0835H9.85954ZM7.85954 4.5835C7.85954 3.47893 8.75497 2.5835 9.85954 2.5835H10.1373C11.2419 2.5835 12.1373 3.47893 12.1373 4.5835V15.4161C12.1373 16.5206 11.2419 17.4161 10.1373 17.4161H9.85954C8.75497 17.4161 7.85954 16.5206 7.85954 15.4161V4.5835ZM4.58203 8.9598C4.30589 8.9598 4.08203 9.18366 4.08203 9.4598V15.4168C4.08203 15.693 4.30589 15.9168 4.58203 15.9168H4.85981C5.13595 15.9168 5.35981 15.693 5.35981 15.4168V9.4598C5.35981 9.18366 5.13595 8.9598 4.85981 8.9598H4.58203ZM2.58203 9.4598C2.58203 8.35523 3.47746 7.4598 4.58203 7.4598H4.85981C5.96438 7.4598 6.85981 8.35523 6.85981 9.4598V15.4168C6.85981 16.5214 5.96438 17.4168 4.85981 17.4168H4.58203C3.47746 17.4168 2.58203 16.5214 2.58203 15.4168V9.4598ZM14.637 12.435C14.637 12.1589 14.8609 11.935 15.137 11.935H15.4148C15.691 11.935 15.9148 12.1589 15.9148 12.435V15.4168C15.9148 15.693 15.691 15.9168 15.4148 15.9168H15.137C14.8609 15.9168 14.637 15.693 14.637 15.4168V12.435ZM15.137 10.435C14.0325 10.435 13.137 11.3304 13.137 12.435V15.4168C13.137 16.5214 14.0325 17.4168 15.137 17.4168H15.4148C16.5194 17.4168 17.4148 16.5214 17.4148 15.4168V12.435C17.4148 11.3304 16.5194 10.435 15.4148 10.435H15.137Z" fill="currentColor"/>
                    </svg>
                    Summary
                  </button>
                </nav>
              </div>

              <!-- Tab Content -->
              <div class="p-4 dark:border-gray-800 sm:p-6">
                
                <!-- Table View Tab -->
                <div x-show="activeTab === 'table'">
                  
            <!-- Buttons & Search Bar -->
            <div class="mb-4 flex flex-wrap items-center gap-3">
              <!-- Buttons -->
              <button
                onclick="openAddTicketModal()"
                class="flex items-center gap-2 rounded-lg bg-brand-500 px-4 py-2.5 !text-base font-medium text-white hover:bg-brand-600 transition-all duration-200"
              >
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                </svg>
                Add Ticket
              </button>
              
              <button
                onclick="exportToExcel()"
                class="flex items-center gap-2 rounded-lg bg-success-500 px-4 py-2.5 !text-base font-medium text-white hover:bg-success-600 transition-all duration-200"
              >
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                </svg>
                Export
              </button>
              
              <button
                id="refreshButton"
                onclick="refreshTicketsTable()"
                class="flex items-center gap-2 rounded-lg bg-gray-100 px-4 py-2.5 !text-base font-medium text-gray-700 hover:bg-gray-200 transition-all duration-200 dark:bg-gray-800 dark:text-gray-300 dark:hover:bg-gray-700"
              >
                <svg id="refreshIcon" class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" xmlns="http://www.w3.org/2000/svg">
                  <path d="M21 10C21 10 18.995 7.26822 17.3662 5.63824C15.7373 4.00827 13.4864 3 11 3C6.02944 3 2 7.02944 2 12C2 16.9706 6.02944 21 11 21C15.1031 21 18.5649 18.2543 19.6482 14.5M21 10V4M21 10H15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                Refresh
              </button>
              
              <!-- Search Bar -->
              <div class="relative w-80">
                <span class="pointer-events-none absolute top-1/2 left-4 -translate-y-1/2">
                  <svg class="fill-gray-500 dark:fill-gray-400" width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path fill-rule="evenodd" clip-rule="evenodd" d="M3.04199 9.37381C3.04199 5.87712 5.87735 3.04218 9.37533 3.04218C12.8733 3.04218 15.7087 5.87712 15.7087 9.37381C15.7087 12.8705 12.8733 15.7055 9.37533 15.7055C5.87735 15.7055 3.04199 12.8705 3.04199 9.37381ZM9.37533 1.54218C5.04926 1.54218 1.54199 5.04835 1.54199 9.37381C1.54199 13.6993 5.04926 17.2055 9.37533 17.2055C11.2676 17.2055 13.0032 16.5346 14.3572 15.4178L17.1773 18.2381C17.4702 18.531 17.945 18.5311 18.2379 18.2382C18.5308 17.9453 18.5309 17.4704 18.238 17.1775L15.4182 14.3575C16.5367 13.0035 17.2087 11.2671 17.2087 9.37381C17.2087 5.04835 13.7014 1.54218 9.37533 1.54218Z" fill=""></path>
                  </svg>
                </span>
                <input
                  type="text"
                  id="searchInput"
                  placeholder="Search tickets..."
                  class="h-11 w-full rounded-lg border border-gray-300 bg-transparent py-2.5 pr-4 pl-[42px] !text-base text-gray-800 placeholder:text-gray-400 focus:border-brand-500 focus:ring-2 focus:ring-brand-500/10 focus:outline-none shadow-sm dark:border-gray-700 dark:text-white dark:placeholder:text-gray-500"
                  oninput="filterTickets()"
                />
              </div>
            </div>
            
            <!-- Filters & Pagination -->
            <div class="mb-6 flex flex-wrap items-center justify-between gap-3">
              <!-- Filters on the Left -->
              <div class="flex flex-wrap items-center gap-3">
              <div x-data="{ open: false, selected: 'All Statuses' }" class="relative">
                  <button @click="open = !open" type="button"
                    class="inline-flex items-center justify-between gap-2 rounded-lg border border-gray-300 bg-white px-4 py-2.5 !text-base font-medium text-gray-800 hover:bg-gray-50 shadow-theme-xs transition-colors dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:hover:bg-gray-800">
                    <span x-text="selected"></span>
                    <svg class="h-4 w-4 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                    </svg>
                  </button>
                  <div x-show="open" @click.outside="open = false" x-cloak
                    class="absolute right-0 top-full z-[99999] mt-2 w-48 space-y-1 rounded-2xl border border-gray-200 bg-white p-2 shadow-theme-lg dark:border-gray-700 dark:bg-gray-800">
                    <button type="button" @click="selected = 'All Statuses'; open = false; filterTicketsByStatus('All')"
                      class="flex w-full rounded-lg px-3 py-2 text-left !text-base font-medium text-gray-700 hover:bg-gray-100 transition-colors dark:text-gray-300 dark:hover:bg-gray-700">
                      All Statuses
                    </button>
                    <button type="button" @click="selected = 'Pending'; open = false; filterTicketsByStatus('Pending')"
                      class="flex w-full rounded-lg px-3 py-2 text-left !text-base font-medium text-gray-700 hover:bg-gray-100 transition-colors dark:text-gray-300 dark:hover:bg-gray-700">
                      Pending
                    </button>
                    <button type="button" @click="selected = 'In Progress'; open = false; filterTicketsByStatus('In Progress')"
                      class="flex w-full rounded-lg px-3 py-2 text-left !text-base font-medium text-gray-700 hover:bg-gray-100 transition-colors dark:text-gray-300 dark:hover:bg-gray-700">
                      In Progress
                    </button>
                    <button type="button" @click="selected = 'Completed'; open = false; filterTicketsByStatus('Completed')"
                      class="flex w-full rounded-lg px-3 py-2 text-left !text-base font-medium text-gray-700 hover:bg-gray-100 transition-colors dark:text-gray-300 dark:hover:bg-gray-700">
                      Completed
                    </button>
                    <button type="button" @click="selected = 'On Hold'; open = false; filterTicketsByStatus('On Hold')"
                      class="flex w-full rounded-lg px-3 py-2 text-left !text-base font-medium text-gray-700 hover:bg-gray-100 transition-colors dark:text-gray-300 dark:hover:bg-gray-700">
                      On Hold
                    </button>
                  </div>
                </div>
                
                <!-- Ticket Type Filter -->
                <div x-data="{ open: false, selected: 'All Types' }" class="relative">
                  <button @click="open = !open" type="button"
                    class="inline-flex items-center justify-between gap-2 rounded-lg border border-gray-300 bg-white px-4 py-2.5 !text-base font-medium text-gray-800 hover:bg-gray-50 shadow-theme-xs transition-colors dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:hover:bg-gray-800">
                    <span x-text="selected"></span>
                    <svg class="h-4 w-4 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                    </svg>
                  </button>
                  <div x-show="open" @click.outside="open = false" x-cloak
                    class="absolute right-0 top-full z-[99999] mt-2 w-48 space-y-1 rounded-2xl border border-gray-200 bg-white p-2 shadow-theme-lg dark:border-gray-700 dark:bg-gray-800">
                    <button type="button" @click="selected = 'All Types'; open = false; filterTicketsByType('All')"
                      class="flex w-full rounded-lg px-3 py-2 text-left !text-base font-medium text-gray-700 hover:bg-gray-100 transition-colors dark:text-gray-300 dark:hover:bg-gray-700">
                      All Types
                    </button>
                    <button type="button" @click="selected = 'Bug'; open = false; filterTicketsByType('Bug')"
                      class="flex w-full rounded-lg px-3 py-2 text-left !text-base font-medium text-gray-700 hover:bg-gray-100 transition-colors dark:text-gray-300 dark:hover:bg-gray-700">
                      Bug
                    </button>
                    <button type="button" @click="selected = 'Feature Request'; open = false; filterTicketsByType('Feature Request')"
                      class="flex w-full rounded-lg px-3 py-2 text-left !text-base font-medium text-gray-700 hover:bg-gray-100 transition-colors dark:text-gray-300 dark:hover:bg-gray-700">
                      Feature Request
                    </button>
                    <button type="button" @click="selected = 'Support'; open = false; filterTicketsByType('Support')"
                      class="flex w-full rounded-lg px-3 py-2 text-left !text-base font-medium text-gray-700 hover:bg-gray-100 transition-colors dark:text-gray-300 dark:hover:bg-gray-700">
                      Support
                    </button>
                    <button type="button" @click="selected = 'Enhancement'; open = false; filterTicketsByType('Enhancement')"
                      class="flex w-full rounded-lg px-3 py-2 text-left !text-base font-medium text-gray-700 hover:bg-gray-100 transition-colors dark:text-gray-300 dark:hover:bg-gray-700">
                      Enhancement
                    </button>
                    <button type="button" @click="selected = 'Investigation'; open = false; filterTicketsByType('Investigation')"
                      class="flex w-full rounded-lg px-3 py-2 text-left !text-base font-medium text-gray-700 hover:bg-gray-100 transition-colors dark:text-gray-300 dark:hover:bg-gray-700">
                      Investigation
                    </button>
                  </div>
                </div>
                
                <!-- Priority Filter -->
                <div x-data="{ open: false, selected: 'All Priorities' }" class="relative">
                  <button @click="open = !open" type="button"
                    class="inline-flex items-center justify-between gap-2 rounded-lg border border-gray-300 bg-white px-4 py-2.5 !text-base font-medium text-gray-800 hover:bg-gray-50 shadow-theme-xs transition-colors dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:hover:bg-gray-800">
                    <span x-text="selected"></span>
                    <svg class="h-4 w-4 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                    </svg>
                  </button>
                  <div x-show="open" @click.outside="open = false" x-cloak
                    class="absolute right-0 top-full z-[99999] mt-2 w-48 space-y-1 rounded-2xl border border-gray-200 bg-white p-2 shadow-theme-lg dark:border-gray-700 dark:bg-gray-800">
                    <button type="button" @click="selected = 'All Priorities'; open = false; filterTicketsByPriority('All')"
                      class="flex w-full rounded-lg px-3 py-2 text-left !text-base font-medium text-gray-700 hover:bg-gray-100 transition-colors dark:text-gray-300 dark:hover:bg-gray-700">
                      All Priorities
                    </button>
                    <button type="button" @click="selected = 'Low'; open = false; filterTicketsByPriority('Low')"
                      class="flex w-full rounded-lg px-3 py-2 text-left !text-base font-medium text-gray-700 hover:bg-gray-100 transition-colors dark:text-gray-300 dark:hover:bg-gray-700">
                      Low
                    </button>
                    <button type="button" @click="selected = 'Medium'; open = false; filterTicketsByPriority('Medium')"
                      class="flex w-full rounded-lg px-3 py-2 text-left !text-base font-medium text-gray-700 hover:bg-gray-100 transition-colors dark:text-gray-300 dark:hover:bg-gray-700">
                      Medium
                    </button>
                    <button type="button" @click="selected = 'High'; open = false; filterTicketsByPriority('High')"
                      class="flex w-full rounded-lg px-3 py-2 text-left !text-base font-medium text-gray-700 hover:bg-gray-100 transition-colors dark:text-gray-300 dark:hover:bg-gray-700">
                      High
                    </button>
                    <button type="button" @click="selected = 'Urgent'; open = false; filterTicketsByPriority('Urgent')"
                      class="flex w-full rounded-lg px-3 py-2 text-left !text-base font-medium text-gray-700 hover:bg-gray-100 transition-colors dark:text-gray-300 dark:hover:bg-gray-700">
                      Urgent
                    </button>
                  </div>
                </div>
              </div>
              
              <!-- Pagination Controls on the Right -->
              <div class="flex items-center gap-2">
                <span class="!text-base text-gray-700 dark:text-gray-400">Show</span>
                <select
                  id="itemsPerPage"
                  class="rounded-lg border border-gray-300 bg-white px-3 py-2 !text-base text-gray-700 dark:border-gray-700 dark:bg-gray-800 dark:text-white"
                  onchange="changeItemsPerPage()"
                >
                  <option value="10">10</option>
                  <option value="25" selected>25</option>
                  <option value="50">50</option>
                  <option value="100">100</option>
                </select>
                <span class="!text-base text-gray-700 dark:text-gray-400">per page</span>
              </div>
            </div>
            
            <!-- Tasks Table -->
            <div class="rounded-2xl border border-gray-200 bg-white dark:border-gray-800 relative" style="background-color: var(--card-bg, white);" id="tableContainer">
              <!-- Loading Overlay -->
              <div id="tableLoadingOverlay" class="absolute inset-0 bg-white/80 dark:bg-gray-900/80 backdrop-blur-sm rounded-2xl hidden z-50 flex items-center justify-center">
                <div class="text-center">
                  <svg class="animate-spin h-12 w-12 text-blue-600 dark:text-blue-500 mx-auto" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                  </svg>
                  <p class="mt-3 !text-base font-medium text-gray-700 dark:text-gray-300">Refreshing tasks...</p>
                </div>
              </div>
              
              <div class="custom-scrollbar overflow-x-auto" id="tableContent">
                <table class="min-w-full" id="mainTasksTable">
                  <thead>
                    <tr class="bg-gray-50 dark:bg-gray-800/50">
                      <th class="px-6 py-4 text-left !text-base font-medium whitespace-nowrap text-gray-500 dark:text-gray-400">Ticket ID</th>
                      <th class="px-6 py-4 text-center !text-base font-medium whitespace-nowrap text-gray-500 dark:text-gray-400">Ticket Type</th>
                      <th class="px-6 py-4 text-left !text-base font-medium whitespace-nowrap text-gray-500 dark:text-gray-400" style="min-width: 250px;">Description</th>
                      <th class="px-6 py-4 text-center !text-base font-medium whitespace-nowrap text-gray-500 dark:text-gray-400">Requested By</th>
                      <th class="px-6 py-4 text-center !text-base font-medium whitespace-nowrap text-gray-500 dark:text-gray-400">Submission Date</th>
                      <th class="px-6 py-4 text-center !text-base font-medium whitespace-nowrap text-gray-500 dark:text-gray-400">Close Date</th>
                      <th class="px-6 py-4 text-center !text-base font-medium whitespace-nowrap text-gray-500 dark:text-gray-400">Team in Charge</th>
                      <th class="px-6 py-4 text-center !text-base font-medium whitespace-nowrap text-gray-500 dark:text-gray-400">Status</th>
                      <th class="px-6 py-4 text-center !text-base font-medium whitespace-nowrap text-gray-500 dark:text-gray-400">Days to Close</th>
                      <th class="px-6 py-4 text-center !text-base font-medium whitespace-nowrap text-gray-500 dark:text-gray-400">Priority</th>
                      <th class="px-6 py-4 text-center !text-base font-medium whitespace-nowrap text-gray-500 dark:text-gray-400">Actions</th>
                    </tr>
                  </thead>
                  <tbody class="divide-y divide-gray-200 dark:divide-gray-700" id="ticketsTableBody">
                    <!-- Tasks will be populated here -->
                  </tbody>
                </table>
              </div>
              
              <!-- Pagination -->
              <div class="border-t border-gray-200 px-6 py-4 dark:border-gray-800">
                <div class="flex items-center justify-between">
                  <div class="!text-base text-gray-700 dark:text-gray-400">
                    Showing <span id="showingStart">0</span> to <span id="showingEnd">0</span> of <span id="totalTasks">0</span> tasks
                  </div>
                  
                  <div class="flex items-center gap-2">
                    <button
                      onclick="previousPage()"
                      class="flex items-center gap-2 rounded-lg border border-gray-300 bg-white px-3 py-2 !text-base font-medium text-gray-700 hover:bg-gray-50 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-400 dark:hover:bg-gray-700"
                      id="prevButton"
                    >
                      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                      </svg>
                      Previous
                    </button>
                    
                    <span class="!text-base font-medium text-gray-700 dark:text-gray-400">
                      Page <span id="currentPage">1</span> of <span id="totalPages">1</span>
                    </span>
                    
                    <button
                      onclick="nextPage()"
                      class="flex items-center gap-2 rounded-lg border border-gray-300 bg-white px-3 py-2 !text-base font-medium text-gray-700 hover:bg-gray-50 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-400 dark:hover:bg-gray-700"
                      id="nextButton"
                    >
                      Next
                      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                      </svg>
                    </button>
                  </div>
                </div>
              </div>
            </div>
            
                </div>
                <!-- End Table View Tab -->
                
                <!-- Kanban View Tab -->
                <div x-show="activeTab === 'kanban'" x-data="{ selectedFilter: 'All' }">
                  
                  <!-- Kanban Filters Header -->
                  <div class="flex flex-col items-center mb-7">
                    <div class="flex flex-col w-full gap-5 sm:justify-between xl:flex-row xl:items-center">
                      
                      <!-- Search Input -->
                      <div class="relative w-full xl:w-80">
                        <span class="pointer-events-none absolute top-1/2 left-3 -translate-y-1/2">
                          <svg class="fill-gray-500 dark:fill-gray-400" width="18" height="18" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path fill-rule="evenodd" clip-rule="evenodd" d="M3.04199 9.37381C3.04199 5.87712 5.87735 3.04218 9.37533 3.04218C12.8733 3.04218 15.7087 5.87712 15.7087 9.37381C15.7087 12.8705 12.8733 15.7055 9.37533 15.7055C5.87735 15.7055 3.04199 12.8705 3.04199 9.37381ZM9.37533 1.54218C5.04926 1.54218 1.54199 5.04835 1.54199 9.37381C1.54199 13.6993 5.04926 17.2055 9.37533 17.2055C11.2676 17.2055 13.0032 16.5346 14.3572 15.4178L17.1773 18.2381C17.4702 18.531 17.945 18.5311 18.2379 18.2382C18.5308 17.9453 18.5309 17.4704 18.238 17.1775L15.4182 14.3575C16.5367 13.0035 17.2087 11.2671 17.2087 9.37381C17.2087 5.04835 13.7014 1.54218 9.37533 1.54218Z" fill="" />
                          </svg>
                        </span>
                        <input 
                          type="text" 
                          id="kanbanSearchInput" 
                          placeholder="Search tasks in Kanban..." 
                          class="h-11 w-full rounded-lg border border-gray-300 bg-white py-2.5 pr-3 pl-10 !text-base text-gray-800 placeholder:text-gray-400 focus:border-brand-500 focus:ring-2 focus:ring-brand-500/10 focus:outline-none shadow-sm dark:border-gray-700 dark:bg-gray-800 dark:text-white dark:placeholder:text-gray-500"
                          oninput="searchKanbanTasks(this.value)"
                        />
                      </div>
                      
                      <!-- Filter Pills -->
                      <div class="flex flex-wrap items-center gap-x-1 gap-y-2 rounded-lg bg-gray-100 p-0.5 dark:bg-gray-900">
                        <button
                          class="inline-flex items-center gap-2 px-4 py-2 !text-base font-medium rounded-md group hover:text-gray-900 dark:hover:text-white"
                          :class="selectedFilter === 'All' ? 'text-gray-900 dark:text-white bg-white dark:bg-gray-800' : 'text-gray-500 dark:text-gray-400'"
                          @click="selectedFilter = 'All'; applyKanbanFilter('All')"
                        >
                          All Tasks
                          <span
                            class="inline-flex rounded-full px-2 py-0.5 !text-base font-medium leading-normal group-hover:bg-brand-50 group-hover:text-brand-500 dark:group-hover:bg-brand-500/15 dark:group-hover:text-brand-400"
                            :class="selectedFilter === 'All' ? 'text-brand-500 dark:text-brand-400 bg-brand-50 dark:bg-brand-500/15' : 'bg-white dark:bg-white/[0.03]'"
                            id="kanban-all-count"
                          >
                            0
                          </span>
                        </button>
                        
                        <button
                          class="inline-flex items-center gap-2 px-4 py-2 !text-base font-medium rounded-md group hover:text-gray-900 dark:hover:text-white"
                          :class="selectedFilter === 'Pending' ? 'text-gray-900 dark:text-white bg-white dark:bg-gray-800' : 'text-gray-500 dark:text-gray-400'"
                          @click="selectedFilter = 'Pending'; applyKanbanFilter('Pending')"
                        >
                          Pending
                          <span
                            class="inline-flex rounded-full px-2 py-0.5 !text-base font-medium leading-normal group-hover:bg-brand-50 group-hover:text-brand-500 dark:group-hover:bg-brand-500/15 dark:group-hover:text-brand-400"
                            :class="selectedFilter === 'Pending' ? 'text-brand-500 dark:text-brand-400 bg-brand-50 dark:bg-brand-500/15' : 'bg-white dark:bg-white/[0.03]'"
                            id="kanban-pending-filter-count"
                          >
                            0
                          </span>
                        </button>
                        
                        <button
                          class="inline-flex items-center gap-2 px-4 py-2 !text-base font-medium rounded-md group hover:text-gray-900 dark:hover:text-white"
                          :class="selectedFilter === 'In Progress' ? 'text-gray-900 dark:text-white bg-white dark:bg-gray-800' : 'text-gray-500 dark:text-gray-400'"
                          @click="selectedFilter = 'In Progress'; applyKanbanFilter('In Progress')"
                        >
                          In Progress
                          <span
                            class="inline-flex rounded-full px-2 py-0.5 !text-base font-medium leading-normal group-hover:bg-brand-50 group-hover:text-brand-500 dark:group-hover:bg-brand-500/15 dark:group-hover:text-brand-400"
                            :class="selectedFilter === 'In Progress' ? 'text-brand-500 dark:text-brand-400 bg-brand-50 dark:bg-brand-500/15' : 'bg-white dark:bg-white/[0.03]'"
                            id="kanban-inprogress-filter-count"
                          >
                            0
                          </span>
                        </button>
                        
                        <button
                          class="inline-flex items-center gap-2 px-4 py-2 !text-base font-medium rounded-md group hover:text-gray-900 dark:hover:text-white"
                          :class="selectedFilter === 'Completed' ? 'text-gray-900 dark:text-white bg-white dark:bg-gray-800' : 'text-gray-500 dark:text-gray-400'"
                          @click="selectedFilter = 'Completed'; applyKanbanFilter('Completed')"
                        >
                          Completed
                          <span
                            class="inline-flex rounded-full px-2 py-0.5 !text-base font-medium leading-normal group-hover:bg-brand-50 group-hover:text-brand-500 dark:group-hover:bg-brand-500/15 dark:group-hover:text-brand-400"
                            :class="selectedFilter === 'Completed' ? 'text-brand-500 dark:text-brand-400 bg-brand-50 dark:bg-brand-500/15' : 'bg-white dark:bg-white/[0.03]'"
                            id="kanban-completed-filter-count"
                          >
                            0
                          </span>
                        </button>
                      </div>
                      
                      <!-- Add Ticket Button for Kanban -->
                      <button
                        onclick="openAddTicketModal()"
                        class="inline-flex items-center gap-2 rounded-lg bg-blue-600 px-5 py-2.5 !text-base font-medium text-white hover:bg-blue-700 focus:outline-none focus:ring-4 focus:ring-blue-300 dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800"
                      >
                        <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
                        </svg>
                        Add Ticket
                      </button>
                    </div>
                  </div>
                  
                  <!-- Kanban Board -->
                  <div class="mt-7 grid grid-cols-1 border-t border-gray-200 dark:border-gray-800 sm:mt-0 sm:grid-cols-2 xl:grid-cols-4 min-h-[600px]">
                    
                    <!-- Pending Column -->
                    <div class="swim-lane flex flex-col gap-5 border-r border-gray-200 dark:border-gray-800">
                      <div class="mb-1 flex items-center justify-between p-4 xl:px-6 xl:pt-6">
                        <h3 class="flex items-center gap-3 text-base font-medium text-gray-800 dark:text-white/90">
                          Pending
                          <span id="pending-count" class="inline-flex rounded-full bg-gray-100 px-2 py-0.5 !text-base font-medium text-gray-700 dark:bg-white/[0.03] dark:text-white/80">
                            0
                          </span>
                        </h3>
                        
                        <div x-data="{openDropDown: false}" class="relative">
                          <button
                            @click="openDropDown = !openDropDown"
                            class="text-gray-700 dark:text-gray-400"
                          >
                            <svg class="fill-current" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                              <path fill-rule="evenodd" clip-rule="evenodd" d="M5.99902 10.2451C6.96552 10.2451 7.74902 11.0286 7.74902 11.9951V12.0051C7.74902 12.9716 6.96552 13.7551 5.99902 13.7551C5.03253 13.7551 4.24902 12.9716 4.24902 12.0051V11.9951C4.24902 11.0286 5.03253 10.2451 5.99902 10.2451ZM17.999 10.2451C18.9655 10.2451 19.749 11.0286 19.749 11.9951V12.0051C19.749 12.9716 18.9655 13.7551 17.999 13.7551C17.0325 13.7551 16.249 12.9716 16.249 12.0051V11.9951C16.249 11.0286 17.0325 10.2451 17.999 10.2451ZM13.749 11.9951C13.749 11.0286 12.9655 10.2451 11.999 10.2451C11.0325 10.2451 10.249 11.0286 10.249 11.9951V12.0051C10.249 12.9716 11.0325 13.7551 11.999 13.7551C12.9655 13.7551 13.749 12.9716 13.749 12.0051V11.9951Z" fill=""/>
                            </svg>
                          </button>
                          <div
                            x-show="openDropDown"
                            @click.outside="openDropDown = false"
                            x-cloak
                            class="absolute right-0 top-full z-40 w-[160px] space-y-1 rounded-2xl border border-gray-200 bg-white p-2 shadow-theme-md dark:border-gray-800 dark:bg-gray-dark"
                          >
                            <button 
                              onclick="openAddTicketModal()"
                              class="flex w-full items-center gap-2 rounded-lg px-3 py-2 text-left !text-base font-medium text-gray-500 hover:bg-gray-100 hover:text-gray-700 dark:text-gray-400 dark:hover:bg-white/5 dark:hover:text-gray-300">
                              <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
                              </svg>
                              Add Ticket
                            </button>
                          </div>
                        </div>
                      </div>
                      <div id="pending-tasks" class="space-y-5 min-h-[500px] max-h-[600px] overflow-y-scroll custom-scrollbar px-4 pb-4 xl:px-6 xl:pb-6" 
                           ondrop="drop(event, 'Pending')" 
                           ondragover="allowDrop(event)"
                           ondragleave="dragLeave(event)">
                        <!-- Pending tasks will be populated here -->
                      </div>
                    </div>
                    
                    <!-- In Progress Column -->
                    <div class="swim-lane flex flex-col gap-5 border-r border-gray-200 dark:border-gray-800">
                      <div class="mb-1 flex items-center justify-between p-4 xl:px-6 xl:pt-6">
                        <h3 class="flex items-center gap-3 text-base font-medium text-gray-800 dark:text-white/90">
                          In Progress
                          <span id="inprogress-count" class="inline-flex rounded-full bg-warning-50 px-2 py-0.5 !text-base font-medium text-warning-700 dark:bg-warning-500/15 dark:text-orange-400">
                            0
                          </span>
                        </h3>
                        
                        <div x-data="{openDropDown: false}" class="relative">
                          <button
                            @click="openDropDown = !openDropDown"
                            class="text-gray-700 dark:text-gray-400"
                          >
                            <svg class="fill-current" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                              <path fill-rule="evenodd" clip-rule="evenodd" d="M5.99902 10.2451C6.96552 10.2451 7.74902 11.0286 7.74902 11.9951V12.0051C7.74902 12.9716 6.96552 13.7551 5.99902 13.7551C5.03253 13.7551 4.24902 12.9716 4.24902 12.0051V11.9951C4.24902 11.0286 5.03253 10.2451 5.99902 10.2451ZM17.999 10.2451C18.9655 10.2451 19.749 11.0286 19.749 11.9951V12.0051C19.749 12.9716 18.9655 13.7551 17.999 13.7551C17.0325 13.7551 16.249 12.9716 16.249 12.0051V11.9951C16.249 11.0286 17.0325 10.2451 17.999 10.2451ZM13.749 11.9951C13.749 11.0286 12.9655 10.2451 11.999 10.2451C11.0325 10.2451 10.249 11.0286 10.249 11.9951V12.0051C10.249 12.9716 11.0325 13.7551 11.999 13.7551C12.9655 13.7551 13.749 12.9716 13.749 12.0051V11.9951Z" fill=""/>
                            </svg>
                          </button>
                          <div
                            x-show="openDropDown"
                            @click.outside="openDropDown = false"
                            x-cloak
                            class="absolute right-0 top-full z-40 w-[160px] space-y-1 rounded-2xl border border-gray-200 bg-white p-2 shadow-theme-md dark:border-gray-800 dark:bg-gray-dark"
                          >
                            <button 
                              onclick="openAddTicketModal()"
                              class="flex w-full items-center gap-2 rounded-lg px-3 py-2 text-left !text-base font-medium text-gray-500 hover:bg-gray-100 hover:text-gray-700 dark:text-gray-400 dark:hover:bg-white/5 dark:hover:text-gray-300">
                              <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
                              </svg>
                              Add Ticket
                            </button>
                          </div>
                        </div>
                      </div>
                      <div id="inprogress-tasks" class="space-y-5 min-h-[500px] max-h-[600px] overflow-y-scroll custom-scrollbar px-4 pb-4 xl:px-6 xl:pb-6"
                           ondrop="drop(event, 'In Progress')" 
                           ondragover="allowDrop(event)"
                           ondragleave="dragLeave(event)">
                        <!-- In Progress tasks will be populated here -->
                      </div>
                    </div>
                    
                    <!-- On Hold Column -->
                    <div class="swim-lane flex flex-col gap-5 border-r border-gray-200 dark:border-gray-800">
                      <div class="mb-1 flex items-center justify-between p-4 xl:px-6 xl:pt-6">
                        <h3 class="flex items-center gap-3 text-base font-medium text-gray-800 dark:text-white/90">
                          On Hold
                          <span id="onhold-count" class="inline-flex rounded-full bg-gray-100 px-2 py-0.5 !text-base font-medium text-gray-700 dark:bg-white/[0.03] dark:text-white/80">
                            0
                          </span>
                        </h3>
                        
                        <div x-data="{openDropDown: false}" class="relative">
                          <button
                            @click="openDropDown = !openDropDown"
                            class="text-gray-700 dark:text-gray-400"
                          >
                            <svg class="fill-current" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                              <path fill-rule="evenodd" clip-rule="evenodd" d="M5.99902 10.2451C6.96552 10.2451 7.74902 11.0286 7.74902 11.9951V12.0051C7.74902 12.9716 6.96552 13.7551 5.99902 13.7551C5.03253 13.7551 4.24902 12.9716 4.24902 12.0051V11.9951C4.24902 11.0286 5.03253 10.2451 5.99902 10.2451ZM17.999 10.2451C18.9655 10.2451 19.749 11.0286 19.749 11.9951V12.0051C19.749 12.9716 18.9655 13.7551 17.999 13.7551C17.0325 13.7551 16.249 12.9716 16.249 12.0051V11.9951C16.249 11.0286 17.0325 10.2451 17.999 10.2451ZM13.749 11.9951C13.749 11.0286 12.9655 10.2451 11.999 10.2451C11.0325 10.2451 10.249 11.0286 10.249 11.9951V12.0051C10.249 12.9716 11.0325 13.7551 11.999 13.7551C12.9655 13.7551 13.749 12.9716 13.749 12.0051V11.9951Z" fill=""/>
                            </svg>
                          </button>
                          <div
                            x-show="openDropDown"
                            @click.outside="openDropDown = false"
                            x-cloak
                            class="absolute right-0 top-full z-40 w-[160px] space-y-1 rounded-2xl border border-gray-200 bg-white p-2 shadow-theme-md dark:border-gray-800 dark:bg-gray-dark"
                          >
                            <button 
                              onclick="openAddTicketModal()"
                              class="flex w-full items-center gap-2 rounded-lg px-3 py-2 text-left !text-base font-medium text-gray-500 hover:bg-gray-100 hover:text-gray-700 dark:text-gray-400 dark:hover:bg-white/5 dark:hover:text-gray-300">
                              <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
                              </svg>
                              Add Ticket
                            </button>
                          </div>
                        </div>
                      </div>
                      <div id="onhold-tasks" class="space-y-5 min-h-[500px] max-h-[600px] overflow-y-scroll custom-scrollbar px-4 pb-4 xl:px-6 xl:pb-6"
                           ondrop="drop(event, 'On Hold')" 
                           ondragover="allowDrop(event)"
                           ondragleave="dragLeave(event)">
                        <!-- On Hold tasks will be populated here -->
                      </div>
                    </div>
                    
                    <!-- Completed Column -->
                    <div class="swim-lane flex flex-col gap-5">
                      <div class="mb-1 flex items-center justify-between p-4 xl:px-6 xl:pt-6">
                        <h3 class="flex items-center gap-3 text-base font-medium text-gray-800 dark:text-white/90">
                          Completed
                          <span id="completed-count" class="inline-flex rounded-full bg-success-50 px-2 py-0.5 !text-base font-medium text-success-700 dark:bg-success-500/15 dark:text-success-500">
                            0
                          </span>
                        </h3>
                        
                        <div x-data="{openDropDown: false}" class="relative">
                          <button
                            @click="openDropDown = !openDropDown"
                            class="text-gray-700 dark:text-gray-400"
                          >
                            <svg class="fill-current" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                              <path fill-rule="evenodd" clip-rule="evenodd" d="M5.99902 10.2451C6.96552 10.2451 7.74902 11.0286 7.74902 11.9951V12.0051C7.74902 12.9716 6.96552 13.7551 5.99902 13.7551C5.03253 13.7551 4.24902 12.9716 4.24902 12.0051V11.9951C4.24902 11.0286 5.03253 10.2451 5.99902 10.2451ZM17.999 10.2451C18.9655 10.2451 19.749 11.0286 19.749 11.9951V12.0051C19.749 12.9716 18.9655 13.7551 17.999 13.7551C17.0325 13.7551 16.249 12.9716 16.249 12.0051V11.9951C16.249 11.0286 17.0325 10.2451 17.999 10.2451ZM13.749 11.9951C13.749 11.0286 12.9655 10.2451 11.999 10.2451C11.0325 10.2451 10.249 11.0286 10.249 11.9951V12.0051C10.249 12.9716 11.0325 13.7551 11.999 13.7551C12.9655 13.7551 13.749 12.9716 13.749 12.0051V11.9951Z" fill=""/>
                            </svg>
                          </button>
                          <div
                            x-show="openDropDown"
                            @click.outside="openDropDown = false"
                            x-cloak
                            class="absolute right-0 top-full z-40 w-[160px] space-y-1 rounded-2xl border border-gray-200 bg-white p-2 shadow-theme-md dark:border-gray-800 dark:bg-gray-dark"
                          >
                            <button 
                              onclick="openAddTicketModal()"
                              class="flex w-full items-center gap-2 rounded-lg px-3 py-2 text-left !text-base font-medium text-gray-500 hover:bg-gray-100 hover:text-gray-700 dark:text-gray-400 dark:hover:bg-white/5 dark:hover:text-gray-300">
                              <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
                              </svg>
                              Add Ticket
                            </button>
                          </div>
                        </div>
                      </div>
                      <div id="completed-tasks" class="space-y-5 min-h-[500px] max-h-[600px] overflow-y-scroll custom-scrollbar px-4 pb-4 xl:px-6 xl:pb-6"
                           ondrop="drop(event, 'Completed')" 
                           ondragover="allowDrop(event)"
                           ondragleave="dragLeave(event)">
                        <!-- Completed tasks will be populated here -->
                      </div>
                    </div>
                    
                  </div>
                  
                </div>
                <!-- End Kanban View Tab -->
                
                <!-- Summary Tab -->
                <div x-show="activeTab === 'summary'">
                  <div class="grid grid-cols-12 gap-4 md:gap-6">
                    
                    <!-- Metric Cards -->
                    <div class="col-span-12">
                      <div class="grid grid-cols-1 gap-4 sm:grid-cols-2 md:gap-6 xl:grid-cols-4">
                        
                        <!-- Total Tickets -->
                        <div class="rounded-2xl border border-gray-200 bg-white px-6 pb-5 pt-6 dark:border-gray-800" style="background-color: var(--card-bg, white);">
                          <div class="mb-6 flex items-center gap-3">
                            <div class="flex h-10 w-10 items-center justify-center rounded-full bg-blue-100 dark:bg-blue-900/20">
                              <svg class="h-6 w-6 text-blue-600 dark:text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path>
                              </svg>
                            </div>
                            <div>
                              <h3 class="text-base font-semibold text-gray-800 dark:text-white/90">Total Tickets</h3>
                              <span class="block !text-base text-gray-500 dark:text-gray-400">All tickets</span>
                            </div>
                          </div>
                          <div class="flex items-end justify-between">
                            <div>
                              <h4 id="summary-total-tasks" class="text-3xl font-bold text-gray-800 leading-none dark:text-white/90">0</h4>
                            </div>
                          </div>
                        </div>

                        <!-- Pending Tasks -->
                        <div class="rounded-2xl border border-gray-200 bg-white px-6 pb-5 pt-6 dark:border-gray-800" style="background-color: var(--card-bg, white);">
                          <div class="mb-6 flex items-center gap-3">
                            <div class="flex h-10 w-10 items-center justify-center rounded-full bg-amber-100 dark:bg-amber-900/20">
                              <svg class="h-6 w-6 text-amber-600 dark:text-amber-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                              </svg>
                            </div>
                            <div>
                              <h3 class="text-base font-semibold text-gray-800 dark:text-white/90">Pending</h3>
                              <span class="block !text-base text-gray-500 dark:text-gray-400">Not started</span>
                            </div>
                          </div>
                          <div class="flex items-end justify-between gap-3">
                            <div>
                              <h4 id="summary-pending-tasks" class="text-3xl font-bold text-gray-800 leading-none dark:text-white/90">0</h4>
                            </div>
                            <span class="flex items-center gap-1 rounded-full bg-amber-50 px-3 py-1 text-xl font-bold text-amber-600 leading-none dark:bg-amber-500/15 dark:text-amber-500" id="summary-pending-percentage">
                              0%
                            </span>
                          </div>
                        </div>

                        <!-- In Progress Tasks -->
                        <div class="rounded-2xl border border-gray-200 bg-white px-6 pb-5 pt-6 dark:border-gray-800" style="background-color: var(--card-bg, white);">
                          <div class="mb-6 flex items-center gap-3">
                            <div class="flex h-10 w-10 items-center justify-center rounded-full bg-orange-100 dark:bg-orange-900/20">
                              <svg class="h-6 w-6 text-orange-600 dark:text-orange-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                              </svg>
                            </div>
                            <div>
                              <h3 class="text-base font-semibold text-gray-800 dark:text-white/90">In Progress</h3>
                              <span class="block !text-base text-gray-500 dark:text-gray-400">Active</span>
                            </div>
                          </div>
                          <div class="flex items-end justify-between gap-3">
                            <div>
                              <h4 id="summary-inprogress-tasks" class="text-3xl font-bold text-gray-800 leading-none dark:text-white/90">0</h4>
                            </div>
                            <span class="flex items-center gap-1 rounded-full bg-orange-50 px-3 py-1 text-xl font-bold text-orange-600 leading-none dark:bg-orange-500/15 dark:text-orange-500" id="summary-inprogress-percentage">
                              0%
                            </span>
                          </div>
                        </div>

                        <!-- Completed Tasks -->
                        <div class="rounded-2xl border border-gray-200 bg-white px-6 pb-5 pt-6 dark:border-gray-800" style="background-color: var(--card-bg, white);">
                          <div class="mb-6 flex items-center gap-3">
                            <div class="flex h-10 w-10 items-center justify-center rounded-full bg-green-100 dark:bg-green-900/20">
                              <svg class="h-6 w-6 text-green-600 dark:text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                              </svg>
                            </div>
                            <div>
                              <h3 class="text-base font-semibold text-gray-800 dark:text-white/90">Completed</h3>
                              <span class="block !text-base text-gray-500 dark:text-gray-400">Finished</span>
                            </div>
                          </div>
                          <div class="flex items-end justify-between gap-3">
                            <div>
                              <h4 id="summary-completed-tasks" class="text-3xl font-bold text-gray-800 leading-none dark:text-white/90">0</h4>
                            </div>
                            <span class="flex items-center gap-1 rounded-full bg-success-50 px-3 py-1 text-xl font-bold text-success-600 leading-none dark:bg-success-500/15 dark:text-success-500" id="summary-completed-percentage">
                              0%
                            </span>
                          </div>
                        </div>

                      </div>
                    </div>

                    <!-- Close Date Metrics Row -->
                    <div class="col-span-12">
                      <div class="grid rounded-2xl border border-gray-200 bg-white sm:grid-cols-2 xl:grid-cols-3 dark:border-gray-800 dark:bg-gray-900">
                        
                        <!-- Average Days to Close -->
                        <div class="border-b border-gray-200 px-6 py-5 sm:border-r xl:border-b-0 dark:border-gray-800">
                          <span class="text-sm text-gray-500 dark:text-gray-400">Average Days to Close</span>
                          <div class="mt-2 flex items-end gap-3">
                            <h4 class="text-title-xs sm:text-title-sm font-bold text-gray-800 dark:text-white/90">
                              <span id="summary-avg-days-to-close">0</span> days
                            </h4>
                            <div>
                              <span class="bg-purple-50 text-purple-600 dark:bg-purple-500/15 dark:text-purple-500 flex items-center gap-1 rounded-full py-0.5 pr-2.5 pl-2 text-sm font-medium">
                                <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                                  <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"/>
                                </svg>
                              </span>
                            </div>
                          </div>
                        </div>

                        <!-- Fastest Close Time -->
                        <div class="border-b border-gray-200 px-6 py-5 xl:border-r xl:border-b-0 dark:border-gray-800">
                          <span class="text-sm text-gray-500 dark:text-gray-400">Fastest Resolution</span>
                          <div class="mt-2 flex items-end gap-3">
                            <h4 class="text-title-xs sm:text-title-sm font-bold text-gray-800 dark:text-white/90">
                              <span id="summary-fastest-close">0</span> days
                            </h4>
                            <div>
                              <span class="bg-success-50 text-success-600 dark:bg-success-500/15 dark:text-success-500 flex items-center gap-1 rounded-full py-0.5 pr-2.5 pl-2 text-sm font-medium">
                                <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                                  <path fill-rule="evenodd" d="M11.3 1.046A1 1 0 0112 2v5h4a1 1 0 01.82 1.573l-7 10A1 1 0 018 18v-5H4a1 1 0 01-.82-1.573l7-10a1 1 0 011.12-.38z" clip-rule="evenodd"/>
                                </svg>
                              </span>
                            </div>
                          </div>
                        </div>

                        <!-- Slowest Close Time -->
                        <div class="px-6 py-5">
                          <span class="text-sm text-gray-500 dark:text-gray-400">Slowest Resolution</span>
                          <div class="mt-2 flex items-end gap-3">
                            <h4 class="text-title-xs sm:text-title-sm font-bold text-gray-800 dark:text-white/90">
                              <span id="summary-slowest-close">0</span> days
                            </h4>
                            <div>
                              <span class="bg-error-50 text-error-600 dark:bg-error-500/15 dark:text-error-500 flex items-center gap-1 rounded-full py-0.5 pr-2.5 pl-2 text-sm font-medium">
                                <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                                  <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"/>
                                </svg>
                              </span>
                            </div>
                          </div>
                        </div>

                      </div>
                    </div>

                    <!-- Charts Row -->
                    <div class="col-span-12 grid grid-cols-1 gap-4 md:gap-6 lg:grid-cols-2">
                      
                      <!-- Ticket Status Distribution Chart -->
                      <div class="rounded-2xl border border-gray-200 bg-white px-5 pb-5 pt-5 dark:border-gray-800" style="background-color: var(--card-bg, white);">
                        <div class="mb-6 flex flex-col gap-5 sm:flex-row sm:items-center sm:justify-between">
                          <div>
                            <h3 class="text-lg font-semibold text-gray-800 dark:text-white/90">Tech Ticket Status Distribution</h3>
                            <p class="mt-1 !text-base text-gray-500 dark:text-gray-400">Current status of tickets raised to Tech team</p>
                          </div>
                        </div>
                        <div>
                          <div id="taskStatusChart" class="-ml-5"></div>
                        </div>
                      </div>

                      <!-- Ticket Priority Distribution Chart -->
                      <div class="rounded-2xl border border-gray-200 bg-white px-5 pb-5 pt-5 dark:border-gray-800" style="background-color: var(--card-bg, white);">
                        <div class="mb-6 flex items-center justify-between">
                          <div>
                            <h3 class="text-lg font-semibold text-gray-800 dark:text-white/90">Tech Ticket Priority Levels</h3>
                            <p class="mt-1 !text-base text-gray-500 dark:text-gray-400">Urgency distribution of tech support requests</p>
                          </div>
                        </div>
                        <div>
                          <div id="taskPriorityChart" class="-ml-5"></div>
                        </div>
                      </div>

                    </div>

                    <!-- Tickets Raised vs Resolved Chart -->
                    <div class="col-span-12">
                      <div class="rounded-2xl border border-gray-200 bg-white px-5 pb-5 pt-5 dark:border-gray-800" style="background-color: var(--card-bg, white);">
                        <div class="mb-6 flex flex-col gap-5 sm:flex-row sm:items-center sm:justify-between">
                          <div>
                            <h3 class="text-lg font-semibold text-gray-800 dark:text-white/90">Tickets Raised vs Resolved</h3>
                            <p class="mt-1 !text-base text-gray-500 dark:text-gray-400">Monthly trend of incoming tickets compared to resolved tickets</p>
                          </div>
                        </div>
                        <div class="max-w-full overflow-x-auto">
                          <div id="taskRegionChart" class="-ml-4 min-w-[600px] pl-2"></div>
                        </div>
                      </div>
                    </div>

                    <!-- Recent Tickets Table -->
                    <div class="col-span-12">
                      <div class="rounded-2xl border border-gray-200 bg-white dark:border-gray-800" style="background-color: var(--card-bg, white);">
                        <!-- Header with Title and Search -->
                        <div class="px-6 py-4 border-b border-gray-200 dark:border-gray-800">
                          <div class="flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between">
                            <div>
                              <h3 class="text-lg font-semibold text-gray-800 dark:text-white/90">Recent Tech Support Tickets</h3>
                              <p class="mt-1 !text-base text-gray-500 dark:text-gray-400">Latest tickets raised to the Tech team</p>
                            </div>
                            <!-- Search Input -->
                            <div class="relative w-full sm:w-64">
                              <span class="pointer-events-none absolute top-1/2 left-3 -translate-y-1/2">
                                <svg class="fill-gray-500 dark:fill-gray-400" width="18" height="18" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                                  <path fill-rule="evenodd" clip-rule="evenodd" d="M3.04199 9.37381C3.04199 5.87712 5.87735 3.04218 9.37533 3.04218C12.8733 3.04218 15.7087 5.87712 15.7087 9.37381C15.7087 12.8705 12.8733 15.7055 9.37533 15.7055C5.87735 15.7055 3.04199 12.8705 3.04199 9.37381ZM9.37533 1.54218C5.04926 1.54218 1.54199 5.04835 1.54199 9.37381C1.54199 13.6993 5.04926 17.2055 9.37533 17.2055C11.2676 17.2055 13.0032 16.5346 14.3572 15.4178L17.1773 18.2381C17.4702 18.531 17.945 18.5311 18.2379 18.2382C18.5308 17.9453 18.5309 17.4704 18.238 17.1775L15.4182 14.3575C16.5367 13.0035 17.2087 11.2671 17.2087 9.37381C17.2087 5.04835 13.7014 1.54218 9.37533 1.54218Z" fill="" />
                                </svg>
                              </span>
                              <input type="text" id="summaryTaskSearchInput" placeholder="Search tickets..." class="h-9 w-full rounded-lg border border-gray-300 bg-white py-2 pr-3 pl-9 !text-base text-gray-800 placeholder:text-gray-400 focus:border-brand-500 focus:ring-2 focus:ring-brand-500/10 focus:outline-none shadow-sm dark:border-gray-700 dark:bg-gray-800 dark:text-white dark:placeholder:text-gray-500" />
                            </div>
                          </div>
                        </div>
                        <!-- Table -->
                        <div class="custom-scrollbar overflow-x-auto">
                          <table class="min-w-full" id="summaryRecentTasksTable">
                            <thead>
                              <tr class="bg-gray-50 dark:bg-gray-800/50">
                                <th class="px-6 py-4 text-center !text-base font-medium whitespace-nowrap text-gray-500 dark:text-gray-400">Ticket ID</th>
                                <th class="px-6 py-4 text-center !text-base font-medium whitespace-nowrap text-gray-500 dark:text-gray-400">Description</th>
                                <th class="px-6 py-4 text-center !text-base font-medium whitespace-nowrap text-gray-500 dark:text-gray-400">Type</th>
                                <th class="px-6 py-4 text-center !text-base font-medium whitespace-nowrap text-gray-500 dark:text-gray-400">Status</th>
                                <th class="px-6 py-4 text-center !text-base font-medium whitespace-nowrap text-gray-500 dark:text-gray-400">Priority</th>
                                <th class="px-6 py-4 text-center !text-base font-medium whitespace-nowrap text-gray-500 dark:text-gray-400">Region</th>
                                <th class="px-6 py-4 text-center !text-base font-medium whitespace-nowrap text-gray-500 dark:text-gray-400">Submitted Date</th>
                              </tr>
                            </thead>
                            <tbody class="divide-y divide-gray-200 dark:divide-gray-700" id="summaryRecentTasksTableBody">
                              <!-- Table rows will be populated by JavaScript -->
                            </tbody>
                          </table>
                        </div>
                      </div>
                    </div>

                  </div>
                </div>
                <!-- End Summary Tab -->
                
              </div>
              <!-- End Tab Content -->
            </div>
            <!-- End Tabs -->
            
          </div>
        </div>
      </div>
    </main>
    <!-- ===== Main Content End ===== -->
    
    <!-- Add/Edit Task Modal -->
    <div
      class="fixed inset-0 items-center justify-center hidden p-5 overflow-y-auto modal z-[99999]"
      id="ticketModal"
    >
      <div class="modal-close-btn fixed inset-0 h-full w-full bg-gray-400/50 backdrop-blur-[32px]"></div>
      <div
        class="modal-dialog relative w-full max-w-[700px] rounded-3xl bg-white p-6 lg:p-10"
        style="background-color: var(--card-bg, white);"
      >
        <!-- Close button -->
        <button
          class="modal-close-btn group absolute right-3 top-3 z-999 flex h-9.5 w-9.5 items-center justify-center rounded-full bg-gray-200 text-gray-500 transition-colors hover:bg-gray-300 hover:text-gray-500 dark:bg-gray-800 dark:hover:bg-gray-700 sm:right-6 sm:top-6 sm:h-11 sm:w-11"
        >
          <svg class="fill-current transition-colors group-hover:text-gray-600 dark:group-hover:text-gray-200" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path fill-rule="evenodd" clip-rule="evenodd" d="M6.04289 16.5413C5.65237 16.9318 5.65237 17.565 6.04289 17.9555C6.43342 18.346 7.06658 18.346 7.45711 17.9555L11.9987 13.4139L16.5408 17.956C16.9313 18.3466 17.5645 18.3466 17.955 17.956C18.3455 17.5655 18.3455 16.9323 17.955 16.5418L13.4129 11.9997L17.955 7.4576C18.3455 7.06707 18.3455 6.43391 17.955 6.04338C17.5645 5.65286 16.9313 5.65286 16.5408 6.04338L11.9987 10.5855L7.45711 6.0439C7.06658 5.65338 6.43342 5.65338 6.04289 6.0439C5.65237 6.43442 5.65237 7.06759 6.04289 7.45811L10.5845 11.9997L6.04289 16.5413Z" fill=""/>
          </svg>
        </button>
        
        <form id="ticketForm" onsubmit="submitTicket(event)">
          <input type="hidden" id="ticket-id-internal" />
          <input type="hidden" id="ticket-parent-id" />
          
          <h4 class="mb-6 text-lg font-medium text-gray-800 dark:text-white/90" id="ticketModalTitle">
            Add Ticket
          </h4>
          
          <div class="grid grid-cols-1 gap-x-6 gap-y-5 sm:grid-cols-2">
            <!-- Report Name (Full Width) -->
            <div class="col-span-1 sm:col-span-2">
              <label class="mb-1.5 block !text-base font-medium text-gray-700 dark:text-gray-400">
                Ticket ID <span class="text-error-500">*</span>
              </label>
              <input
                type="text"
                id="ticket-id-field"
                required
                placeholder="Enter Jira ticket ID (e.g., TECH-1234)"
                class="h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 !text-base text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"
              />
            </div>
            
            <!-- Description (Full Width) -->
            <div class="col-span-1 sm:col-span-2">
              <label class="mb-1.5 block !text-base font-medium text-gray-700 dark:text-gray-400">
                Description
              </label>
              <textarea
                id="task-description"
                rows="2"
                placeholder="Enter task description"
                class="w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 !text-base text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"
              ></textarea>
            </div>
            
            <!-- Date Received -->
            <div class="col-span-1">
              <label class="mb-1.5 block !text-base font-medium text-gray-700 dark:text-gray-400">
                Submission Date <span class="text-error-500">*</span>
              </label>
              <input
                type="date"
                id="ticket-submission-date"
                required
                class="h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 !text-base text-gray-800 shadow-theme-xs focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:focus:border-brand-800"
              />
            </div>
            
            <!-- Status -->
            <div class="col-span-1" x-data="{ open: false, selected: 'Pending' }">
              <label class="mb-1.5 block !text-base font-medium text-gray-700 dark:text-gray-400">
                Status <span class="text-error-500">*</span>
              </label>
              <div class="relative">
                <button @click="open = !open" type="button"
                  class="inline-flex items-center justify-between w-full h-11 gap-2 rounded-lg border border-gray-300 bg-white px-4 py-2.5 !text-base font-medium text-gray-800 hover:bg-gray-50 shadow-theme-xs transition-colors dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:hover:bg-gray-800">
                  <span x-text="selected"></span>
                  <svg class="h-4 w-4 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                  </svg>
                </button>
                <div x-show="open" @click.outside="open = false" x-cloak
                  class="absolute left-0 right-0 top-full z-[99999] max-h-60 overflow-auto space-y-1 rounded-2xl border border-gray-200 bg-white p-2 shadow-theme-lg mt-2 dark:border-gray-700 dark:bg-gray-800">
                  <button type="button" @click="selected = 'Pending'; open = false; document.getElementById('task-status').value = 'Pending';"
                    :class="selected === 'Pending' ? 'bg-blue-50 text-blue-700 dark:bg-blue-900/30 dark:text-blue-400' : 'text-gray-700 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-700'"
                    class="flex w-full rounded-lg px-3 py-2 text-left !text-base font-medium transition-colors">
                    Pending
                  </button>
                  <button type="button" @click="selected = 'In Progress'; open = false; document.getElementById('task-status').value = 'In Progress';"
                    :class="selected === 'In Progress' ? 'bg-blue-50 text-blue-700 dark:bg-blue-900/30 dark:text-blue-400' : 'text-gray-700 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-700'"
                    class="flex w-full rounded-lg px-3 py-2 text-left !text-base font-medium transition-colors">
                    In Progress
                  </button>
                  <button type="button" @click="selected = 'Completed'; open = false; document.getElementById('task-status').value = 'Completed';"
                    :class="selected === 'Completed' ? 'bg-blue-50 text-blue-700 dark:bg-blue-900/30 dark:text-blue-400' : 'text-gray-700 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-700'"
                    class="flex w-full rounded-lg px-3 py-2 text-left !text-base font-medium transition-colors">
                    Completed
                  </button>
                  <button type="button" @click="selected = 'On Hold'; open = false; document.getElementById('task-status').value = 'On Hold';"
                    :class="selected === 'On Hold' ? 'bg-blue-50 text-blue-700 dark:bg-blue-900/30 dark:text-blue-400' : 'text-gray-700 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-700'"
                    class="flex w-full rounded-lg px-3 py-2 text-left !text-base font-medium transition-colors">
                    On Hold
                  </button>
                  <button type="button" @click="selected = 'Cancelled'; open = false; document.getElementById('task-status').value = 'Cancelled';"
                    :class="selected === 'Cancelled' ? 'bg-blue-50 text-blue-700 dark:bg-blue-900/30 dark:text-blue-400' : 'text-gray-700 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-700'"
                    class="flex w-full rounded-lg px-3 py-2 text-left !text-base font-medium transition-colors">
                    Cancelled
                  </button>
                </div>
                <input type="hidden" id="task-status" value="Pending" required />
              </div>
            </div>
            
            <!-- Maker -->
            <div class="col-span-1" x-data="{ open: false, selected: 'Requested By', selectedValue: '' }" x-init="$watch('open', value => { if(value) { /* Populate from teamMembers */ } })">
              <label class="mb-1.5 block !text-base font-medium text-gray-700 dark:text-gray-400">
                Requested By <span class="text-error-500">*</span>
              </label>
              <div class="relative">
                <button @click="open = !open" type="button"
                  class="inline-flex items-center justify-between w-full h-11 gap-2 rounded-lg border border-gray-300 bg-white px-4 py-2.5 !text-base font-medium text-gray-800 hover:bg-gray-50 shadow-theme-xs transition-colors dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:hover:bg-gray-800">
                  <span x-text="selected" :class="selected === 'Select Requested By' ? 'text-gray-400 dark:text-gray-500' : ''"></span>
                  <svg class="h-4 w-4 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                  </svg>
                </button>
                <div x-show="open" @click.outside="open = false" x-cloak id="ticket-requested-by-dropdown"
                  class="absolute left-0 right-0 top-full z-[99999] max-h-60 overflow-auto space-y-1 rounded-2xl border border-gray-200 bg-white p-2 shadow-theme-lg mt-2 dark:border-gray-700 dark:bg-gray-800">
                  <!-- Options will be populated dynamically -->
                </div>
                <input type="hidden" id="ticket-requested-by" required />
              </div>
            </div>
            
            <!-- Team in Charge -->
            <div class="col-span-1">
              <label class="mb-1.5 block !text-base font-medium text-gray-700 dark:text-gray-400">
                Team in Charge <span class="text-error-500">*</span>
              </label>
              <input
                type="text"
                id="ticket-team-in-charge"
                required
                placeholder="Enter team name (e.g., IT Support, DevOps)"
                class="h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 !text-base text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"
              />
            </div>
            
            <!-- Region -->
            <div class="col-span-1" x-data="{ open: false, selected: 'Select Ticket Type' }">
              <label class="mb-1.5 block !text-base font-medium text-gray-700 dark:text-gray-400">
                Ticket Type <span class="text-error-500">*</span>
              </label>
              <div class="relative">
                <button @click="open = !open" type="button"
                  class="inline-flex items-center justify-between w-full h-11 gap-2 rounded-lg border border-gray-300 bg-white px-4 py-2.5 !text-base font-medium text-gray-800 hover:bg-gray-50 shadow-theme-xs transition-colors dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:hover:bg-gray-800">
                  <span x-text="selected" :class="selected === 'Select Ticket Type' ? 'text-gray-400 dark:text-gray-500' : ''"></span>
                  <svg class="h-4 w-4 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                  </svg>
                </button>
                <div x-show="open" @click.outside="open = false" x-cloak
                  class="absolute left-0 right-0 top-full z-[99999] max-h-60 overflow-auto space-y-1 rounded-2xl border border-gray-200 bg-white p-2 shadow-theme-lg mt-2 dark:border-gray-700 dark:bg-gray-800">
                  <button type="button" @click="selected = 'Bug'; open = false; document.getElementById('ticket-type').value = 'Bug';"
                    :class="selected === 'Bug' ? 'bg-blue-50 text-blue-700 dark:bg-blue-900/30 dark:text-blue-400' : 'text-gray-700 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-700'"
                    class="flex w-full rounded-lg px-3 py-2 text-left !text-base font-medium transition-colors">
                    Bug
                  </button>
                  <button type="button" @click="selected = 'Feature Request'; open = false; document.getElementById('ticket-type').value = 'Feature Request';"
                    :class="selected === 'Feature Request' ? 'bg-blue-50 text-blue-700 dark:bg-blue-900/30 dark:text-blue-400' : 'text-gray-700 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-700'"
                    class="flex w-full rounded-lg px-3 py-2 text-left !text-base font-medium transition-colors">
                    Feature Request
                  </button>
                  <button type="button" @click="selected = 'Support'; open = false; document.getElementById('ticket-type').value = 'Support';"
                    :class="selected === 'Support' ? 'bg-blue-50 text-blue-700 dark:bg-blue-900/30 dark:text-blue-400' : 'text-gray-700 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-700'"
                    class="flex w-full rounded-lg px-3 py-2 text-left !text-base font-medium transition-colors">
                    Support
                  </button>
                  <button type="button" @click="selected = 'Enhancement'; open = false; document.getElementById('ticket-type').value = 'Enhancement';"
                    :class="selected === 'Enhancement' ? 'bg-blue-50 text-blue-700 dark:bg-blue-900/30 dark:text-blue-400' : 'text-gray-700 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-700'"
                    class="flex w-full rounded-lg px-3 py-2 text-left !text-base font-medium transition-colors">
                    Enhancement
                  </button>
                  <button type="button" @click="selected = 'Investigation'; open = false; document.getElementById('ticket-type').value = 'Investigation';"
                    :class="selected === 'Investigation' ? 'bg-blue-50 text-blue-700 dark:bg-blue-900/30 dark:text-blue-400' : 'text-gray-700 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-700'"
                    class="flex w-full rounded-lg px-3 py-2 text-left !text-base font-medium transition-colors">
                    Investigation
                  </button>
                </div>
                <input type="hidden" id="task-region" required />
              </div>
            </div>
            
            <!-- Requestor Region -->
            <div class="col-span-1" x-data="{ open: false, selected: 'Select Requestor Region' }">
              <label class="mb-1.5 block !text-base font-medium text-gray-700 dark:text-gray-400">
                Requestor Region
              </label>
              <div class="relative">
                <button @click="open = !open" type="button"
                  class="inline-flex items-center justify-between w-full h-11 gap-2 rounded-lg border border-gray-300 bg-white px-4 py-2.5 !text-base font-medium text-gray-800 hover:bg-gray-50 shadow-theme-xs transition-colors dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:hover:bg-gray-800">
                  <span x-text="selected" :class="selected === 'Select Requestor Region' ? 'text-gray-400 dark:text-gray-500' : ''"></span>
                  <svg class="h-4 w-4 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                  </svg>
                </button>
                <div x-show="open" @click.outside="open = false" x-cloak
                  class="absolute left-0 right-0 top-full z-[99999] max-h-60 overflow-auto space-y-1 rounded-2xl border border-gray-200 bg-white p-2 shadow-theme-lg mt-2 dark:border-gray-700 dark:bg-gray-800">
                  <button type="button" @click="selected = 'APAC'; open = false; document.getElementById('task-requestor-region').value = 'APAC';"
                    :class="selected === 'APAC' ? 'bg-blue-50 text-blue-700 dark:bg-blue-900/30 dark:text-blue-400' : 'text-gray-700 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-700'"
                    class="flex w-full rounded-lg px-3 py-2 text-left !text-base font-medium transition-colors">
                    APAC
                  </button>
                  <button type="button" @click="selected = 'EMEA'; open = false; document.getElementById('task-requestor-region').value = 'EMEA';"
                    :class="selected === 'EMEA' ? 'bg-blue-50 text-blue-700 dark:bg-blue-900/30 dark:text-blue-400' : 'text-gray-700 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-700'"
                    class="flex w-full rounded-lg px-3 py-2 text-left !text-base font-medium transition-colors">
                    EMEA
                  </button>
                  <button type="button" @click="selected = 'NAM'; open = false; document.getElementById('task-requestor-region').value = 'NAM';"
                    :class="selected === 'NAM' ? 'bg-blue-50 text-blue-700 dark:bg-blue-900/30 dark:text-blue-400' : 'text-gray-700 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-700'"
                    class="flex w-full rounded-lg px-3 py-2 text-left !text-base font-medium transition-colors">
                    NAM
                  </button>
                  <button type="button" @click="selected = 'LATAM'; open = false; document.getElementById('task-requestor-region').value = 'LATAM';"
                    :class="selected === 'LATAM' ? 'bg-blue-50 text-blue-700 dark:bg-blue-900/30 dark:text-blue-400' : 'text-gray-700 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-700'"
                    class="flex w-full rounded-lg px-3 py-2 text-left !text-base font-medium transition-colors">
                    LATAM
                  </button>
                </div>
                <input type="hidden" id="task-requestor-region" />
              </div>
            </div>
            
            <!-- Time Spent -->
            <div class="col-span-1">
              <label class="mb-1.5 block !text-base font-medium text-gray-700 dark:text-gray-400">
                Time Spent (hours)
              </label>
              <input
                type="number"
                id="task-time-spent"
                min="0"
                step="0.5"
                placeholder="0.0"
                class="h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 !text-base text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"
              />
            </div>
            
            <!-- Priority (New Field) -->
            <div class="col-span-1" x-data="{ open: false, selected: 'Select Priority' }">
              <label class="mb-1.5 block !text-base font-medium text-gray-700 dark:text-gray-400">
                Priority
              </label>
              <div class="relative">
                <button @click="open = !open" type="button"
                  class="inline-flex items-center justify-between w-full h-11 gap-2 rounded-lg border border-gray-300 bg-white px-4 py-2.5 !text-base font-medium text-gray-800 hover:bg-gray-50 shadow-theme-xs transition-colors dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:hover:bg-gray-800">
                  <span x-text="selected" :class="selected === 'Select Priority' ? 'text-gray-400 dark:text-gray-500' : ''"></span>
                  <svg class="h-4 w-4 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                  </svg>
                </button>
                <div x-show="open" @click.outside="open = false" x-cloak
                  class="absolute left-0 right-0 top-full z-[99999] max-h-60 overflow-auto space-y-1 rounded-2xl border border-gray-200 bg-white p-2 shadow-theme-lg mt-2 dark:border-gray-700 dark:bg-gray-800">
                  <button type="button" @click="selected = 'Low'; open = false; document.getElementById('task-priority').value = 'Low';"
                    :class="selected === 'Low' ? 'bg-blue-50 text-blue-700 dark:bg-blue-900/30 dark:text-blue-400' : 'text-gray-700 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-700'"
                    class="flex w-full rounded-lg px-3 py-2 text-left !text-base font-medium transition-colors">
                    Low
                  </button>
                  <button type="button" @click="selected = 'Medium'; open = false; document.getElementById('task-priority').value = 'Medium';"
                    :class="selected === 'Medium' ? 'bg-blue-50 text-blue-700 dark:bg-blue-900/30 dark:text-blue-400' : 'text-gray-700 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-700'"
                    class="flex w-full rounded-lg px-3 py-2 text-left !text-base font-medium transition-colors">
                    Medium
                  </button>
                  <button type="button" @click="selected = 'High'; open = false; document.getElementById('task-priority').value = 'High';"
                    :class="selected === 'High' ? 'bg-blue-50 text-blue-700 dark:bg-blue-900/30 dark:text-blue-400' : 'text-gray-700 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-700'"
                    class="flex w-full rounded-lg px-3 py-2 text-left !text-base font-medium transition-colors">
                    High
                  </button>
                  <button type="button" @click="selected = 'Urgent'; open = false; document.getElementById('task-priority').value = 'Urgent';"
                    :class="selected === 'Urgent' ? 'bg-blue-50 text-blue-700 dark:bg-blue-900/30 dark:text-blue-400' : 'text-gray-700 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-700'"
                    class="flex w-full rounded-lg px-3 py-2 text-left !text-base font-medium transition-colors">
                    Urgent
                  </button>
                </div>
                <input type="hidden" id="task-priority" />
              </div>
            </div>
          </div>
          
          <div class="flex items-center justify-end w-full gap-3 mt-6">
            <button
              type="button"
              onclick="closeTicketModal()"
              class="modal-close-btn flex w-full justify-center rounded-lg border border-gray-300 bg-white px-4 py-3 !text-base font-medium text-gray-700 shadow-theme-xs transition-colors hover:bg-gray-50 hover:text-gray-800 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-400 dark:hover:bg-white/[0.03] dark:hover:text-gray-200 sm:w-auto"
            >
              Cancel
            </button>
            <button
              type="submit"
              class="flex justify-center w-full px-4 py-3 !text-base font-medium text-white rounded-lg bg-brand-500 shadow-theme-xs hover:bg-brand-600 sm:w-auto"
            >
              Save Ticket
            </button>
          </div>
        </form>
      </div>
    </div>
    </div>
    
    <script>
      // Global variables
      let tickets = [];
      let filteredTickets = [];
      let teamMembers = [];
      let currentPage = 1;
      let itemsPerPage = 25;
      let expandedTickets = new Set();
      let kanbanSearchTerm = '';
      let kanbanStatusFilter = 'All';
      
      // Fetch team members from leave tracker
      async function fetchTeamMembers() {
        try {
          const response = await fetch('https://cedt-confluence.net/confluence/download/attachments/2740868871/team_members.json?api=v2');
          
          if (!response.ok) {
            console.warn('Team members file not found');
            return [];
          }
          
          const data = await response.json();
          
          if (data.members && Array.isArray(data.members)) {
            return data.members;
          } else if (Array.isArray(data)) {
            return data;
          } else {
            return [];
          }
        } catch (error) {
          console.error('Error fetching team members:', error);
          return [];
        }
      }
      
      // Fetch tasks from Confluence
      async function fetchTickets() {
        try {
          const response = await fetch('https://cedt-confluence.net/confluence/download/attachments/2740868871/tech_jira_tickets.json?api=v2');
          
          if (!response.ok) {
            if (response.status === 404) {
            } else {
              console.warn(' Could not fetch tickets file:', response.status, response.statusText);
            }
            return [];
          }
          
          const data = await response.json();
          
          if (data.tickets && Array.isArray(data.tickets)) {
            return data.tickets;
          } else if (Array.isArray(data)) {
            return data;
          } else {
            console.warn(' Unexpected data format in tech_jira_tickets.json');
            return [];
          }
        } catch (error) {
          console.error(' Error fetching tickets:', error);
          return [];
        }
      }
      
      // Update tasks in Confluence
      // This function handles both creating a new tech_jira_tickets.json file (if it doesn't exist)
      // and updating an existing file. It automatically detects which operation to perform.
      async function updateTicketsFile(ticketsData) {
        try {
          let attachmentId = null;
          let fileExists = false;
          
          // Check if the file already exists in Confluence attachments
          try {
            const attachmentsResponse = await fetch('https://cedt-confluence.net/confluence/rest/api/content/2740868871/child/attachment?filename=tech_jira_tickets.json');
            
            if (attachmentsResponse.ok) {
              const attachmentsData = await attachmentsResponse.json();
              
              if (attachmentsData.results && attachmentsData.results.length > 0) {
                attachmentId = attachmentsData.results[0].id;
                fileExists = true;
              } else {
              }
            }
          } catch (checkError) {
            console.warn(' Could not check for existing file (might be local dev):', checkError);
          }
          
          const dataToSave = {
            tickets: ticketsData,
            metadata: {
              lastUpdated: new Date().toISOString(),
              totalTickets: ticketsData.length,
              version: '1.0'
            }
          };
          
          const formData = new FormData();
          const blob = new Blob([JSON.stringify(dataToSave, null, 2)], { type: 'application/json' });
          formData.append('file', blob, 'tech_jira_tickets.json');
          
          // If file exists, update it (use /{attachmentId}), otherwise create new (no ID in URL)
          const endpoint = attachmentId 
            ? `https://cedt-confluence.net/confluence/rest/api/content/2740868871/child/attachment/${attachmentId}/data`
            : `https://cedt-confluence.net/confluence/rest/api/content/2740868871/child/attachment`;
          
          
          const response = await fetch(endpoint, {
            method: 'POST',
            headers: {
              'X-Atlassian-Token': 'no-check'
            },
            body: formData
          });
          
          if (!response.ok) {
            const errorText = await response.text();
            console.error(' Server response:', response.status, errorText);
            throw new Error(`Failed to ${fileExists ? 'update' : 'create'} tasks file: ${response.status} ${response.statusText}`);
          }
          
          return true;
        } catch (error) {
          console.error(' Error updating tasks file:', error);
          // Don't throw in local dev environment
          if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {
            console.warn(' Running in local dev mode. File update skipped.');
            return true;
          }
          throw error;
        }
      }
      
      // Populate team member dropdowns
      function populateTeamMemberDropdowns() {
        const requestedByDropdown = document.getElementById('ticket-requested-by-dropdown');
        
        const requestedByOptions = teamMembers.map(member => `
          <button type="button" 
            onclick="setDropdownValue('ticket-requested-by', '${member.id}', '${member.name}'); this.closest('[x-data]').__x.$data.selected = '${member.name}'; this.closest('[x-data]').__x.$data.open = false;"
            class="flex w-full rounded-lg px-3 py-2 text-left !text-base font-medium text-gray-700 hover:bg-gray-100 transition-colors dark:text-gray-300 dark:hover:bg-gray-700">
            ${member.name}
          </button>
        `).join('');
        
        if (requestedByDropdown) requestedByDropdown.innerHTML = requestedByOptions;
      }
      
      // Helper function to set dropdown values
      function setDropdownValue(fieldId, value, displayText) {
        const field = document.getElementById(fieldId);
        if (field) field.value = value;
      }
      
      // Expand all parent tasks by default
      function expandAllParentTasks() {
        const parentTasks = tickets.filter(t => !t.parentId);
        parentTasks.forEach(parent => {
          const hasChildren = tickets.some(t => t.parentId === parent.id);
          if (hasChildren) {
            expandedTickets.add(parent.id);
          }
        });
      }
      
      // Get task numbering (e.g., "1", "1.1", "1.2", "2", etc.)
      function getTaskNumber(task) {
        if (!task.parentId) {
          // Parent task - find its index among all parent tasks
          const parentTasks = tickets.filter(t => !t.parentId);
          const index = parentTasks.findIndex(t => t.id === task.id);
          return `${index + 1}`;
        } else {
          // Child task - find parent's number and child's index
          const parent = tickets.find(t => t.id === task.parentId);
          if (!parent) return '?';
          
          const parentNumber = getTaskNumber(parent);
          const siblings = tickets.filter(t => t.parentId === task.parentId);
          const childIndex = siblings.findIndex(t => t.id === task.id);
          return `${parentNumber}.${childIndex + 1}`;
        }
      }
      
      // Get status SVG icon
      function getStatusIcon(status, className = "w-5 h-5") {
        const icons = {
          'Pending': `<svg class="${className}" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>`,
          'In Progress': `<svg class="${className}" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg>`,
          'Completed': `<svg class="${className}" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>`,
          'On Hold': `<svg class="${className}" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 9v6m4-6v6m7-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>`,
          'Cancelled': `<svg class="${className}" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>`
        };
        return icons[status] || icons['Pending'];
      }
      
      // Get status dropdown HTML
      function getStatusDropdown(taskId, currentStatus) {
        const statusConfig = {
          'Pending': { class: 'bg-warning-50 text-warning-600 dark:bg-warning-900/20 dark:text-warning-400' },
          'In Progress': { class: 'bg-blue-50 text-blue-600 dark:bg-blue-900/20 dark:text-blue-400' },
          'Completed': { class: 'bg-success-50 text-success-600 dark:bg-success-900/20 dark:text-success-400' },
          'On Hold': { class: 'bg-gray-50 text-gray-600 dark:bg-gray-900/20 dark:text-gray-400' },
          'Cancelled': { class: 'bg-error-50 text-error-600 dark:bg-error-900/20 dark:text-error-400' }
        };
        
        const current = statusConfig[currentStatus] || statusConfig['Pending'];
        const badgeClass = current.class;
        const dropdownId = `dropdown-${taskId}`;
        
        return `
          <div x-data="{ 
            open: false,
            positionDropdown() {
              if (this.open) {
                const button = this.$refs.button;
                const dropdown = this.$refs.dropdown;
                const rect = button.getBoundingClientRect();
                dropdown.style.top = (rect.bottom + 4) + 'px';
                dropdown.style.left = rect.left + 'px';
              }
            }
          }" 
          class="inline-block" 
          @click.away="open = false"
          x-init="$watch('open', value => positionDropdown())">
            <button 
              x-ref="button"
              @click="open = !open" 
              class="inline-flex items-center gap-1 rounded-full px-2.5 py-0.5 !text-base font-medium ${badgeClass} hover:opacity-80 transition-opacity cursor-pointer whitespace-nowrap">
              ${getStatusIcon(currentStatus)}
              <span>${currentStatus}</span>
              <svg class="w-3 h-3 ml-0.5 transition-transform" :class="open ? 'rotate-180' : ''" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
              </svg>
            </button>
            
            <div x-ref="dropdown"
                 x-show="open" 
                 x-cloak
                 x-transition:enter="transition ease-out duration-100"
                 x-transition:enter-start="opacity-0 scale-95"
                 x-transition:enter-end="opacity-100 scale-100"
                 x-transition:leave="transition ease-in duration-75"
                 x-transition:leave-start="opacity-100 scale-100"
                 x-transition:leave-end="opacity-0 scale-95"
                 class="fixed w-44 rounded-lg border border-gray-200 bg-white shadow-xl dark:border-gray-700 dark:bg-gray-800"
                 style="display: none; z-index: 99999;"
                 @click.stop>
              <div class="py-1">
                ${Object.keys(statusConfig).map(status => `
                  <button onclick="changeTaskStatus('${taskId}', '${status}'); event.stopPropagation();" 
                          class="flex w-full items-center gap-2 px-3 py-2 !text-base text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors ${status === currentStatus ? 'bg-gray-50 dark:bg-gray-700' : ''}">
                    ${getStatusIcon(status, 'w-4 h-4')}
                    <span class="font-medium">${status}</span>
                  </button>
                `).join('')}
              </div>
            </div>
          </div>
        `;
      }
      
      // Calculate days pending from submission date to today
      function calculateDaysPending(submissionDate) {
        if (!submissionDate) return 0;
        const today = new Date();
        const submitted = new Date(submissionDate);
        const diffTime = Math.abs(today - submitted);
        const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
        return diffDays;
      }
      
      // Get ticket type badge HTML
      function getTicketTypeBadge(ticketType) {
        if (!ticketType) return '<span class="!text-base text-gray-400 dark:text-gray-500">-</span>';
        
        const typeConfig = {
          'Bug': 'bg-red-50 text-red-600 dark:bg-red-900/20 dark:text-red-400',
          'Feature Request': 'bg-blue-50 text-blue-600 dark:bg-blue-900/20 dark:text-blue-400',
          'Support': 'bg-green-50 text-green-600 dark:bg-green-900/20 dark:text-green-400',
          'Enhancement': 'bg-purple-50 text-purple-600 dark:bg-purple-900/20 dark:text-purple-400',
          'Investigation': 'bg-orange-50 text-orange-600 dark:bg-orange-900/20 dark:text-orange-400'
        };
        
        const badgeClass = typeConfig[ticketType] || 'bg-gray-50 text-gray-600 dark:bg-gray-900/20 dark:text-gray-400';
        return `<span class="inline-flex items-center whitespace-nowrap rounded-full px-2.5 py-0.5 !text-base font-medium ${badgeClass}">${ticketType}</span>`;
      }
      
      // Get priority badge with SVG icon
      function getPriorityBadge(priority) {
        if (!priority) return '<span class="!text-base text-gray-400 dark:text-gray-500">-</span>';
        
        const priorityConfig = {
          'Low': {
            class: 'bg-gray-100 text-gray-700 dark:bg-gray-800 dark:text-gray-300',
            svg: `<svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M5.293 9.707a1 1 0 010-1.414l4-4a1 1 0 011.414 0l4 4a1 1 0 01-1.414 1.414L11 7.414V15a1 1 0 11-2 0V7.414L6.707 9.707a1 1 0 01-1.414 0z" clip-rule="evenodd"/></svg>`
          },
          'Medium': {
            class: 'bg-blue-50 text-blue-600 dark:bg-blue-900/20 dark:text-blue-400',
            svg: `<svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"/></svg>`
          },
          'High': {
            class: 'bg-orange-50 text-orange-600 dark:bg-orange-900/20 dark:text-orange-400',
            svg: `<svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M14.707 10.293a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 111.414-1.414L9 12.586V5a1 1 0 012 0v7.586l2.293-2.293a1 1 0 011.414 0z" clip-rule="evenodd"/></svg>`
          },
          'Urgent': {
            class: 'bg-red-50 text-red-600 dark:bg-red-900/20 dark:text-red-400',
            svg: `<svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"/></svg>`
          }
        };
        
        const config = priorityConfig[priority] || priorityConfig['Low'];
        return `<span class="inline-flex items-center whitespace-nowrap gap-1 rounded-full px-2.5 py-0.5 !text-base font-medium ${config.class}">${config.svg}${priority}</span>`;
      }
      
      function getRegionBadge(region) {
        if (!region) return '<span class="!text-base text-gray-400 dark:text-gray-500">-</span>';
        
        const regionConfig = {
          'NAM': {
            class: 'bg-blue-50 text-blue-600 dark:bg-blue-900/20 dark:text-blue-400'   },
          'EMEA': {
            class: 'bg-purple-50 text-purple-600 dark:bg-purple-900/20 dark:text-purple-400'     },
          'APAC': {
            class: 'bg-green-50 text-green-600 dark:bg-green-900/20 dark:text-green-400'          },
          'LATAM': {
            class: 'bg-amber-50 text-amber-600 dark:bg-amber-900/20 dark:text-amber-400'          }
        };
        
        const config = regionConfig[region] || { class: 'bg-gray-100 text-gray-700 dark:bg-gray-800 dark:text-gray-300', icon: '' };
        return `<span class="inline-flex items-center whitespace-nowrap gap-1 rounded-full px-2.5 py-0.5 !text-base font-medium ${config.class}">${region}</span>`;
      }
      
      function getTicketTypeBadge(type) {
        if (!type) return '<span class="!text-base text-gray-400 dark:text-gray-500">-</span>';
        
        const typeConfig = {
          'Bug': {
            class: 'bg-red-50 text-red-600 dark:bg-red-900/20 dark:text-red-400',
            svg: `<svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"/></svg>`
          },
          'Feature Request': {
            class: 'bg-blue-50 text-blue-600 dark:bg-blue-900/20 dark:text-blue-400',
            svg: `<svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M11.3 1.046A1 1 0 0112 2v5h4a1 1 0 01.82 1.573l-7 10A1 1 0 018 18v-5H4a1 1 0 01-.82-1.573l7-10a1 1 0 011.12-.38z" clip-rule="evenodd"/></svg>`
          },
          'Enhancement': {
            class: 'bg-purple-50 text-purple-600 dark:bg-purple-900/20 dark:text-purple-400',
            svg: `<svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20"><path d="M11 3a1 1 0 10-2 0v1a1 1 0 102 0V3zM15.657 5.757a1 1 0 00-1.414-1.414l-.707.707a1 1 0 001.414 1.414l.707-.707zM18 10a1 1 0 01-1 1h-1a1 1 0 110-2h1a1 1 0 011 1zM5.05 6.464A1 1 0 106.464 5.05l-.707-.707a1 1 0 00-1.414 1.414l.707.707zM5 10a1 1 0 01-1 1H3a1 1 0 110-2h1a1 1 0 011 1zM8 16v-1h4v1a2 2 0 11-4 0zM12 14c.015-.34.208-.646.477-.859a4 4 0 10-4.954 0c.27.213.462.519.476.859h4.002z"/></svg>`
          },
          'Support': {
            class: 'bg-green-50 text-green-600 dark:bg-green-900/20 dark:text-green-400',
            svg: `<svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-3a1 1 0 00-.867.5 1 1 0 11-1.731-1A3 3 0 0113 8a3.001 3.001 0 01-2 2.83V11a1 1 0 11-2 0v-1a1 1 0 011-1 1 1 0 100-2zm0 8a1 1 0 100-2 1 1 0 000 2z" clip-rule="evenodd"/></svg>`
          },
          'Investigation': {
            class: 'bg-amber-50 text-amber-600 dark:bg-amber-900/20 dark:text-amber-400',
            svg: `<svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20"><path d="M9 9a2 2 0 114 0 2 2 0 01-4 0z"/><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-13a4 4 0 00-3.446 6.032l-2.261 2.26a1 1 0 101.414 1.415l2.261-2.261A4 4 0 1011 5z" clip-rule="evenodd"/></svg>`
          },
          'Update': {
            class: 'bg-gray-50 text-gray-600 dark:bg-gray-800 dark:text-gray-400',
            svg: `<svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 010 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z" clip-rule="evenodd"/></svg>`
          }
        };
        
        const config = typeConfig[type] || typeConfig['Update'];
        return `<span class="inline-flex items-center whitespace-nowrap gap-1 rounded-full px-2.5 py-0.5 !text-base font-medium ${config.class}">${config.svg}${type}</span>`;
      }
      
      // Change task status
      async function changeTaskStatus(taskId, newStatus) {
        try {
          const task = tickets.find(t => t.id === taskId);
          if (!task) return;
          
          const oldStatus = task.status;
          task.status = newStatus;
          task.updatedAt = new Date().toISOString();
          
          // Auto-populate close date when status changes to Completed
          if (newStatus === 'Completed' && oldStatus !== 'Completed') {
            task.closeDate = new Date().toISOString().split('T')[0];
            showSuccessToast(`Status updated to "Completed" - Close date set to today`);
          } else if (newStatus !== 'Completed' && task.closeDate) {
            // Remove close date if status changed away from Completed
            delete task.closeDate;
            showSuccessToast(`Status updated to "${newStatus}" - Close date removed`);
          } else {
            showSuccessToast(`Status updated to "${newStatus}"`);
          }
          
          await updateTicketsFile(tickets);
          filteredTickets = [...tickets];
          renderAllViews();
        } catch (error) {
          console.error('Error updating status:', error);
          showErrorToast('Failed to update status. Please try again.');
        }
      }
      
      // Get inline editable hours HTML
      function getInlineHoursEditor(taskId, hours) {
        return `
          <div x-data="{ editing: false, value: ${hours || 0} }" class="inline-block">
            <div x-show="!editing" @click="editing = true; $nextTick(() => $refs.input.focus())" class="cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700 rounded px-2 py-1 transition-colors">
              <span class="!text-base font-medium text-gray-900 dark:text-white">\${value}</span>
            </div>
            <div x-show="editing" x-cloak class="inline-flex items-center gap-1">
              <input 
                x-ref="input"
                type="number" 
                step="0.5"
                min="0"
                x-model="value"
                @blur="editing = false; updateTaskHours('${taskId}', value)"
                @keydown.enter="editing = false; updateTaskHours('${taskId}', value)"
                @keydown.escape="editing = false; value = ${hours || 0}"
                class="w-16 h-7 px-2 !text-base text-center border border-blue-500 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-800 dark:text-white dark:border-blue-400"
              />
            </div>
          </div>
        `;
      }
      
      // Update task hours
      async function updateTaskHours(taskId, newHours) {
        try {
          const task = tickets.find(t => t.id === taskId);
          if (!task) return;
          
          const hours = parseFloat(newHours) || 0;
          task.timeSpent = hours;
          task.updatedAt = new Date().toISOString();
          
          await updateTicketsFile(tickets);
          filteredTickets = [...tickets];
          
          showSuccessToast(`Time updated to ${hours} hours`);
        } catch (error) {
          console.error('Error updating hours:', error);
          showErrorToast('Failed to update hours. Please try again.');
        }
      }
      
      // Render tasks table
      function renderTicketsTable() {
        const tbody = document.getElementById('ticketsTableBody');
        
        if (filteredTickets.length === 0) {
          tbody.innerHTML = `
            <tr>
              <td colspan="11" class="px-6 py-12 text-center">
                <div class="flex flex-col items-center justify-center">
                  <svg class="h-12 w-12 text-gray-400 dark:text-gray-600 mb-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path>
                  </svg>
                  <p class="!text-base font-medium text-gray-500 dark:text-gray-400">No tickets found</p>
                  <p class="!text-base text-gray-400 dark:text-gray-500 mt-1">Click "Add Ticket" to get started</p>
                </div>
              </td>
            </tr>
          `;
          updatePaginationInfo();
          return;
        }
        
        // Get parent tickets for current page - Using PAL-dashboard pagination pattern
        const parentTickets = filteredTickets.filter(t => !t.parentId);
        const start = (currentPage - 1) * itemsPerPage;
        const end = Math.min(start + itemsPerPage, parentTickets.length);
        const pageParentTickets = parentTickets.slice(start, end);
              
        let html = '';
        
        pageParentTickets.forEach(task => {
          const taskNumber = getTaskNumber(task);
          const isExpanded = expandedTickets.has(task.id);
          const childTasks = tickets.filter(t => t.parentId === task.id);
          const hasChildren = childTasks.length > 0;
          
          const maker = teamMembers.find(m => m.id === task.makerId);
          const requestor = teamMembers.find(m => m.id === task.requestorId);
          
          // Parent task row
          const isCompleted = task.status === 'Completed';
          const daysToClose = task.closeDate && task.dateReceived 
            ? Math.floor((new Date(task.closeDate) - new Date(task.dateReceived)) / (1000 * 60 * 60 * 24))
            : (isCompleted && task.dateReceived 
                ? Math.floor((new Date() - new Date(task.dateReceived)) / (1000 * 60 * 60 * 24))
                : 0);
          
          html += `
            <tr class="hover:bg-gray-50 dark:hover:bg-gray-800/50 transition-colors task-row-parent ${hasChildren ? 'cursor-pointer' : ''}" ${hasChildren ? `onclick="toggleTaskExpansion('${task.id}')"` : `onclick="editTicket('${task.id}')"`}>
              <td class="px-6 py-4 whitespace-nowrap">
                <div class="flex items-center gap-2">
                  ${hasChildren ? `
                    <svg class="w-4 h-4 text-gray-400 expand-icon ${isExpanded ? 'expanded' : ''}" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                    </svg>
                  ` : '<div class="w-4"></div>'}
                  <span class="!text-base font-mono text-blue-600 dark:text-blue-400">${task.ticketId || taskNumber}</span>
                </div>
              </td>
              <td class="px-6 py-4 text-center whitespace-nowrap">
                ${getTicketTypeBadge(task.ticketType)}
              </td>
              <td class="px-6 py-4 text-left" style="max-width: 400px; min-width: 250px;">
                <div class="!text-base font-medium text-gray-900 dark:text-white overflow-hidden">
                  <div class="line-clamp-2" title="${task.reportName || task.description || '-'}">${task.reportName || task.description || '-'}</div>
                </div>
              </td>
              <td class="px-6 py-4 text-center whitespace-nowrap">
                <span class="!text-base text-gray-700 dark:text-gray-300">${requestor ? requestor.name : '-'}</span>
              </td>
              <td class="px-6 py-4 text-center whitespace-nowrap">
                <span class="!text-base text-gray-700 dark:text-gray-300">${new Date(task.dateReceived).toLocaleDateString()}</span>
              </td>
              <td class="px-6 py-4 text-center whitespace-nowrap">
                ${task.closeDate ? `<span class="!text-base text-success-600 dark:text-success-400 font-medium">${new Date(task.closeDate).toLocaleDateString()}</span>` : '<span class="!text-base text-gray-400 dark:text-gray-500">-</span>'}
              </td>
              <td class="px-6 py-4 text-center whitespace-nowrap">
                <span class="!text-base text-gray-700 dark:text-gray-300">${task.teamInCharge || '-'}</span>
              </td>
              <td class="px-6 py-4 text-center whitespace-nowrap relative" onclick="event.stopPropagation()">
                ${getStatusDropdown(task.id, task.status)}
              </td>
              <td class="px-6 py-4 text-center whitespace-nowrap">
                ${isCompleted ? `<span class="!text-base font-medium text-success-600 dark:text-success-400">${daysToClose}</span>` : '<span class="!text-base text-gray-400 dark:text-gray-500">-</span>'}
              </td>
              <td class="px-6 py-4 text-center whitespace-nowrap">
                ${getPriorityBadge(task.priority)}
              </td>
              <td class="px-6 py-4 whitespace-nowrap" onclick="event.stopPropagation()">
                <div class="flex items-center justify-center gap-2">
                  <button onclick="addChildTask('${task.id}')" class="text-brand-500 hover:text-brand-600 dark:text-brand-400" title="Add Update">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                    </svg>
                  </button>
                  <button onclick="editTicket('${task.id}')" class="text-gray-400 hover:text-gray-600 dark:text-gray-500" title="Edit">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                    </svg>
                  </button>
                  <button onclick="deleteTicket('${task.id}')" class="text-error-500 hover:text-error-600 dark:text-error-400" title="Delete">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                    </svg>
                  </button>
                </div>
              </td>
            </tr>
          `;
          
          // Child tasks (if expanded)
          if (isExpanded && hasChildren) {
            childTasks.forEach(childTask => {
              const childNumber = getTaskNumber(childTask);
              const childMaker = teamMembers.find(m => m.id === childTask.makerId);
              const childRequestor = teamMembers.find(m => m.id === childTask.requestorId);
              const childIsCompleted = childTask.status === 'Completed';
              const childDaysToClose = childTask.closeDate && childTask.dateReceived 
                ? Math.floor((new Date(childTask.closeDate) - new Date(childTask.dateReceived)) / (1000 * 60 * 60 * 24))
                : (childIsCompleted && childTask.dateReceived 
                    ? Math.floor((new Date() - new Date(childTask.dateReceived)) / (1000 * 60 * 60 * 24))
                    : 0);
              
              html += `
                <tr class="task-row-child hover:bg-gray-100 dark:hover:bg-gray-700/50 transition-colors cursor-pointer" onclick="editTicket('${childTask.id}')">
                  <td class="px-6 py-3 whitespace-nowrap">
                    <div class="flex items-center gap-2 pl-6">
                      <span class="!text-base font-mono text-gray-500 dark:text-gray-400"> ${childNumber}</span>
                    </div>
                  </td>
                  <td class="px-6 py-3 text-center whitespace-nowrap">
                    ${getTicketTypeBadge(childTask.ticketType || 'Update')}
                  </td>
                  <td class="px-6 py-3 text-left" style="max-width: 400px; min-width: 250px;">
                    <div class="!text-base text-gray-700 dark:text-gray-300 overflow-hidden">
                      <div class="line-clamp-2" title="${childTask.reportName || childTask.description || '-'}">${childTask.reportName || childTask.description || '-'}</div>
                    </div>
                  </td>
                  <td class="px-6 py-3 text-center whitespace-nowrap">
                    <span class="!text-base text-gray-600 dark:text-gray-400">${childRequestor ? childRequestor.name : '-'}</span>
                  </td>
                  <td class="px-6 py-3 text-center whitespace-nowrap">
                    <span class="!text-base text-gray-600 dark:text-gray-400">${new Date(childTask.dateReceived).toLocaleDateString()}</span>
                  </td>
                  <td class="px-6 py-3 text-center whitespace-nowrap">
                    ${childTask.closeDate ? `<span class="!text-base text-success-600 dark:text-success-400">${new Date(childTask.closeDate).toLocaleDateString()}</span>` : '<span class="!text-base text-gray-400 dark:text-gray-500">-</span>'}
                  </td>
                  <td class="px-6 py-3 text-center whitespace-nowrap">
                    <span class="!text-base text-gray-600 dark:text-gray-400">${childTask.teamInCharge || '-'}</span>
                  </td>
                  <td class="px-6 py-3 text-center whitespace-nowrap relative" onclick="event.stopPropagation()">
                    ${getStatusDropdown(childTask.id, childTask.status)}
                  </td>
                  <td class="px-6 py-3 text-center whitespace-nowrap">
                    ${childIsCompleted ? `<span class="!text-base text-success-600 dark:text-success-400">${childDaysToClose}</span>` : '<span class="!text-base text-gray-400 dark:text-gray-500">-</span>'}
                  </td>
                  <td class="px-6 py-3 text-center whitespace-nowrap">
                    ${getPriorityBadge(childTask.priority)}
                  </td>
                  <td class="px-6 py-3 whitespace-nowrap" onclick="event.stopPropagation()">
                    <div class="flex items-center justify-center gap-2">
                      <button onclick="editTicket('${childTask.id}')" class="text-gray-400 hover:text-gray-600 dark:text-gray-500" title="Edit">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                        </svg>
                      </button>
                      <button onclick="deleteTicket('${childTask.id}')" class="text-error-500 hover:text-error-600 dark:text-error-400" title="Delete">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                        </svg>
                      </button>
                    </div>
                  </td>
                </tr>
              `;
            });
          }
        });
        
        tbody.innerHTML = html;
        updatePaginationInfo();
      }
      
      // Render all views
      function renderAllViews(kanbanFilter = null) {
        renderTicketsTable();
        renderKanbanBoard(kanbanFilter || kanbanStatusFilter, kanbanSearchTerm);
        refreshSummary();
      }
      
      // Apply Kanban filter
      function applyKanbanFilter(filter) {
        kanbanStatusFilter = filter;
        renderKanbanBoard(filter, kanbanSearchTerm);
      }
      
      // Search Kanban tasks
      function searchKanbanTasks(searchTerm) {
        kanbanSearchTerm = searchTerm.toLowerCase();
        renderKanbanBoard(kanbanStatusFilter, kanbanSearchTerm);
      }
      
      // Render Kanban Board with optional filter and search
      function renderKanbanBoard(filterByStatus = null, searchTerm = '') {
        const statusColumns = {
          'Pending': document.getElementById('pending-tasks'),
          'In Progress': document.getElementById('inprogress-tasks'),
          'On Hold': document.getElementById('onhold-tasks'),
          'Completed': document.getElementById('completed-tasks')
        };
        
        // Calculate total counts from all parent tasks (for filter pills)
        const allParentTasks = tickets.filter(t => !t.parentId);
        const totalStatusCounts = {
          'Pending': 0,
          'In Progress': 0,
          'On Hold': 0,
          'Completed': 0
        };
        
        allParentTasks.forEach(task => {
          if (totalStatusCounts[task.status] !== undefined) {
            totalStatusCounts[task.status]++;
          }
        });
        
        // Calculate counts for displayed tasks (for column headers)
        const displayedStatusCounts = {
          'Pending': 0,
          'In Progress': 0,
          'On Hold': 0,
          'Completed': 0
        };
        
        // Clear all columns
        Object.values(statusColumns).forEach(col => col.innerHTML = '');
        
        // Filter only parent tasks for Kanban
        let parentTasks = allParentTasks;
        
        // Apply status filter if provided
        if (filterByStatus && filterByStatus !== 'All') {
          parentTasks = parentTasks.filter(t => t.status === filterByStatus);
        }
        
        // Apply search filter if provided
        if (searchTerm && searchTerm.trim() !== '') {
          const search = searchTerm.toLowerCase().trim();
          parentTasks = parentTasks.filter(t => 
            t.reportName.toLowerCase().includes(search) ||
            (t.description && t.description.toLowerCase().includes(search)) ||
            (teamMembers.find(m => m.id === t.makerId)?.name.toLowerCase().includes(search)) ||
            (teamMembers.find(m => m.id === t.requestorId)?.name.toLowerCase().includes(search))
          );
        }
        
        parentTasks.forEach(task => {
          const maker = teamMembers.find(m => m.id === task.makerId);
          const requestor = teamMembers.find(m => m.id === task.requestorId);
          const childTasks = tickets.filter(t => t.parentId === task.id);
          const childCount = childTasks.length;
          
          displayedStatusCounts[task.status]++;
          
          const card = `
            <div draggable="true" 
                 ondragstart="drag(event, '${task.id}')" 
                 class="task rounded-xl border border-gray-200 bg-white p-5 shadow-theme-sm dark:border-gray-800 dark:bg-white/5 cursor-grab active:cursor-grabbing hover:shadow-md transition-all" 
                 data-task-id="${task.id}">
              <div class="flex items-start justify-between gap-6">
                <div class="flex-1" onclick="editTicket('${task.id}')" style="cursor: pointer;">
                  <h4 class="mb-5 text-base text-gray-800 dark:text-white/90">
                    ${task.reportName}
                  </h4>
                  
                  <div class="flex items-center gap-3">
                    <span class="flex cursor-pointer items-center gap-1 !text-base text-gray-500 dark:text-gray-400">
                      <svg class="fill-current" width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path fill-rule="evenodd" clip-rule="evenodd" d="M5.33329 1.0835C5.74751 1.0835 6.08329 1.41928 6.08329 1.8335V2.25016L9.91663 2.25016V1.8335C9.91663 1.41928 10.2524 1.0835 10.6666 1.0835C11.0808 1.0835 11.4166 1.41928 11.4166 1.8335V2.25016L12.3333 2.25016C13.2998 2.25016 14.0833 3.03366 14.0833 4.00016V6.00016L14.0833 12.6668C14.0833 13.6333 13.2998 14.4168 12.3333 14.4168L3.66663 14.4168C2.70013 14.4168 1.91663 13.6333 1.91663 12.6668L1.91663 6.00016L1.91663 4.00016C1.91663 3.03366 2.70013 2.25016 3.66663 2.25016L4.58329 2.25016V1.8335C4.58329 1.41928 4.91908 1.0835 5.33329 1.0835ZM5.33329 3.75016L3.66663 3.75016C3.52855 3.75016 3.41663 3.86209 3.41663 4.00016V5.25016L12.5833 5.25016V4.00016C12.5833 3.86209 12.4714 3.75016 12.3333 3.75016L10.6666 3.75016L5.33329 3.75016ZM12.5833 6.75016L3.41663 6.75016L3.41663 12.6668C3.41663 12.8049 3.52855 12.9168 3.66663 12.9168L12.3333 12.9168C12.4714 12.9168 12.5833 12.8049 12.5833 12.6668L12.5833 6.75016Z" fill=""/>
                      </svg>
                      ${new Date(task.dateReceived).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' })}
                    </span>
                    
                    ${childCount > 0 ? `
                    <span class="flex cursor-pointer items-center gap-1 !text-base text-gray-500 dark:text-gray-400">
                      <svg class="stroke-current" width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M9 15.6343C12.6244 15.6343 15.5625 12.6961 15.5625 9.07178C15.5625 5.44741 12.6244 2.50928 9 2.50928C5.37563 2.50928 2.4375 5.44741 2.4375 9.07178C2.4375 10.884 3.17203 12.5246 4.35961 13.7122L2.4375 15.6343H9Z" stroke="" stroke-width="1.5" stroke-linejoin="round"/>
                      </svg>
                      ${childCount}
                    </span>
                    ` : ''}
                  </div>
                  
                  ${task.priority ? `<span class="mt-3 inline-flex rounded-full bg-brand-50 px-2 py-0.5 !text-base font-medium text-brand-500 dark:bg-brand-500/15 dark:text-brand-400">${task.priority}</span>` : ''}
                </div>
                
                <div class="h-6 w-full max-w-6 overflow-hidden rounded-full border-[0.5px] border-gray-200 dark:border-gray-800">
                  <div class="h-6 w-6 rounded-full bg-brand-100 flex items-center justify-center text-brand-600 font-medium !text-base dark:bg-brand-900/30 dark:text-brand-400">
                    ${maker ? maker.name.split(' ').map(n => n[0]).join('').substring(0, 2).toUpperCase() : '?'}
                  </div>
                </div>
              </div>
            </div>
          `;
          
          if (statusColumns[task.status]) {
            statusColumns[task.status].innerHTML += card;
          }
        });
        
        // Update filter pill counts (always show total counts)
        const totalCount = Object.values(totalStatusCounts).reduce((a, b) => a + b, 0);
        document.getElementById('kanban-all-count').textContent = totalCount;
        document.getElementById('kanban-pending-filter-count').textContent = totalStatusCounts['Pending'];
        document.getElementById('kanban-inprogress-filter-count').textContent = totalStatusCounts['In Progress'];
        document.getElementById('kanban-completed-filter-count').textContent = totalStatusCounts['Completed'];
        
        // Update column header counts (show displayed counts)
        document.getElementById('pending-count').textContent = displayedStatusCounts['Pending'];
        document.getElementById('inprogress-count').textContent = displayedStatusCounts['In Progress'];
        document.getElementById('onhold-count').textContent = displayedStatusCounts['On Hold'];
        document.getElementById('completed-count').textContent = displayedStatusCounts['Completed'];
        
        // Show empty state if no tasks in a column
        Object.entries(statusColumns).forEach(([status, column]) => {
          if (displayedStatusCounts[status] === 0) {
            column.innerHTML = `
              <div class="flex items-center justify-center p-8 text-gray-400 dark:text-gray-600">
                <div class="text-center">
                  <svg class="w-12 h-12 mx-auto mb-2 opacity-50" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4"/>
                  </svg>
                  <p class="!text-base">No tickets</p>
                </div>
              </div>
            `;
          }
        });
      }
      
      // Toggle task expansion
      function toggleTaskExpansion(taskId) {
        if (expandedTickets.has(taskId)) {
          expandedTickets.delete(taskId);
        } else {
          expandedTickets.add(taskId);
        }
        renderTicketsTable();
      }
      
      // Filter tasks
      // Global filter state
      let statusFilter = 'All';
      let typeFilter = 'All';
      let priorityFilter = 'All';
      
      // Filter by status
      function filterTicketsByStatus(status) {
        statusFilter = status;
        applyAllFilters();
      }
      
      // Filter by type
      function filterTicketsByType(type) {
        typeFilter = type;
        applyAllFilters();
      }
      
      // Filter by priority
      function filterTicketsByPriority(priority) {
        priorityFilter = priority;
        applyAllFilters();
      }
      
      // Apply all filters combined
      function applyAllFilters() {
        const searchTerm = document.getElementById('searchInput').value.toLowerCase();
        
        filteredTickets = tickets.filter(task => {
          const maker = teamMembers.find(m => m.id === task.makerId);
          const requestor = teamMembers.find(m => m.id === task.requestorId);
          
          // Search filter
          const matchesSearch = !searchTerm || 
            task.reportName.toLowerCase().includes(searchTerm) ||
            (task.description && task.description.toLowerCase().includes(searchTerm)) ||
            (maker && maker.name.toLowerCase().includes(searchTerm)) ||
            (requestor && requestor.name.toLowerCase().includes(searchTerm)) ||
            task.status.toLowerCase().includes(searchTerm) ||
            (task.ticketType && task.ticketType.toLowerCase().includes(searchTerm));
          
          // Status filter
          const matchesStatus = statusFilter === 'All' || task.status === statusFilter;
          
          // Type filter
          const matchesType = typeFilter === 'All' || task.ticketType === typeFilter;
          
          // Priority filter
          const matchesPriority = priorityFilter === 'All' || task.priority === priorityFilter;
          
          return matchesSearch && matchesStatus && matchesType && matchesPriority;
        });
        
        currentPage = 1;
        renderTicketsTable();
      }
      
      // Filter tickets (called by search input)
      function filterTickets() {
        applyAllFilters();
      }
      
      // Pagination
      function updatePaginationInfo() {
        // Using PAL-dashboard pagination pattern
        const parentTickets = filteredTickets.filter(t => !t.parentId);
        const total = parentTickets.length;
        const startIdx = (currentPage - 1) * itemsPerPage;
        const endIdx = Math.min(startIdx + itemsPerPage, total);
        const totalPagesCalc = Math.max(1, Math.ceil(total / itemsPerPage));
        
        // Update pagination display (1-based indexing for user display)
        document.getElementById('showingStart').textContent = total > 0 ? startIdx + 1 : 0;
        document.getElementById('showingEnd').textContent = endIdx;
        document.getElementById('totalTasks').textContent = total;
        document.getElementById('currentPage').textContent = currentPage;
        document.getElementById('totalPages').textContent = totalPagesCalc;
        
        // Update button states
        const prevBtn = document.getElementById('prevButton');
        const nextBtn = document.getElementById('nextButton');
        if (prevBtn) prevBtn.disabled = currentPage === 1;
        if (nextBtn) nextBtn.disabled = currentPage >= totalPagesCalc;
      }
      
      function changeItemsPerPage() {
        const newValue = parseInt(document.getElementById('itemsPerPage').value);
        if (isNaN(newValue) || newValue <= 0) {
          console.error('Invalid itemsPerPage value');
          return;
        }
        itemsPerPage = newValue;
        currentPage = 1;
        renderTicketsTable();
        updatePaginationInfo();
      }
      
      function previousPage() {
        if (currentPage > 1) {
          currentPage--;
          renderTicketsTable();
          updatePaginationInfo();
        }
      }
      
      function nextPage() {
        const parentTickets = filteredTickets.filter(t => !t.parentId);
        const totalPages = Math.ceil(parentTickets.length / itemsPerPage);
        if (currentPage < totalPages) {
          currentPage++;
          renderTicketsTable();
          updatePaginationInfo();
        }
      }
      
      // Modal functions
      function openAddTicketModal() {
        document.getElementById('ticketModalTitle').textContent = 'Add Ticket';
        document.getElementById('ticketForm').reset();
        document.getElementById('ticket-id-internal').value = '';
        document.getElementById('ticket-parent-id').value = '';
        
        // Reset Alpine.js dropdowns
        setTimeout(() => {
          updateAlpineDropdown('ticket-status', 'Pending');
          updateAlpineDropdown('ticket-requested-by', 'Select Requested By');
          updateAlpineDropdown('ticket-type', 'Select Ticket Type');
          updateAlpineDropdown('ticket-priority', 'Select Priority');
        }, 50);
        
        const modal = document.getElementById('ticketModal');
        modal.classList.remove('hidden');
        modal.classList.add('flex');
      }
      
      function addChildTask(parentId) {
        document.getElementById('ticketModalTitle').textContent = 'Add Update';
        document.getElementById('ticketForm').reset();
        document.getElementById('ticket-id-internal').value = '';
        document.getElementById('ticket-parent-id').value = parentId;
        
        // Reset Alpine.js dropdowns
        setTimeout(() => {
          updateAlpineDropdown('task-status', 'Pending');
          updateAlpineDropdown('ticket-requested-by', 'Select Requested By');
          updateAlpineDropdown('task-priority', 'Select Priority');
        }, 50);
        
        const modal = document.getElementById('ticketModal');
        modal.classList.remove('hidden');
        modal.classList.add('flex');
      }
      
      function editTicket(ticketId) {
        const ticket = tickets.find(t => t.id === ticketId);
        if (!ticket) return;
        
        const isChild = !!ticket.parentId;
        document.getElementById('ticketModalTitle').textContent = isChild ? 'Edit Update' : 'Edit Ticket';
        
        // Fill form fields
        document.getElementById('ticket-id-internal').value = ticket.id;
        document.getElementById('ticket-parent-id').value = ticket.parentId || '';
        document.getElementById('ticket-id-field').value = ticket.ticketId || '';
        document.getElementById('task-description').value = ticket.description || '';
        document.getElementById('ticket-submission-date').value = ticket.dateReceived || '';
        document.getElementById('ticket-team-in-charge').value = ticket.teamInCharge || '';
        document.getElementById('task-time-spent').value = ticket.timeSpent || 0;
        
        // Set hidden fields
        document.getElementById('task-status').value = ticket.status;
        document.getElementById('ticket-requested-by').value = ticket.requestorId || '';
        document.getElementById('task-region').value = ticket.region || '';
        document.getElementById('task-requestor-region').value = ticket.requestorRegion || '';
        document.getElementById('task-priority').value = ticket.priority || '';
        
        // Update Alpine.js dropdown display values
        setTimeout(() => {
          updateAlpineDropdown('task-status', ticket.status);
          const requestor = teamMembers.find(m => m.id === ticket.requestorId);
          updateAlpineDropdown('ticket-requested-by', requestor ? requestor.name : 'Select Requested By');
          updateAlpineDropdown('task-priority', ticket.priority || 'Select Priority');
          updateAlpineDropdown('task-region', ticket.region || 'Select Region');
          updateAlpineDropdown('task-requestor-region', ticket.requestorRegion || 'Select Requestor Region');
        }, 50);
        
        const modal = document.getElementById('ticketModal');
        modal.classList.remove('hidden');
        modal.classList.add('flex');
      }
      
      // Helper function to update Alpine.js dropdown display
      function updateAlpineDropdown(fieldId, displayValue) {
        const field = document.getElementById(fieldId);
        if (field && field.closest('[x-data]')) {
          try {
            const alpineComponent = field.closest('[x-data]').__x;
            if (alpineComponent && alpineComponent.$data) {
              alpineComponent.$data.selected = displayValue;
            }
          } catch (e) {
            console.warn('Could not update Alpine dropdown for', fieldId, e);
          }
        }
      }
      
      function closeTicketModal() {
        const modal = document.getElementById('ticketModal');
        modal.classList.add('hidden');
        modal.classList.remove('flex');
        document.getElementById('taskForm').reset();
      }
      
      // Submit task
      async function submitTicket(event) {
        event.preventDefault();
        
        const ticketIdField = document.getElementById('ticket-id-internal').value;
        const parentId = document.getElementById('ticket-parent-id').value;
        const ticketIdValue = document.getElementById('ticket-id-field').value;
        
        const ticketData = {
          id: ticketIdField || `ticket-${Date.now()}`,
          parentId: parentId || null,
          ticketId: ticketIdValue || '',
          ticketType: document.getElementById('task-region').value || '', // Using region as type for now
          reportName: ticketIdValue || `Update ${Date.now()}`,
          description: document.getElementById('task-description').value,
          requestorId: document.getElementById('ticket-requested-by').value,
          makerId: document.getElementById('ticket-requested-by').value, // Same as requestor for now
          dateReceived: document.getElementById('ticket-submission-date').value,
          teamInCharge: document.getElementById('ticket-team-in-charge').value,
          status: document.getElementById('task-status').value,
          priority: document.getElementById('task-priority').value || '',
          region: document.getElementById('task-region').value || '',
          requestorRegion: document.getElementById('task-requestor-region').value || '',
          timeSpent: parseFloat(document.getElementById('task-time-spent').value) || 0,
          createdAt: ticketIdField ? (tickets.find(t => t.id === ticketIdField)?.createdAt || new Date().toISOString()) : new Date().toISOString(),
          updatedAt: new Date().toISOString()
        };
        
        try {
          if (ticketIdField) {
            // Update existing ticket
            const index = tickets.findIndex(t => t.id === ticketIdField);
            if (index !== -1) {
              tickets[index] = ticketData;
            }
          } else {
            // Add new ticket
            tickets.push(ticketData);
            
            // If it's a new parent ticket, expand it by default
            if (!parentId) {
              expandedTickets.add(ticketData.id);
            }
          }
          
          await updateTicketsFile(tickets);
          filteredTickets = [...tickets];
          renderAllViews();
          closeTicketModal();
          
          showSuccessToast(ticketIdField ? 'Ticket updated successfully' : 'Ticket added successfully');
        } catch (error) {
          console.error('Error saving ticket:', error);
          showErrorToast('Failed to save ticket. Please try again.');
        }
      }
      
      // Delete task
      async function deleteTicket(taskId) {
        const task = tickets.find(t => t.id === taskId);
        if (!task) return;
        
        // Check if task has children
        const hasChildren = tickets.some(t => t.parentId === taskId);
        
        if (hasChildren) {
          if (!confirm('This task has child tasks. Deleting it will also delete all child tasks. Continue?')) {
            return;
          }
        } else {
          if (!confirm(`Are you sure you want to delete "${task.reportName}"?`)) {
            return;
          }
        }
        
        try {
          // Remove task and all its children
          tickets = tickets.filter(t => t.id !== taskId && t.parentId !== taskId);
          
          await updateTicketsFile(tickets);
          filteredTickets = [...tickets];
          expandedTickets.delete(taskId);
          renderAllViews();
          
          showSuccessToast('Task deleted successfully');
        } catch (error) {
          console.error('Error deleting task:', error);
          showErrorToast('Failed to delete task. Please try again.');
        }
      }
      
      // Refresh tasks table
      async function refreshTicketsTable() {
        const refreshButton = document.getElementById('refreshButton');
        const tableLoadingOverlay = document.getElementById('tableLoadingOverlay');
        const tableContent = document.getElementById('tableContent');
        
        // Disable button
        refreshButton.disabled = true;
        
        // Show loading overlay and hide table content
        tableLoadingOverlay.classList.remove('hidden');
        tableLoadingOverlay.classList.add('flex');
        tableContent.style.opacity = '0.3';
        
        try {          
          // Re-fetch tasks from Confluence
          const fetchedTasks = await fetchTickets();
          
          if (fetchedTasks && fetchedTasks.length > 0) {
            tickets = fetchedTasks;
          } else {
          }
          
          // Keep current expansion state (don't auto-expand after refresh)
          // Note: expandedTickets Set is preserved to maintain user's expand/collapse choices
          
          // Apply current search filter
          const searchTerm = document.getElementById('searchInput').value.toLowerCase();
          if (searchTerm) {
            filterTickets();
          } else {
            filteredTickets = [...tickets];
          }
          
          // Reset to first page
          currentPage = 1;
          
          // Re-render all views
          renderAllViews();
          
          // Wait a bit to ensure render completes, then hide overlay and show toast
          setTimeout(() => {
            tableLoadingOverlay.classList.add('hidden');
            tableLoadingOverlay.classList.remove('flex');
            tableContent.style.opacity = '1';
            showSuccessToast('Tasks refreshed successfully');
          }, 500);
        } catch (error) {
          console.error(' Error refreshing tasks:', error);
          // Hide overlay immediately on error
          tableLoadingOverlay.classList.add('hidden');
          tableLoadingOverlay.classList.remove('flex');
          tableContent.style.opacity = '1';
          showErrorToast('Failed to refresh tasks');
        } finally {
          // Re-enable button
          setTimeout(() => {
            refreshButton.disabled = false;
          }, 500); // Keep disabled for at least 500ms
        }
      }
      
      // Export to Excel
      function exportToExcel() {
        try {
          // Prepare data for export with numbering
          const exportData = [];
          
          const parentTasks = filteredTasks.filter(t => !t.parentId);
          
          parentTasks.forEach(task => {
            const taskNumber = getTaskNumber(task);
            const maker = teamMembers.find(m => m.id === task.makerId);
            const requestor = teamMembers.find(m => m.id === task.requestorId);
            
            exportData.push({
              'Task #': taskNumber,
              'Report Name': task.reportName,
              'Description': task.description || '',
              'Date Received': new Date(task.dateReceived).toLocaleDateString(),
              'Maker': maker ? maker.name : '',
              'Requestor': requestor ? requestor.name : '',
              'Status': task.status,
              'Time Spent (hrs)': task.timeSpent || 0,
              'Priority': task.priority || '',
              'Region': task.region || '',
              'Requestor Region': task.requestorRegion || ''
            });
            
            // Add child tasks
            const childTasks = tickets.filter(t => t.parentId === task.id);
            childTasks.forEach(childTask => {
              const childNumber = getTaskNumber(childTask);
              const childMaker = teamMembers.find(m => m.id === childTask.makerId);
              const childRequestor = teamMembers.find(m => m.id === childTask.requestorId);
              
              exportData.push({
                'Task #': childNumber,
                'Report Name': childTask.reportName,
                'Description': childTask.description || '',
                'Date Received': new Date(childTask.dateReceived).toLocaleDateString(),
                'Maker': childMaker ? childMaker.name : '',
                'Requestor': childRequestor ? childRequestor.name : '',
                'Status': childTask.status,
                'Time Spent (hrs)': childTask.timeSpent || 0,
                'Priority': childTask.priority || '',
                'Region': childTask.region || '',
                'Requestor Region': childTask.requestorRegion || ''
              });
            });
          });
          
          // Create workbook
          const ws = XLSX.utils.json_to_sheet(exportData);
          const wb = XLSX.utils.book_new();
          XLSX.utils.book_append_sheet(wb, ws, 'Ad Hoc Tasks');
          
          // Generate filename with date
          const today = new Date();
          const dateStr = `${today.getFullYear()}-${String(today.getMonth() + 1).padStart(2, '0')}-${String(today.getDate()).padStart(2, '0')}`;
          const filename = `adhoc_tasks_${dateStr}.xlsx`;
          
          // Save file
          XLSX.writeFile(wb, filename);
          
          showSuccessToast(`Exported ${exportData.length} tasks to ${filename}`);
        } catch (error) {
          console.error('Error exporting to Excel:', error);
          showErrorToast('Failed to export. Please try again.');
        }
      }
      
      // Drag and Drop Functions for Kanban
      let draggedTaskId = null;
      
      function allowDrop(ev) {
        ev.preventDefault();
        ev.currentTarget.classList.add('bg-gray-50', 'dark:bg-gray-900/50');
      }
      
      function dragLeave(ev) {
        ev.preventDefault();
        ev.currentTarget.classList.remove('bg-gray-50', 'dark:bg-gray-900/50');
      }
      
      function drag(ev, taskId) {
        draggedTaskId = taskId;
        ev.dataTransfer.effectAllowed = 'move';
        ev.target.style.opacity = '0.5';
      }
      
      async function drop(ev, newStatus) {
        ev.preventDefault();
        
        // Remove all grey backgrounds from all columns
        document.querySelectorAll('.space-y-5').forEach(col => {
          col.classList.remove('bg-gray-50', 'dark:bg-gray-900/50');
        });
        
        if (!draggedTaskId) return;
        
        const task = tickets.find(t => t.id === draggedTaskId);
        if (!task) {
          draggedTaskId = null;
          return;
        }
        
        const oldStatus = task.status;
        if (oldStatus === newStatus) {
          // Reset opacity
          const taskElement = document.querySelector(`[data-task-id="${draggedTaskId}"]`);
          if (taskElement) taskElement.style.opacity = '1';
          draggedTaskId = null;
          return;
        }
        
        // Optimistic update: Update task status immediately
        task.status = newStatus;
        task.updatedAt = new Date().toISOString();
        filteredTickets = [...tickets];
        
        // Render instantly for immediate visual feedback
        renderAllViews();
        
        // Reset opacity
        const taskElement = document.querySelector(`[data-task-id="${draggedTaskId}"]`);
        if (taskElement) taskElement.style.opacity = '1';
        
        draggedTaskId = null;
        
        // Then persist to server in background
        try {
          await updateTicketsFile(tickets);
          showSuccessToast(`Task moved to "${newStatus}"`);
        } catch (error) {
          console.error('Error updating task status:', error);
          // Revert on error
          task.status = oldStatus;
          filteredTickets = [...tickets];
          renderAllViews();
          showErrorToast('Failed to update task status');
        }
      }
      
      // Reset opacity when drag ends
      document.addEventListener('dragend', (ev) => {
        if (ev.target.classList.contains('task')) {
          ev.target.style.opacity = '1';
        }
      });
      
      // Remove hover effect when dragging leaves the column
      document.addEventListener('dragleave', (ev) => {
        if (ev.target.classList.contains('space-y-5')) {
          ev.target.classList.remove('bg-gray-50', 'dark:bg-gray-900/50');
        }
      });
      
      // Modal close event listeners
      document.querySelectorAll('.modal-close-btn').forEach(btn => {
        btn.addEventListener('click', closeTicketModal);
      });
      
      window.addEventListener('click', (event) => {
        if (event.target === document.getElementById('ticketModal')) {
          closeTicketModal();
        }
      });
      
      // ============================================
      // SUMMARY DASHBOARD FUNCTIONS
      // ============================================
      
      let taskStatusChart = null;
      let taskPriorityChart = null;
      let taskRegionChart = null;
      
      function initializeSummary() {
        calculateAndDisplayMetrics();
        initializeTaskStatusChart();
        initializeTaskPriorityChart();
        initializeTaskRegionChart();
        populateRecentTasksTable();
      }
      
      function calculateAndDisplayMetrics() {
        const parentTasks = tickets.filter(t => !t.parentId);
        const totalTasks = parentTasks.length;
        
        // Count by status
        const pendingCount = parentTasks.filter(t => t.status === 'Pending').length;
        const inProgressCount = parentTasks.filter(t => t.status === 'In Progress').length;
        const completedCount = parentTasks.filter(t => t.status === 'Completed').length;
        const onHoldCount = parentTasks.filter(t => t.status === 'On Hold').length;
        
        // Calculate percentages
        const pendingPercentage = totalTasks > 0 ? Math.round((pendingCount / totalTasks) * 100) : 0;
        const inProgressPercentage = totalTasks > 0 ? Math.round((inProgressCount / totalTasks) * 100) : 0;
        const completedPercentage = totalTasks > 0 ? Math.round((completedCount / totalTasks) * 100) : 0;
        
        // Calculate hours
        const totalHours = parentTasks.reduce((sum, t) => sum + (t.timeSpent || 0), 0);
        const avgHours = totalTasks > 0 ? (totalHours / totalTasks).toFixed(1) : 0;
        
        // Calculate close date metrics
        const completedTasksWithCloseDate = parentTasks.filter(t => t.status === 'Completed' && t.closeDate && t.dateReceived);
        let avgDaysToClose = 0;
        let fastestClose = 0;
        let slowestClose = 0;
        
        if (completedTasksWithCloseDate.length > 0) {
          const daysToCloseArray = completedTasksWithCloseDate.map(t => {
            const start = new Date(t.dateReceived);
            const end = new Date(t.closeDate);
            return Math.floor((end - start) / (1000 * 60 * 60 * 24));
          });
          
          const totalDays = daysToCloseArray.reduce((sum, days) => sum + days, 0);
          avgDaysToClose = Math.round(totalDays / completedTasksWithCloseDate.length);
          fastestClose = Math.min(...daysToCloseArray);
          slowestClose = Math.max(...daysToCloseArray);
        }
        
        // Update metric cards
        document.getElementById('summary-total-tasks').textContent = totalTasks;
        document.getElementById('summary-pending-tasks').textContent = pendingCount;
        document.getElementById('summary-inprogress-tasks').textContent = inProgressCount;
        document.getElementById('summary-completed-tasks').textContent = completedCount;
        
        document.getElementById('summary-pending-percentage').textContent = pendingPercentage + '%';
        document.getElementById('summary-inprogress-percentage').textContent = inProgressPercentage + '%';
        document.getElementById('summary-completed-percentage').textContent = completedPercentage + '%';
        
        // Update close date metrics
        document.getElementById('summary-avg-days-to-close').textContent = avgDaysToClose;
        document.getElementById('summary-fastest-close').textContent = fastestClose;
        document.getElementById('summary-slowest-close').textContent = slowestClose;
      }
      
      function initializeTaskStatusChart() {
        const chartElement = document.querySelector("#taskStatusChart");
        if (!chartElement) return;
        
        // Destroy existing chart if it exists
        if (taskStatusChart) {
          taskStatusChart.destroy();
          taskStatusChart = null;
        }
        
        chartElement.innerHTML = '';
        
        const parentTasks = tickets.filter(t => !t.parentId);
        
        if (parentTasks.length === 0) {
          chartElement.innerHTML = `
            <div class="flex items-center justify-center py-20">
              <div class="text-center">
                <svg class="mx-auto h-12 w-12 text-gray-400 dark:text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                </svg>
                <p class="mt-4 !text-base text-gray-500 dark:text-gray-400">No task data available</p>
              </div>
            </div>
          `;
          return;
        }
        
        // Count by status
        const statusCounts = {
          'Pending': parentTasks.filter(t => t.status === 'Pending').length,
          'In Progress': parentTasks.filter(t => t.status === 'In Progress').length,
          'On Hold': parentTasks.filter(t => t.status === 'On Hold').length,
          'Completed': parentTasks.filter(t => t.status === 'Completed').length,
          'Cancelled': parentTasks.filter(t => t.status === 'Cancelled').length
        };
        
        const chartOptions = {
          series: [
            { name: "Tasks", data: [statusCounts['Pending'], statusCounts['In Progress'], statusCounts['On Hold'], statusCounts['Completed'], statusCounts['Cancelled']] }
          ],
          colors: ["#465fff"],
          chart: {
            fontFamily: "Outfit, sans-serif",
            type: "bar",
            height: 335,
            toolbar: { show: false },
          },
          plotOptions: {
            bar: {
              horizontal: false,
              columnWidth: "50%",
              borderRadius: 5,
              borderRadiusApplication: "end",
              dataLabels: {
                position: "top",
              },
            },
          },
          dataLabels: { 
            enabled: true,
            offsetY: -25,
            style: {
              fontSize: "11px",
              fontWeight: 600,
              colors: ["#374151"],
            },
            background: {
              enabled: true,
              foreColor: "#374151",
              backgroundColor: "#F3F4F6",
              borderRadius: 8,
              padding: 6,
              opacity: 1,
              borderWidth: 0,
            },
          },
          stroke: {
            show: true,
            width: 4,
            colors: ["transparent"],
          },
          xaxis: {
            categories: ["Pending", "In Progress", "On Hold", "Completed", "Cancelled"],
            axisBorder: { show: false },
            axisTicks: { show: false },
          },
          legend: {
            show: false,
          },
          yaxis: { title: false },
          grid: {
            yaxis: { lines: { show: true } },
            borderColor: '#E5E7EB',
            strokeDashArray: 4,
          },
          fill: { opacity: 1 },
          tooltip: {
            x: { show: true },
            y: {
              formatter: function (val) {
                return val + " tasks";
              },
            },
          },
        };
        
        taskStatusChart = new ApexCharts(chartElement, chartOptions);
        taskStatusChart.render();
      }
      
      function initializeTaskPriorityChart() {
        const chartElement = document.querySelector("#taskPriorityChart");
        if (!chartElement) return;
        
        // Destroy existing chart if it exists
        if (taskPriorityChart) {
          taskPriorityChart.destroy();
          taskPriorityChart = null;
        }
        
        chartElement.innerHTML = '';
        
        const parentTasks = tickets.filter(t => !t.parentId);
        
        if (parentTasks.length === 0) {
          chartElement.innerHTML = `
            <div class="flex items-center justify-center py-20">
              <div class="text-center">
                <svg class="mx-auto h-12 w-12 text-gray-400 dark:text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                </svg>
                <p class="mt-4 !text-base text-gray-500 dark:text-gray-400">No task data available</p>
              </div>
            </div>
          `;
          return;
        }
        
        // Count by priority
        const priorityCounts = {
          'Low': parentTasks.filter(t => t.priority === 'Low').length,
          'Medium': parentTasks.filter(t => t.priority === 'Medium').length,
          'High': parentTasks.filter(t => t.priority === 'High').length,
          'Urgent': parentTasks.filter(t => t.priority === 'Urgent').length
        };
        
        const chartOptions = {
          series: [
            { name: "Tasks", data: [priorityCounts['Low'], priorityCounts['Medium'], priorityCounts['High'], priorityCounts['Urgent']] }
          ],
          colors: ["#10B981"],
          chart: {
            fontFamily: "Outfit, sans-serif",
            type: "bar",
            height: 335,
            toolbar: { show: false },
          },
          plotOptions: {
            bar: {
              horizontal: false,
              columnWidth: "50%",
              borderRadius: 5,
              borderRadiusApplication: "end",
              dataLabels: {
                position: "top",
              },
            },
          },
          dataLabels: { 
            enabled: true,
            offsetY: -25,
            style: {
              fontSize: "11px",
              fontWeight: 600,
              colors: ["#374151"],
            },
            background: {
              enabled: true,
              foreColor: "#374151",
              backgroundColor: "#F3F4F6",
              borderRadius: 8,
              padding: 6,
              opacity: 1,
              borderWidth: 0,
            },
          },
          stroke: {
            show: true,
            width: 4,
            colors: ["transparent"],
          },
          xaxis: {
            categories: ["Low", "Medium", "High", "Urgent"],
            axisBorder: { show: false },
            axisTicks: { show: false },
          },
          legend: {
            show: false,
          },
          yaxis: { title: false },
          grid: {
            yaxis: { lines: { show: true } },
            borderColor: '#E5E7EB',
            strokeDashArray: 4,
          },
          fill: { opacity: 1 },
          tooltip: {
            x: { show: true },
            y: {
              formatter: function (val) {
                return val + " tasks";
              },
            },
          },
        };
        
        taskPriorityChart = new ApexCharts(chartElement, chartOptions);
        taskPriorityChart.render();
      }
      
      function initializeTaskRegionChart() {
        const chartElement = document.querySelector("#taskRegionChart");
        if (!chartElement) return;
        
        // Destroy existing chart if it exists
        if (taskRegionChart) {
          taskRegionChart.destroy();
          taskRegionChart = null;
        }
        
        chartElement.innerHTML = '';
        
        const parentTickets = tickets.filter(t => !t.parentId);
        
        if (parentTickets.length === 0) {
          chartElement.innerHTML = `
            <div class="flex items-center justify-center py-20">
              <div class="text-center">
                <svg class="mx-auto h-12 w-12 text-gray-400 dark:text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                </svg>
                <p class="mt-4 !text-base text-gray-500 dark:text-gray-400">No ticket data available</p>
              </div>
            </div>
          `;
          return;
        }
        
        // Collect all unique month-year combinations from the data
        const monthNames = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
        const monthYearSet = new Set();
        
        // Get months from dateReceived
        parentTickets.forEach(ticket => {
          if (ticket.dateReceived) {
            const date = new Date(ticket.dateReceived);
            const monthYear = `${date.getFullYear()}-${String(date.getMonth()).padStart(2, '0')}`;
            monthYearSet.add(monthYear);
          }
        });
        
        // Get months from closeDate
        parentTickets.forEach(ticket => {
          if (ticket.closeDate) {
            const date = new Date(ticket.closeDate);
            const monthYear = `${date.getFullYear()}-${String(date.getMonth()).padStart(2, '0')}`;
            monthYearSet.add(monthYear);
          }
        });
        
        // Sort month-year combinations chronologically
        const sortedMonthYears = Array.from(monthYearSet).sort();
        
        // Create display labels (e.g., "Jan 2024", "Feb 2024")
        const monthLabels = sortedMonthYears.map(my => {
          const [year, month] = my.split('-');
          return `${monthNames[parseInt(month)]} ${year}`;
        });
        
        // Count tickets for each month
        const ticketsRaisedByMonth = {};
        const ticketsResolvedByMonth = {};
        
        sortedMonthYears.forEach(my => {
          ticketsRaisedByMonth[my] = 0;
          ticketsResolvedByMonth[my] = 0;
        });
        
        // Count tickets raised per month based on dateReceived
        parentTickets.forEach(ticket => {
          if (ticket.dateReceived) {
            const date = new Date(ticket.dateReceived);
            const monthYear = `${date.getFullYear()}-${String(date.getMonth()).padStart(2, '0')}`;
            if (ticketsRaisedByMonth[monthYear] !== undefined) {
              ticketsRaisedByMonth[monthYear]++;
            }
          }
        });
        
        // Count tickets resolved per month based on closeDate (only for completed tickets)
        parentTickets.forEach(ticket => {
          if (ticket.closeDate && (ticket.status === 'Completed' || ticket.status === 'Resolved')) {
            const date = new Date(ticket.closeDate);
            const monthYear = `${date.getFullYear()}-${String(date.getMonth()).padStart(2, '0')}`;
            if (ticketsResolvedByMonth[monthYear] !== undefined) {
              ticketsResolvedByMonth[monthYear]++;
            }
          }
        });
        
        // Prepare data arrays
        const ticketsRaisedData = sortedMonthYears.map(my => ticketsRaisedByMonth[my]);
        const ticketsResolvedData = sortedMonthYears.map(my => ticketsResolvedByMonth[my]);
        
        const chartOptions = {
          series: [
            { name: "Tickets Raised", data: ticketsRaisedData },
            { name: "Tickets Resolved", data: ticketsResolvedData }
          ],
          legend: {
            show: true,
            position: 'top',
            horizontalAlign: 'right',
            fontSize: '14px',
            fontFamily: 'Outfit, sans-serif',
            fontWeight: 500,
            markers: {
              width: 10,
              height: 10,
              radius: 12,
            },
            itemMargin: {
              horizontal: 15,
              vertical: 5
            },
          },
          colors: ["#3B82F6", "#10B981"], // Blue for raised, Green for resolved
          chart: {
            fontFamily: "Outfit, sans-serif",
            height: 335,
            type: "area",
            toolbar: { show: false },
          },
          stroke: {
            curve: "smooth",
            width: 3,
          },
          dataLabels: { enabled: false },
          markers: { 
            size: 0,
            hover: {
              size: 6
            }
          },
          xaxis: {
            categories: monthLabels,
            axisBorder: { show: false },
            axisTicks: { show: false },
          },
          fill: {
            type: 'gradient',
            gradient: {
              shade: 'light',
              type: 'vertical',
              shadeIntensity: 0.5,
              gradientToColors: undefined,
              inverseColors: false,
              opacityFrom: 0.6,
              opacityTo: 0.1,
              stops: [0, 100]
            },
          },
          grid: {
            xaxis: { lines: { show: false } },
            yaxis: { lines: { show: true } },
            borderColor: '#E5E7EB',
            strokeDashArray: 4,
          },
          yaxis: {
            title: { 
              text: 'Number of Tickets',
              style: { 
                fontSize: "14px",
                fontWeight: 500,
                color: '#6B7280'
              } 
            },
          },
          tooltip: {
            x: { show: true },
            y: {
              formatter: function (val) {
                return val + " tickets";
              },
            },
          },
        };
        
        taskRegionChart = new ApexCharts(chartElement, chartOptions);
        taskRegionChart.render();
      }
      
      function populateRecentTasksTable() {
        const tbody = document.getElementById('summaryRecentTasksTableBody');
        if (!tbody) return;
        
        tbody.innerHTML = '';
        
        // Get only parent tickets and sort by date received (most recent first)
        const parentTickets = tickets.filter(t => !t.parentId);
        const sortedTickets = parentTickets.sort((a, b) => new Date(b.dateReceived) - new Date(a.dateReceived)).slice(0, 10);
        
        if (sortedTickets.length === 0) {
          tbody.innerHTML = `
            <tr>
              <td colspan="7" class="px-6 py-8 text-center">
                <p class="text-gray-500 dark:text-gray-400">No tech ticket data available. Raise a ticket to see it here.</p>
              </td>
            </tr>
          `;
          return;
        }
        
        sortedTickets.forEach(ticket => {
          const dateReceived = new Date(ticket.dateReceived).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
          const description = ticket.description ? (ticket.description.length > 50 ? ticket.description.substring(0, 50) + '...' : ticket.description) : '-';
          
          const row = document.createElement('tr');
          row.className = 'hover:bg-gray-50 dark:hover:bg-gray-800/50 transition-colors';
          row.innerHTML = `
            <td class="px-6 py-4 text-center whitespace-nowrap">
              <span class="!text-base font-mono font-semibold text-blue-600 dark:text-blue-400">${ticket.ticketId || '-'}</span>
            </td>
            <td class="px-6 py-4 text-center" style="max-width: 200px;">
              <span class="!text-base text-gray-700 dark:text-gray-300" title="${ticket.description || ''}">${description}</span>
            </td>
            <td class="px-6 py-4 text-center whitespace-nowrap">
              ${getTicketTypeBadge(ticket.ticketType)}
            </td>
            <td class="px-6 py-4 text-center whitespace-nowrap">
              ${getStatusBadgeForTable(ticket.status)}
            </td>
            <td class="px-6 py-4 text-center whitespace-nowrap">
              ${getPriorityBadgeForTable(ticket.priority)}
            </td>
            <td class="px-6 py-4 text-center whitespace-nowrap">
              ${getRegionBadge(ticket.region)}
            </td>
            <td class="px-6 py-4 text-center whitespace-nowrap">
              <span class="!text-base text-gray-700 dark:text-gray-300">${dateReceived}</span>
            </td>
          `;
          tbody.appendChild(row);
        });
      }
      
      // Helper functions for table badges
      function getStatusBadgeForTable(status) {
        const badges = {
          'Pending': '<span class="inline-flex items-center whitespace-nowrap rounded-full bg-amber-100 px-2.5 py-0.5 !text-base font-medium text-amber-700 dark:bg-amber-900/20 dark:text-amber-400">Pending</span>',
          'In Progress': '<span class="inline-flex items-center whitespace-nowrap rounded-full bg-orange-100 px-2.5 py-0.5 !text-base font-medium text-orange-700 dark:bg-orange-900/20 dark:text-orange-400">In Progress</span>',
          'Completed': '<span class="inline-flex items-center whitespace-nowrap rounded-full bg-green-100 px-2.5 py-0.5 !text-base font-medium text-green-700 dark:bg-green-900/20 dark:text-green-400">Completed</span>',
          'On Hold': '<span class="inline-flex items-center whitespace-nowrap rounded-full bg-gray-100 px-2.5 py-0.5 !text-base font-medium text-gray-700 dark:bg-gray-900/20 dark:text-gray-400">On Hold</span>',
          'Cancelled': '<span class="inline-flex items-center whitespace-nowrap rounded-full bg-red-100 px-2.5 py-0.5 !text-base font-medium text-red-700 dark:bg-red-900/20 dark:text-red-400">Cancelled</span>'
        };
        return badges[status] || status;
      }
      
      function getPriorityBadgeForTable(priority) {
        const badges = {
          'Low': '<span class="inline-flex items-center whitespace-nowrap rounded-full bg-blue-100 px-2.5 py-0.5 !text-base font-medium text-blue-700 dark:bg-blue-900/20 dark:text-blue-400">Low</span>',
          'Medium': '<span class="inline-flex items-center whitespace-nowrap rounded-full bg-amber-100 px-2.5 py-0.5 !text-base font-medium text-amber-700 dark:bg-amber-900/20 dark:text-amber-400">Medium</span>',
          'High': '<span class="inline-flex items-center whitespace-nowrap rounded-full bg-orange-100 px-2.5 py-0.5 !text-base font-medium text-orange-700 dark:bg-orange-900/20 dark:text-orange-400">High</span>',
          'Urgent': '<span class="inline-flex items-center whitespace-nowrap rounded-full bg-red-100 px-2.5 py-0.5 !text-base font-medium text-red-700 dark:bg-red-900/20 dark:text-red-400">Urgent</span>'
        };
        return badges[priority] || priority;
      }
      
      // Refresh summary whenever tasks change
      function refreshSummary() {
        if (typeof initializeSummary === 'function') {
          initializeSummary();
        }
      }
      
      // Search functionality for summary tickets table
      document.addEventListener('DOMContentLoaded', function() {
        const searchInput = document.getElementById('summaryTaskSearchInput');
        if (searchInput) {
          searchInput.addEventListener('input', function(e) {
            const searchTerm = e.target.value.toLowerCase();
            const tableBody = document.getElementById('summaryRecentTasksTableBody');
            const rows = tableBody.getElementsByTagName('tr');
            
            for (let row of rows) {
              if (row.cells.length === 1) continue; // Skip "no data" row
              
              // New column order: Ticket ID, Description, Type, Status, Priority, Region, Submitted Date
              const ticketId = row.cells[0].textContent.toLowerCase();
              const description = row.cells[1].textContent.toLowerCase();
              const type = row.cells[2].textContent.toLowerCase();
              const status = row.cells[3].textContent.toLowerCase();
              const priority = row.cells[4].textContent.toLowerCase();
              const region = row.cells[5].textContent.toLowerCase();
              
              if (ticketId.includes(searchTerm) || description.includes(searchTerm) || type.includes(searchTerm) || 
                  status.includes(searchTerm) || priority.includes(searchTerm) || region.includes(searchTerm)) {
                row.style.display = '';
              } else {
                row.style.display = 'none';
              }
            }
          });
        }
      });
      
      // ============================================
      // END SUMMARY DASHBOARD FUNCTIONS
      // ============================================
      
      // Initialize on page load
      document.addEventListener('DOMContentLoaded', async function() {
        try {
          // Load team members first
          teamMembers = await fetchTeamMembers();
          
          // ============================================
          // DUMMY DATA - FOR TESTING
          // ============================================
          // Add dummy team members if none exist
          if (teamMembers.length === 0) {
            teamMembers = [
              { id: 'tm-001', name: 'John Smith', country: 'USA' },
              { id: 'tm-002', name: 'Sarah Johnson', country: 'UK' },
              { id: 'tm-003', name: 'Michael Chen', country: 'Singapore' },
              { id: 'tm-004', name: 'Emma Williams', country: 'Australia' },
              { id: 'tm-005', name: 'David Brown', country: 'Canada' },
              { id: 'tm-006', name: 'Lisa Anderson', country: 'Germany' },
              { id: 'tm-007', name: 'James Wilson', country: 'Austria' }
            ];
          }
          populateTeamMemberDropdowns();
          // ============================================
          
          // Load tickets
          tickets = await fetchTickets();
          
          // ============================================
          // DUMMY DATA - FOR TESTING
          // ============================================
          // Add dummy tickets if none exist
          if (tickets.length === 0) {
            const dummyTickets = [
              // Ticket 1: Bug - Resolved with updates
              {
                id: 'ticket-001',
                parentId: null,
                ticketId: 'TECH-101',
                ticketType: 'Bug',
                reportName: 'TECH-101: User Authentication Failure',
                description: 'User authentication failing for EMEA region users after latest deployment',
                dateReceived: '2025-12-20',
                closeDate: '2025-12-22',
                makerId: 'tm-003',
                requestorId: 'tm-001',
                teamInCharge: 'Platform Engineering Team',
                status: 'Completed',
                timeSpent: 8,
                region: 'EMEA',
                requestorRegion: 'EMEA',
                priority: 'Urgent',
                createdAt: '2025-12-20T08:30:00Z',
                updatedAt: '2025-12-22T15:45:00Z'
              },
              {
                id: 'ticket-001-update-1',
                parentId: 'ticket-001',
                reportName: 'Update: Root Cause Identified',
                description: 'Issue identified: OAuth token expiration misconfigured in production environment',
                dateReceived: '2025-12-20',
                makerId: 'tm-003',
                requestorId: 'tm-001',
                status: 'In Progress',
                timeSpent: 3,
                region: 'EMEA',
                requestorRegion: 'EMEA',
                priority: 'Urgent',
                createdAt: '2025-12-20T10:15:00Z',
                updatedAt: '2025-12-20T10:15:00Z'
              },
              {
                id: 'ticket-001-update-2',
                parentId: 'ticket-001',
                reportName: 'Update: Hot-fix Deployed',
                description: 'Hot-fix deployed to production. Monitoring authentication success rates.',
                dateReceived: '2025-12-20',
                closeDate: '2025-12-20',
                makerId: 'tm-003',
                requestorId: 'tm-001',
                status: 'Completed',
                timeSpent: 5,
                region: 'EMEA',
                requestorRegion: 'EMEA',
                priority: 'Urgent',
                createdAt: '2025-12-20T14:30:00Z',
                updatedAt: '2025-12-20T14:30:00Z'
              },
              
              // Ticket 2: Feature Request - In Progress
              {
                id: 'ticket-002',
                parentId: null,
                ticketId: 'TECH-102',
                ticketType: 'Feature Request',
                reportName: 'TECH-102: Multi-Currency Support',
                description: 'Add multi-currency support for NAM region portfolio dashboard',
                dateReceived: '2026-01-03',
                makerId: 'tm-002',
                requestorId: 'tm-005',
                teamInCharge: 'Frontend Development Team',
                status: 'In Progress',
                timeSpent: 32,
                region: 'NAM',
                requestorRegion: 'NAM',
                priority: 'High',
                createdAt: '2026-01-03T09:00:00Z',
                updatedAt: '2026-01-14T11:20:00Z'
              },
              {
                id: 'ticket-002-update-1',
                parentId: 'ticket-002',
                reportName: 'Update: Requirements Complete',
                description: 'Requirements gathering completed. 12 currencies identified for Phase 1.',
                dateReceived: '2026-01-05',
                makerId: 'tm-002',
                requestorId: 'tm-005',
                status: 'In Progress',
                timeSpent: 12,
                region: 'NAM',
                requestorRegion: 'NAM',
                priority: 'High',
                createdAt: '2026-01-05T16:00:00Z',
                updatedAt: '2026-01-05T16:00:00Z'
              },
              {
                id: 'ticket-002-update-2',
                parentId: 'ticket-002',
                reportName: 'Update: Backend Development',
                description: 'Backend API development 80% complete. Exchange rate service integrated.',
                dateReceived: '2026-01-10',
                makerId: 'tm-002',
                requestorId: 'tm-005',
                status: 'In Progress',
                timeSpent: 20,
                region: 'NAM',
                requestorRegion: 'NAM',
                priority: 'High',
                createdAt: '2026-01-10T13:45:00Z',
                updatedAt: '2026-01-10T13:45:00Z'
              },
              
              // Ticket 3: Enhancement - Open (No updates)
              {
                id: 'ticket-003',
                parentId: null,
                ticketId: 'TECH-103',
                ticketType: 'Enhancement',
                reportName: 'TECH-103: Dashboard Performance Optimization',
                description: 'Improve page load performance for Risk Assessment Dashboard (target: under 2 seconds)',
                dateReceived: '2026-01-08',
                makerId: 'tm-004',
                requestorId: 'tm-002',
                teamInCharge: 'Performance Engineering Team',
                status: 'Pending',
                timeSpent: 0,
                region: 'APAC',
                requestorRegion: 'NAM',
                priority: 'Medium',
                createdAt: '2026-01-08T10:30:00Z',
                updatedAt: '2026-01-08T10:30:00Z'
              },
              
              // Ticket 4: Bug - In Progress with multiple updates
              {
                id: 'ticket-004',
                parentId: null,
                ticketId: 'TECH-104',
                ticketType: 'Bug',
                reportName: 'TECH-104: Data Aggregation Discrepancy',
                description: 'Incorrect data aggregation in APAC regional reports causing 5% discrepancy',
                dateReceived: '2026-01-06',
                makerId: 'tm-003',
                requestorId: 'tm-007',
                teamInCharge: 'Data Engineering Team',
                status: 'In Progress',
                timeSpent: 24,
                region: 'APAC',
                requestorRegion: 'APAC',
                priority: 'Urgent',
                createdAt: '2026-01-06T07:15:00Z',
                updatedAt: '2026-01-14T09:30:00Z'
              },
              {
                id: 'ticket-004-update-1',
                parentId: 'ticket-004',
                reportName: 'Update: Root Cause Analysis',
                description: 'Root cause: Timezone conversion issue in ETL pipeline for Singapore data center',
                dateReceived: '2026-01-07',
                makerId: 'tm-003',
                requestorId: 'tm-007',
                status: 'In Progress',
                timeSpent: 8,
                region: 'APAC',
                requestorRegion: 'APAC',
                priority: 'Urgent',
                createdAt: '2026-01-07T14:20:00Z',
                updatedAt: '2026-01-07T14:20:00Z'
              },
              {
                id: 'ticket-004-update-2',
                parentId: 'ticket-004',
                reportName: 'Update: Fix in DEV',
                description: 'Fix implemented in DEV environment. Awaiting QA validation.',
                dateReceived: '2026-01-10',
                makerId: 'tm-003',
                requestorId: 'tm-007',
                status: 'In Progress',
                timeSpent: 10,
                region: 'APAC',
                requestorRegion: 'APAC',
                priority: 'Urgent',
                createdAt: '2026-01-10T11:00:00Z',
                updatedAt: '2026-01-10T11:00:00Z'
              },
              {
                id: 'ticket-004-update-3',
                parentId: 'ticket-004',
                reportName: 'Update: QA Complete',
                description: 'QA testing complete. Scheduling production deployment for Jan 16.',
                dateReceived: '2026-01-13',
                makerId: 'tm-003',
                requestorId: 'tm-007',
                status: 'In Progress',
                timeSpent: 6,
                region: 'APAC',
                requestorRegion: 'APAC',
                priority: 'Urgent',
                createdAt: '2026-01-13T16:45:00Z',
                updatedAt: '2026-01-13T16:45:00Z'
              },
              
              // Ticket 5: Investigation - Pending
              {
                id: 'ticket-005',
                parentId: null,
                ticketId: 'TECH-105',
                ticketType: 'Investigation',
                reportName: 'TECH-105: Database Connection Timeouts',
                description: 'Intermittent database connection timeouts during peak hours (2-4 PM EST)',
                dateReceived: '2026-01-11',
                makerId: 'tm-004',
                requestorId: 'tm-001',
                teamInCharge: 'Database Operations Team',
                status: 'Pending',
                timeSpent: 4,
                region: 'NAM',
                requestorRegion: 'NAM',
                priority: 'High',
                createdAt: '2026-01-11T15:20:00Z',
                updatedAt: '2026-01-12T08:10:00Z'
              },
              {
                id: 'ticket-005-update-1',
                parentId: 'ticket-005',
                reportName: 'Update: Logging Enabled',
                description: 'Enabling detailed connection logging to identify bottleneck. Monitoring for 48 hours.',
                dateReceived: '2026-01-12',
                makerId: 'tm-004',
                requestorId: 'tm-001',
                status: 'Pending',
                timeSpent: 4,
                region: 'NAM',
                requestorRegion: 'NAM',
                priority: 'High',
                createdAt: '2026-01-12T08:10:00Z',
                updatedAt: '2026-01-12T08:10:00Z'
              },
              
              // Ticket 6: Feature Request - Closed
              {
                id: 'ticket-006',
                parentId: null,
                ticketId: 'TECH-106',
                ticketType: 'Feature Request',
                reportName: 'TECH-106: PDF Export for Compliance',
                description: 'Add export to PDF functionality for compliance reports',
                dateReceived: '2025-12-15',
                closeDate: '2025-12-28',
                makerId: 'tm-005',
                requestorId: 'tm-004',
                teamInCharge: 'Reports & Analytics Team',
                status: 'Completed',
                timeSpent: 40,
                region: 'EMEA',
                requestorRegion: 'NAM',
                priority: 'Medium',
                createdAt: '2025-12-15T09:00:00Z',
                updatedAt: '2025-12-28T16:00:00Z'
              },
              {
                id: 'ticket-006-update-1',
                parentId: 'ticket-006',
                reportName: 'Update: Feature Complete',
                description: 'Feature developed and deployed to production. User acceptance testing passed.',
                dateReceived: '2025-12-28',
                closeDate: '2025-12-28',
                makerId: 'tm-005',
                requestorId: 'tm-004',
                status: 'Completed',
                timeSpent: 40,
                region: 'EMEA',
                requestorRegion: 'NAM',
                priority: 'Medium',
                createdAt: '2025-12-28T16:00:00Z',
                updatedAt: '2025-12-28T16:00:00Z'
              },
              
              // Ticket 7: Bug - Open (Recently submitted)
              {
                id: 'ticket-007',
                parentId: null,
                ticketId: 'TECH-107',
                ticketType: 'Bug',
                reportName: 'TECH-107: Email Notifications Failure',
                description: 'Email notifications not being sent for critical alerts in LATAM region',
                dateReceived: '2026-01-14',
                makerId: 'tm-006',
                requestorId: 'tm-002',
                teamInCharge: 'Notifications & Alerts Team',
                status: 'Pending',
                timeSpent: 0,
                region: 'LATAM',
                requestorRegion: 'LATAM',
                priority: 'Urgent',
                createdAt: '2026-01-14T07:45:00Z',
                updatedAt: '2026-01-14T07:45:00Z'
              },
              
              // Ticket 8: Enhancement - In Progress
              {
                id: 'ticket-008',
                parentId: null,
                ticketId: 'TECH-108',
                ticketType: 'Enhancement',
                reportName: 'TECH-108: FullCalendar Library Upgrade',
                description: 'Upgrade FullCalendar library to latest version for improved mobile responsiveness',
                dateReceived: '2026-01-09',
                makerId: 'tm-001',
                requestorId: 'tm-002',
                teamInCharge: 'Frontend Development Team',
                status: 'In Progress',
                timeSpent: 12,
                region: 'NAM',
                requestorRegion: 'APAC',
                priority: 'Low',
                createdAt: '2026-01-09T11:00:00Z',
                updatedAt: '2026-01-13T14:30:00Z'
              },
              {
                id: 'ticket-008-update-1',
                parentId: 'ticket-008',
                reportName: 'Update: Testing Mobile Devices',
                description: 'Library upgrade complete. Testing in progress across mobile devices.',
                dateReceived: '2026-01-13',
                makerId: 'tm-001',
                requestorId: 'tm-002',
                status: 'In Progress',
                timeSpent: 12,
                region: 'NAM',
                requestorRegion: 'APAC',
                priority: 'Low',
                createdAt: '2026-01-13T14:30:00Z',
                updatedAt: '2026-01-13T14:30:00Z'
              },
              
              // Ticket 9: Investigation - Resolved
              {
                id: 'ticket-009',
                parentId: null,
                ticketId: 'TECH-109',
                ticketType: 'Investigation',
                reportName: 'TECH-109: API Error Spike Investigation',
                description: 'Spike in API error rates (500 errors) observed on January 4th between 3-5 AM UTC',
                dateReceived: '2026-01-04',
                closeDate: '2026-01-06',
                makerId: 'tm-003',
                requestorId: 'tm-001',
                teamInCharge: 'Platform Engineering Team',
                status: 'Completed',
                timeSpent: 16,
                region: 'EMEA',
                requestorRegion: 'NAM',
                priority: 'High',
                createdAt: '2026-01-04T08:00:00Z',
                updatedAt: '2026-01-06T12:00:00Z'
              },
              {
                id: 'ticket-009-update-1',
                parentId: 'ticket-009',
                reportName: 'Update: Cause Identified',
                description: 'Cause identified: Scheduled database maintenance window overlapped with batch job processing.',
                dateReceived: '2026-01-05',
                makerId: 'tm-003',
                requestorId: 'tm-001',
                status: 'In Progress',
                timeSpent: 8,
                region: 'EMEA',
                requestorRegion: 'NAM',
                priority: 'High',
                createdAt: '2026-01-05T10:30:00Z',
                updatedAt: '2026-01-05T10:30:00Z'
              },
              {
                id: 'ticket-009-update-2',
                parentId: 'ticket-009',
                reportName: 'Update: Issue Resolved',
                description: 'Maintenance window rescheduled. Monitoring confirms no recurrence of issue.',
                dateReceived: '2026-01-06',
                closeDate: '2026-01-06',
                makerId: 'tm-003',
                requestorId: 'tm-001',
                status: 'Completed',
                timeSpent: 8,
                region: 'EMEA',
                requestorRegion: 'NAM',
                priority: 'High',
                createdAt: '2026-01-06T12:00:00Z',
                updatedAt: '2026-01-06T12:00:00Z'
              },
              
              // Ticket 10: Feature Request - Pending (Awaiting approval)
              {
                id: 'ticket-010',
                parentId: null,
                ticketId: 'TECH-110',
                ticketType: 'Feature Request',
                reportName: 'TECH-110: Azure AD SSO Integration',
                description: 'Implement SSO integration with Azure AD for all enterprise users',
                dateReceived: '2026-01-12',
                makerId: 'tm-007',
                requestorId: 'tm-005',
                teamInCharge: 'Identity & Access Management Team',
                status: 'Pending',
                timeSpent: 8,
                region: 'NAM',
                requestorRegion: 'EMEA',
                priority: 'Medium',
                createdAt: '2026-01-12T13:15:00Z',
                updatedAt: '2026-01-13T09:00:00Z'
              },
              {
                id: 'ticket-010-update-1',
                parentId: 'ticket-010',
                reportName: 'Update: Awaiting Approval',
                description: 'Business case submitted to architecture review board. Awaiting approval.',
                dateReceived: '2026-01-13',
                makerId: 'tm-007',
                requestorId: 'tm-005',
                status: 'Pending',
                timeSpent: 8,
                region: 'NAM',
                requestorRegion: 'EMEA',
                priority: 'Medium',
                createdAt: '2026-01-13T09:00:00Z',
                updatedAt: '2026-01-13T09:00:00Z'
              }
            ];
            
            tickets = dummyTickets;

          }
          // ============================================
          // END DUMMY DATA
          // ============================================
          filteredTickets = [...tickets];
          
          // Set default date to today (if element exists)
          const today = new Date().toISOString().split('T')[0];
          const dateReceivedInput = document.getElementById('ticket-date-received');
          if (dateReceivedInput) {
            dateReceivedInput.value = today;
          }
          
          // Render all views
          renderAllViews();
          if (tickets.length > 0) {
            showInfoToast(`Loaded ${tickets.length} tickets`);
          } else {
          }
        } catch (error) {
          console.error(' Error initializing:', error);
          console.error('Error details:', error.message, error.stack);
          showErrorToast('Failed to load data. Please refresh the page.');
        }
      });
    </script>
</body>
</html>

