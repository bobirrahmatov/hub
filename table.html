<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Covenants Table - Test</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        success: {
                            50: '#f0fdf4',
                            500: '#10b981',
                            600: '#059669',
                            700: '#047857'
                        },
                        danger: '#dc2626',
                        warning: '#f59e0b'
                    }
                }
            }
        }
    </script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
        }

        /* Enhanced Tooltip Styles */
        #enhancedTooltip {
            position: fixed;
            z-index: 99999;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.2s ease-in-out;
            max-width: 380px;
        }

        #enhancedTooltip.show {
            opacity: 1;
        }

        .tooltip-content {
            background: #ffffff;
            border-radius: 12px;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            overflow: hidden;
            font-family: 'Outfit', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }

        .tooltip-header {
            border-bottom: 1px solid #E5E7EB;
            padding: 16px 16px 12px 16px;
            margin-bottom: 14px;
        }

        .tooltip-title {
            font-weight: 600;
            font-size: 15px;
            color: #111827;
            margin-bottom: 4px;
        }

        .tooltip-subtitle {
            font-size: 12px;
            font-weight: 500;
            color: #6B7280;
        }

        .tooltip-body {
            padding: 0 16px 16px 16px;
        }

        .tooltip-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 16px;
        }

        .tooltip-widget {
            background: #F9FAFB;
            border-radius: 8px;
            padding: 12px;
            border: 1px solid #E5E7EB;
        }

        .tooltip-widget-label {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 11px;
            color: #6B7280;
            font-weight: 500;
            margin-bottom: 6px;
        }

        .tooltip-widget-value {
            font-size: 20px;
            font-weight: 700;
            color: #111827;
        }

        .tooltip-widget-value.medium {
            font-size: 16px;
        }

        .tooltip-section-title {
            display: flex;
            align-items: center;
            gap: 6px;
            margin-bottom: 8px;
            font-size: 12px;
            font-weight: 600;
            color: #374151;
        }

        .tooltip-table {
            width: 100%;
            border-collapse: collapse;
        }

        .tooltip-table thead tr {
            border-bottom: 1px solid #E5E7EB;
        }

        .tooltip-table th {
            padding: 6px 8px;
            text-align: left;
            font-size: 10px;
            color: #6B7280;
            font-weight: 600;
            text-transform: uppercase;
        }

        .tooltip-table th.text-right {
            text-align: right;
        }

        .tooltip-table td {
            padding: 6px 8px;
            font-size: 11px;
            color: #6B7280;
            font-weight: 500;
        }

        .tooltip-table td.value {
            text-align: right;
            color: #111827;
            font-weight: 600;
        }

        /* Row hover effect */
        tbody tr {
            transition: background-color 0.15s ease;
            cursor: pointer;
        }

        tbody tr:hover {
            background-color: #F9FAFB !important;
        }
    </style>
</head>

<body class="bg-gray-50 p-8">
    <div class="max-w-7xl mx-auto">
        <!-- Page Title -->
        <div class="mb-6">
            <h1 class="text-3xl font-bold text-gray-900">Covenants Table - Test</h1>
            <p class="text-base text-gray-600 mt-2">Dummy data for tooltip development</p>
        </div>

        <!-- Covenants Table -->
        <div class="mb-6 rounded-2xl border border-gray-200 bg-white">
            <!-- Table Header -->
            <div class="px-6 py-4">
                <h3 class="!text-lg font-semibold text-gray-800">Covenants</h3>
                <p class="!text-base font-medium text-gray-500 mt-1">Covenant tracking and due dates</p>
            </div>

            <!-- Table Content -->
            <div class="overflow-hidden">
                <table class="w-full table-auto">
                    <thead>
                        <tr class="bg-gray-50">
                            <th
                                class="px-6 py-4 text-center !text-base font-medium whitespace-nowrap text-gray-500">
                                Region</th>
                            <th
                                class="px-6 py-4 text-center !text-base font-medium whitespace-nowrap text-gray-500">
                                Fac ID</th>
                            <th
                                class="px-6 py-4 text-center !text-base font-medium whitespace-nowrap text-gray-500">
                                Prod Program</th>
                            <th
                                class="px-6 py-4 text-center !text-base font-medium whitespace-nowrap text-gray-500">
                                Covenant Number</th>
                            <th
                                class="px-6 py-4 text-center !text-base font-medium whitespace-nowrap text-gray-500">
                                Covenant Due Date</th>
                            <th
                                class="px-6 py-4 text-center !text-base font-medium whitespace-nowrap text-gray-500">
                                Status</th>
                        </tr>
                    </thead>
                    <tbody id="deepDiveCovenantsTable" class="divide-y divide-gray-200">
                        <!-- Rows will be populated by JavaScript -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Enhanced Tooltip -->
    <div id="enhancedTooltip">
        <div class="tooltip-content" id="tooltipContent"></div>
    </div>

    <script>
        // Dummy Covenants Data - Matching the structure from PAL-dashboard.html
        const covenantsData = [
            {
                Relationship_ID: "REL001",
                Relationship_Name: "Global Tech Corporation",
                Region: "NAM",
                Facility_Number: "FAC-12345",
                Product_Program_Name: "Term Loan",
                Sub_Product: "Senior Secured",
                Covenant_Number: "COV-001",
                Due_Date: "15/03/2026",
                Covenant_Description: "Debt Service Coverage Ratio"
            },
            {
                Relationship_ID: "REL001",
                Relationship_Name: "Global Tech Corporation",
                Region: "NAM",
                Facility_Number: "FAC-12346",
                Product_Program_Name: "Revolving Credit",
                Sub_Product: "",
                Covenant_Number: "COV-002",
                Due_Date: "20/02/2026",
                Covenant_Description: "Leverage Ratio"
            },
            {
                Relationship_ID: "REL001",
                Relationship_Name: "Global Tech Corporation",
                Region: "EMEA",
                Facility_Number: "FAC-12347",
                Product_Program_Name: "Working Capital",
                Sub_Product: "Unsecured",
                Covenant_Number: "COV-003",
                Due_Date: "10/01/2026",
                Covenant_Description: "Current Ratio"
            },
            {
                Relationship_ID: "REL002",
                Relationship_Name: "Asia Pacific Industries",
                Region: "APAC",
                Facility_Number: "FAC-23456",
                Product_Program_Name: "Bridge Loan",
                Sub_Product: "Convertible",
                Covenant_Number: "COV-004",
                Due_Date: "25/04/2026",
                Covenant_Description: "Interest Coverage Ratio"
            },
            {
                Relationship_ID: "REL002",
                Relationship_Name: "Asia Pacific Industries",
                Region: "APAC",
                Facility_Number: "FAC-23457",
                Product_Program_Name: "Equipment Finance",
                Sub_Product: "",
                Covenant_Number: "COV-005",
                Due_Date: "05/05/2026",
                Covenant_Description: "Fixed Charge Coverage"
            },
            {
                Relationship_ID: "REL003",
                Relationship_Name: "Latin America Resources",
                Region: "LATAM",
                Facility_Number: "FAC-34567",
                Product_Program_Name: "Project Finance",
                Sub_Product: "Non-Recourse",
                Covenant_Number: "COV-006",
                Due_Date: "30/06/2026",
                Covenant_Description: "Debt to EBITDA"
            },
            {
                Relationship_ID: "REL003",
                Relationship_Name: "Latin America Resources",
                Region: "LATAM",
                Facility_Number: "FAC-34568",
                Product_Program_Name: "Trade Finance",
                Sub_Product: "Letter of Credit",
                Covenant_Number: "COV-007",
                Due_Date: "15/12/2025",
                Covenant_Description: "Liquidity Ratio"
            },
            {
                Relationship_ID: "REL004",
                Relationship_Name: "European Manufacturing Ltd",
                Region: "EMEA",
                Facility_Number: "FAC-45678",
                Product_Program_Name: "Asset Based Lending",
                Sub_Product: "Inventory Financing",
                Covenant_Number: "COV-008",
                Due_Date: "28/02/2026",
                Covenant_Description: "Tangible Net Worth"
            },
            {
                Relationship_ID: "REL004",
                Relationship_Name: "European Manufacturing Ltd",
                Region: "EMEA",
                Facility_Number: "FAC-45679",
                Product_Program_Name: "Capex Facility",
                Sub_Product: "",
                Covenant_Number: "COV-009",
                Due_Date: "10/03/2026",
                Covenant_Description: "Cash Flow Coverage"
            },
            {
                Relationship_ID: "REL005",
                Relationship_Name: "North American Energy Co",
                Region: "NAM",
                Facility_Number: "FAC-56789",
                Product_Program_Name: "Syndicated Loan",
                Sub_Product: "Senior",
                Covenant_Number: "COV-010",
                Due_Date: "18/01/2026",
                Covenant_Description: "Net Leverage Ratio"
            },
            {
                Relationship_ID: "REL005",
                Relationship_Name: "North American Energy Co",
                Region: "NAM",
                Facility_Number: "FAC-56790",
                Product_Program_Name: "Mezzanine Finance",
                Sub_Product: "Subordinated",
                Covenant_Number: "COV-011",
                Due_Date: "22/07/2026",
                Covenant_Description: "EBITDA Minimum"
            },
            {
                Relationship_ID: "REL006",
                Relationship_Name: "Southeast Asia Holdings",
                Region: "APAC",
                Facility_Number: "FAC-67890",
                Product_Program_Name: "Real Estate Finance",
                Sub_Product: "Commercial Mortgage",
                Covenant_Number: "COV-012",
                Due_Date: "08/08/2026",
                Covenant_Description: "Loan to Value Ratio"
            }
        ];

        // Date parsing function (from PAL-dashboard.html)
        function parseDate(dateStr) {
            if (!dateStr) return null;

            // Handle DD/MM/YYYY format
            if (dateStr.includes("/")) {
                const parts = dateStr.split("/");
                if (parts.length === 3) {
                    const day = parseInt(parts[0], 10);
                    const month = parseInt(parts[1], 10) - 1;
                    const year = parseInt(parts[2], 10);
                    return new Date(year, month, day);
                }
            }

            // Try standard date parsing
            const date = new Date(dateStr);
            return isNaN(date.getTime()) ? null : date;
        }

        // Format date to DD/MM/YYYY
        function formatDateToDDMMYYYY(date) {
            if (!date) return "";
            const day = String(date.getDate()).padStart(2, "0");
            const month = String(date.getMonth() + 1).padStart(2, "0");
            const year = date.getFullYear();
            return `${day}/${month}/${year}`;
        }

        // Populate Covenants Table (from PAL-dashboard.html)
        function populateDeepDiveCovenantsTable() {
            const tbody = document.getElementById("deepDiveCovenantsTable");

            if (!tbody) {
                return;
            }

            if (!covenantsData || covenantsData.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="6" class="px-6 py-8">
                            <div class="flex items-center justify-center py-20">
                                <div class="text-center">
                                    <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                                    </svg>
                                    <p class="mt-4 !text-base text-gray-500">No data available</p>
                                </div>
                            </div>
                        </td>
                    </tr>
                `;
                return;
            }

            // Generate covenant rows
            const currentDate = new Date();
            const reportingMonth = new Date("2026-01-24"); // Using current date as reporting month
            let html = "";

            covenantsData.forEach((cov, index) => {
                const region = cov.Region || "-";
                const facilityId = cov.Facility_Number || cov.Facility_ID || cov.Facility_id || "-";
                const productProgram = cov.Product_Program_Name || cov.Product_Program || cov.Product || "-";
                const subProduct = cov.Sub_Product || cov.Sub_product || "";
                const covenantNumber = cov.Covenant_Number || cov.Covenant_ID || "-";
                const covenantDueDate = cov.Due_Date || cov.Covenant_Due_Date || "-";
                const covenantDescription = cov.Covenant_Description || cov.Description || "-";

                // Calculate past due days using reportingMonth
                const dueDate = parseDate(covenantDueDate);
                const compareDate = reportingMonth || new Date();
                let pastDueDays = 0;
                let status = "Coming Due";
                let isPastDue = false;

                if (dueDate) {
                    const daysDiff = Math.floor((compareDate - dueDate) / (1000 * 60 * 60 * 24));
                    if (daysDiff > 0) {
                        // Past Due
                        pastDueDays = daysDiff;
                        status = `Past Due (${pastDueDays}d)`;
                        isPastDue = true;
                    } else {
                        // Coming Due - show days until due
                        const daysUntilDue = Math.abs(daysDiff);
                        status = `Coming Due (${daysUntilDue}d)`;
                    }
                }

                // Region badge color
                const regionColors = {
                    'APAC': 'bg-emerald-100 text-emerald-700',
                    'EMEA': 'bg-blue-100 text-blue-700',
                    'NAM': 'bg-purple-100 text-purple-700',
                    'LATAM': 'bg-amber-100 text-amber-700'
                };
                const regionColor = regionColors[region] || 'bg-gray-100 text-gray-700';

                html += `
                    <tr class="hover:bg-gray-50" 
                        data-covenant-index="${index}"
                        onmouseenter="showEnhancedTooltip(event, ${index})"
                        onmousemove="moveEnhancedTooltip(event)"
                        onmouseleave="hideEnhancedTooltip()">
                        <td class="px-6 py-4 text-center">
                            <span class="${regionColor} rounded-full px-2 py-0.5 !text-base font-medium">
                                ${region}
                            </span>
                        </td>
                        <td class="px-6 py-4 text-center !text-base font-medium text-gray-900">${facilityId}</td>
                        <td class="px-6 py-4 text-center">
                            ${subProduct ? `
                            <div class="space-y-1">
                                <div class="!text-base font-medium text-gray-900">${productProgram}</div>
                                    <div class="!text-base text-gray-600">${subProduct}</div>
                                    </div>
                            ` : `
                                <span class="!text-base font-medium text-gray-900">${productProgram}</span>
                            `}
                        </td>
                        <td class="px-6 py-4 text-center !text-base font-medium text-gray-900">${covenantNumber}</td>
                        <td class="px-6 py-4 text-center !text-base whitespace-nowrap text-gray-700">${formatDateToDDMMYYYY(dueDate) || covenantDueDate}</td>
                        <td class="px-6 py-4 text-center">
                            ${isPastDue ? `
                                <span class="bg-red-50 text-red-600 rounded-full px-2 py-0.5 !text-base font-medium">${status}</span>
                            ` : `
                                <span class="bg-yellow-50 text-yellow-600 rounded-full px-2 py-0.5 !text-base font-medium">${status}</span>
                            `}
                        </td>
                    </tr>
                `;
            });

            tbody.innerHTML = html;
        }

        // Initialize table on page load
        document.addEventListener('DOMContentLoaded', function() {
            populateDeepDiveCovenantsTable();
        });

        // ===== ENHANCED TOOLTIP FUNCTIONS =====
        
        let tooltipTimeout = null;
        const tooltip = document.getElementById('enhancedTooltip');
        const tooltipContent = document.getElementById('tooltipContent');

        function showEnhancedTooltip(event, covenantIndex) {
            // Clear any existing timeout
            if (tooltipTimeout) {
                clearTimeout(tooltipTimeout);
            }

            const covenant = covenantsData[covenantIndex];
            if (!covenant) return;

            // Extract covenant details
            const region = covenant.Region || "-";
            const relationshipName = covenant.Relationship_Name || "Unknown Relationship";
            const relationshipId = covenant.Relationship_ID || "-";
            const facilityId = covenant.Facility_Number || covenant.Facility_ID || "-";
            const productProgram = covenant.Product_Program_Name || covenant.Product_Program || "-";
            const subProduct = covenant.Sub_Product || covenant.Sub_product || "";
            const covenantNumber = covenant.Covenant_Number || covenant.Covenant_ID || "-";
            const covenantDueDate = covenant.Due_Date || covenant.Covenant_Due_Date || "-";
            const covenantDescription = covenant.Covenant_Description || covenant.Description || "-";

            // Calculate status
            const dueDate = parseDate(covenantDueDate);
            const reportingMonth = new Date("2026-01-24");
            let pastDueDays = 0;
            let daysUntilDue = 0;
            let status = "Coming Due";
            let isPastDue = false;

            if (dueDate) {
                const daysDiff = Math.floor((reportingMonth - dueDate) / (1000 * 60 * 60 * 24));
                if (daysDiff > 0) {
                    pastDueDays = daysDiff;
                    status = "Past Due";
                    isPastDue = true;
                } else {
                    daysUntilDue = Math.abs(daysDiff);
                    status = "Coming Due";
                }
            }

            // Build tooltip HTML
            const tooltipHTML = `
                <div class="tooltip-header">
                    <div class="tooltip-title">${covenantNumber}</div>
                    <div class="tooltip-subtitle">${relationshipName}</div>
                </div>
                
                <div class="tooltip-body">
                    <!-- Status and Days Grid -->
                    <div class="tooltip-grid">
                        <!-- Status Widget -->
                        <div class="tooltip-widget">
                            <div class="tooltip-widget-label">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <circle cx="12" cy="12" r="10"></circle>
                                    <path d="M12 6v6l4 2"></path>
                                </svg>
                                Status
                            </div>
                            <div class="tooltip-widget-value medium" style="color: ${isPastDue ? '#DC2626' : '#D97706'};">
                                ${status}
                            </div>
                        </div>
                        
                        <!-- Days Widget -->
                        <div class="tooltip-widget">
                            <div class="tooltip-widget-label">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                                    <line x1="16" y1="2" x2="16" y2="6"></line>
                                    <line x1="8" y1="2" x2="8" y2="6"></line>
                                    <line x1="3" y1="10" x2="21" y2="10"></line>
                                </svg>
                                ${isPastDue ? 'Past Due Days' : 'Days Until Due'}
                            </div>
                            <div class="tooltip-widget-value">${isPastDue ? pastDueDays : daysUntilDue}</div>
                        </div>
                    </div>
                    
                    <!-- Covenant Details -->
                    <div style="margin-top: 12px;">
                        <div class="tooltip-section-title">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="#6B7280" stroke-width="2">
                                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                <polyline points="14 2 14 8 20 8"></polyline>
                                <line x1="16" y1="13" x2="8" y2="13"></line>
                                <line x1="16" y1="17" x2="8" y2="17"></line>
                                <polyline points="10 9 9 9 8 9"></polyline>
                            </svg>
                            Covenant Details
                        </div>
                        <table class="tooltip-table">
                            <tbody>
                                <tr>
                                    <td>Region</td>
                                    <td class="value">${region}</td>
                                </tr>
                                <tr>
                                    <td>Relationship ID</td>
                                    <td class="value">${relationshipId}</td>
                                </tr>
                                <tr>
                                    <td>Facility ID</td>
                                    <td class="value">${facilityId}</td>
                                </tr>
                                <tr>
                                    <td>Product</td>
                                    <td class="value">${productProgram}${subProduct ? ` - ${subProduct}` : ''}</td>
                                </tr>
                                <tr>
                                    <td>Due Date</td>
                                    <td class="value">${formatDateToDDMMYYYY(dueDate) || covenantDueDate}</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    
                    <!-- Description Section -->
                    ${covenantDescription !== '-' ? `
                    <div style="margin-top: 12px;">
                        <div class="tooltip-section-title">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="#6B7280" stroke-width="2">
                                <circle cx="12" cy="12" r="10"></circle>
                                <line x1="12" y1="16" x2="12" y2="12"></line>
                                <line x1="12" y1="8" x2="12.01" y2="8"></line>
                            </svg>
                            Description
                        </div>
                        <div style="
                            background: #F9FAFB;
                            border-radius: 8px;
                            padding: 10px;
                            border: 1px solid #E5E7EB;
                            font-size: 11px;
                            color: #374151;
                            line-height: 1.5;
                        ">${covenantDescription}</div>
                    </div>
                    ` : ''}
                </div>
            `;

            tooltipContent.innerHTML = tooltipHTML;
            
            // Show tooltip with slight delay
            tooltipTimeout = setTimeout(() => {
                tooltip.classList.add('show');
            }, 150);

            // Position tooltip
            moveEnhancedTooltip(event);
        }

        function moveEnhancedTooltip(event) {
            if (!tooltip.classList.contains('show') && !tooltipTimeout) return;

            const padding = 20;
            const tooltipWidth = tooltip.offsetWidth || 380;
            const tooltipHeight = tooltip.offsetHeight || 400;
            
            let left = event.clientX + padding;
            let top = event.clientY + padding;

            // Check right boundary
            if (left + tooltipWidth > window.innerWidth) {
                left = event.clientX - tooltipWidth - padding;
            }

            // Check bottom boundary
            if (top + tooltipHeight > window.innerHeight) {
                top = event.clientY - tooltipHeight - padding;
            }

            // Check top boundary
            if (top < 0) {
                top = padding;
            }

            // Check left boundary
            if (left < 0) {
                left = padding;
            }

            tooltip.style.left = left + 'px';
            tooltip.style.top = top + 'px';
        }

        function hideEnhancedTooltip() {
            if (tooltipTimeout) {
                clearTimeout(tooltipTimeout);
                tooltipTimeout = null;
            }
            
            tooltip.classList.remove('show');
        }
    </script>
</body>

</html>

