<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tooltip Test</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom Table Tooltip Styles - Matching ApexCharts Tooltips */
        .custom-tooltip {
            position: fixed;
            background: #ffffff;
            color: #1f2937;
            padding: 0;
            border-radius: 8px;
            font-size: 13px;
            line-height: 1.4;
            max-width: 320px;
            z-index: 99999;
            pointer-events: none;
            opacity: 0;
            transform: translateY(-5px);
            transition: opacity 0.2s ease-in-out, transform 0.2s ease-in-out;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.15), 0 4px 6px -2px rgba(0, 0, 0, 0.1);
            border: 1px solid #e5e7eb;
            font-family: 'Outfit', sans-serif;
        }

        .custom-tooltip.show {
            opacity: 1;
            transform: translateY(0);
        }

        .custom-tooltip-title {
            background: #f9fafb;
            border-bottom: 1px solid #e5e7eb;
            color: #1f2937;
            padding: 8px 12px;
            font-weight: 600;
            font-size: 12px;
            border-radius: 8px 8px 0 0;
        }

        .custom-tooltip-content {
            padding: 8px 12px;
            color: #374151;
            font-size: 13px;
        }

        .custom-tooltip-content strong {
            color: #1f2937;
            font-weight: 600;
        }

        .custom-tooltip-row {
            padding: 4px 0;
        }

        .custom-tooltip-row:first-child {
            padding-top: 0;
        }

        .custom-tooltip-row:last-child {
            padding-bottom: 0;
        }

        body {
            font-family: 'Outfit', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
    </style>
</head>
<body class="bg-gray-50 p-8">
    <div class="max-w-7xl mx-auto">
        <h1 class="text-3xl font-bold text-gray-900 mb-8">Tooltip Test Page</h1>
        
        <div class="mb-8 p-4 bg-blue-50 border border-blue-200 rounded-lg">
            <h2 class="text-lg font-semibold text-blue-900 mb-2">Instructions:</h2>
            <p class="text-blue-800">Hover over any row in the tables below to see the custom tooltips.</p>
        </div>

        <!-- Facilities Table -->
        <div class="mb-8 rounded-2xl border border-gray-200 bg-white overflow-hidden">
            <div class="px-6 py-4 border-b border-gray-200">
                <h2 class="text-xl font-semibold text-gray-800">Facility Details Table</h2>
                <p class="text-sm text-gray-500 mt-1">Hover over rows to see facility type tooltips</p>
            </div>
            <div class="overflow-x-auto">
                <table class="w-full">
                    <thead>
                        <tr class="bg-gray-50">
                            <th class="px-6 py-4 text-left text-sm font-medium text-gray-500">Region</th>
                            <th class="px-6 py-4 text-left text-sm font-medium text-gray-500">Facility ID</th>
                            <th class="px-6 py-4 text-left text-sm font-medium text-gray-500">Product</th>
                            <th class="px-6 py-4 text-left text-sm font-medium text-gray-500">Amount</th>
                        </tr>
                    </thead>
                    <tbody id="facilitiesTable" class="divide-y divide-gray-200">
                        <tr class="hover:bg-gray-50 cursor-pointer transition-colors" 
                            data-facility-type="Revolving Credit Line" 
                            data-region="NAM" 
                            data-maturity="31/12/2025" 
                            data-rating="Pass">
                            <td class="px-6 py-4">
                                <span class="bg-purple-100 text-purple-700 rounded-full px-3 py-1 text-sm font-medium">NAM</span>
                            </td>
                            <td class="px-6 py-4 text-sm font-medium text-gray-900">FAC-001</td>
                            <td class="px-6 py-4 text-sm text-gray-700">Corporate Lending</td>
                            <td class="px-6 py-4 text-sm text-gray-700">$5,000,000</td>
                        </tr>
                        <tr class="hover:bg-gray-50 cursor-pointer transition-colors" 
                            data-facility-type="Term Loan" 
                            data-region="EMEA" 
                            data-maturity="15/06/2026" 
                            data-rating="Pass">
                            <td class="px-6 py-4">
                                <span class="bg-amber-100 text-amber-700 rounded-full px-3 py-1 text-sm font-medium">EMEA</span>
                            </td>
                            <td class="px-6 py-4 text-sm font-medium text-gray-900">FAC-002</td>
                            <td class="px-6 py-4 text-sm text-gray-700">Trade Finance</td>
                            <td class="px-6 py-4 text-sm text-gray-700">$3,000,000</td>
                        </tr>
                        <tr class="hover:bg-gray-50 cursor-pointer transition-colors" 
                            data-facility-type="Letter of Credit" 
                            data-region="APAC" 
                            data-maturity="30/09/2024" 
                            data-rating="Special Mention">
                            <td class="px-6 py-4">
                                <span class="bg-emerald-100 text-emerald-700 rounded-full px-3 py-1 text-sm font-medium">APAC</span>
                            </td>
                            <td class="px-6 py-4 text-sm font-medium text-gray-900">FAC-003</td>
                            <td class="px-6 py-4 text-sm text-gray-700">Working Capital</td>
                            <td class="px-6 py-4 text-sm text-gray-700">$1,500,000</td>
                        </tr>
                        <tr class="hover:bg-gray-50 cursor-pointer transition-colors" 
                            data-facility-type="Bridge Loan" 
                            data-region="LATAM" 
                            data-maturity="31/03/2025" 
                            data-rating="Pass">
                            <td class="px-6 py-4">
                                <span class="bg-blue-100 text-blue-700 rounded-full px-3 py-1 text-sm font-medium">LATAM</span>
                            </td>
                            <td class="px-6 py-4 text-sm font-medium text-gray-900">FAC-004</td>
                            <td class="px-6 py-4 text-sm text-gray-700">Real Estate</td>
                            <td class="px-6 py-4 text-sm text-gray-700">$2,200,000</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Covenants Table -->
        <div class="rounded-2xl border border-gray-200 bg-white overflow-hidden">
            <div class="px-6 py-4 border-b border-gray-200">
                <h2 class="text-xl font-semibold text-gray-800">Covenants Table</h2>
                <p class="text-sm text-gray-500 mt-1">Hover over rows to see covenant description tooltips</p>
            </div>
            <div class="overflow-x-auto">
                <table class="w-full">
                    <thead>
                        <tr class="bg-gray-50">
                            <th class="px-6 py-4 text-left text-sm font-medium text-gray-500">Region</th>
                            <th class="px-6 py-4 text-left text-sm font-medium text-gray-500">Covenant #</th>
                            <th class="px-6 py-4 text-left text-sm font-medium text-gray-500">Due Date</th>
                            <th class="px-6 py-4 text-left text-sm font-medium text-gray-500">Status</th>
                        </tr>
                    </thead>
                    <tbody id="covenantsTable" class="divide-y divide-gray-200">
                        <tr class="hover:bg-gray-50 cursor-pointer transition-colors" 
                            data-covenant-description="Maintain minimum debt service coverage ratio of 1.5x measured quarterly" 
                            data-covenant-number="COV-2024-001" 
                            data-due-date="31/03/2024" 
                            data-status="Past Due (15d)">
                            <td class="px-6 py-4">
                                <span class="bg-purple-100 text-purple-700 rounded-full px-3 py-1 text-sm font-medium">NAM</span>
                            </td>
                            <td class="px-6 py-4 text-sm font-medium text-gray-900">COV-2024-001</td>
                            <td class="px-6 py-4 text-sm text-gray-700">31/03/2024</td>
                            <td class="px-6 py-4">
                                <span class="bg-red-50 text-red-600 rounded-full px-3 py-1 text-sm font-medium">Past Due (15d)</span>
                            </td>
                        </tr>
                        <tr class="hover:bg-gray-50 cursor-pointer transition-colors" 
                            data-covenant-description="Submit audited financial statements within 90 days of fiscal year end" 
                            data-covenant-number="COV-2024-002" 
                            data-due-date="30/06/2024" 
                            data-status="Coming Due (45d)">
                            <td class="px-6 py-4">
                                <span class="bg-amber-100 text-amber-700 rounded-full px-3 py-1 text-sm font-medium">EMEA</span>
                            </td>
                            <td class="px-6 py-4 text-sm font-medium text-gray-900">COV-2024-002</td>
                            <td class="px-6 py-4 text-sm text-gray-700">30/06/2024</td>
                            <td class="px-6 py-4">
                                <span class="bg-yellow-50 text-yellow-600 rounded-full px-3 py-1 text-sm font-medium">Coming Due (45d)</span>
                            </td>
                        </tr>
                        <tr class="hover:bg-gray-50 cursor-pointer transition-colors" 
                            data-covenant-description="Tangible net worth shall not be less than $10 million at any time during the loan period" 
                            data-covenant-number="COV-2024-003" 
                            data-due-date="31/12/2024" 
                            data-status="Coming Due (120d)">
                            <td class="px-6 py-4">
                                <span class="bg-emerald-100 text-emerald-700 rounded-full px-3 py-1 text-sm font-medium">APAC</span>
                            </td>
                            <td class="px-6 py-4 text-sm font-medium text-gray-900">COV-2024-003</td>
                            <td class="px-6 py-4 text-sm text-gray-700">31/12/2024</td>
                            <td class="px-6 py-4">
                                <span class="bg-yellow-50 text-yellow-600 rounded-full px-3 py-1 text-sm font-medium">Coming Due (120d)</span>
                            </td>
                        </tr>
                        <tr class="hover:bg-gray-50 cursor-pointer transition-colors" 
                            data-covenant-description="Borrower shall maintain insurance coverage on all assets with minimum coverage amounts as specified in schedule A" 
                            data-covenant-number="COV-2024-004" 
                            data-due-date="31/01/2025" 
                            data-status="Current">
                            <td class="px-6 py-4">
                                <span class="bg-blue-100 text-blue-700 rounded-full px-3 py-1 text-sm font-medium">LATAM</span>
                            </td>
                            <td class="px-6 py-4 text-sm font-medium text-gray-900">COV-2024-004</td>
                            <td class="px-6 py-4 text-sm text-gray-700">31/01/2025</td>
                            <td class="px-6 py-4">
                                <span class="bg-green-50 text-green-600 rounded-full px-3 py-1 text-sm font-medium">Current</span>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Debug Info -->
        <div class="mt-8 p-4 bg-gray-100 border border-gray-300 rounded-lg">
            <h3 class="text-lg font-semibold text-gray-900 mb-2">Debug Info:</h3>
            <div id="debugInfo" class="text-sm text-gray-700 font-mono max-h-64 overflow-y-auto"></div>
        </div>
    </div>

    <script>
        // ===== CUSTOM TOOLTIP FUNCTIONALITY =====
        let tooltipElement = null;
        let currentRow = null;
        let hideTimeout = null;
        const debugInfo = document.getElementById('debugInfo');

        function log(message) {
            console.log(message);
            debugInfo.innerHTML += message + '<br>';
            // Auto-scroll debug panel
            debugInfo.scrollTop = debugInfo.scrollHeight;
        }

        // Initialize tooltip element
        function initTooltip() {
            if (!tooltipElement) {
                tooltipElement = document.createElement('div');
                tooltipElement.className = 'custom-tooltip';
                document.body.appendChild(tooltipElement);
                log('‚úÖ Tooltip element created and added to body');
            }
        }

        // Show tooltip with content
        function showTooltip(element, content) {
            if (!tooltipElement) initTooltip();

            // Clear any pending hide timeout
            if (hideTimeout) {
                clearTimeout(hideTimeout);
                hideTimeout = null;
            }

            currentRow = element;
            tooltipElement.innerHTML = content;
            
            // Use requestAnimationFrame to ensure DOM is ready
            requestAnimationFrame(() => {
                tooltipElement.classList.add('show');
                positionTooltip(element);
                log('üìç Showing tooltip');
            });
        }

        // Hide tooltip with delay
        function hideTooltip() {
            // Clear any existing timeout
            if (hideTimeout) {
                clearTimeout(hideTimeout);
            }

            // Add a small delay before hiding to prevent flickering
            hideTimeout = setTimeout(() => {
                if (tooltipElement) {
                    tooltipElement.classList.remove('show');
                    currentRow = null;
                    log('‚ùå Hiding tooltip');
                }
            }, 100); // 100ms delay
        }

        // Position tooltip relative to element
        function positionTooltip(element) {
            const rect = element.getBoundingClientRect();
            
            // Force the tooltip to be visible first to get accurate measurements
            tooltipElement.style.visibility = 'hidden';
            tooltipElement.style.display = 'block';
            
            const tooltipRect = tooltipElement.getBoundingClientRect();
            
            tooltipElement.style.visibility = '';
            tooltipElement.style.display = '';

            // Use viewport coordinates (fixed positioning)
            // Calculate position (show above element by default)
            let top = rect.top - tooltipRect.height - 8;
            let left = rect.left + (rect.width / 2) - (tooltipRect.width / 2);

            // Check if tooltip goes off screen top
            if (top < 10) {
                // Show below if no space above
                top = rect.bottom + 8;
            }

            // Prevent going off left edge
            if (left < 10) {
                left = 10;
            }

            // Prevent going off right edge
            const maxLeft = window.innerWidth - tooltipRect.width - 10;
            if (left > maxLeft) {
                left = maxLeft;
            }

            tooltipElement.style.top = top + 'px';
            tooltipElement.style.left = left + 'px';
        }

        // Event handler for facility row enter
        function handleFacilityRowEnter(e) {
            const row = e.target.closest('tr[data-facility-type]');
            if (!row) return;
            
            // Prevent duplicate events for the same row
            if (currentRow === row) return;

            const facilityType = row.getAttribute('data-facility-type');
            log(`üîç Facility row entered: ${facilityType}`);

            if (facilityType) {
                const content = `
                    <div class="custom-tooltip-title">Facility Details</div>
                    <div class="custom-tooltip-content">
                        <div class="custom-tooltip-row"><strong>Facility Type:</strong> ${facilityType}</div>
                    </div>
                `;
                showTooltip(row, content);
            }
        }

        // Event handler for facility row leave
        function handleFacilityRowLeave(e) {
            const row = e.target.closest('tr[data-facility-type]');
            if (!row) return;
            
            // Only hide if we're leaving the current row
            if (currentRow === row) {
                hideTooltip();
            }
        }

        // Event handler for covenant row enter
        function handleCovenantRowEnter(e) {
            const row = e.target.closest('tr[data-covenant-description]');
            if (!row) return;
            
            // Prevent duplicate events for the same row
            if (currentRow === row) return;

            const description = row.getAttribute('data-covenant-description');
            log(`üîç Covenant row entered: ${description.substring(0, 50)}...`);
            
            if (description) {
                const content = `
                    <div class="custom-tooltip-title">Covenant Details</div>
                    <div class="custom-tooltip-content">
                        <div class="custom-tooltip-row"><strong>Description:</strong> ${description}</div>
                    </div>
                `;
                showTooltip(row, content);
            }
        }

        // Event handler for covenant row leave
        function handleCovenantRowLeave(e) {
            const row = e.target.closest('tr[data-covenant-description]');
            if (!row) return;
            
            // Only hide if we're leaving the current row
            if (currentRow === row) {
                hideTooltip();
            }
        }

        // Generic event handler for row mouse move
        function handleRowMove(e) {
            const row = e.target.closest('tr[data-facility-type], tr[data-covenant-description]');
            if (row && tooltipElement && tooltipElement.classList.contains('show')) {
                positionTooltip(row);
            }
        }

        // Add tooltip event listeners for facilities table
        function addFacilityTooltips() {
            const tbody = document.getElementById('facilitiesTable');
            if (!tbody) {
                log('‚ùå Facilities table not found');
                return;
            }

            log('üîß Adding facility tooltip listeners...');
            
            // Add event delegation listeners
            tbody.addEventListener('mouseenter', handleFacilityRowEnter, true);
            tbody.addEventListener('mouseleave', handleFacilityRowLeave, true);
            tbody.addEventListener('mousemove', handleRowMove, true);
            
            log('‚úÖ Facility tooltip listeners added');
        }

        // Add tooltip event listeners for covenants table
        function addCovenantTooltips() {
            const tbody = document.getElementById('covenantsTable');
            if (!tbody) {
                log('‚ùå Covenants table not found');
                return;
            }

            log('üîß Adding covenant tooltip listeners...');
            
            // Add event delegation listeners
            tbody.addEventListener('mouseenter', handleCovenantRowEnter, true);
            tbody.addEventListener('mouseleave', handleCovenantRowLeave, true);
            tbody.addEventListener('mousemove', handleRowMove, true);
            
            log('‚úÖ Covenant tooltip listeners added');
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', () => {
            log('üöÄ Page loaded, initializing tooltips...');
            initTooltip();
            addFacilityTooltips();
            addCovenantTooltips();
            log('‚úÖ Initialization complete! Hover over table rows to test.');
        });
    </script>
</body>
</html>

